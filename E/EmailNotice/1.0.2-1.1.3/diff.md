# Comparing `tmp/EmailNotice-1.0.2-py3-none-any.whl.zip` & `tmp/EmailNotice-1.1.3-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,8 +1,8 @@
-Zip file size: 45777 bytes, number of entries: 60
+Zip file size: 48270 bytes, number of entries: 60
 -rw-rw-rw-  2.0 fat        0 b- defN 23-Feb-17 10:05 era/__init__.py
 -rw-rw-rw-  2.0 fat    10677 b- defN 23-Apr-07 09:38 era/Assets/refresh-icon.png
 -rw-rw-rw-  2.0 fat        0 b- defN 23-Feb-25 07:10 era/Database/__init__.py
 -rw-rw-rw-  2.0 fat        0 b- defN 23-Feb-20 15:27 era/Database/Dao/__init__.py
 -rw-rw-rw-  2.0 fat        0 b- defN 23-Feb-20 15:26 era/Database/Dao/emailAccountDao.py
 -rw-rw-rw-  2.0 fat        0 b- defN 23-Feb-23 15:47 era/Database/Dao/emailTemplateDao.py
 -rw-rw-rw-  2.0 fat        0 b- defN 23-Feb-21 15:14 era/Database/Impl/__init__.py
@@ -15,23 +15,23 @@
 -rw-rw-rw-  2.0 fat        0 b- defN 23-Feb-20 15:29 era/Database/Repository/__init__.py
 -rw-rw-rw-  2.0 fat     1513 b- defN 23-Mar-26 14:47 era/Database/Repository/baseDatabaaseRepository.py
 -rw-rw-rw-  2.0 fat     3051 b- defN 23-Apr-07 08:07 era/Database/Repository/databaseRepository.py
 -rw-rw-rw-  2.0 fat     9988 b- defN 23-Apr-07 08:21 era/Database/Repository/sqliteRepository.py
 -rw-rw-rw-  2.0 fat        0 b- defN 22-Nov-19 09:15 era/Logger/__init__.py
 -rw-rw-rw-  2.0 fat     1320 b- defN 23-Mar-19 15:29 era/Logger/logger.py
 -rw-rw-rw-  2.0 fat        0 b- defN 23-Feb-20 15:07 era/Service/__init__.py
--rw-rw-rw-  2.0 fat     2660 b- defN 23-Apr-12 15:09 era/Service/emailService.py
+-rw-rw-rw-  2.0 fat     7627 b- defN 23-Apr-29 13:27 era/Service/emailService.py
 -rw-rw-rw-  2.0 fat     3963 b- defN 23-Apr-12 15:10 era/Utility/ConfigUtility.py
--rw-rw-rw-  2.0 fat      620 b- defN 23-Mar-25 09:11 era/Utility/FileUtility.py
--rw-rw-rw-  2.0 fat    11196 b- defN 23-Apr-12 14:22 era/Utility/StringUtilityCTK.py
+-rw-rw-rw-  2.0 fat     1693 b- defN 23-Apr-29 13:19 era/Utility/FileUtility.py
+-rw-rw-rw-  2.0 fat    11979 b- defN 23-May-01 11:39 era/Utility/StringUtilityCTK.py
 -rw-rw-rw-  2.0 fat        0 b- defN 23-Feb-21 15:05 era/Utility/__init__.py
 -rw-rw-rw-  2.0 fat        0 b- defN 23-Feb-20 15:15 era/View/__init__.py
--rw-rw-rw-  2.0 fat    10902 b- defN 23-Mar-28 15:32 era/View/edit_email_list_top_level.py
--rw-rw-rw-  2.0 fat    16075 b- defN 23-Mar-26 15:26 era/View/edit_template_top_level.py
--rw-rw-rw-  2.0 fat    13393 b- defN 23-Apr-09 08:02 era/View/main_view.py
+-rw-rw-rw-  2.0 fat    10958 b- defN 23-May-01 11:38 era/View/edit_email_list_top_level.py
+-rw-rw-rw-  2.0 fat    16130 b- defN 23-May-01 11:38 era/View/edit_template_top_level.py
+-rw-rw-rw-  2.0 fat    20069 b- defN 23-May-01 11:40 era/View/main_view.py
 -rw-rw-rw-  2.0 fat        0 b- defN 23-Feb-17 10:05 src/__init__.py
 -rw-rw-rw-  2.0 fat        0 b- defN 23-Feb-25 07:10 src/Database/__init__.py
 -rw-rw-rw-  2.0 fat        0 b- defN 23-Feb-20 15:27 src/Database/Dao/__init__.py
 -rw-rw-rw-  2.0 fat        0 b- defN 23-Feb-20 15:26 src/Database/Dao/emailAccountDao.py
 -rw-rw-rw-  2.0 fat        0 b- defN 23-Feb-23 15:47 src/Database/Dao/emailTemplateDao.py
 -rw-rw-rw-  2.0 fat        0 b- defN 23-Feb-21 15:14 src/Database/Impl/__init__.py
 -rw-rw-rw-  2.0 fat        0 b- defN 23-Feb-21 15:14 src/Database/Impl/emailAccountDaoImpl.py
@@ -51,12 +51,12 @@
 -rw-rw-rw-  2.0 fat     1166 b- defN 23-Jan-09 08:16 src/Utility/ConfigUtility.py
 -rw-rw-rw-  2.0 fat     7134 b- defN 23-Mar-19 15:11 src/Utility/StringUtilityCTK.py
 -rw-rw-rw-  2.0 fat        0 b- defN 23-Feb-21 15:05 src/Utility/__init__.py
 -rw-rw-rw-  2.0 fat        0 b- defN 23-Feb-20 15:15 src/View/__init__.py
 -rw-rw-rw-  2.0 fat    16050 b- defN 23-Mar-19 15:14 src/View/edit_template_top_level.py
 -rw-rw-rw-  2.0 fat     7989 b- defN 23-Mar-19 15:00 src/View/main_view.py
 -rw-rw-rw-  2.0 fat      147 b- defN 23-Feb-19 10:04 src/View/testHtml.py
--rw-rw-rw-  2.0 fat      532 b- defN 23-Apr-13 15:19 EmailNotice-1.0.2.dist-info/METADATA
--rw-rw-rw-  2.0 fat       92 b- defN 23-Apr-13 15:19 EmailNotice-1.0.2.dist-info/WHEEL
--rw-rw-rw-  2.0 fat        4 b- defN 23-Apr-13 15:19 EmailNotice-1.0.2.dist-info/top_level.txt
-?rw-rw-r--  2.0 fat     5166 b- defN 23-Apr-13 15:19 EmailNotice-1.0.2.dist-info/RECORD
-60 files, 141460 bytes uncompressed, 37413 bytes compressed:  73.6%
+-rw-rw-rw-  2.0 fat      532 b- defN 23-May-01 11:41 EmailNotice-1.1.3.dist-info/METADATA
+-rw-rw-rw-  2.0 fat       92 b- defN 23-May-01 11:41 EmailNotice-1.1.3.dist-info/WHEEL
+-rw-rw-rw-  2.0 fat        4 b- defN 23-May-01 11:41 EmailNotice-1.1.3.dist-info/top_level.txt
+?rw-rw-r--  2.0 fat     5167 b- defN 23-May-01 11:41 EmailNotice-1.1.3.dist-info/RECORD
+60 files, 155071 bytes uncompressed, 39906 bytes compressed:  74.3%
```

## zipnote {}

```diff
@@ -162,20 +162,20 @@
 
 Filename: src/View/main_view.py
 Comment: 
 
 Filename: src/View/testHtml.py
 Comment: 
 
-Filename: EmailNotice-1.0.2.dist-info/METADATA
+Filename: EmailNotice-1.1.3.dist-info/METADATA
 Comment: 
 
-Filename: EmailNotice-1.0.2.dist-info/WHEEL
+Filename: EmailNotice-1.1.3.dist-info/WHEEL
 Comment: 
 
-Filename: EmailNotice-1.0.2.dist-info/top_level.txt
+Filename: EmailNotice-1.1.3.dist-info/top_level.txt
 Comment: 
 
-Filename: EmailNotice-1.0.2.dist-info/RECORD
+Filename: EmailNotice-1.1.3.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## era/Service/emailService.py

```diff
@@ -1,16 +1,30 @@
+from email.mime.application import MIMEApplication
+from email.mime.image import MIMEImage
 from email.mime.multipart import MIMEMultipart
 from email.mime.text import MIMEText
+from string import Template
 from era.Database.Model.emailTemplateModel import EmailTemplateModel
 from era.Database.Model.recipientModel import RecipientModel
 from era.Utility.ConfigUtility import GetConfigSingletion
 from era.Logger.logger import Logger
 import smtplib, ssl
+import os
 
 class EmailService:
+
+    # 0 - EMail Matching
+    # 1 - Attachment
+    # 2 - CC
+    # 3 - BCC
+    # 4 - Subject (To override template value)
+    # 5 - All customer data
+    __CUSTOMER_DATA_START_IDX = 5
+
+
     def __init__(self) -> None:
         self.config_obj = GetConfigSingletion()
         self.logger = Logger()
         self.emailServer = None
         self.emailContext = ssl.create_default_context()
         self.isLogin = False
         pass
@@ -44,46 +58,161 @@
             self.isLogin = False
         finally:
             return self.isLogin
         
     def DisconnectEmailAccount(self):
         pass
 
-    def SendEmail(self,emailList:list[RecipientModel], template:EmailTemplateModel) -> list[str]:
+    def SendEmail(self,emailList:list[RecipientModel], template:EmailTemplateModel, attachmentData:list) -> list[str]:
         sendError = []
 
         for recipient in emailList:
             try:
                 mimemsg = MIMEMultipart()
 
                 mimemsg['From']=self.config_obj.ReadConfig('email','emailAc')
                 mimemsg['To']=recipient.GetRecipientEMail()
                 mimemsg['Subject']=template.GetSubject()
 
-                file = open(template.GetPath(),encoding="utf-8")#append mode 
-                templateData = file.read()
-                file.close()
-
+                # file = open(template.GetPath(),encoding="utf-8")#append mode 
+                # templateData = file.read()
+                # file.close()
+                if attachmentData != None:
+                    templateData = self.FormatEmailTemplateWithData(recipient.GetRecipientEMail(),attachData=attachmentData,emailTemplate=template)
+                    mimemsg = self.__AddSelfAttachment(recipient.GetRecipientEMail(),attachData=attachmentData,emailTemplate=template,emailObject=mimemsg)
+                    mimemsg = self.__AddCCandBCC(recipient.GetRecipientEMail(),emailObject=mimemsg,attachData=attachmentData)
+                else:
+                    file = open(template.GetPath(),encoding="utf-8")#append mode 
+                    templateData = file.read()
+                    file.close()
                 mimemsg.attach(MIMEText(templateData, 'plain'))
-
+                self.ConnectEmailAccount()
                 self.emailServer.send_message(mimemsg)
-            except:
+            except Exception as ex:
+                print(str(ex))
                 sendError.append(recipient.GetRecipientEMail())
         
         return sendError
+    
 
     def GetEmailAccount(self)->str:
         try:
             return self.config_obj.ReadConfig('email','emailAc')
         except:
             return ""
 
+    def FormatEmailTemplateWithData(self,email:str, attachData:list ,emailTemplate: EmailTemplateModel) -> str:
+        headerData = attachData[0]
+        matchData = None
+        for data in attachData:
+            try:
+                data.index(email)
+                matchData = data
+                break
+            except ValueError:
+                continue 
+        
+        if matchData == None:
+            return None
 
+        mapData = {}
+        for idx,header in enumerate(headerData[self.__CUSTOMER_DATA_START_IDX:],start=self.__CUSTOMER_DATA_START_IDX):
+            mapData[headerData[idx]] = matchData[idx]
+
+        if emailTemplate != None:
+            file = open(emailTemplate.GetPath(),encoding="utf-8")#append mode 
+            sample = Template(file.read()).substitute(mapData)
+            file.close()
+            return sample
+        else:
+            return None
+
+    def __AddSelfAttachment(self,email:str, attachData:list ,emailTemplate: EmailTemplateModel, emailObject:MIMEMultipart) ->MIMEMultipart:
+
+        #No need to attach anything
+        if not emailTemplate.GetContainAttachment() and not emailTemplate.GetContainData():
+            return emailObject
 
-    #Private function
-    def __AttachSelfData(self):
-        pass
+        matchData = None
+        for data in attachData:
+            try:
+                data.index(email)
+                matchData = data
+                break
+            except ValueError:
+                continue 
+        
+        #Cannot email which email address belongs to
+        if matchData == None:
+            return emailObject
+
+        totalPath = matchData[1]
+        if totalPath == totalPath:
+            totalPath = totalPath.split(";")
+            for path in totalPath:
+                self.__FormAttachmentObject(filePath=path,emailObject=emailObject)
+        
 
-    def __AddSelfAttachment(self):
-        pass
+        #Check if override subject
+        customSubject = matchData[4]
+        if customSubject == customSubject:
+            emailObject['Subject']=customSubject
+        
+        return emailObject
+
+    def __FormAttachmentObject(self,filePath:str,emailObject:MIMEMultipart):
+        fileName = os.path.basename(filePath)
+
+        name, file_extension = os.path.splitext(filePath)
+
+        if file_extension in ['.png','jpeg','.jpg']:
+            with open(filePath, 'rb') as fp:
+                img = MIMEImage(fp.read())
+                img.add_header('Content-Disposition', 'attachment', filename=fileName)
+                emailObject.attach(img)
+        else:
+            pdf = MIMEApplication(open(filePath, 'rb').read())
+            pdf.add_header('Content-Disposition', 'attachment', filename= fileName)
+            emailObject.attach(pdf)        
+
+        
+        return emailObject
+    
+    def GetAttachmentListByEmail(self, email:str, attachData:list)->list:
+        headerData = attachData[0]
+        matchData = None
+        for data in attachData:
+            try:
+                data.index(email)
+                matchData = data
+                break
+            except ValueError:
+                continue 
+
+        return matchData
+    
+    def __AddCCandBCC(self,email:str,emailObject:MIMEMultipart,attachData:list)->MIMEMultipart:
+        if attachData == None:
+            return emailObject
+        else:
+            matchData = None
+            for data in attachData:
+                try:
+                    data.index(email)
+                    matchData = data
+                    break
+                except ValueError:
+                    continue 
+            
+            #Cannot email which email address belongs to
+            if matchData == None:
+                return emailObject
+            
+            ccList = matchData[2]
+            if ccList == ccList:
+                emailObject['Cc']  = ccList
+
+            bccList = matchData[3]
+            if bccList == bccList:
+                emailObject['Bcc']  = bccList    
 
-    pass
+            return emailObject
```

## era/Utility/FileUtility.py

```diff
@@ -1,22 +1,49 @@
 import pandas as pd
+from typing import Any, Callable
 
 class _FileUtilitySingletion():
+    _default_Header_list = 5
     _fileInstance = None
+    _emailHeader = "Email"
+    _attachmentHeader = "AttachmentPath"
+    _ccListHeader = "CC"
+    _bccListHeader = "BCC"
+    _subjectHeader = "Subject"
 
     def __init__(self) -> None:
         pass
 
 
     def ReadEmailList(self,path):
         try:
             recipient_no_col = pd.read_excel(path,usecols='A:E',header=0,dtype=str)
             policy_no_list = recipient_no_col.values.tolist()
             return policy_no_list
         except:
             return None
+        
+    def ReadAttachmentList(self,path:str,callBack:Callable[[list], Any]):
+        try:
+            recipient_no_col = pd.read_excel(path,dtype=str)
+            policy_no_list = [recipient_no_col.columns.ravel().tolist()]
+            policy_no_list += recipient_no_col.values.tolist()
+            callBack(policy_no_list)
+            return
+        except:
+            callBack(None)
+            return
+    
+    def CheckAttachmentFormat(self, data :list) -> bool:
+        header = data[0]
+        if len(header) < self._default_Header_list:
+            return False
+        elif header[0] == self._emailHeader and header[1] == self._attachmentHeader and header[2] == self._ccListHeader and header[3] == self._bccListHeader and header[4] == self._subjectHeader:
+            return True
+        else:
+            return False
 
 
 def GetFileUtilitySingletion():
     if _FileUtilitySingletion._fileInstance is None:
         _FileUtilitySingletion._fileInstance = _FileUtilitySingletion()
     return _FileUtilitySingletion._fileInstance
```

## era/Utility/StringUtilityCTK.py

```diff
@@ -65,15 +65,21 @@
         "新增電郵組別失敗",
 
         "請重試。",
 
         "傳送成功",
         "以下電郵傳效失敗：",
 
-        "登入電郵系統失敗，請重試。"
+        "登入電郵系統失敗，請重試。",
+        "數據/附件格式錯誤，請重試。",
+        "確認傳送{0}封電郵？",
+
+        "請輸入附上數據或附件。"
+
+        ""
     ]
 
     enString = [
         "Status: ",
         "Offline",
         "Online",
         "Email AC: ",
@@ -131,15 +137,19 @@
         "Create Email List Failed",
 
         "Please retry",
 
         "Send Success",
         "Below email address send failed:",
 
-        "Login Email Failed, Please try again."
+        "Login Email Failed, Please try again.",
+        "Attachment format error, Please try again.",
+        "Confirm send {0} email?",
+
+        "Please add attachment or data."
     ]
 
     def __init__(self) -> None:
         self.status = StringVar()
         self.offline = StringVar()
         self.online = StringVar()
         self.emailAC = StringVar()
@@ -200,14 +210,18 @@
 
         self.retry = StringVar()
 
         self.sendSuccess = StringVar()
         self.sendFailed = StringVar()
 
         self.loginFailed = StringVar()
+        self.attachmentFormatError = StringVar()
+        self.sendConfirm = StringVar()
+
+        self.missingAttachment = StringVar()
         
 
         self.SetString()
         pass
 
     def SetString(self):
         self.config = GetConfigSingletion()
@@ -261,14 +275,17 @@
             self.errorInputListName.set(self.zhString[41])
             self.createEmailListSuccess.set(self.zhString[42])
             self.createEmailListFailed.set(self.zhString[43])
             self.retry.set(self.zhString[44])
             self.sendSuccess.set(self.zhString[45])
             self.sendFailed.set(self.zhString[46])
             self.loginFailed.set(self.zhString[47])
+            self.attachmentFormatError.set(self.zhString[48])
+            self.sendConfirm.set(self.zhString[49])
+            self.missingAttachment.set(self.zhString[50])
 
 
         else:
             self.status.set(self.enString[0])
             self.offline.set(self.enString[1])
             self.online.set(self.enString[2])
             self.emailAC.set(self.enString[3])
@@ -312,14 +329,19 @@
             self.errorInputListName.set(self.enString[41])
             self.createEmailListSuccess.set(self.enString[42])
             self.createEmailListFailed.set(self.enString[43])
             self.retry.set(self.enString[44])
             self.sendSuccess.set(self.enString[45])
             self.sendFailed.set(self.enString[46])
             self.loginFailed.set(self.enString[47])
+            self.attachmentFormatError.set(self.enString[48])
+            self.sendConfirm.set(self.enString[49])
+            self.missingAttachment.set(self.enString[50])
+
+
 
 
 
 def GetStringSingletionCTK():
     if _StringSingletonCTK._stringInstance is None:
         _StringSingletonCTK._stringInstance = _StringSingletonCTK()
```

## era/View/edit_email_list_top_level.py

```diff
@@ -23,14 +23,15 @@
         self.config_obj = GetConfigSingletion()
         self.stringVar = GetStringSingletionCTK()
         self.database = GetDBRepositorySingletion()
         self.fileUtility = GetFileUtilitySingletion()
         self.geometry(f'+{xPos}+{yPos}')
         self.geometry("800x900")
         self.operationType = self.__None
+        self.title(self.stringVar.editEmailList.get())
 
         customtkinter.CTkFrame.rowconfigure(self,0)
 
         customtkinter.CTkFrame.columnconfigure(self,0,weight=1)
         customtkinter.CTkFrame.columnconfigure(self,1,weight=1)
         customtkinter.CTkFrame.columnconfigure(self,2,weight=1)
```

## era/View/edit_template_top_level.py

```diff
@@ -23,14 +23,15 @@
 
         self.config_obj = GetConfigSingletion()
         self.stringVar = GetStringSingletionCTK()
         self.database = GetDBRepositorySingletion()
         self.geometry(f'+{xPos}+{yPos}')
         self.geometry("800x900")
         self.operationType = self.__None
+        self.title(self.stringVar.editTemplate.get())
 
         customtkinter.CTkFrame.rowconfigure(self,0)
         # customtkinter.CTkFrame.rowconfigure(self,1)
         # customtkinter.CTkFrame.rowconfigure(self,2)
         # customtkinter.CTkFrame.rowconfigure(self,3)
         # customtkinter.CTkFrame.rowconfigure(self,4)
         # customtkinter.CTkFrame.rowconfigure(self,5,weight=10)
```

## era/View/main_view.py

```diff
@@ -1,51 +1,54 @@
 
 import threading
 import customtkinter
-from tkinter import DISABLED, NORMAL, messagebox ,ttk
-
+from tkinter import DISABLED, NORMAL, filedialog, messagebox ,ttk
 from PIL import Image
-
 from pkg_resources import resource_stream
+from era.Database.Model.recipientModel import RecipientModel
 from era.Database.Repository.databaseRepository import GetDBRepositorySingletion
-
 from era.Service.emailService import EmailService
 from era.Logger.logger import Logger
 from era.Utility.ConfigUtility import GetConfigSingletion
 from era.Utility.StringUtilityCTK import GetStringSingletionCTK
+from era.Utility.FileUtility import GetFileUtilitySingletion
 from era.View.edit_email_list_top_level import EditEmailListTopLevel
 from era.View.edit_template_top_level import EditTemplateTopLevel
+from string import Template
 
 class MainView(customtkinter.CTkFrame):
 
     editTemplateTopLevel = None
     editEmailTopLevel = None
     _selectedEmailTemplate = None
     _selectedEmailGroup = None
+    _attachedData = None
 
     def __init__(self,app):
         super().__init__(master=app,corner_radius=0, fg_color="transparent")
         self.grid_columnconfigure(0, weight=1)
         customtkinter.CTkFrame.rowconfigure(self,0)
         customtkinter.CTkFrame.rowconfigure(self,1)
         customtkinter.CTkFrame.rowconfigure(self,2)
         customtkinter.CTkFrame.rowconfigure(self,3,weight=10)
         customtkinter.CTkFrame.rowconfigure(self,4)
         customtkinter.CTkFrame.rowconfigure(self,5)
+        customtkinter.CTkFrame.rowconfigure(self,6)
 
-        customtkinter.CTkFrame.columnconfigure(self,0,weight=1)
-        customtkinter.CTkFrame.columnconfigure(self,1,weight=1)
-        customtkinter.CTkFrame.columnconfigure(self,2,weight=1)
-        customtkinter.CTkFrame.columnconfigure(self,3,weight=1)
+        customtkinter.CTkFrame.columnconfigure(self,0,weight=1,uniform="fred")
+        customtkinter.CTkFrame.columnconfigure(self,1,weight=1,uniform="fred")
+        customtkinter.CTkFrame.columnconfigure(self,2,weight=1,uniform="fred")
+        customtkinter.CTkFrame.columnconfigure(self,3,weight=1,uniform="fred")
 
         self.emailService = EmailService()
         self.logger = Logger()
         self.configParser = GetConfigSingletion()
         self.stringValue = GetStringSingletionCTK()
         self.database = GetDBRepositorySingletion()
+        self.fileUtility = GetFileUtilitySingletion()
 
 
         #ROW0
         # self.emailAc = customtkinter.CTkOptionMenu(self,values=["Gmail", "Microsoft"],dynamic_resizing=False)
         # self.emailAc.grid(row=0, column=0, pady = 10, padx = 10, sticky="nsew")
         self.emailAcLabel = customtkinter.CTkLabel(self, text=self.stringValue.emailAC.get()+self.emailService.GetEmailAccount(),font=("Arial bold", 15))
         self.emailAcLabel.grid(row=0, column=0, pady = 10, padx = 10,sticky="w")
@@ -70,16 +73,16 @@
         # self.editEmail.grid(row=0, column=3, pady = 10, padx = 10,sticky="nsew")
 
 
         #ROW1
         self.template = customtkinter.CTkOptionMenu(self,values=self.database.GetAllEmailTemplateName(),command=self._OnSelectEmailTemplate,dynamic_resizing=False)
         self.template.grid(row=1, column=0, pady = 10, padx = 10, sticky="nsew")
 
-        # self.attachData = customtkinter.CTkButton(self,text = self.stringValue.attachData.get())
-        # self.attachData.grid(row=1, column=1, pady = 10, padx = 10,sticky="nsew")
+        self.attachData = customtkinter.CTkButton(self,text = self.stringValue.attachData.get(),command=self.__ReadAttachmentData)
+        self.attachData.grid(row=1, column=1, pady = 10, padx = 10,sticky="nsew")
 
         self.editEmail = customtkinter.CTkButton(self,text = self.stringValue.editTemplate.get(),command=self._CreateEditTemplateTopLevel)
         self.editEmail.grid(row=1, column=3, pady = 10, padx = 10,sticky="nsew")
 
 
         #ROW2
         self.recipient = customtkinter.CTkOptionMenu(self,values=self.database.GetAllRecipientGroupName(),command=self._OnSelectEmailList,dynamic_resizing=False)
@@ -90,26 +93,28 @@
 
 
         #ROW3
         self.leftFrame = customtkinter.CTkFrame(self)
         self.leftFrame.grid(row=3, column=0, columnspan=2, padx=(10,5), pady=(10,0), sticky="nsew")
 
         self.tree = ttk.Treeview(self.leftFrame,show='headings')
-        self.tree["column"]=("fullNameEn","fullNameZh","displayNameEn","displayNameZh","recipientEmail")
+        self.tree.bind("<Double-1>", self.__OnDoubleClickRecipient)
+        #self.tree["column"]=("fullNameEn","fullNameZh","displayNameEn","displayNameZh","recipientEmail")
+        self.tree["column"]=("fullNameEn","fullNameZh","recipientEmail")
         self.tree.grid(row=0,column=0,rowspan=2,sticky='nsew')
         col_width = self.tree.winfo_width()
         self.tree.column("fullNameEn",width=col_width)
         self.tree.column("fullNameZh",width=col_width)
-        self.tree.column("displayNameEn",width=col_width)
-        self.tree.column("displayNameZh",width=col_width)
+        # self.tree.column("displayNameEn",width=col_width)
+        # self.tree.column("displayNameZh",width=col_width)
         self.tree.column("recipientEmail",width=col_width)
         self.tree.heading("fullNameEn",text=self.stringValue.fullNameEn.get())
         self.tree.heading("fullNameZh",text=self.stringValue.fullNameZh.get())
-        self.tree.heading("displayNameEn",text=self.stringValue.displayNameEn.get())
-        self.tree.heading("displayNameZh",text=self.stringValue.displayNameZh.get())
+        # self.tree.heading("displayNameEn",text=self.stringValue.displayNameEn.get())
+        # self.tree.heading("displayNameZh",text=self.stringValue.displayNameZh.get())
         self.tree.heading("recipientEmail",text=self.stringValue.recipientEmail.get())
 
         self.tree.pack(fill='both',expand=1)
 
         self.rightFrame = customtkinter.CTkFrame(self)
         self.rightFrame.grid(row=3, column=2, columnspan=2, padx=(5,10), pady=(10,0), sticky="nsew")
         self.rightFrame.grid_columnconfigure(0, weight=1)
@@ -117,23 +122,43 @@
 
         self.emailPreview = customtkinter.CTkTextbox(self.rightFrame)
         self.emailPreview.configure(state=DISABLED)
         self.emailPreview.grid(row=0, column=0,sticky="nsew")
 
 
         #ROW4
-        # self.attachmentStatus = customtkinter.CTkLabel(self, text=self.stringValue.attachment.get(),padx = 10)
-        # self.attachmentStatus.grid(row=4, column=3, columnspan=2,sticky="e")
+        self.attachmentLabel = customtkinter.CTkLabel(self, text=self.stringValue.attachment.get(),padx = 10)
+        self.attachmentLabel.grid(row=4, column=1,sticky="e")
+
+        self.attachmentVar = customtkinter.StringVar()
+        self.attachmentPath = customtkinter.CTkLabel(self, textvariable = self.attachmentVar,padx = 10)
+        self.attachmentPath.grid(row=4, column=2, columnspan = 2, sticky="nsew")
+
 
         #ROW5
+        self.ccLabel = customtkinter.CTkLabel(self, text="CC:",padx = 10)
+        self.ccLabel.grid(row=5, column=0,sticky="w")
+        self.ccVar = customtkinter.StringVar()
+        self.ccList = customtkinter.CTkLabel(self, textvariable = self.ccVar,padx = 10)
+        self.ccList.grid(row=5, column=1, sticky="nsew")
+
+
+        self.bccLabel = customtkinter.CTkLabel(self, text="BCC:",padx = 10)
+        self.bccLabel.grid(row=5, column=2,sticky="w")
+        self.bccVar = customtkinter.StringVar()
+        self.bccList = customtkinter.CTkLabel(self, textvariable = self.bccVar,padx = 10)
+        self.bccList.grid(row=5, column=3, sticky="nsew")
+
+
+        #ROW6
         self.sendEmail = customtkinter.CTkButton(self,text = self.stringValue.sendEmail.get(),command = self.__Send)
-        self.sendEmail.grid(row=5, column=2, pady = 10, padx = 10,sticky="nsew")
+        self.sendEmail.grid(row=6, column=2, pady = 10, padx = 10,sticky="nsew")
 
         self.clearEmail = customtkinter.CTkButton(master=self, text = self.stringValue.resetEmail.get(),fg_color="transparent", border_width=2, text_color=("gray10", "#DCE4EE"),command = self.__Clear)
-        self.clearEmail.grid(row=5, column=3, pady = 10, padx = 10,sticky="nsew")
+        self.clearEmail.grid(row=6, column=3, pady = 10, padx = 10,sticky="nsew")
         self.InitView()
 
     pass
 
 
     def InitView(self):
         if self.emailService.ConnectEmailAccount():
@@ -143,28 +168,26 @@
             self.emailLoginStatusString.set(self.stringValue.status.get()+self.stringValue.offline.get())
             pass
         pass
 
     def RefreshEmailLoginStatus(self):
         threading.Thread(target=self.__RefreshEmailLogin).start()
 
-
     def __RefreshEmailLogin(self):
         self.configParser.ReloadConfig()
         if self.emailService.ConnectEmailAccount():
             self.emailLoginStatusString.set(self.stringValue.status.get()+self.stringValue.online.get())
             #self.emailLoginStatus.after(100,self.emailLoginStatus.configure(text=self.stringValue.status.get()+self.stringValue.online.get()))
             pass
         else:
             self.emailLoginStatusString.set(self.stringValue.status.get()+self.stringValue.offline.get())
             #self.emailLoginStatus.after(100,self.emailLoginStatus.configure(text=self.stringValue.status.get()+self.stringValue.offline.get()))
             pass
         pass
 
-
     def _CreateEditTemplateTopLevel(self):
         if self.editTemplateTopLevel is None or not self.editTemplateTopLevel.winfo_exists():
             self.editTemplateTopLevel = EditTemplateTopLevel(xPos=self.winfo_rootx(),yPos=self.winfo_rooty())  # create window if its None or destroyed
             operation = self.editTemplateTopLevel.show()
 
             if operation != -1:
                 self.template.configure(values = self.database.GetAllEmailTemplateName()) 
@@ -206,79 +229,191 @@
             pass
         else:
             recipientList = self.database.GetRecipientByGroupName(choice)
 
             if recipientList != None and len(recipientList) > 0:
                 self._selectedEmailGroup = recipientList
                 for recipient in recipientList:
-                    self.tree.insert('','end',values=recipient.toList())
+                    self.tree.insert('','end',values=(recipient.GetFullNameEn(),recipient.GetFullNameZh(),recipient.GetRecipientEMail()))
                 pass
             else:
                 pass
 
-
     def __CreateEditEmailTopLevel(self):
         if self.editEmailTopLevel is None or not self.editEmailTopLevel.winfo_exists():
             self.editEmailTopLevel = EditEmailListTopLevel(xPos=self.winfo_rootx(),yPos=self.winfo_rooty())  # create window if its None or destroyed
             operation = self.editEmailTopLevel.show()
 
             if operation != -1:
                 self.recipient.configure(values = self.database.GetAllRecipientGroupName()) 
                 self.recipient.set(self.stringValue.defaultEmailGroup.get())
                 return
             else:
                 pass
         else:
             self.editEmailTopLevel.focus()  # if window exists focus it
+
+    def SetAttachmentDataList(self, attachment:list):
+        self._attachedData = attachment
+        if not self.fileUtility.CheckAttachmentFormat(attachment):
+            #prompt error
+            messagebox.showerror(self.stringValue.attachmentFormatError.get(), self.stringValue.attachmentFormatError.get())
+            return  
+        else:
+            #update the template for sample display
+            threading.Thread(target=self.__AttachementDataToTemplate).start()
+            pass
+
+    def __ReadAttachmentData(self):
+        if self._selectedEmailTemplate == None:
+            messagebox.showerror(self.stringValue.defaultTemplate.get(), self.stringValue.defaultTemplate.get())
+            return
+        
+        path = filedialog.askopenfilename()
+        if path == '':
+            return
+        else:
+            self.recipient.configure(state='disabled')
+            self.template.configure(state='disabled')
+            threading.Thread(target=self.fileUtility.ReadAttachmentList,args=(path,self.SetAttachmentDataList)).start()
+        pass
+
+    def __AttachementDataToTemplate(self):
+
+        if self._selectedEmailGroup == None:
+            #use the attached data's email list directly
+            self._selectedEmailGroup = [ RecipientModel("","","","",item[0]) for item in self._attachedData]
+            self._selectedEmailGroup.pop(0)
+            for recipient in self._selectedEmailGroup:
+                self.tree.insert('','end',values=(recipient.GetFullNameEn(),recipient.GetFullNameZh(),recipient.GetRecipientEMail()))
+
+            pass
+
+        sample = self.emailService.FormatEmailTemplateWithData(email=self._selectedEmailGroup[0].GetRecipientEMail(),attachData=self._attachedData,emailTemplate=self._selectedEmailTemplate)
+
+        if sample != None:
+            self.emailPreview.configure(state=NORMAL)
+            self.emailPreview.delete("0.0","end")
+            self.emailPreview.insert("0.0",sample)
+            self.emailPreview.configure(state=DISABLED)
+
+        self.tree.focus_set()
+        children = self.tree.get_children()
+        if children:
+            self.tree.focus(children[0])
+            self.tree.selection_set(children[0])   
+
+        attachData = self.emailService.GetAttachmentListByEmail(email=self._selectedEmailGroup[0].GetRecipientEMail(),attachData=self._attachedData)
+        if attachData != None:
+            attachementPath = attachData[1]
+            if attachementPath == attachementPath:
+                attachementPath = attachementPath.replace(';','\n')
+                self.attachmentVar.set(attachementPath)
+
+            ccList = attachData[2]
+            if ccList == ccList:
+                ccList = ccList.replace(';','\n')
+                self.ccVar.set(ccList)
+
+            bccList = attachData[3]
+            if bccList == bccList:
+                bccList = bccList.replace(';','\n')
+                self.bccVar.set(bccList)
+
     
+    def __OnDoubleClickRecipient(self, event):
+        selectedEmail = self.tree.item(self.tree.selection()[0],'values')[2]
+
+        sample = self.emailService.FormatEmailTemplateWithData(email=selectedEmail,attachData=self._attachedData,emailTemplate=self._selectedEmailTemplate)
+
+        if sample != None:
+            self.emailPreview.configure(state=NORMAL)
+            self.emailPreview.delete("0.0","end")
+            self.emailPreview.insert("0.0",sample)
+            self.emailPreview.configure(state=DISABLED)  
+
+        self.attachmentVar.set("")
+        self.bccVar.set("")
+        self.ccVar.set("")
+
+        attachData = self.emailService.GetAttachmentListByEmail(email=selectedEmail,attachData=self._attachedData)
+        if attachData != None:
+            attachementPath = attachData[1]
+            if attachementPath == attachementPath:
+                attachementPath = attachementPath.replace(';','\n')
+                self.attachmentVar.set(attachementPath)
+
+            ccList = attachData[2]
+            if ccList == ccList:
+                ccList = ccList.replace(';','\n')
+                self.ccVar.set(ccList)
+
+            bccList = attachData[3]
+            if bccList == bccList:
+                bccList = bccList.replace(';','\n')
+                self.bccVar.set(bccList)
+
+        pass
+
     def __Clear(self):
 
         self._selectedEmailTemplate = None
         self._selectedEmailGroup = None
+        self._attachedData = None
 
         self.template.set(self.stringValue.defaultTemplate.get())
         self.recipient.set(self.stringValue.defaultEmailGroup.get())
 
         self.emailPreview.configure(state=NORMAL)
         self.emailPreview.delete("0.0","end")
         self.emailPreview.configure(state=DISABLED)
         
         for i in self.tree.get_children():
             self.tree.delete(i)
+
+        self.attachmentVar.set("")
+        self.ccVar.set("")
+        self.bccVar.set("")
+        self.recipient.configure(state='normal')
+        self.template.configure(state='normal')
         pass
 
     def __Send(self):
         if not self.emailService.IsLogin():
             messagebox.showerror(self.stringValue.loginFailed.get(), self.stringValue.loginFailed.get())
             return
 
         if self._selectedEmailTemplate == None:
             messagebox.showerror(self.stringValue.defaultTemplate.get(), self.stringValue.defaultTemplate.get())
             return
         elif self._selectedEmailGroup == None or len(self._selectedEmailGroup) == 0:
             messagebox.showerror(self.stringValue.defaultEmailGroup.get(), self.stringValue.defaultEmailGroup.get())
             return
         
-        errorList = self.emailService.SendEmail(self._selectedEmailGroup,self._selectedEmailTemplate)
+        #required attachment but not included
+        elif self._selectedEmailTemplate != None and (self._selectedEmailTemplate.GetContainAttachment() or self._selectedEmailTemplate.GetContainData()) and self._attachedData == None:
+            messagebox.showerror(self.stringValue.missingAttachment.get(), self.stringValue.missingAttachment.get())
+            return
+        
+        if not messagebox.askokcancel(self.stringValue.sendConfirm.get().format(len(self._selectedEmailGroup)), self.stringValue.sendConfirm.get().format(len(self._selectedEmailGroup))):
+            return
+
+        errorList = self.emailService.SendEmail(self._selectedEmailGroup,self._selectedEmailTemplate,attachmentData=self._attachedData)
 
         if len(errorList) == 0:
             messagebox.showinfo(self.stringValue.sendSuccess.get(), self.stringValue.sendSuccess.get())
             return
         else:
             errorMessage = self.stringValue.sendFailed.get() + "\n"
             for emailAddr in errorList:
                 errorMessage += emailAddr + "\n"
-
             messagebox.showerror(self.stringValue.retry.get(), errorMessage)
             pass
 
         pass
-
-
-    
 # customtkinter.set_appearance_mode("Light")  # Modes: "System" (standard), "Dark", "Light"
 # customtkinter.set_default_color_theme("dark-blue")  # Themes: "blue" (standard), "green", "dark-blue"
 
 # app = customtkinter.CTk()
 # app.geometry("1000x1000")
 
 # # set grid layout 1x2
```

## Comparing `EmailNotice-1.0.2.dist-info/METADATA` & `EmailNotice-1.1.3.dist-info/METADATA`

 * *Files 2% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: EmailNotice
-Version: 1.0.2
+Version: 1.1.3
 Summary: GUI Application
 Home-page: 
 Author: HexBee
 Author-email: mat230821@hotmail.com
 Classifier: Programming Language :: Python :: 3
 Classifier: License :: OSI Approved :: MIT License
 Classifier: Operating System :: OS Independent
```

## Comparing `EmailNotice-1.0.2.dist-info/RECORD` & `EmailNotice-1.1.3.dist-info/RECORD`

 * *Files 5% similar despite different names*

```diff
@@ -14,23 +14,23 @@
 era/Database/Repository/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 era/Database/Repository/baseDatabaaseRepository.py,sha256=-WeuIzfneg5b2pADqQSW8Z4_PyUrTrcuXWcjebeHL8M,1513
 era/Database/Repository/databaseRepository.py,sha256=lG9Rc8TrcYiT1q8uVLjsf-xegITOZsYbtsC3Cku9gHM,3051
 era/Database/Repository/sqliteRepository.py,sha256=4BbEboKV34meIItsznhAy5qs9e_a20HJpgCmNUu0LN4,9988
 era/Logger/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 era/Logger/logger.py,sha256=RqkySNPAweOYZkjedR-kj2mw7VJCEszWtlHcBikIMmQ,1320
 era/Service/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
-era/Service/emailService.py,sha256=iz4vkKLjdHcF7tVq0jLKHiMEnPveXPDrVtJeBJL3RDw,2660
+era/Service/emailService.py,sha256=Cq40bOSztR4_ASVbpK9cxbDzd4w-D3JeF8Ffe9nOqTA,7627
 era/Utility/ConfigUtility.py,sha256=Psho2X_-5WtQMtV3sAHPVc2uVivoLv1-PEDN48wJ3LA,3963
-era/Utility/FileUtility.py,sha256=5kCFOD6C3dBu0mXZ3KsMW6eWyNhlcmoeBh1T1KBJEew,620
-era/Utility/StringUtilityCTK.py,sha256=PNSaHMqAf0ORZoVs2FRFGGXLCAWksFOPCPm6im7gLJg,11196
+era/Utility/FileUtility.py,sha256=_dVjoILoVU8wFVJiWFGmTtAVH7pOPnK0dlhV4d60SgY,1693
+era/Utility/StringUtilityCTK.py,sha256=E5RL4Al0vRgFcwa-Kr7r61mDIOf1PnwS1l6HF7bZ7jE,11979
 era/Utility/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 era/View/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
-era/View/edit_email_list_top_level.py,sha256=0_WyPrh45jpj1tLkLXl1uVrd3cQUSSQH8E_YK08-Vu4,10902
-era/View/edit_template_top_level.py,sha256=3QA4Nif8jUZAAa7cM2JOZftDxq0vT9KbEO40xLwX76s,16075
-era/View/main_view.py,sha256=4gMkuuUGpaq1dylrPOx10ZIKwzTQUGYQshuXW-2_wkI,13393
+era/View/edit_email_list_top_level.py,sha256=SDYMm9SFaEjbpW2hmBRn3UZnk50m1AgOoamAUJ6ClOg,10958
+era/View/edit_template_top_level.py,sha256=2tHtZ5FVgzFBDAQ3GHoxyfojMV6mPV22iSySksJgdMg,16130
+era/View/main_view.py,sha256=J_okCPNx9DfH_ijLa5YF9xD5tXud2dH4XTWEGTq8qdI,20069
 src/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 src/Database/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 src/Database/Dao/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 src/Database/Dao/emailAccountDao.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 src/Database/Dao/emailTemplateDao.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 src/Database/Impl/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 src/Database/Impl/emailAccountDaoImpl.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
@@ -50,11 +50,11 @@
 src/Utility/ConfigUtility.py,sha256=ryrC2uVxU0slRZAp9294-vam6T1tBMHiZeYqbZ9Z1pc,1166
 src/Utility/StringUtilityCTK.py,sha256=JahZ119BJVHCxJ2SOwQC_pw-1oQCPGssJpqF_MGfybo,7134
 src/Utility/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 src/View/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 src/View/edit_template_top_level.py,sha256=j7vjeUyT4NME7GLlMP5mlTtngmlooa9k9RTWkzhvg-M,16050
 src/View/main_view.py,sha256=NU8UEFs8QbGxQgUz8w27t8ACiQCjaTN1bTBcRjG0EyQ,7989
 src/View/testHtml.py,sha256=T6tMYcnII859MpDblnFcwaSEMZLaNmybQXoIJcHaSm8,147
-EmailNotice-1.0.2.dist-info/METADATA,sha256=f58deDAs229270wk37ptuojY0xpptbv33jqn6dYqylI,532
-EmailNotice-1.0.2.dist-info/WHEEL,sha256=G16H4A3IeoQmnOrYV4ueZGKSjhipXx8zc8nu9FGlvMA,92
-EmailNotice-1.0.2.dist-info/top_level.txt,sha256=mwOEYCo2fCv-4-kWSscMR7P3BTepFDFooHL4qGH9pyg,4
-EmailNotice-1.0.2.dist-info/RECORD,,
+EmailNotice-1.1.3.dist-info/METADATA,sha256=7gvtAlWVXjdBWjv3suAHKX8o7DQ6nKxJX9cCtrMfCks,532
+EmailNotice-1.1.3.dist-info/WHEEL,sha256=G16H4A3IeoQmnOrYV4ueZGKSjhipXx8zc8nu9FGlvMA,92
+EmailNotice-1.1.3.dist-info/top_level.txt,sha256=mwOEYCo2fCv-4-kWSscMR7P3BTepFDFooHL4qGH9pyg,4
+EmailNotice-1.1.3.dist-info/RECORD,,
```

