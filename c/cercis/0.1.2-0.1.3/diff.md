# Comparing `tmp/cercis-0.1.2.tar.gz` & `tmp/cercis-0.1.3.tar.gz`

## Comparing `cercis-0.1.2.tar` & `cercis-0.1.3.tar`

### file list

```diff
@@ -1,297 +1,305 @@
--rw-r--r--   0        0        0      106 2020-02-02 00:00:00.000000 cercis-0.1.2/.coveragerc
--rw-r--r--   0        0        0      360 2020-02-02 00:00:00.000000 cercis-0.1.2/.flake8
--rw-r--r--   0        0        0      125 2020-02-02 00:00:00.000000 cercis-0.1.2/.git_archival.txt
--rw-r--r--   0        0        0       32 2020-02-02 00:00:00.000000 cercis-0.1.2/.gitattributes
--rw-r--r--   0        0        0     1276 2020-02-02 00:00:00.000000 cercis-0.1.2/.pre-commit-config.yaml
--rw-r--r--   0        0        0      533 2020-02-02 00:00:00.000000 cercis-0.1.2/.pre-commit-hooks.yaml
--rw-r--r--   0        0        0       49 2020-02-02 00:00:00.000000 cercis-0.1.2/.prettierrc.yaml
--rw-r--r--   0        0        0      220 2020-02-02 00:00:00.000000 cercis-0.1.2/.readthedocs.yaml
--rw-r--r--   0        0        0      790 2020-02-02 00:00:00.000000 cercis-0.1.2/CHANGES.md
--rw-r--r--   0        0        0      422 2020-02-02 00:00:00.000000 cercis-0.1.2/CONTRIBUTING.md
--rw-r--r--   0        0        0      587 2020-02-02 00:00:00.000000 cercis-0.1.2/Dockerfile
--rw-r--r--   0        0        0     8193 2020-02-02 00:00:00.000000 cercis-0.1.2/README.md
--rw-r--r--   0        0        0      289 2020-02-02 00:00:00.000000 cercis-0.1.2/SECURITY.md
--rw-r--r--   0        0        0     1540 2020-02-02 00:00:00.000000 cercis-0.1.2/action.yml
--rw-r--r--   0        0        0      796 2020-02-02 00:00:00.000000 cercis-0.1.2/mypy.ini
--rw-r--r--   0        0        0       99 2020-02-02 00:00:00.000000 cercis-0.1.2/test_requirements.txt
--rw-r--r--   0        0        0     2972 2020-02-02 00:00:00.000000 cercis-0.1.2/tox.ini
--rw-r--r--   0        0        0      554 2020-02-02 00:00:00.000000 cercis-0.1.2/.github/CODE_OF_CONDUCT.md
--rw-r--r--   0        0        0     1537 2020-02-02 00:00:00.000000 cercis-0.1.2/.github/PULL_REQUEST_TEMPLATE.md
--rw-r--r--   0        0        0      565 2020-02-02 00:00:00.000000 cercis-0.1.2/.github/dependabot.yml
--rw-r--r--   0        0        0     1557 2020-02-02 00:00:00.000000 cercis-0.1.2/.github/ISSUE_TEMPLATE/bug_report.md
--rw-r--r--   0        0        0      545 2020-02-02 00:00:00.000000 cercis-0.1.2/.github/ISSUE_TEMPLATE/config.yml
--rw-r--r--   0        0        0      692 2020-02-02 00:00:00.000000 cercis-0.1.2/.github/ISSUE_TEMPLATE/docs-issue.md
--rw-r--r--   0        0        0      649 2020-02-02 00:00:00.000000 cercis-0.1.2/.github/ISSUE_TEMPLATE/feature_request.md
--rw-r--r--   0        0        0      646 2020-02-02 00:00:00.000000 cercis-0.1.2/.github/ISSUE_TEMPLATE/style_issue.md
--rw-r--r--   0        0        0     1894 2020-02-02 00:00:00.000000 cercis-0.1.2/.github/workflows/docker.yml
--rw-r--r--   0        0        0     1127 2020-02-02 00:00:00.000000 cercis-0.1.2/.github/workflows/fuzz.yml
--rw-r--r--   0        0        0     1232 2020-02-02 00:00:00.000000 cercis-0.1.2/.github/workflows/lint.yml
--rw-r--r--   0        0        0      811 2020-02-02 00:00:00.000000 cercis-0.1.2/.github/workflows/python-package.yml
--rw-r--r--   0        0        0     1090 2020-02-02 00:00:00.000000 cercis-0.1.2/.github/workflows/python-publish.yml
--rw-r--r--   0        0        0     2998 2020-02-02 00:00:00.000000 cercis-0.1.2/.github/workflows/test.yml
--rw-r--r--   0        0        0     1910 2020-02-02 00:00:00.000000 cercis-0.1.2/.github/workflows/upload_binary.yml
--rw-r--r--   0        0        0     2245 2020-02-02 00:00:00.000000 cercis-0.1.2/action/main.py
--rw-r--r--   0        0        0     7597 2020-02-02 00:00:00.000000 cercis-0.1.2/autoload/black.vim
--rw-r--r--   0        0        0      342 2020-02-02 00:00:00.000000 cercis-0.1.2/gallery/Dockerfile
--rw-r--r--   0        0        0     1595 2020-02-02 00:00:00.000000 cercis-0.1.2/gallery/README.md
--rwxr-xr-x   0        0        0     9123 2020-02-02 00:00:00.000000 cercis-0.1.2/gallery/gallery.py
--rw-r--r--   0        0        0     2176 2020-02-02 00:00:00.000000 cercis-0.1.2/plugin/black.vim
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 cercis-0.1.2/scripts/__init__.py
--rw-r--r--   0        0        0     8650 2020-02-02 00:00:00.000000 cercis-0.1.2/scripts/diff_shades_gha_helper.py
--rw-r--r--   0        0        0     3527 2020-02-02 00:00:00.000000 cercis-0.1.2/scripts/fuzz.py
--rw-r--r--   0        0        0     2458 2020-02-02 00:00:00.000000 cercis-0.1.2/scripts/make_width_table.py
--rwxr-xr-x   0        0        0     2993 2020-02-02 00:00:00.000000 cercis-0.1.2/scripts/migrate-black.py
--rw-r--r--   0        0        0       18 2020-02-02 00:00:00.000000 cercis-0.1.2/src/_cercis_version.py
--rw-r--r--   0        0        0     8100 2020-02-02 00:00:00.000000 cercis-0.1.2/src/blackd/__init__.py
--rw-r--r--   0        0        0       37 2020-02-02 00:00:00.000000 cercis-0.1.2/src/blackd/__main__.py
--rw-r--r--   0        0        0     1585 2020-02-02 00:00:00.000000 cercis-0.1.2/src/blackd/middlewares.py
--rw-r--r--   0        0        0    11278 2020-02-02 00:00:00.000000 cercis-0.1.2/src/blib2to3/Grammar.txt
--rw-r--r--   0        0        0    12762 2020-02-02 00:00:00.000000 cercis-0.1.2/src/blib2to3/LICENSE
--rw-r--r--   0        0        0      793 2020-02-02 00:00:00.000000 cercis-0.1.2/src/blib2to3/PatternGrammar.txt
--rw-r--r--   0        0        0     1071 2020-02-02 00:00:00.000000 cercis-0.1.2/src/blib2to3/README
--rw-r--r--   0        0        0        8 2020-02-02 00:00:00.000000 cercis-0.1.2/src/blib2to3/__init__.py
--rw-r--r--   0        0        0     5732 2020-02-02 00:00:00.000000 cercis-0.1.2/src/blib2to3/pygram.py
--rw-r--r--   0        0        0    32612 2020-02-02 00:00:00.000000 cercis-0.1.2/src/blib2to3/pytree.py
--rw-r--r--   0        0        0      143 2020-02-02 00:00:00.000000 cercis-0.1.2/src/blib2to3/pgen2/__init__.py
--rw-r--r--   0        0        0     9607 2020-02-02 00:00:00.000000 cercis-0.1.2/src/blib2to3/pgen2/conv.py
--rw-r--r--   0        0        0    10671 2020-02-02 00:00:00.000000 cercis-0.1.2/src/blib2to3/pgen2/driver.py
--rw-r--r--   0        0        0     6873 2020-02-02 00:00:00.000000 cercis-0.1.2/src/blib2to3/pgen2/grammar.py
--rw-r--r--   0        0        0     1628 2020-02-02 00:00:00.000000 cercis-0.1.2/src/blib2to3/pgen2/literals.py
--rw-r--r--   0        0        0    14859 2020-02-02 00:00:00.000000 cercis-0.1.2/src/blib2to3/pgen2/parse.py
--rw-r--r--   0        0        0    15491 2020-02-02 00:00:00.000000 cercis-0.1.2/src/blib2to3/pgen2/pgen.py
--rw-r--r--   0        0        0     1919 2020-02-02 00:00:00.000000 cercis-0.1.2/src/blib2to3/pgen2/token.py
--rw-r--r--   0        0        0    23120 2020-02-02 00:00:00.000000 cercis-0.1.2/src/blib2to3/pgen2/tokenize.py
--rw-r--r--   0        0        0    48202 2020-02-02 00:00:00.000000 cercis-0.1.2/src/cercis/__init__.py
--rw-r--r--   0        0        0       48 2020-02-02 00:00:00.000000 cercis-0.1.2/src/cercis/__main__.py
--rw-r--r--   0        0        0    10871 2020-02-02 00:00:00.000000 cercis-0.1.2/src/cercis/_width_table.py
--rw-r--r--   0        0        0    12274 2020-02-02 00:00:00.000000 cercis-0.1.2/src/cercis/brackets.py
--rw-r--r--   0        0        0     2952 2020-02-02 00:00:00.000000 cercis-0.1.2/src/cercis/cache.py
--rw-r--r--   0        0        0    12797 2020-02-02 00:00:00.000000 cercis-0.1.2/src/cercis/comments.py
--rw-r--r--   0        0        0     6343 2020-02-02 00:00:00.000000 cercis-0.1.2/src/cercis/concurrency.py
--rw-r--r--   0        0        0      404 2020-02-02 00:00:00.000000 cercis-0.1.2/src/cercis/const.py
--rw-r--r--   0        0        0     1597 2020-02-02 00:00:00.000000 cercis-0.1.2/src/cercis/debug.py
--rw-r--r--   0        0        0    13538 2020-02-02 00:00:00.000000 cercis-0.1.2/src/cercis/files.py
--rw-r--r--   0        0        0    13506 2020-02-02 00:00:00.000000 cercis-0.1.2/src/cercis/handle_ipynb_magics.py
--rw-r--r--   0        0        0    61366 2020-02-02 00:00:00.000000 cercis-0.1.2/src/cercis/linegen.py
--rw-r--r--   0        0        0    36582 2020-02-02 00:00:00.000000 cercis-0.1.2/src/cercis/lines.py
--rw-r--r--   0        0        0     7513 2020-02-02 00:00:00.000000 cercis-0.1.2/src/cercis/mode.py
--rw-r--r--   0        0        0    25731 2020-02-02 00:00:00.000000 cercis-0.1.2/src/cercis/nodes.py
--rw-r--r--   0        0        0     1653 2020-02-02 00:00:00.000000 cercis-0.1.2/src/cercis/numerics.py
--rw-r--r--   0        0        0     3486 2020-02-02 00:00:00.000000 cercis-0.1.2/src/cercis/output.py
--rw-r--r--   0        0        0    10164 2020-02-02 00:00:00.000000 cercis-0.1.2/src/cercis/parsing.py
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 cercis-0.1.2/src/cercis/py.typed
--rw-r--r--   0        0        0     3452 2020-02-02 00:00:00.000000 cercis-0.1.2/src/cercis/report.py
--rw-r--r--   0        0        0      556 2020-02-02 00:00:00.000000 cercis-0.1.2/src/cercis/rusty.py
--rw-r--r--   0        0        0    14304 2020-02-02 00:00:00.000000 cercis-0.1.2/src/cercis/strings.py
--rw-r--r--   0        0        0    91688 2020-02-02 00:00:00.000000 cercis-0.1.2/src/cercis/trans.py
--rw-r--r--   0        0        0     2327 2020-02-02 00:00:00.000000 cercis-0.1.2/src/cercis/utils_line_wrapping.py
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/__init__.py
--rw-r--r--   0        0        0       36 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/conftest.py
--rw-r--r--   0        0        0       89 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/empty.toml
--rw-r--r--   0        0        0     4133 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/optional.py
--rw-r--r--   0        0        0      389 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/test.toml
--rw-r--r--   0        0        0   100658 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/test_black.py
--rw-r--r--   0        0        0     9188 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/test_blackd.py
--rw-r--r--   0        0        0     9000 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/test_format.py
--rw-r--r--   0        0        0    16377 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/test_ipynb.py
--rw-r--r--   0        0        0     1292 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/test_no_ipynb.py
--rw-r--r--   0        0        0     2267 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/test_trans.py
--rw-r--r--   0        0        0     2546 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/test_utils_line_wrapping.py
--rw-r--r--   0        0        0     7023 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/util.py
--rw-r--r--   0        0        0     4160 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/conditional_expression.py
--rw-r--r--   0        0        0       99 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/empty_pyproject.toml
--rw-r--r--   0        0        0      334 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/configurable_cases/func_def_indent/func_def_extra_indent.py
--rw-r--r--   0        0        0      322 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/configurable_cases/func_def_indent/func_def_no_extra_indent.py
--rw-r--r--   0        0        0    11583 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/configurable_cases/line_with_long_string/long_strings_flag_disabled__Black_default.py
--rw-r--r--   0        0        0    23081 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/configurable_cases/line_with_long_string/long_strings_flag_disabled__Cercis_default.py
--rw-r--r--   0        0        0     6138 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/configurable_cases/line_with_long_string/test_cases__Black_default.py
--rw-r--r--   0        0        0     6024 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/configurable_cases/line_with_long_string/test_cases__Cercis_default.py
--rw-r--r--   0        0        0     7702 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/configurable_cases/single_quote/docstring.py
--rw-r--r--   0        0        0      140 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/configurable_cases/single_quote/docstring_no_extra_empty_line_before_eof.py
--rw-r--r--   0        0        0     3513 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/configurable_cases/single_quote/docstring_preview.py
--rw-r--r--   0        0        0      745 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/configurable_cases/single_quote/more_quotes.py
--rw-r--r--   0        0        0      845 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/configurable_cases/single_quote/string_prefixes.py
--rw-r--r--   0        0        0     2279 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/configurable_cases/single_quote/torture.py
--rw-r--r--   0        0        0      498 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/fast/pep_572_do_not_remove_parens.py
--rw-r--r--   0        0        0        5 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/gitignore_used_on_multiple_sources/.gitignore
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/gitignore_used_on_multiple_sources/dir1/a.py
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/gitignore_used_on_multiple_sources/dir1/b.py
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/gitignore_used_on_multiple_sources/dir2/a.py
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/gitignore_used_on_multiple_sources/dir2/b.py
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/ignore_subfolders_gitignore_tests/a.py
--rw-r--r--   0        0        0        4 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/ignore_subfolders_gitignore_tests/subdir/.gitignore
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/ignore_subfolders_gitignore_tests/subdir/b.py
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/ignore_subfolders_gitignore_tests/subdir/subdir/c.py
--rw-r--r--   0        0        0       14 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/include_exclude_tests/.gitignore
--rw-r--r--   0        0        0      114 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/include_exclude_tests/pyproject.toml
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/include_exclude_tests/b/.definitely_exclude/a.pie
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/include_exclude_tests/b/.definitely_exclude/a.py
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/include_exclude_tests/b/.definitely_exclude/a.pyi
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/include_exclude_tests/b/dont_exclude/a.pie
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/include_exclude_tests/b/dont_exclude/a.py
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/include_exclude_tests/b/dont_exclude/a.pyi
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/include_exclude_tests/b/exclude/a.pie
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/include_exclude_tests/b/exclude/a.py
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/include_exclude_tests/b/exclude/a.pyi
--rw-r--r--   0        0        0        2 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/invalid_gitignore_tests/.gitignore
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/invalid_gitignore_tests/a.py
--rw-r--r--   0        0        0       89 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/invalid_gitignore_tests/pyproject.toml
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/invalid_nested_gitignore_tests/a.py
--rw-r--r--   0        0        0       89 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/invalid_nested_gitignore_tests/pyproject.toml
--rw-r--r--   0        0        0        2 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/invalid_nested_gitignore_tests/a/.gitignore
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/invalid_nested_gitignore_tests/a/a.py
--rw-r--r--   0        0        0      436 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/jupyter/non_python_notebook.ipynb
--rw-r--r--   0        0        0      369 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/jupyter/notebook_empty_metadata.ipynb
--rw-r--r--   0        0        0      639 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/jupyter/notebook_no_trailing_newline.ipynb
--rw-r--r--   0        0        0      640 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/jupyter/notebook_trailing_newline.ipynb
--rw-r--r--   0        0        0        4 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/jupyter/notebook_which_cant_be_parsed.ipynb
--rw-r--r--   0        0        0      763 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/jupyter/notebook_without_changes.ipynb
--rw-r--r--   0        0        0      495 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/miscellaneous/async_as_identifier.py
--rw-r--r--   0        0        0      255 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/miscellaneous/blackd_diff.diff
--rw-r--r--   0        0        0       98 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/miscellaneous/blackd_diff.py
--rw-r--r--   0        0        0    15604 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/miscellaneous/debug_visitor.out
--rw-r--r--   0        0        0     1193 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/miscellaneous/debug_visitor.py
--rw-r--r--   0        0        0     1774 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/miscellaneous/decorators.py
--rw-r--r--   0        0        0     3601 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/miscellaneous/docstring_no_string_normalization.py
--rw-r--r--   0        0        0      357 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/miscellaneous/docstring_preview_no_string_normalization.py
--rw-r--r--   0        0        0    15711 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/miscellaneous/expression_skip_magic_trailing_comma.diff
--rw-r--r--   0        0        0      626 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/miscellaneous/force_py36.py
--rw-r--r--   0        0        0      793 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/miscellaneous/force_pyi.py
--rw-r--r--   0        0        0       59 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/miscellaneous/invalid_header.py
--rw-r--r--   0        0        0      101 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/miscellaneous/linelength6.py
--rw-r--r--   0        0        0    11583 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/miscellaneous/long_strings_flag_disabled.py
--rw-r--r--   0        0        0      293 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/miscellaneous/missing_final_newline.diff
--rw-r--r--   0        0        0      145 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/miscellaneous/missing_final_newline.py
--rw-r--r--   0        0        0      284 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/miscellaneous/nested_class_stub.pyi
--rw-r--r--   0        0        0      279 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/miscellaneous/pattern_matching_invalid.py
--rw-r--r--   0        0        0       69 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/miscellaneous/power_op_newline.py
--rw-r--r--   0        0        0      758 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/miscellaneous/python2_detection.py
--rw-r--r--   0        0        0     2361 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/miscellaneous/string_quotes.py
--rw-r--r--   0        0        0     2266 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/miscellaneous/stub.pyi
--rw-r--r--   0        0        0      114 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/nested_gitignore_tests/pyproject.toml
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/nested_gitignore_tests/x.py
--rw-r--r--   0        0        0        5 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/nested_gitignore_tests/root/.gitignore
--rw-r--r--   0        0        0       39 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/nested_gitignore_tests/root/a.py
--rw-r--r--   0        0        0       21 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/nested_gitignore_tests/root/b.py
--rw-r--r--   0        0        0       21 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/nested_gitignore_tests/root/c.py
--rw-r--r--   0        0        0        5 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/nested_gitignore_tests/root/child/.gitignore
--rw-r--r--   0        0        0       39 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/nested_gitignore_tests/root/child/a.py
--rw-r--r--   0        0        0       40 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/nested_gitignore_tests/root/child/b.py
--rw-r--r--   0        0        0       21 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/nested_gitignore_tests/root/child/c.py
--rw-r--r--   0        0        0      279 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/preview/async_stmts.py
--rw-r--r--   0        0        0     4107 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/preview/cantfit.py
--rw-r--r--   0        0        0     8294 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/preview/comments7.py
--rw-r--r--   0        0        0      613 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/preview/format_unicode_escape_seq.py
--rw-r--r--   0        0        0     2784 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/preview/long_dict_values.py
--rw-r--r--   0        0        0    33216 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/preview/long_strings.py
--rw-r--r--   0        0        0     1418 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/preview/long_strings__east_asian_width.py
--rw-r--r--   0        0        0     6536 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/preview/long_strings__edge_case.py
--rw-r--r--   0        0        0    45897 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/preview/long_strings__regression.py
--rw-r--r--   0        0        0     1105 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/preview/long_strings__type_annotations.py
--rw-r--r--   0        0        0     7207 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/preview/multiline_strings.py
--rw-r--r--   0        0        0      481 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/preview/percent_precedence.py
--rw-r--r--   0        0        0     2525 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/preview/prefer_rhs_split.py
--rw-r--r--   0        0        0      342 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/preview/return_annotation_brackets_string.py
--rw-r--r--   0        0        0      655 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/preview/trailing_comma.py
--rw-r--r--   0        0        0     1140 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/preview_context_managers/targeting_py38.py
--rw-r--r--   0        0        0     3361 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/preview_context_managers/targeting_py39.py
--rw-r--r--   0        0        0      595 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/preview_context_managers/auto_detect/features_3_10.py
--rw-r--r--   0        0        0      553 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/preview_context_managers/auto_detect/features_3_11.py
--rw-r--r--   0        0        0     1058 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/preview_context_managers/auto_detect/features_3_8.py
--rw-r--r--   0        0        0      623 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/preview_context_managers/auto_detect/features_3_9.py
--rw-r--r--   0        0        0      133 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/project_metadata/both_pyproject.toml
--rw-r--r--   0        0        0       74 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/project_metadata/neither_pyproject.toml
--rw-r--r--   0        0        0      101 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/project_metadata/only_black_pyproject.toml
--rw-r--r--   0        0        0      106 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/project_metadata/only_metadata_pyproject.toml
--rw-r--r--   0        0        0      765 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/py_310/parenthesized_context_managers.py
--rw-r--r--   0        0        0     2668 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/py_310/pattern_matching_complex.py
--rw-r--r--   0        0        0     1965 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/py_310/pattern_matching_extras.py
--rw-r--r--   0        0        0     3066 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/py_310/pattern_matching_generic.py
--rw-r--r--   0        0        0     2641 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/py_310/pattern_matching_simple.py
--rw-r--r--   0        0        0     1061 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/py_310/pattern_matching_style.py
--rw-r--r--   0        0        0      491 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/py_310/pep_572_py310.py
--rw-r--r--   0        0        0      509 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/py_310/remove_newline_after_match.py
--rw-r--r--   0        0        0      380 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/py_310/starred_for_target.py
--rw-r--r--   0        0        0     2114 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/py_311/pep_646.py
--rw-r--r--   0        0        0      972 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/py_311/pep_654.py
--rw-r--r--   0        0        0     2033 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/py_311/pep_654_style.py
--rw-r--r--   0        0        0      597 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/py_36/numeric_literals.py
--rw-r--r--   0        0        0      267 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/py_36/numeric_literals_skip_underscores.py
--rw-r--r--   0        0        0     1199 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/py_37/python37.py
--rw-r--r--   0        0        0      740 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/py_38/pep_570.py
--rw-r--r--   0        0        0      970 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/py_38/pep_572.py
--rw-r--r--   0        0        0     1895 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/py_38/pep_572_remove_parens.py
--rw-r--r--   0        0        0      834 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/py_38/python38.py
--rw-r--r--   0        0        0      251 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/py_39/pep_572_py39.py
--rw-r--r--   0        0        0      696 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/py_39/python39.py
--rw-r--r--   0        0        0     2575 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/py_39/remove_with_brackets.py
--rw-r--r--   0        0        0      907 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/simple_cases/attribute_access_on_number_literals.py
--rw-r--r--   0        0        0       63 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/simple_cases/beginning_backslash.py
--rw-r--r--   0        0        0      333 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/simple_cases/bracketmatch.py
--rw-r--r--   0        0        0     1091 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/simple_cases/class_blank_parentheses.py
--rw-r--r--   0        0        0     4318 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/simple_cases/class_methods_new_line.py
--rw-r--r--   0        0        0     3294 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/simple_cases/collections.py
--rw-r--r--   0        0        0      212 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/simple_cases/comment_after_escaped_newline.py
--rw-r--r--   0        0        0     1909 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/simple_cases/comments.py
--rw-r--r--   0        0        0     7639 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/simple_cases/comments2.py
--rw-r--r--   0        0        0     1573 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/simple_cases/comments3.py
--rw-r--r--   0        0        0     3536 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/simple_cases/comments4.py
--rw-r--r--   0        0        0     1196 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/simple_cases/comments5.py
--rw-r--r--   0        0        0     2567 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/simple_cases/comments6.py
--rw-r--r--   0        0        0      300 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/simple_cases/comments8.py
--rw-r--r--   0        0        0     5279 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/simple_cases/comments9.py
--rw-r--r--   0        0        0      994 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/simple_cases/comments_non_breaking_space.py
--rw-r--r--   0        0        0     5597 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/simple_cases/composition.py
--rw-r--r--   0        0        0    11198 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/simple_cases/composition_no_trailing_comma.py
--rw-r--r--   0        0        0     7699 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/simple_cases/docstring.py
--rw-r--r--   0        0        0      140 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/simple_cases/docstring_no_extra_empty_line_before_eof.py
--rw-r--r--   0        0        0     3513 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/simple_cases/docstring_preview.py
--rw-r--r--   0        0        0     4596 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/simple_cases/empty_lines.py
--rw-r--r--   0        0        0    15801 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/simple_cases/expression.diff
--rw-r--r--   0        0        0    18624 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/simple_cases/expression.py
--rw-r--r--   0        0        0     9681 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/simple_cases/fmtonoff.py
--rw-r--r--   0        0        0      604 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/simple_cases/fmtonoff2.py
--rw-r--r--   0        0        0      251 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/simple_cases/fmtonoff3.py
--rw-r--r--   0        0        0      278 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/simple_cases/fmtonoff4.py
--rw-r--r--   0        0        0     3627 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/simple_cases/fmtonoff5.py
--rw-r--r--   0        0        0      277 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/simple_cases/fmtpass_imports.py
--rw-r--r--   0        0        0       40 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/simple_cases/fmtskip.py
--rw-r--r--   0        0        0      555 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/simple_cases/fmtskip2.py
--rw-r--r--   0        0        0      362 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/simple_cases/fmtskip3.py
--rw-r--r--   0        0        0       92 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/simple_cases/fmtskip4.py
--rw-r--r--   0        0        0      301 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/simple_cases/fmtskip5.py
--rw-r--r--   0        0        0      235 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/simple_cases/fmtskip6.py
--rw-r--r--   0        0        0      356 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/simple_cases/fmtskip7.py
--rw-r--r--   0        0        0     1705 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/simple_cases/fmtskip8.py
--rw-r--r--   0        0        0      989 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/simple_cases/fstring.py
--rw-r--r--   0        0        0     6482 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/simple_cases/function.py
--rw-r--r--   0        0        0     2427 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/simple_cases/function2.py
--rw-r--r--   0        0        0     3657 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/simple_cases/function_trailing_comma.py
--rw-r--r--   0        0        0     2542 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/simple_cases/import_spacing.py
--rw-r--r--   0        0        0      674 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/simple_cases/one_element_subscript.py
--rw-r--r--   0        0        0     3359 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/simple_cases/power_op_spacing.py
--rw-r--r--   0        0        0     1106 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/simple_cases/prefer_rhs_split_reformatted.py
--rw-r--r--   0        0        0     3205 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/simple_cases/remove_await_parens.py
--rw-r--r--   0        0        0     2025 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/simple_cases/remove_except_parens.py
--rw-r--r--   0        0        0     1460 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/simple_cases/remove_for_brackets.py
--rw-r--r--   0        0        0     3351 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/simple_cases/remove_newline_after_code_block_open.py
--rw-r--r--   0        0        0     3493 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/simple_cases/remove_parens.py
--rw-r--r--   0        0        0     5141 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/simple_cases/return_annotation_brackets.py
--rw-r--r--   0        0        0     1398 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/simple_cases/skip_magic_trailing_comma.py
--rw-r--r--   0        0        0      787 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/simple_cases/slices.py
--rw-r--r--   0        0        0      845 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/simple_cases/string_prefixes.py
--rw-r--r--   0        0        0     2279 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/simple_cases/torture.py
--rw-r--r--   0        0        0     1615 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/simple_cases/trailing_comma_optional_parens1.py
--rw-r--r--   0        0        0      248 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/simple_cases/trailing_comma_optional_parens2.py
--rw-r--r--   0        0        0      967 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/simple_cases/trailing_comma_optional_parens3.py
--rw-r--r--   0        0        0     2123 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/simple_cases/trailing_commas_in_leading_parts.py
--rw-r--r--   0        0        0       80 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/simple_cases/tricky_unicode_symbols.py
--rw-r--r--   0        0        0      510 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/simple_cases/tupleassign.py
--rw-r--r--   0        0        0       27 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/simple_cases/whitespace.py
--rw-r--r--   0        0        0      101 2020-02-02 00:00:00.000000 cercis-0.1.2/tests/data/type_comments/type_comment_syntax_error.py
--rw-r--r--   0        0        0      273 2020-02-02 00:00:00.000000 cercis-0.1.2/.gitignore
--rw-r--r--   0        0        0     8043 2020-02-02 00:00:00.000000 cercis-0.1.2/AUTHORS.md
--rw-r--r--   0        0        0     1061 2020-02-02 00:00:00.000000 cercis-0.1.2/LICENSE
--rw-r--r--   0        0        0     1080 2020-02-02 00:00:00.000000 cercis-0.1.2/LICENSE_ORIGINAL
--rw-r--r--   0        0        0     6940 2020-02-02 00:00:00.000000 cercis-0.1.2/pyproject.toml
--rw-r--r--   0        0        0    10925 2020-02-02 00:00:00.000000 cercis-0.1.2/PKG-INFO
+-rw-r--r--   0        0        0      106 2020-02-02 00:00:00.000000 cercis-0.1.3/.coveragerc
+-rw-r--r--   0        0        0      360 2020-02-02 00:00:00.000000 cercis-0.1.3/.flake8
+-rw-r--r--   0        0        0      125 2020-02-02 00:00:00.000000 cercis-0.1.3/.git_archival.txt
+-rw-r--r--   0        0        0       32 2020-02-02 00:00:00.000000 cercis-0.1.3/.gitattributes
+-rw-r--r--   0        0        0     1250 2020-02-02 00:00:00.000000 cercis-0.1.3/.pre-commit-config.yaml
+-rw-r--r--   0        0        0      533 2020-02-02 00:00:00.000000 cercis-0.1.3/.pre-commit-hooks.yaml
+-rw-r--r--   0        0        0       49 2020-02-02 00:00:00.000000 cercis-0.1.3/.prettierrc.yaml
+-rw-r--r--   0        0        0      220 2020-02-02 00:00:00.000000 cercis-0.1.3/.readthedocs.yaml
+-rw-r--r--   0        0        0     1501 2020-02-02 00:00:00.000000 cercis-0.1.3/CHANGELOG.md
+-rw-r--r--   0        0        0      587 2020-02-02 00:00:00.000000 cercis-0.1.3/Dockerfile
+-rw-r--r--   0        0        0    13675 2020-02-02 00:00:00.000000 cercis-0.1.3/README.md
+-rw-r--r--   0        0        0     1540 2020-02-02 00:00:00.000000 cercis-0.1.3/action.yml
+-rw-r--r--   0        0        0      796 2020-02-02 00:00:00.000000 cercis-0.1.3/mypy.ini
+-rw-r--r--   0        0        0       99 2020-02-02 00:00:00.000000 cercis-0.1.3/test_requirements.txt
+-rw-r--r--   0        0        0     2972 2020-02-02 00:00:00.000000 cercis-0.1.3/tox.ini
+-rw-r--r--   0        0        0     1537 2020-02-02 00:00:00.000000 cercis-0.1.3/.github/PULL_REQUEST_TEMPLATE.md
+-rw-r--r--   0        0        0      565 2020-02-02 00:00:00.000000 cercis-0.1.3/.github/dependabot.yml
+-rw-r--r--   0        0        0     1557 2020-02-02 00:00:00.000000 cercis-0.1.3/.github/ISSUE_TEMPLATE/bug_report.md
+-rw-r--r--   0        0        0      545 2020-02-02 00:00:00.000000 cercis-0.1.3/.github/ISSUE_TEMPLATE/config.yml
+-rw-r--r--   0        0        0      692 2020-02-02 00:00:00.000000 cercis-0.1.3/.github/ISSUE_TEMPLATE/docs-issue.md
+-rw-r--r--   0        0        0      649 2020-02-02 00:00:00.000000 cercis-0.1.3/.github/ISSUE_TEMPLATE/feature_request.md
+-rw-r--r--   0        0        0      646 2020-02-02 00:00:00.000000 cercis-0.1.3/.github/ISSUE_TEMPLATE/style_issue.md
+-rw-r--r--   0        0        0      795 2020-02-02 00:00:00.000000 cercis-0.1.3/.github/workflows/check-changelog.yml
+-rw-r--r--   0        0        0     1894 2020-02-02 00:00:00.000000 cercis-0.1.3/.github/workflows/docker.yml
+-rw-r--r--   0        0        0     1127 2020-02-02 00:00:00.000000 cercis-0.1.3/.github/workflows/fuzz.yml
+-rw-r--r--   0        0        0     1232 2020-02-02 00:00:00.000000 cercis-0.1.3/.github/workflows/lint.yml
+-rw-r--r--   0        0        0      811 2020-02-02 00:00:00.000000 cercis-0.1.3/.github/workflows/python-package.yml
+-rw-r--r--   0        0        0     1253 2020-02-02 00:00:00.000000 cercis-0.1.3/.github/workflows/python-publish.yml
+-rw-r--r--   0        0        0     2998 2020-02-02 00:00:00.000000 cercis-0.1.3/.github/workflows/test.yml
+-rw-r--r--   0        0        0     1910 2020-02-02 00:00:00.000000 cercis-0.1.3/.github/workflows/upload_binary.yml
+-rw-r--r--   0        0        0      780 2020-02-02 00:00:00.000000 cercis-0.1.3/.github/workflows/version-check.yml
+-rw-r--r--   0        0        0     2245 2020-02-02 00:00:00.000000 cercis-0.1.3/action/main.py
+-rw-r--r--   0        0        0     7597 2020-02-02 00:00:00.000000 cercis-0.1.3/autoload/black.vim
+-rw-r--r--   0        0        0      342 2020-02-02 00:00:00.000000 cercis-0.1.3/gallery/Dockerfile
+-rw-r--r--   0        0        0     1595 2020-02-02 00:00:00.000000 cercis-0.1.3/gallery/README.md
+-rwxr-xr-x   0        0        0     9123 2020-02-02 00:00:00.000000 cercis-0.1.3/gallery/gallery.py
+-rw-r--r--   0        0        0     2176 2020-02-02 00:00:00.000000 cercis-0.1.3/plugin/black.vim
+-rw-r--r--   0        0        0       55 2020-02-02 00:00:00.000000 cercis-0.1.3/scripts/README.md
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 cercis-0.1.3/scripts/__init__.py
+-rw-r--r--   0        0        0     2500 2020-02-02 00:00:00.000000 cercis-0.1.3/scripts/check_version_and_changelog.py
+-rw-r--r--   0        0        0     8650 2020-02-02 00:00:00.000000 cercis-0.1.3/scripts/diff_shades_gha_helper.py
+-rw-r--r--   0        0        0     3527 2020-02-02 00:00:00.000000 cercis-0.1.3/scripts/fuzz.py
+-rw-r--r--   0        0        0     2458 2020-02-02 00:00:00.000000 cercis-0.1.3/scripts/make_width_table.py
+-rwxr-xr-x   0        0        0     2993 2020-02-02 00:00:00.000000 cercis-0.1.3/scripts/migrate-black.py
+-rw-r--r--   0        0        0       18 2020-02-02 00:00:00.000000 cercis-0.1.3/src/_cercis_version.py
+-rw-r--r--   0        0        0     8100 2020-02-02 00:00:00.000000 cercis-0.1.3/src/blackd/__init__.py
+-rw-r--r--   0        0        0       37 2020-02-02 00:00:00.000000 cercis-0.1.3/src/blackd/__main__.py
+-rw-r--r--   0        0        0     1585 2020-02-02 00:00:00.000000 cercis-0.1.3/src/blackd/middlewares.py
+-rw-r--r--   0        0        0    11278 2020-02-02 00:00:00.000000 cercis-0.1.3/src/blib2to3/Grammar.txt
+-rw-r--r--   0        0        0    12762 2020-02-02 00:00:00.000000 cercis-0.1.3/src/blib2to3/LICENSE
+-rw-r--r--   0        0        0      793 2020-02-02 00:00:00.000000 cercis-0.1.3/src/blib2to3/PatternGrammar.txt
+-rw-r--r--   0        0        0     1071 2020-02-02 00:00:00.000000 cercis-0.1.3/src/blib2to3/README
+-rw-r--r--   0        0        0        8 2020-02-02 00:00:00.000000 cercis-0.1.3/src/blib2to3/__init__.py
+-rw-r--r--   0        0        0     5732 2020-02-02 00:00:00.000000 cercis-0.1.3/src/blib2to3/pygram.py
+-rw-r--r--   0        0        0    32612 2020-02-02 00:00:00.000000 cercis-0.1.3/src/blib2to3/pytree.py
+-rw-r--r--   0        0        0      143 2020-02-02 00:00:00.000000 cercis-0.1.3/src/blib2to3/pgen2/__init__.py
+-rw-r--r--   0        0        0     9607 2020-02-02 00:00:00.000000 cercis-0.1.3/src/blib2to3/pgen2/conv.py
+-rw-r--r--   0        0        0    10671 2020-02-02 00:00:00.000000 cercis-0.1.3/src/blib2to3/pgen2/driver.py
+-rw-r--r--   0        0        0     6873 2020-02-02 00:00:00.000000 cercis-0.1.3/src/blib2to3/pgen2/grammar.py
+-rw-r--r--   0        0        0     1628 2020-02-02 00:00:00.000000 cercis-0.1.3/src/blib2to3/pgen2/literals.py
+-rw-r--r--   0        0        0    14859 2020-02-02 00:00:00.000000 cercis-0.1.3/src/blib2to3/pgen2/parse.py
+-rw-r--r--   0        0        0    15491 2020-02-02 00:00:00.000000 cercis-0.1.3/src/blib2to3/pgen2/pgen.py
+-rw-r--r--   0        0        0     1919 2020-02-02 00:00:00.000000 cercis-0.1.3/src/blib2to3/pgen2/token.py
+-rw-r--r--   0        0        0    23120 2020-02-02 00:00:00.000000 cercis-0.1.3/src/blib2to3/pgen2/tokenize.py
+-rw-r--r--   0        0        0    49104 2020-02-02 00:00:00.000000 cercis-0.1.3/src/cercis/__init__.py
+-rw-r--r--   0        0        0       48 2020-02-02 00:00:00.000000 cercis-0.1.3/src/cercis/__main__.py
+-rw-r--r--   0        0        0    10871 2020-02-02 00:00:00.000000 cercis-0.1.3/src/cercis/_width_table.py
+-rw-r--r--   0        0        0    12274 2020-02-02 00:00:00.000000 cercis-0.1.3/src/cercis/brackets.py
+-rw-r--r--   0        0        0     2952 2020-02-02 00:00:00.000000 cercis-0.1.3/src/cercis/cache.py
+-rw-r--r--   0        0        0    12797 2020-02-02 00:00:00.000000 cercis-0.1.3/src/cercis/comments.py
+-rw-r--r--   0        0        0     6343 2020-02-02 00:00:00.000000 cercis-0.1.3/src/cercis/concurrency.py
+-rw-r--r--   0        0        0      480 2020-02-02 00:00:00.000000 cercis-0.1.3/src/cercis/const.py
+-rw-r--r--   0        0        0     1597 2020-02-02 00:00:00.000000 cercis-0.1.3/src/cercis/debug.py
+-rw-r--r--   0        0        0    13538 2020-02-02 00:00:00.000000 cercis-0.1.3/src/cercis/files.py
+-rw-r--r--   0        0        0    13514 2020-02-02 00:00:00.000000 cercis-0.1.3/src/cercis/handle_ipynb_magics.py
+-rw-r--r--   0        0        0    62207 2020-02-02 00:00:00.000000 cercis-0.1.3/src/cercis/linegen.py
+-rw-r--r--   0        0        0    38672 2020-02-02 00:00:00.000000 cercis-0.1.3/src/cercis/lines.py
+-rw-r--r--   0        0        0     7717 2020-02-02 00:00:00.000000 cercis-0.1.3/src/cercis/mode.py
+-rw-r--r--   0        0        0    25731 2020-02-02 00:00:00.000000 cercis-0.1.3/src/cercis/nodes.py
+-rw-r--r--   0        0        0     1653 2020-02-02 00:00:00.000000 cercis-0.1.3/src/cercis/numerics.py
+-rw-r--r--   0        0        0     3486 2020-02-02 00:00:00.000000 cercis-0.1.3/src/cercis/output.py
+-rw-r--r--   0        0        0    10164 2020-02-02 00:00:00.000000 cercis-0.1.3/src/cercis/parsing.py
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 cercis-0.1.3/src/cercis/py.typed
+-rw-r--r--   0        0        0     3452 2020-02-02 00:00:00.000000 cercis-0.1.3/src/cercis/report.py
+-rw-r--r--   0        0        0      556 2020-02-02 00:00:00.000000 cercis-0.1.3/src/cercis/rusty.py
+-rw-r--r--   0        0        0    14304 2020-02-02 00:00:00.000000 cercis-0.1.3/src/cercis/strings.py
+-rw-r--r--   0        0        0    91688 2020-02-02 00:00:00.000000 cercis-0.1.3/src/cercis/trans.py
+-rw-r--r--   0        0        0     2676 2020-02-02 00:00:00.000000 cercis-0.1.3/src/cercis/utils_line_wrapping.py
+-rw-r--r--   0        0        0     3267 2020-02-02 00:00:00.000000 cercis-0.1.3/src/cercis/utils_linegen.py
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/__init__.py
+-rw-r--r--   0        0        0       36 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/conftest.py
+-rw-r--r--   0        0        0       89 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/empty.toml
+-rw-r--r--   0        0        0     4133 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/optional.py
+-rw-r--r--   0        0        0      389 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/test.toml
+-rw-r--r--   0        0        0   101263 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/test_black.py
+-rw-r--r--   0        0        0     9188 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/test_blackd.py
+-rw-r--r--   0        0        0    11625 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/test_format.py
+-rw-r--r--   0        0        0    16390 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/test_ipynb.py
+-rw-r--r--   0        0        0     1292 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/test_no_ipynb.py
+-rw-r--r--   0        0        0     2267 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/test_trans.py
+-rw-r--r--   0        0        0     2546 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/test_utils_line_wrapping.py
+-rw-r--r--   0        0        0     7023 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/util.py
+-rw-r--r--   0        0        0     4160 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/conditional_expression.py
+-rw-r--r--   0        0        0       99 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/empty_pyproject.toml
+-rw-r--r--   0        0        0      334 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/configurable_cases/func_def_indent/func_def_extra_indent.py
+-rw-r--r--   0        0        0      322 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/configurable_cases/func_def_indent/func_def_no_extra_indent.py
+-rw-r--r--   0        0        0      863 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/configurable_cases/line_with_long_string/edge_cases.py
+-rw-r--r--   0        0        0    11060 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/configurable_cases/line_with_long_string/long_strings_flag_disabled__Black_default.py
+-rw-r--r--   0        0        0    22087 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/configurable_cases/line_with_long_string/long_strings_flag_disabled__Cercis_default.py
+-rw-r--r--   0        0        0     6138 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/configurable_cases/line_with_long_string/test_cases__Black_default.py
+-rw-r--r--   0        0        0     6056 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/configurable_cases/line_with_long_string/test_cases__Cercis_default.py
+-rw-r--r--   0        0        0     6193 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/configurable_cases/nested_brackets/nested_brackets__Black_default.py
+-rw-r--r--   0        0        0     2832 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/configurable_cases/nested_brackets/nested_brackets__Cercis_default.py
+-rw-r--r--   0        0        0     2011 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/configurable_cases/nested_brackets/nested_brackets_explodes__Black_default.py
+-rw-r--r--   0        0        0     2212 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/configurable_cases/nested_brackets/nested_brackets_explodes__Cercis_default.py
+-rw-r--r--   0        0        0     7699 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/configurable_cases/pragma_comments/Black_default.py
+-rw-r--r--   0        0        0    10763 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/configurable_cases/pragma_comments/Cercis_default.py
+-rw-r--r--   0        0        0     7702 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/configurable_cases/single_quote/docstring.py
+-rw-r--r--   0        0        0      140 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/configurable_cases/single_quote/docstring_no_extra_empty_line_before_eof.py
+-rw-r--r--   0        0        0     3513 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/configurable_cases/single_quote/docstring_preview.py
+-rw-r--r--   0        0        0      745 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/configurable_cases/single_quote/more_quotes.py
+-rw-r--r--   0        0        0      845 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/configurable_cases/single_quote/string_prefixes.py
+-rw-r--r--   0        0        0     2279 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/configurable_cases/single_quote/torture.py
+-rw-r--r--   0        0        0      498 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/fast/pep_572_do_not_remove_parens.py
+-rw-r--r--   0        0        0        5 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/gitignore_used_on_multiple_sources/.gitignore
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/gitignore_used_on_multiple_sources/dir1/a.py
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/gitignore_used_on_multiple_sources/dir1/b.py
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/gitignore_used_on_multiple_sources/dir2/a.py
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/gitignore_used_on_multiple_sources/dir2/b.py
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/ignore_subfolders_gitignore_tests/a.py
+-rw-r--r--   0        0        0        4 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/ignore_subfolders_gitignore_tests/subdir/.gitignore
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/ignore_subfolders_gitignore_tests/subdir/b.py
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/ignore_subfolders_gitignore_tests/subdir/subdir/c.py
+-rw-r--r--   0        0        0       14 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/include_exclude_tests/.gitignore
+-rw-r--r--   0        0        0      114 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/include_exclude_tests/pyproject.toml
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/include_exclude_tests/b/.definitely_exclude/a.pie
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/include_exclude_tests/b/.definitely_exclude/a.py
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/include_exclude_tests/b/.definitely_exclude/a.pyi
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/include_exclude_tests/b/dont_exclude/a.pie
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/include_exclude_tests/b/dont_exclude/a.py
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/include_exclude_tests/b/dont_exclude/a.pyi
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/include_exclude_tests/b/exclude/a.pie
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/include_exclude_tests/b/exclude/a.py
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/include_exclude_tests/b/exclude/a.pyi
+-rw-r--r--   0        0        0        2 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/invalid_gitignore_tests/.gitignore
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/invalid_gitignore_tests/a.py
+-rw-r--r--   0        0        0       89 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/invalid_gitignore_tests/pyproject.toml
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/invalid_nested_gitignore_tests/a.py
+-rw-r--r--   0        0        0       89 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/invalid_nested_gitignore_tests/pyproject.toml
+-rw-r--r--   0        0        0        2 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/invalid_nested_gitignore_tests/a/.gitignore
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/invalid_nested_gitignore_tests/a/a.py
+-rw-r--r--   0        0        0      436 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/jupyter/non_python_notebook.ipynb
+-rw-r--r--   0        0        0      371 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/jupyter/notebook_empty_metadata.ipynb
+-rw-r--r--   0        0        0      641 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/jupyter/notebook_no_trailing_newline.ipynb
+-rw-r--r--   0        0        0      642 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/jupyter/notebook_trailing_newline.ipynb
+-rw-r--r--   0        0        0        4 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/jupyter/notebook_which_cant_be_parsed.ipynb
+-rw-r--r--   0        0        0      761 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/jupyter/notebook_without_changes.ipynb
+-rw-r--r--   0        0        0      495 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/miscellaneous/async_as_identifier.py
+-rw-r--r--   0        0        0      255 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/miscellaneous/blackd_diff.diff
+-rw-r--r--   0        0        0       98 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/miscellaneous/blackd_diff.py
+-rw-r--r--   0        0        0    15604 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/miscellaneous/debug_visitor.out
+-rw-r--r--   0        0        0     1193 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/miscellaneous/debug_visitor.py
+-rw-r--r--   0        0        0     1774 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/miscellaneous/decorators.py
+-rw-r--r--   0        0        0     3601 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/miscellaneous/docstring_no_string_normalization.py
+-rw-r--r--   0        0        0      357 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/miscellaneous/docstring_preview_no_string_normalization.py
+-rw-r--r--   0        0        0    15711 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/miscellaneous/expression_skip_magic_trailing_comma.diff
+-rw-r--r--   0        0        0      626 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/miscellaneous/force_py36.py
+-rw-r--r--   0        0        0      793 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/miscellaneous/force_pyi.py
+-rw-r--r--   0        0        0       59 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/miscellaneous/invalid_header.py
+-rw-r--r--   0        0        0      101 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/miscellaneous/linelength6.py
+-rw-r--r--   0        0        0    11583 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/miscellaneous/long_strings_flag_disabled.py
+-rw-r--r--   0        0        0      293 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/miscellaneous/missing_final_newline.diff
+-rw-r--r--   0        0        0      145 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/miscellaneous/missing_final_newline.py
+-rw-r--r--   0        0        0      284 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/miscellaneous/nested_class_stub.pyi
+-rw-r--r--   0        0        0      279 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/miscellaneous/pattern_matching_invalid.py
+-rw-r--r--   0        0        0       69 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/miscellaneous/power_op_newline.py
+-rw-r--r--   0        0        0      758 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/miscellaneous/python2_detection.py
+-rw-r--r--   0        0        0     2361 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/miscellaneous/string_quotes.py
+-rw-r--r--   0        0        0     2266 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/miscellaneous/stub.pyi
+-rw-r--r--   0        0        0      114 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/nested_gitignore_tests/pyproject.toml
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/nested_gitignore_tests/x.py
+-rw-r--r--   0        0        0        5 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/nested_gitignore_tests/root/.gitignore
+-rw-r--r--   0        0        0       39 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/nested_gitignore_tests/root/a.py
+-rw-r--r--   0        0        0       21 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/nested_gitignore_tests/root/b.py
+-rw-r--r--   0        0        0       21 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/nested_gitignore_tests/root/c.py
+-rw-r--r--   0        0        0        5 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/nested_gitignore_tests/root/child/.gitignore
+-rw-r--r--   0        0        0       39 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/nested_gitignore_tests/root/child/a.py
+-rw-r--r--   0        0        0       40 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/nested_gitignore_tests/root/child/b.py
+-rw-r--r--   0        0        0       21 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/nested_gitignore_tests/root/child/c.py
+-rw-r--r--   0        0        0      279 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/preview/async_stmts.py
+-rw-r--r--   0        0        0     4107 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/preview/cantfit.py
+-rw-r--r--   0        0        0     8294 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/preview/comments7.py
+-rw-r--r--   0        0        0      613 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/preview/format_unicode_escape_seq.py
+-rw-r--r--   0        0        0     2784 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/preview/long_dict_values.py
+-rw-r--r--   0        0        0    33216 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/preview/long_strings.py
+-rw-r--r--   0        0        0     1418 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/preview/long_strings__east_asian_width.py
+-rw-r--r--   0        0        0     6536 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/preview/long_strings__edge_case.py
+-rw-r--r--   0        0        0    45897 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/preview/long_strings__regression.py
+-rw-r--r--   0        0        0     1105 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/preview/long_strings__type_annotations.py
+-rw-r--r--   0        0        0     7207 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/preview/multiline_strings.py
+-rw-r--r--   0        0        0      481 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/preview/percent_precedence.py
+-rw-r--r--   0        0        0     2525 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/preview/prefer_rhs_split.py
+-rw-r--r--   0        0        0      342 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/preview/return_annotation_brackets_string.py
+-rw-r--r--   0        0        0      655 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/preview/trailing_comma.py
+-rw-r--r--   0        0        0     1140 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/preview_context_managers/targeting_py38.py
+-rw-r--r--   0        0        0     3361 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/preview_context_managers/targeting_py39.py
+-rw-r--r--   0        0        0      595 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/preview_context_managers/auto_detect/features_3_10.py
+-rw-r--r--   0        0        0      553 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/preview_context_managers/auto_detect/features_3_11.py
+-rw-r--r--   0        0        0     1058 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/preview_context_managers/auto_detect/features_3_8.py
+-rw-r--r--   0        0        0      623 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/preview_context_managers/auto_detect/features_3_9.py
+-rw-r--r--   0        0        0      133 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/project_metadata/both_pyproject.toml
+-rw-r--r--   0        0        0       74 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/project_metadata/neither_pyproject.toml
+-rw-r--r--   0        0        0      101 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/project_metadata/only_black_pyproject.toml
+-rw-r--r--   0        0        0      106 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/project_metadata/only_metadata_pyproject.toml
+-rw-r--r--   0        0        0      765 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/py_310/parenthesized_context_managers.py
+-rw-r--r--   0        0        0     2668 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/py_310/pattern_matching_complex.py
+-rw-r--r--   0        0        0     1965 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/py_310/pattern_matching_extras.py
+-rw-r--r--   0        0        0     3066 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/py_310/pattern_matching_generic.py
+-rw-r--r--   0        0        0     2641 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/py_310/pattern_matching_simple.py
+-rw-r--r--   0        0        0     1061 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/py_310/pattern_matching_style.py
+-rw-r--r--   0        0        0      491 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/py_310/pep_572_py310.py
+-rw-r--r--   0        0        0      509 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/py_310/remove_newline_after_match.py
+-rw-r--r--   0        0        0      380 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/py_310/starred_for_target.py
+-rw-r--r--   0        0        0     2114 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/py_311/pep_646.py
+-rw-r--r--   0        0        0      972 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/py_311/pep_654.py
+-rw-r--r--   0        0        0     2033 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/py_311/pep_654_style.py
+-rw-r--r--   0        0        0      597 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/py_36/numeric_literals.py
+-rw-r--r--   0        0        0      267 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/py_36/numeric_literals_skip_underscores.py
+-rw-r--r--   0        0        0     1199 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/py_37/python37.py
+-rw-r--r--   0        0        0      740 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/py_38/pep_570.py
+-rw-r--r--   0        0        0      970 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/py_38/pep_572.py
+-rw-r--r--   0        0        0     1895 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/py_38/pep_572_remove_parens.py
+-rw-r--r--   0        0        0      834 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/py_38/python38.py
+-rw-r--r--   0        0        0      251 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/py_39/pep_572_py39.py
+-rw-r--r--   0        0        0      696 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/py_39/python39.py
+-rw-r--r--   0        0        0     2575 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/py_39/remove_with_brackets.py
+-rw-r--r--   0        0        0      907 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/simple_cases/attribute_access_on_number_literals.py
+-rw-r--r--   0        0        0       63 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/simple_cases/beginning_backslash.py
+-rw-r--r--   0        0        0      333 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/simple_cases/bracketmatch.py
+-rw-r--r--   0        0        0     1091 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/simple_cases/class_blank_parentheses.py
+-rw-r--r--   0        0        0     4318 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/simple_cases/class_methods_new_line.py
+-rw-r--r--   0        0        0     3294 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/simple_cases/collections.py
+-rw-r--r--   0        0        0      212 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/simple_cases/comment_after_escaped_newline.py
+-rw-r--r--   0        0        0     1909 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/simple_cases/comments.py
+-rw-r--r--   0        0        0     7639 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/simple_cases/comments2.py
+-rw-r--r--   0        0        0     1573 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/simple_cases/comments3.py
+-rw-r--r--   0        0        0     3536 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/simple_cases/comments4.py
+-rw-r--r--   0        0        0     1196 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/simple_cases/comments5.py
+-rw-r--r--   0        0        0     2567 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/simple_cases/comments6.py
+-rw-r--r--   0        0        0      300 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/simple_cases/comments8.py
+-rw-r--r--   0        0        0     5279 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/simple_cases/comments9.py
+-rw-r--r--   0        0        0      994 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/simple_cases/comments_non_breaking_space.py
+-rw-r--r--   0        0        0     5597 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/simple_cases/composition.py
+-rw-r--r--   0        0        0    11198 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/simple_cases/composition_no_trailing_comma.py
+-rw-r--r--   0        0        0     7699 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/simple_cases/docstring.py
+-rw-r--r--   0        0        0      140 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/simple_cases/docstring_no_extra_empty_line_before_eof.py
+-rw-r--r--   0        0        0     3513 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/simple_cases/docstring_preview.py
+-rw-r--r--   0        0        0     4596 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/simple_cases/empty_lines.py
+-rw-r--r--   0        0        0    15801 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/simple_cases/expression.diff
+-rw-r--r--   0        0        0    18624 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/simple_cases/expression.py
+-rw-r--r--   0        0        0     9681 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/simple_cases/fmtonoff.py
+-rw-r--r--   0        0        0      604 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/simple_cases/fmtonoff2.py
+-rw-r--r--   0        0        0      251 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/simple_cases/fmtonoff3.py
+-rw-r--r--   0        0        0      278 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/simple_cases/fmtonoff4.py
+-rw-r--r--   0        0        0     3627 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/simple_cases/fmtonoff5.py
+-rw-r--r--   0        0        0      277 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/simple_cases/fmtpass_imports.py
+-rw-r--r--   0        0        0       40 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/simple_cases/fmtskip.py
+-rw-r--r--   0        0        0      555 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/simple_cases/fmtskip2.py
+-rw-r--r--   0        0        0      362 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/simple_cases/fmtskip3.py
+-rw-r--r--   0        0        0       92 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/simple_cases/fmtskip4.py
+-rw-r--r--   0        0        0      301 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/simple_cases/fmtskip5.py
+-rw-r--r--   0        0        0      235 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/simple_cases/fmtskip6.py
+-rw-r--r--   0        0        0      356 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/simple_cases/fmtskip7.py
+-rw-r--r--   0        0        0     1705 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/simple_cases/fmtskip8.py
+-rw-r--r--   0        0        0      989 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/simple_cases/fstring.py
+-rw-r--r--   0        0        0     6482 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/simple_cases/function.py
+-rw-r--r--   0        0        0     2427 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/simple_cases/function2.py
+-rw-r--r--   0        0        0     3657 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/simple_cases/function_trailing_comma.py
+-rw-r--r--   0        0        0     2542 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/simple_cases/import_spacing.py
+-rw-r--r--   0        0        0      674 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/simple_cases/one_element_subscript.py
+-rw-r--r--   0        0        0     3359 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/simple_cases/power_op_spacing.py
+-rw-r--r--   0        0        0     1106 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/simple_cases/prefer_rhs_split_reformatted.py
+-rw-r--r--   0        0        0     3205 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/simple_cases/remove_await_parens.py
+-rw-r--r--   0        0        0     2025 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/simple_cases/remove_except_parens.py
+-rw-r--r--   0        0        0     1460 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/simple_cases/remove_for_brackets.py
+-rw-r--r--   0        0        0     3351 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/simple_cases/remove_newline_after_code_block_open.py
+-rw-r--r--   0        0        0     3493 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/simple_cases/remove_parens.py
+-rw-r--r--   0        0        0     5141 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/simple_cases/return_annotation_brackets.py
+-rw-r--r--   0        0        0     1398 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/simple_cases/skip_magic_trailing_comma.py
+-rw-r--r--   0        0        0      787 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/simple_cases/slices.py
+-rw-r--r--   0        0        0      845 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/simple_cases/string_prefixes.py
+-rw-r--r--   0        0        0     2279 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/simple_cases/torture.py
+-rw-r--r--   0        0        0     1615 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/simple_cases/trailing_comma_optional_parens1.py
+-rw-r--r--   0        0        0      248 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/simple_cases/trailing_comma_optional_parens2.py
+-rw-r--r--   0        0        0      967 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/simple_cases/trailing_comma_optional_parens3.py
+-rw-r--r--   0        0        0     2123 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/simple_cases/trailing_commas_in_leading_parts.py
+-rw-r--r--   0        0        0       80 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/simple_cases/tricky_unicode_symbols.py
+-rw-r--r--   0        0        0      510 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/simple_cases/tupleassign.py
+-rw-r--r--   0        0        0       27 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/simple_cases/whitespace.py
+-rw-r--r--   0        0        0      101 2020-02-02 00:00:00.000000 cercis-0.1.3/tests/data/type_comments/type_comment_syntax_error.py
+-rw-r--r--   0        0        0      273 2020-02-02 00:00:00.000000 cercis-0.1.3/.gitignore
+-rw-r--r--   0        0        0     1061 2020-02-02 00:00:00.000000 cercis-0.1.3/LICENSE
+-rw-r--r--   0        0        0     1080 2020-02-02 00:00:00.000000 cercis-0.1.3/LICENSE_ORIGINAL
+-rw-r--r--   0        0        0     7134 2020-02-02 00:00:00.000000 cercis-0.1.3/pyproject.toml
+-rw-r--r--   0        0        0    17093 2020-02-02 00:00:00.000000 cercis-0.1.3/PKG-INFO
```

### Comparing `cercis-0.1.2/.pre-commit-config.yaml` & `cercis-0.1.3/.pre-commit-config.yaml`

 * *Files 14% similar despite different names*

```diff
@@ -33,14 +33,14 @@
           - pytest
           - hypothesis
 
   - repo: https://github.com/pre-commit/mirrors-prettier
     rev: v2.7.1
     hooks:
       - id: prettier
-        exclude: \.github/workflows/diff_shades\.yml
+        exclude: .*\.ya?ml
 
   - repo: https://github.com/pre-commit/pre-commit-hooks
     rev: v4.3.0
     hooks:
       - id: end-of-file-fixer
       - id: trailing-whitespace
```

### Comparing `cercis-0.1.2/.pre-commit-hooks.yaml` & `cercis-0.1.3/.pre-commit-hooks.yaml`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/Dockerfile` & `cercis-0.1.3/Dockerfile`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/action.yml` & `cercis-0.1.3/action.yml`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/mypy.ini` & `cercis-0.1.3/mypy.ini`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tox.ini` & `cercis-0.1.3/tox.ini`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/.github/PULL_REQUEST_TEMPLATE.md` & `cercis-0.1.3/.github/PULL_REQUEST_TEMPLATE.md`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/.github/dependabot.yml` & `cercis-0.1.3/.github/dependabot.yml`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/.github/ISSUE_TEMPLATE/bug_report.md` & `cercis-0.1.3/.github/ISSUE_TEMPLATE/bug_report.md`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/.github/ISSUE_TEMPLATE/config.yml` & `cercis-0.1.3/.github/ISSUE_TEMPLATE/config.yml`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/.github/ISSUE_TEMPLATE/docs-issue.md` & `cercis-0.1.3/.github/ISSUE_TEMPLATE/docs-issue.md`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/.github/ISSUE_TEMPLATE/feature_request.md` & `cercis-0.1.3/.github/ISSUE_TEMPLATE/feature_request.md`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/.github/ISSUE_TEMPLATE/style_issue.md` & `cercis-0.1.3/.github/ISSUE_TEMPLATE/style_issue.md`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/.github/workflows/docker.yml` & `cercis-0.1.3/.github/workflows/docker.yml`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/.github/workflows/fuzz.yml` & `cercis-0.1.3/.github/workflows/fuzz.yml`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/.github/workflows/lint.yml` & `cercis-0.1.3/.github/workflows/lint.yml`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/.github/workflows/python-package.yml` & `cercis-0.1.3/.github/workflows/python-package.yml`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/.github/workflows/python-publish.yml` & `cercis-0.1.3/.github/workflows/python-publish.yml`

 * *Files 19% similar despite different names*

```diff
@@ -21,14 +21,18 @@
 
     steps:
       - uses: actions/checkout@v3
       - name: Set up Python
         uses: actions/setup-python@v3
         with:
           python-version: "3.x"
+      - name: Check version in CHANGELOG.md
+        run: |
+          python -m pip install requests
+          python ./scripts/check_version_and_changelog.py main
       - name: Install dependencies
         run: |
           python -m pip install --upgrade pip
           pip install build
       - name: Build package
         run: python -m build
       - name: Publish package
```

### Comparing `cercis-0.1.2/.github/workflows/test.yml` & `cercis-0.1.3/.github/workflows/test.yml`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/.github/workflows/upload_binary.yml` & `cercis-0.1.3/.github/workflows/upload_binary.yml`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/action/main.py` & `cercis-0.1.3/action/main.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/autoload/black.vim` & `cercis-0.1.3/autoload/black.vim`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/gallery/README.md` & `cercis-0.1.3/gallery/README.md`

 * *Files 14% similar despite different names*

```diff
@@ -1,11 +1,12 @@
 # Gallery
 
-Gallery is a script that automates the process of applying different _Black_ versions to
-a selected PyPI package and seeing the results between _Black_ versions.
+Gallery is a script that automates the process of applying different _Black_
+versions to a selected PyPI package and seeing the results between _Black_
+versions.
 
 ## Build
 
 ```console
 $ docker build -t black_gallery .
 ```
```

### Comparing `cercis-0.1.2/gallery/gallery.py` & `cercis-0.1.3/gallery/gallery.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/plugin/black.vim` & `cercis-0.1.3/plugin/black.vim`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/scripts/diff_shades_gha_helper.py` & `cercis-0.1.3/scripts/diff_shades_gha_helper.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/scripts/fuzz.py` & `cercis-0.1.3/scripts/fuzz.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/scripts/make_width_table.py` & `cercis-0.1.3/scripts/make_width_table.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/scripts/migrate-black.py` & `cercis-0.1.3/scripts/migrate-black.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/src/blackd/__init__.py` & `cercis-0.1.3/src/blackd/__init__.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/src/blackd/middlewares.py` & `cercis-0.1.3/src/blackd/middlewares.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/src/blib2to3/Grammar.txt` & `cercis-0.1.3/src/blib2to3/Grammar.txt`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/src/blib2to3/LICENSE` & `cercis-0.1.3/src/blib2to3/LICENSE`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/src/blib2to3/PatternGrammar.txt` & `cercis-0.1.3/src/blib2to3/PatternGrammar.txt`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/src/blib2to3/README` & `cercis-0.1.3/src/blib2to3/README`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/src/blib2to3/pygram.py` & `cercis-0.1.3/src/blib2to3/pygram.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/src/blib2to3/pytree.py` & `cercis-0.1.3/src/blib2to3/pytree.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/src/blib2to3/pgen2/conv.py` & `cercis-0.1.3/src/blib2to3/pgen2/conv.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/src/blib2to3/pgen2/driver.py` & `cercis-0.1.3/src/blib2to3/pgen2/driver.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/src/blib2to3/pgen2/grammar.py` & `cercis-0.1.3/src/blib2to3/pgen2/grammar.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/src/blib2to3/pgen2/literals.py` & `cercis-0.1.3/src/blib2to3/pgen2/literals.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/src/blib2to3/pgen2/parse.py` & `cercis-0.1.3/src/blib2to3/pgen2/parse.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/src/blib2to3/pgen2/pgen.py` & `cercis-0.1.3/src/blib2to3/pgen2/pgen.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/src/blib2to3/pgen2/token.py` & `cercis-0.1.3/src/blib2to3/pgen2/token.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/src/blib2to3/pgen2/tokenize.py` & `cercis-0.1.3/src/blib2to3/pgen2/tokenize.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/src/cercis/__init__.py` & `cercis-0.1.3/src/cercis/__init__.py`

 * *Files 2% similar despite different names*

```diff
@@ -35,20 +35,22 @@
 
 from _cercis_version import version as __version__
 from blib2to3.pgen2 import token
 from blib2to3.pytree import Leaf, Node
 from cercis.cache import Cache, get_cache_info, read_cache, write_cache
 from cercis.comments import normalize_fmt_off
 from cercis.const import (
+    DEFAULT_COLLAPSE_NESTED_BRACKETS,
     DEFAULT_EXCLUDES,
     DEFAULT_FUNCTION_DEFINITION_EXTRA_INDENT,
     DEFAULT_INCLUDES,
     DEFAULT_LINE_LENGTH,
     DEFAULT_SINGLE_QUOTE,
     DEFAULT_WRAP_LINE_WITH_LONG_STRING,
+    DEFAULT_WRAP_PRAGMA_COMMENTS,
     STDIN_PLACEHOLDER,
 )
 from cercis.files import (
     find_project_root,
     find_pyproject_toml,
     find_user_pyproject_toml,
     gen_python_files,
@@ -243,14 +245,37 @@
     help=(
         "If False, do not wrap lines with just a variable, an operator, and"
         " a long string, even if it exceeds the line length limit. If True,"
         " wrap that line with the string put in parentheses."
     ),
 )
 @click.option(
+    "-cnb",
+    "--collapse-nested-brackets",
+    type=bool,
+    show_default=True,
+    default=DEFAULT_COLLAPSE_NESTED_BRACKETS,
+    help=(
+        "If True, collapse nested brackets on one line, instead of exploding"
+        " into multiple levels in multiple lines"
+    ),
+)
+@click.option(
+    "-wpc",
+    "--wrap-pragma-comments",
+    type=bool,
+    show_default=True,
+    default=DEFAULT_WRAP_PRAGMA_COMMENTS,
+    help=(
+        "If False, do not wrap long lines if the line exceeds length limit"
+        " only because of trailing pragma comments. Black's default behavior"
+        " is 'True'."
+    ),
+)
+@click.option(
     "-t",
     "--target-version",
     type=click.Choice([v.name.lower() for v in TargetVersion]),
     callback=target_version_option_callback,
     multiple=True,
     help=(
         "Python versions that should be supported by Cercis's output. By default,"
@@ -462,14 +487,16 @@
 def main(  # noqa: C901
         ctx: click.Context,
         code: Optional[str],
         line_length: int,
         function_definition_extra_indent: bool,
         single_quote: bool,
         wrap_line_with_long_string: bool,
+        collapse_nested_brackets: bool,
+        wrap_pragma_comments: bool,
         target_version: List[TargetVersion],
         check: bool,
         diff: bool,
         color: bool,
         fast: bool,
         pyi: bool,
         ipynb: bool,
@@ -587,14 +614,16 @@
         magic_trailing_comma=not skip_magic_trailing_comma,
         experimental_string_processing=experimental_string_processing,
         preview=preview,
         python_cell_magics=set(python_cell_magics),
         function_definition_extra_indent=function_definition_extra_indent,
         single_quote=single_quote,
         wrap_line_with_long_string=wrap_line_with_long_string,
+        collapse_nested_brackets=collapse_nested_brackets,
+        wrap_pragma_comments=wrap_pragma_comments,
     )
 
     if code is not None:
         # Run in quiet mode by default with -c; the extra output isn't useful.
         # You can still pass -v to get verbose output.
         quiet = True
 
@@ -1393,26 +1422,27 @@
 
     try:
         dst_ast = parse_ast(dst)
     except Exception as exc:
         log = dump_to_file("".join(traceback.format_tb(exc.__traceback__)), dst)
         raise AssertionError(
             f"INTERNAL ERROR: Cercis produced invalid code: {exc}. "
-            "Please report a bug on https://github.com/psf/black/issues.  "
+            "Please report a bug on https://github.com/jsh9/cercis/issues.  "
             f"This invalid output might be helpful: {log}"
         ) from None
 
     src_ast_str = "\n".join(stringify_ast(src_ast))
     dst_ast_str = "\n".join(stringify_ast(dst_ast))
     if src_ast_str != dst_ast_str:
         log = dump_to_file(diff(src_ast_str, dst_ast_str, "src", "dst"))
         raise AssertionError(
             "INTERNAL ERROR: Cercis produced code that is not equivalent to the"
             " source.  Please report a bug on "
-            f"https://github.com/psf/black/issues.  This diff might be helpful: {log}"
+            "https://github.com/jsh9/cercis/issues."
+            f" This diff might be helpful: {log}"
         ) from None
 
 
 def assert_stable(src: str, dst: str, mode: Mode) -> None:
     """Raise AssertionError if `dst` reformats differently the second time."""
     # We shouldn't call format_str() here, because that formats the string
     # twice and may hide a bug where we bounce back and forth between two
@@ -1422,15 +1452,15 @@
         log = dump_to_file(
             str(mode),
             diff(src, dst, "source", "first pass"),
             diff(dst, newdst, "first pass", "second pass"),
         )
         raise AssertionError(
             "INTERNAL ERROR: Cercis produced different code on the second pass of the"
-            " formatter.  Please report a bug on https://github.com/psf/black/issues."
+            " formatter. Please report a bug on https://github.com/jsh9/cercis/issues"
             f"  This diff might be helpful: {log}"
         ) from None
 
 
 @contextmanager
 def nullcontext() -> Iterator[None]:
     """Return an empty context manager.
```

### Comparing `cercis-0.1.2/src/cercis/_width_table.py` & `cercis-0.1.3/src/cercis/_width_table.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/src/cercis/brackets.py` & `cercis-0.1.3/src/cercis/brackets.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/src/cercis/cache.py` & `cercis-0.1.3/src/cercis/cache.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/src/cercis/comments.py` & `cercis-0.1.3/src/cercis/comments.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/src/cercis/concurrency.py` & `cercis-0.1.3/src/cercis/concurrency.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/src/cercis/debug.py` & `cercis-0.1.3/src/cercis/debug.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/src/cercis/files.py` & `cercis-0.1.3/src/cercis/files.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/src/cercis/handle_ipynb_magics.py` & `cercis-0.1.3/src/cercis/handle_ipynb_magics.py`

 * *Files 1% similar despite different names*

```diff
@@ -119,15 +119,15 @@
         if token.name in TOKENS_TO_IGNORE:
             continue
         tokens[idx] = token._replace(src=token.src + ";")
         break
     else:  # pragma: nocover
         raise AssertionError(
             "INTERNAL ERROR: Was not able to reinstate trailing semicolon. "
-            "Please report a bug on https://github.com/psf/black/issues.  "
+            "Please report a bug on https://github.com/jsh9/cercis/issues.  "
         ) from None
     return str(tokens_to_src(tokens))
 
 
 def mask_cell(src: str) -> Tuple[str, List[Replacement]]:
     """Mask IPython magics so content becomes parseable Python code.
 
@@ -182,20 +182,20 @@
     counter = 0
     while token in src:
         token = TOKEN_HEX(nbytes)
         counter += 1
         if counter > 100:
             raise AssertionError(
                 "INTERNAL ERROR: Black was not able to replace IPython magic. "
-                "Please report a bug on https://github.com/psf/black/issues.  "
+                "Please report a bug on https://github.com/jsh9/cercis/issues.  "
                 f"The magic might be helpful: {magic}"
             ) from None
     if len(token) + 2 < len(magic):
         token = f"{token}."
-    return f'"{token}"'
+    return f"'{token}'"
 
 
 def replace_cell_magics(src: str) -> Tuple[str, List[Replacement]]:
     """Replace cell magic with token.
 
     Note that 'src' will already have been processed by IPython's
     TransformerManager().transform_cell.
@@ -249,15 +249,15 @@
     new_srcs = []
     for i, line in enumerate(src.splitlines(), start=1):
         if i in magic_finder.magics:
             offsets_and_magics = magic_finder.magics[i]
             if len(offsets_and_magics) != 1:  # pragma: nocover
                 raise AssertionError(
                     f"Expecting one magic per line, got: {offsets_and_magics}\n"
-                    "Please report a bug on https://github.com/psf/black/issues."
+                    "Please report a bug on https://github.com/jsh9/cercis/issues."
                 )
             col_offset, magic = (
                 offsets_and_magics[0].col_offset,
                 offsets_and_magics[0].magic,
             )
             mask = get_token(src, magic)
             replacements.append(Replacement(mask=mask, src=magic))
@@ -406,15 +406,15 @@
             elif node.value.func.attr == "run_line_magic":
                 src = f"%{args[0]}"
                 if args[1]:
                     src += f" {args[1]}"
             else:
                 raise AssertionError(
                     f"Unexpected IPython magic {node.value.func.attr!r} found. "
-                    "Please report a bug on https://github.com/psf/black/issues."
+                    "Please report a bug on https://github.com/jsh9/cercis/issues."
                 ) from None
             self.magics[node.value.lineno].append(
                 OffsetAndMagic(node.value.col_offset, src)
             )
         self.generic_visit(node)
 
     def visit_Expr(self, node: ast.Expr) -> None:
```

### Comparing `cercis-0.1.2/src/cercis/linegen.py` & `cercis-0.1.3/src/cercis/linegen.py`

 * *Files 2% similar despite different names*

```diff
@@ -71,14 +71,15 @@
     StringParenStripper,
     StringParenWrapper,
     StringSplitter,
     Transformer,
     hug_power_op,
 )
 from cercis.utils_line_wrapping import check_eligibility_to_opt_out_of_line_wrapping
+from cercis.utils_linegen import perform_collapse_nested_brackets
 
 # types
 LeafID = int
 LN = Union[Leaf, Node]
 
 
 class CannotSplit(CannotTransform):
@@ -743,27 +744,49 @@
         # all content is in the tail.  Otherwise, if `head_leaves` are empty, it means
         # the matching `opening_bracket` wasn't available on `line` anymore.
         raise CannotSplit("No brackets found")
 
     tail_leaves.reverse()
     body_leaves.reverse()
     head_leaves.reverse()
+
+    collapse_nested_brackets_return_values = perform_collapse_nested_brackets(
+        line=line,
+        opening_bracket=opening_bracket,
+        closing_bracket=closing_bracket,
+        head_leaves=head_leaves,
+        body_leaves=body_leaves,
+        tail_leaves=tail_leaves,
+        mode=mode,
+        bracket_split_build_line_func=bracket_split_build_line,
+        bracket_split_component=_BracketSplitComponent,
+    )
+
+    head_leaves = collapse_nested_brackets_return_values.head_leaves
+    body_leaves = collapse_nested_brackets_return_values.body_leaves
+    tail_leaves = collapse_nested_brackets_return_values.tail_leaves
+    body = collapse_nested_brackets_return_values.body
+
     head = bracket_split_build_line(
         head_leaves,
         line,
         opening_bracket,
         component=_BracketSplitComponent.head,
         mode=mode,
     )
-    body = bracket_split_build_line(
-        body_leaves,
-        line,
-        opening_bracket,
-        component=_BracketSplitComponent.body,
-        mode=mode,
+    body = (
+        body
+        if body is not None
+        else bracket_split_build_line(
+            body_leaves,
+            line,
+            opening_bracket,
+            component=_BracketSplitComponent.body,
+            mode=mode,
+        )
     )
     tail = bracket_split_build_line(
         tail_leaves,
         line,
         opening_bracket,
         component=_BracketSplitComponent.tail,
         mode=mode,
```

### Comparing `cercis-0.1.2/src/cercis/lines.py` & `cercis-0.1.3/src/cercis/lines.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,9 +1,10 @@
 import itertools
 import math
+import re
 import sys
 from dataclasses import dataclass, field
 from typing import (
     Callable,
     Dict,
     Iterator,
     List,
@@ -39,14 +40,17 @@
 
 # types
 T = TypeVar("T")
 Index = int
 LeafID = int
 LN = Union[Leaf, Node]
 
+# This regex should contain a single capture group capturing the entire match.
+_PRAGMA_REGEX = re.compile("( *# (?:pylint|pytype|noqa|type(?=: *ignore)):)")
+
 
 @dataclass
 class Line:
     """Holds leaves and comments. Can be printed with `str(line)`."""
 
     mode: Mode
     depth: int = 0
@@ -221,14 +225,24 @@
         for leaf in self.leaves:
             if leaf.type == STANDALONE_COMMENT and leaf.bracket_depth <= depth_limit:
                 return True
 
         return False
 
     def contains_uncollapsable_type_comments(self) -> bool:
+        if not self.mode.wrap_pragma_comments:
+            # We bypass this method entirely because we are handling
+            # all pragma comments (such as "noqa", "pylint", "type: ignore")
+            # together elsewhere.
+            return False
+
+        # The following is Black's default (wrap_pragma_comment == True).
+        # With this style, if a line has "# type: ignore" as the comment,
+        # it will not be wrapped no matter how long it is.
+
         ignored_ids = set()
         try:
             last_leaf = self.leaves[-1]
             ignored_ids.add(id(last_leaf))
             if last_leaf.type == token.COMMA or (
                 last_leaf.type == token.RPAR and not last_leaf.value
             ):
@@ -257,14 +271,24 @@
                         return True
 
                 comment_seen = True
 
         return False
 
     def contains_unsplittable_type_ignore(self) -> bool:
+        if not self.mode.wrap_pragma_comments:
+            # We bypass this method entirely because we are handling
+            # all pragma comments (such as "noqa", "pylint", "type: ignore")
+            # together elsewhere.
+            return False
+
+        # The following is Black's default (wrap_pragma_comment == True).
+        # With this style, if a line has "# type: ignore" as the comment,
+        # it will not be wrapped no matter how long it is.
+
         if not self.leaves:
             return False
 
         # If a 'type: ignore' is attached to the end of a line, we
         # can't split the line, because we can't know which of the
         # subexpressions the ignore was meant to apply to.
         #
@@ -289,14 +313,34 @@
             for node in self.leaves[-2:]:
                 for comment in self.comments.get(id(node), []):
                     if is_type_comment(comment, " ignore"):
                         return True
 
         return False
 
+    def trailing_pragma_comment_length(self) -> int:
+        """
+        This method comes from the wonderful implementation in Pyink:
+        https://github.com/google/pyink/blob/f93771c02e9a26ce9508c59d69c9337c95797eac/src/pyink/lines.py#L316-L328
+
+        Pyink is another fork from Black, and inherits Black's MIT license.
+        """
+        if not self.leaves:
+            return 0
+
+        last_leaf = self.leaves[-1]
+        length = 0
+        for comment in self.comments.get(id(last_leaf), []):
+            # str(comment) contains the whitespace preceding the `#`
+            comment_str = str(comment)
+            parts = _PRAGMA_REGEX.split(comment_str, maxsplit=1)
+            if len(parts) == 3:
+                length += len(parts[1]) + len(parts[2])
+        return length
+
     def contains_multiline_strings(self) -> bool:
         return any(is_multiline_string(leaf) for leaf in self.leaves)
 
     def has_magic_trailing_comma(
             self, closing: Leaf, ensure_removable: bool = False
     ) -> bool:
         """Return True if we have a magic trailing comma, that is when:
@@ -757,27 +801,31 @@
     if it should be inlined or split up.
     Uses the provided `line_str` rendering, if any, otherwise computes a new one.
     """
     if not line_str:
         line_str = line_to_string(line)
 
     width = str_width if mode.preview else len
+    if mode.wrap_pragma_comments:  # Black's default
+        effective_length = width(line_str)
+    else:  # Cercis's default
+        effective_length = width(line_str) - line.trailing_pragma_comment_length()
 
     if Preview.multiline_string_handling not in mode:
         return (
-            width(line_str) <= mode.line_length
+            effective_length <= mode.line_length
             and "\n" not in line_str  # multiline strings
             and not line.contains_standalone_comments()
         )
 
     if line.contains_standalone_comments():
         return False
     if "\n" not in line_str:
         # No multiline strings (MLS) present
-        return width(line_str) <= mode.line_length
+        return effective_length <= mode.line_length
 
     first, *_, last = line_str.split("\n")
     if width(first) > mode.line_length or width(last) > mode.line_length:
         return False
 
     # Traverse the AST to examine the context of the multiline string (MLS),
     # tracking aspects such as depth and comma existence,
```

### Comparing `cercis-0.1.2/src/cercis/mode.py` & `cercis-0.1.3/src/cercis/mode.py`

 * *Files 2% similar despite different names*

```diff
@@ -14,18 +14,20 @@
 
 if sys.version_info < (3, 8):
     from typing_extensions import Final
 else:
     from typing import Final
 
 from cercis.const import (
+    DEFAULT_COLLAPSE_NESTED_BRACKETS,
     DEFAULT_FUNCTION_DEFINITION_EXTRA_INDENT,
     DEFAULT_LINE_LENGTH,
     DEFAULT_SINGLE_QUOTE,
     DEFAULT_WRAP_LINE_WITH_LONG_STRING,
+    DEFAULT_WRAP_PRAGMA_COMMENTS,
 )
 
 
 class TargetVersion(Enum):
     PY33 = 3
     PY34 = 4
     PY35 = 5
@@ -188,14 +190,16 @@
     magic_trailing_comma: bool = True
     experimental_string_processing: bool = False
     python_cell_magics: Set[str] = field(default_factory=set)
     preview: bool = False
     function_definition_extra_indent: bool = DEFAULT_FUNCTION_DEFINITION_EXTRA_INDENT
     single_quote: bool = DEFAULT_SINGLE_QUOTE
     wrap_line_with_long_string: bool = DEFAULT_WRAP_LINE_WITH_LONG_STRING
+    collapse_nested_brackets: bool = DEFAULT_COLLAPSE_NESTED_BRACKETS
+    wrap_pragma_comments: bool = DEFAULT_WRAP_PRAGMA_COMMENTS
 
     def __post_init__(self) -> None:
         if self.experimental_string_processing:
             warn(
                 "`experimental string processing` has been included in `preview`"
                 " and deprecated. Use `preview` instead.",
                 Deprecated,
```

### Comparing `cercis-0.1.2/src/cercis/nodes.py` & `cercis-0.1.3/src/cercis/nodes.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/src/cercis/numerics.py` & `cercis-0.1.3/src/cercis/numerics.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/src/cercis/output.py` & `cercis-0.1.3/src/cercis/output.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/src/cercis/parsing.py` & `cercis-0.1.3/src/cercis/parsing.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/src/cercis/report.py` & `cercis-0.1.3/src/cercis/report.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/src/cercis/rusty.py` & `cercis-0.1.3/src/cercis/rusty.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/src/cercis/strings.py` & `cercis-0.1.3/src/cercis/strings.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/src/cercis/trans.py` & `cercis-0.1.3/src/cercis/trans.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/optional.py` & `cercis-0.1.3/tests/optional.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/test_black.py` & `cercis-0.1.3/tests/test_black.py`

 * *Files 1% similar despite different names*

```diff
@@ -352,5941 +352,5978 @@
 000015f0: 6c61 636b 5275 6e6e 6572 2829 2e69 6e76  lackRunner().inv
 00001600: 6f6b 6528 0a20 2020 2020 2020 2020 2020  oke(.           
 00001610: 2063 6572 6369 732e 6d61 696e 2c0a 2020   cercis.main,.  
 00001620: 2020 2020 2020 2020 2020 5b0a 2020 2020            [.    
 00001630: 2020 2020 2020 2020 2020 2020 222d 222c              "-",
 00001640: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
 00001650: 2022 2d2d 6661 7374 222c 0a20 2020 2020   "--fast",.     
-00001660: 2020 2020 2020 2020 2020 2066 222d 2d6c             f"--l
-00001670: 696e 652d 6c65 6e67 7468 3d7b 6365 7263  ine-length={cerc
-00001680: 6973 2e44 4546 4155 4c54 5f4c 494e 455f  is.DEFAULT_LINE_
-00001690: 4c45 4e47 5448 7d22 2c0a 2020 2020 2020  LENGTH}",.      
-000016a0: 2020 2020 2020 2020 2020 6622 2d2d 636f            f"--co
-000016b0: 6e66 6967 3d7b 454d 5054 595f 434f 4e46  nfig={EMPTY_CONF
-000016c0: 4947 7d22 2c0a 2020 2020 2020 2020 2020  IG}",.          
-000016d0: 2020 5d2c 0a20 2020 2020 2020 2020 2020    ],.           
-000016e0: 2069 6e70 7574 3d42 7974 6573 494f 2873   input=BytesIO(s
-000016f0: 6f75 7263 652e 656e 636f 6465 2822 7574  ource.encode("ut
-00001700: 6638 2229 292c 0a20 2020 2020 2020 2029  f8")),.        )
-00001710: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-00001720: 7365 7274 4571 7561 6c28 7265 7375 6c74  sertEqual(result
-00001730: 2e65 7869 745f 636f 6465 2c20 3029 0a20  .exit_code, 0). 
-00001740: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00001750: 7274 466f 726d 6174 4571 7561 6c28 6578  rtFormatEqual(ex
-00001760: 7065 6374 6564 2c20 7265 7375 6c74 2e6f  pected, result.o
-00001770: 7574 7075 7429 0a20 2020 2020 2020 2069  utput).        i
-00001780: 6620 736f 7572 6365 2021 3d20 7265 7375  f source != resu
-00001790: 6c74 2e6f 7574 7075 743a 0a20 2020 2020  lt.output:.     
-000017a0: 2020 2020 2020 2063 6572 6369 732e 6173         cercis.as
-000017b0: 7365 7274 5f65 7175 6976 616c 656e 7428  sert_equivalent(
-000017c0: 736f 7572 6365 2c20 7265 7375 6c74 2e6f  source, result.o
-000017d0: 7574 7075 7429 0a20 2020 2020 2020 2020  utput).         
-000017e0: 2020 2063 6572 6369 732e 6173 7365 7274     cercis.assert
-000017f0: 5f73 7461 626c 6528 736f 7572 6365 2c20  _stable(source, 
-00001800: 7265 7375 6c74 2e6f 7574 7075 742c 2044  result.output, D
-00001810: 4546 4155 4c54 5f4d 4f44 4529 0a0a 2020  EFAULT_MODE)..  
-00001820: 2020 6465 6620 7465 7374 5f70 6970 696e    def test_pipin
-00001830: 675f 6469 6666 2873 656c 6629 202d 3e20  g_diff(self) -> 
-00001840: 4e6f 6e65 3a0a 2020 2020 2020 2020 6469  None:.        di
-00001850: 6666 5f68 6561 6465 7220 3d20 7265 2e63  ff_header = re.c
-00001860: 6f6d 7069 6c65 280a 2020 2020 2020 2020  ompile(.        
-00001870: 2020 2020 7222 2853 5444 494e 7c53 5444      r"(STDIN|STD
-00001880: 4f55 5429 5c74 5c64 5c64 5c64 5c64 2d5c  OUT)\t\d\d\d\d-\
-00001890: 645c 642d 5c64 5c64 205c 645c 643a 5c64  d\d-\d\d \d\d:\d
-000018a0: 5c64 3a5c 645c 645c 2e5c 645c 645c 645c  \d:\d\d\.\d\d\d\
-000018b0: 645c 645c 6420 220a 2020 2020 2020 2020  d\d\d ".        
-000018c0: 2020 2020 7222 5c2b 5c64 5c64 5c64 5c64      r"\+\d\d\d\d
-000018d0: 220a 2020 2020 2020 2020 290a 2020 2020  ".        ).    
-000018e0: 2020 2020 736f 7572 6365 2c20 5f20 3d20      source, _ = 
-000018f0: 7265 6164 5f64 6174 6128 2273 696d 706c  read_data("simpl
-00001900: 655f 6361 7365 7322 2c20 2265 7870 7265  e_cases", "expre
-00001910: 7373 696f 6e2e 7079 2229 0a20 2020 2020  ssion.py").     
-00001920: 2020 2065 7870 6563 7465 642c 205f 203d     expected, _ =
-00001930: 2072 6561 645f 6461 7461 2822 7369 6d70   read_data("simp
-00001940: 6c65 5f63 6173 6573 222c 2022 6578 7072  le_cases", "expr
-00001950: 6573 7369 6f6e 2e64 6966 6622 290a 2020  ession.diff").  
-00001960: 2020 2020 2020 6172 6773 203d 205b 0a20        args = [. 
-00001970: 2020 2020 2020 2020 2020 2022 2d22 2c0a             "-",.
-00001980: 2020 2020 2020 2020 2020 2020 222d 2d66              "--f
-00001990: 6173 7422 2c0a 2020 2020 2020 2020 2020  ast",.          
-000019a0: 2020 6622 2d2d 6c69 6e65 2d6c 656e 6774    f"--line-lengt
-000019b0: 683d 7b63 6572 6369 732e 4445 4641 554c  h={cercis.DEFAUL
-000019c0: 545f 4c49 4e45 5f4c 454e 4754 487d 222c  T_LINE_LENGTH}",
-000019d0: 0a20 2020 2020 2020 2020 2020 2022 2d2d  .            "--
-000019e0: 6469 6666 222c 0a20 2020 2020 2020 2020  diff",.         
-000019f0: 2020 2066 222d 2d63 6f6e 6669 673d 7b45     f"--config={E
-00001a00: 4d50 5459 5f43 4f4e 4649 477d 222c 0a20  MPTY_CONFIG}",. 
-00001a10: 2020 2020 2020 205d 0a20 2020 2020 2020         ].       
-00001a20: 2072 6573 756c 7420 3d20 426c 6163 6b52   result = BlackR
-00001a30: 756e 6e65 7228 292e 696e 766f 6b65 280a  unner().invoke(.
-00001a40: 2020 2020 2020 2020 2020 2020 6365 7263              cerc
-00001a50: 6973 2e6d 6169 6e2c 2061 7267 732c 2069  is.main, args, i
-00001a60: 6e70 7574 3d42 7974 6573 494f 2873 6f75  nput=BytesIO(sou
-00001a70: 7263 652e 656e 636f 6465 2822 7574 6638  rce.encode("utf8
-00001a80: 2229 290a 2020 2020 2020 2020 290a 2020  ")).        ).  
-00001a90: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00001aa0: 7445 7175 616c 2872 6573 756c 742e 6578  tEqual(result.ex
-00001ab0: 6974 5f63 6f64 652c 2030 290a 2020 2020  it_code, 0).    
-00001ac0: 2020 2020 6163 7475 616c 203d 2064 6966      actual = dif
-00001ad0: 665f 6865 6164 6572 2e73 7562 2844 4554  f_header.sub(DET
-00001ae0: 4552 4d49 4e49 5354 4943 5f48 4541 4445  ERMINISTIC_HEADE
-00001af0: 522c 2072 6573 756c 742e 6f75 7470 7574  R, result.output
-00001b00: 290a 2020 2020 2020 2020 6163 7475 616c  ).        actual
-00001b10: 203d 2061 6374 7561 6c2e 7273 7472 6970   = actual.rstrip
-00001b20: 2829 202b 2022 5c6e 2220 2023 2074 6865  () + "\n"  # the
-00001b30: 2064 6966 6620 6f75 7470 7574 2068 6173   diff output has
-00001b40: 2061 2074 7261 696c 696e 6720 7370 6163   a trailing spac
-00001b50: 650a 2020 2020 2020 2020 7365 6c66 2e61  e.        self.a
-00001b60: 7373 6572 7445 7175 616c 2865 7870 6563  ssertEqual(expec
-00001b70: 7465 642c 2061 6374 7561 6c29 0a0a 2020  ted, actual)..  
-00001b80: 2020 6465 6620 7465 7374 5f70 6970 696e    def test_pipin
-00001b90: 675f 6469 6666 5f77 6974 685f 636f 6c6f  g_diff_with_colo
-00001ba0: 7228 7365 6c66 2920 2d3e 204e 6f6e 653a  r(self) -> None:
-00001bb0: 0a20 2020 2020 2020 2073 6f75 7263 652c  .        source,
-00001bc0: 205f 203d 2072 6561 645f 6461 7461 2822   _ = read_data("
-00001bd0: 7369 6d70 6c65 5f63 6173 6573 222c 2022  simple_cases", "
-00001be0: 6578 7072 6573 7369 6f6e 2e70 7922 290a  expression.py").
-00001bf0: 2020 2020 2020 2020 6172 6773 203d 205b          args = [
-00001c00: 0a20 2020 2020 2020 2020 2020 2022 2d22  .            "-"
-00001c10: 2c0a 2020 2020 2020 2020 2020 2020 222d  ,.            "-
-00001c20: 2d66 6173 7422 2c0a 2020 2020 2020 2020  -fast",.        
-00001c30: 2020 2020 6622 2d2d 6c69 6e65 2d6c 656e      f"--line-len
-00001c40: 6774 683d 7b63 6572 6369 732e 4445 4641  gth={cercis.DEFA
-00001c50: 554c 545f 4c49 4e45 5f4c 454e 4754 487d  ULT_LINE_LENGTH}
-00001c60: 222c 0a20 2020 2020 2020 2020 2020 2022  ",.            "
-00001c70: 2d2d 6469 6666 222c 0a20 2020 2020 2020  --diff",.       
-00001c80: 2020 2020 2022 2d2d 636f 6c6f 7222 2c0a       "--color",.
-00001c90: 2020 2020 2020 2020 2020 2020 6622 2d2d              f"--
-00001ca0: 636f 6e66 6967 3d7b 454d 5054 595f 434f  config={EMPTY_CO
-00001cb0: 4e46 4947 7d22 2c0a 2020 2020 2020 2020  NFIG}",.        
-00001cc0: 5d0a 2020 2020 2020 2020 7265 7375 6c74  ].        result
-00001cd0: 203d 2042 6c61 636b 5275 6e6e 6572 2829   = BlackRunner()
-00001ce0: 2e69 6e76 6f6b 6528 0a20 2020 2020 2020  .invoke(.       
-00001cf0: 2020 2020 2063 6572 6369 732e 6d61 696e       cercis.main
-00001d00: 2c20 6172 6773 2c20 696e 7075 743d 4279  , args, input=By
-00001d10: 7465 7349 4f28 736f 7572 6365 2e65 6e63  tesIO(source.enc
-00001d20: 6f64 6528 2275 7466 3822 2929 0a20 2020  ode("utf8")).   
-00001d30: 2020 2020 2029 0a20 2020 2020 2020 2061       ).        a
-00001d40: 6374 7561 6c20 3d20 7265 7375 6c74 2e6f  ctual = result.o
-00001d50: 7574 7075 740a 2020 2020 2020 2020 2320  utput.        # 
-00001d60: 4167 6169 6e2c 2074 6865 2063 6f6e 7465  Again, the conte
-00001d70: 6e74 7320 6172 6520 6368 6563 6b65 6420  nts are checked 
-00001d80: 696e 2061 2064 6966 6665 7265 6e74 2074  in a different t
-00001d90: 6573 742c 2073 6f20 6f6e 6c79 206c 6f6f  est, so only loo
-00001da0: 6b20 666f 7220 636f 6c6f 7273 2e0a 2020  k for colors..  
+00001660: 2020 2020 2020 2020 2020 2022 2d2d 6c69             "--li
+00001670: 6e65 2d6c 656e 6774 683d 3838 222c 0a20  ne-length=88",. 
+00001680: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00001690: 222d 2d63 6f6e 6669 673d 7b45 4d50 5459  "--config={EMPTY
+000016a0: 5f43 4f4e 4649 477d 222c 0a20 2020 2020  _CONFIG}",.     
+000016b0: 2020 2020 2020 2020 2020 2022 2d2d 7369             "--si
+000016c0: 6e67 6c65 2d71 756f 7465 3d46 616c 7365  ngle-quote=False
+000016d0: 222c 0a20 2020 2020 2020 2020 2020 205d  ",.            ]
+000016e0: 2c0a 2020 2020 2020 2020 2020 2020 696e  ,.            in
+000016f0: 7075 743d 4279 7465 7349 4f28 736f 7572  put=BytesIO(sour
+00001700: 6365 2e65 6e63 6f64 6528 2275 7466 3822  ce.encode("utf8"
+00001710: 2929 2c0a 2020 2020 2020 2020 290a 2020  )),.        ).  
+00001720: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00001730: 7445 7175 616c 2872 6573 756c 742e 6578  tEqual(result.ex
+00001740: 6974 5f63 6f64 652c 2030 290a 2020 2020  it_code, 0).    
+00001750: 2020 2020 7365 6c66 2e61 7373 6572 7446      self.assertF
+00001760: 6f72 6d61 7445 7175 616c 2865 7870 6563  ormatEqual(expec
+00001770: 7465 642c 2072 6573 756c 742e 6f75 7470  ted, result.outp
+00001780: 7574 290a 2020 2020 2020 2020 6966 2073  ut).        if s
+00001790: 6f75 7263 6520 213d 2072 6573 756c 742e  ource != result.
+000017a0: 6f75 7470 7574 3a0a 2020 2020 2020 2020  output:.        
+000017b0: 2020 2020 6365 7263 6973 2e61 7373 6572      cercis.asser
+000017c0: 745f 6571 7569 7661 6c65 6e74 2873 6f75  t_equivalent(sou
+000017d0: 7263 652c 2072 6573 756c 742e 6f75 7470  rce, result.outp
+000017e0: 7574 290a 2020 2020 2020 2020 2020 2020  ut).            
+000017f0: 6365 7263 6973 2e61 7373 6572 745f 7374  cercis.assert_st
+00001800: 6162 6c65 2873 6f75 7263 652c 2072 6573  able(source, res
+00001810: 756c 742e 6f75 7470 7574 2c20 4445 4641  ult.output, DEFA
+00001820: 554c 545f 4d4f 4445 290a 0a20 2020 2064  ULT_MODE)..    d
+00001830: 6566 2074 6573 745f 7069 7069 6e67 5f64  ef test_piping_d
+00001840: 6966 6628 7365 6c66 2920 2d3e 204e 6f6e  iff(self) -> Non
+00001850: 653a 0a20 2020 2020 2020 2064 6966 665f  e:.        diff_
+00001860: 6865 6164 6572 203d 2072 652e 636f 6d70  header = re.comp
+00001870: 696c 6528 0a20 2020 2020 2020 2020 2020  ile(.           
+00001880: 2072 2228 5354 4449 4e7c 5354 444f 5554   r"(STDIN|STDOUT
+00001890: 295c 745c 645c 645c 645c 642d 5c64 5c64  )\t\d\d\d\d-\d\d
+000018a0: 2d5c 645c 6420 5c64 5c64 3a5c 645c 643a  -\d\d \d\d:\d\d:
+000018b0: 5c64 5c64 5c2e 5c64 5c64 5c64 5c64 5c64  \d\d\.\d\d\d\d\d
+000018c0: 5c64 2022 0a20 2020 2020 2020 2020 2020  \d ".           
+000018d0: 2072 225c 2b5c 645c 645c 645c 6422 0a20   r"\+\d\d\d\d". 
+000018e0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+000018f0: 2073 6f75 7263 652c 205f 203d 2072 6561   source, _ = rea
+00001900: 645f 6461 7461 2822 7369 6d70 6c65 5f63  d_data("simple_c
+00001910: 6173 6573 222c 2022 6578 7072 6573 7369  ases", "expressi
+00001920: 6f6e 2e70 7922 290a 2020 2020 2020 2020  on.py").        
+00001930: 6578 7065 6374 6564 2c20 5f20 3d20 7265  expected, _ = re
+00001940: 6164 5f64 6174 6128 2273 696d 706c 655f  ad_data("simple_
+00001950: 6361 7365 7322 2c20 2265 7870 7265 7373  cases", "express
+00001960: 696f 6e2e 6469 6666 2229 0a20 2020 2020  ion.diff").     
+00001970: 2020 2061 7267 7320 3d20 5b0a 2020 2020     args = [.    
+00001980: 2020 2020 2020 2020 222d 222c 0a20 2020          "-",.   
+00001990: 2020 2020 2020 2020 2022 2d2d 6661 7374           "--fast
+000019a0: 222c 0a20 2020 2020 2020 2020 2020 2022  ",.            "
+000019b0: 2d2d 6c69 6e65 2d6c 656e 6774 683d 3838  --line-length=88
+000019c0: 222c 0a20 2020 2020 2020 2020 2020 2022  ",.            "
+000019d0: 2d2d 6469 6666 222c 0a20 2020 2020 2020  --diff",.       
+000019e0: 2020 2020 2066 222d 2d63 6f6e 6669 673d       f"--config=
+000019f0: 7b45 4d50 5459 5f43 4f4e 4649 477d 222c  {EMPTY_CONFIG}",
+00001a00: 0a20 2020 2020 2020 205d 0a20 2020 2020  .        ].     
+00001a10: 2020 2072 6573 756c 7420 3d20 426c 6163     result = Blac
+00001a20: 6b52 756e 6e65 7228 292e 696e 766f 6b65  kRunner().invoke
+00001a30: 280a 2020 2020 2020 2020 2020 2020 6365  (.            ce
+00001a40: 7263 6973 2e6d 6169 6e2c 2061 7267 732c  rcis.main, args,
+00001a50: 2069 6e70 7574 3d42 7974 6573 494f 2873   input=BytesIO(s
+00001a60: 6f75 7263 652e 656e 636f 6465 2822 7574  ource.encode("ut
+00001a70: 6638 2229 290a 2020 2020 2020 2020 290a  f8")).        ).
+00001a80: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00001a90: 6572 7445 7175 616c 2872 6573 756c 742e  ertEqual(result.
+00001aa0: 6578 6974 5f63 6f64 652c 2030 290a 2020  exit_code, 0).  
+00001ab0: 2020 2020 2020 6163 7475 616c 203d 2064        actual = d
+00001ac0: 6966 665f 6865 6164 6572 2e73 7562 2844  iff_header.sub(D
+00001ad0: 4554 4552 4d49 4e49 5354 4943 5f48 4541  ETERMINISTIC_HEA
+00001ae0: 4445 522c 2072 6573 756c 742e 6f75 7470  DER, result.outp
+00001af0: 7574 290a 2020 2020 2020 2020 6163 7475  ut).        actu
+00001b00: 616c 203d 2061 6374 7561 6c2e 7273 7472  al = actual.rstr
+00001b10: 6970 2829 202b 2022 5c6e 2220 2023 2074  ip() + "\n"  # t
+00001b20: 6865 2064 6966 6620 6f75 7470 7574 2068  he diff output h
+00001b30: 6173 2061 2074 7261 696c 696e 6720 7370  as a trailing sp
+00001b40: 6163 650a 2020 2020 2020 2020 7365 6c66  ace.        self
+00001b50: 2e61 7373 6572 7445 7175 616c 2865 7870  .assertEqual(exp
+00001b60: 6563 7465 642c 2061 6374 7561 6c29 0a0a  ected, actual)..
+00001b70: 2020 2020 6465 6620 7465 7374 5f70 6970      def test_pip
+00001b80: 696e 675f 6469 6666 5f77 6974 685f 636f  ing_diff_with_co
+00001b90: 6c6f 7228 7365 6c66 2920 2d3e 204e 6f6e  lor(self) -> Non
+00001ba0: 653a 0a20 2020 2020 2020 2073 6f75 7263  e:.        sourc
+00001bb0: 652c 205f 203d 2072 6561 645f 6461 7461  e, _ = read_data
+00001bc0: 2822 7369 6d70 6c65 5f63 6173 6573 222c  ("simple_cases",
+00001bd0: 2022 6578 7072 6573 7369 6f6e 2e70 7922   "expression.py"
+00001be0: 290a 2020 2020 2020 2020 6172 6773 203d  ).        args =
+00001bf0: 205b 0a20 2020 2020 2020 2020 2020 2022   [.            "
+00001c00: 2d22 2c0a 2020 2020 2020 2020 2020 2020  -",.            
+00001c10: 222d 2d66 6173 7422 2c0a 2020 2020 2020  "--fast",.      
+00001c20: 2020 2020 2020 222d 2d6c 696e 652d 6c65        "--line-le
+00001c30: 6e67 7468 3d38 3822 2c0a 2020 2020 2020  ngth=88",.      
+00001c40: 2020 2020 2020 222d 2d64 6966 6622 2c0a        "--diff",.
+00001c50: 2020 2020 2020 2020 2020 2020 222d 2d63              "--c
+00001c60: 6f6c 6f72 222c 0a20 2020 2020 2020 2020  olor",.         
+00001c70: 2020 2066 222d 2d63 6f6e 6669 673d 7b45     f"--config={E
+00001c80: 4d50 5459 5f43 4f4e 4649 477d 222c 0a20  MPTY_CONFIG}",. 
+00001c90: 2020 2020 2020 205d 0a20 2020 2020 2020         ].       
+00001ca0: 2072 6573 756c 7420 3d20 426c 6163 6b52   result = BlackR
+00001cb0: 756e 6e65 7228 292e 696e 766f 6b65 280a  unner().invoke(.
+00001cc0: 2020 2020 2020 2020 2020 2020 6365 7263              cerc
+00001cd0: 6973 2e6d 6169 6e2c 2061 7267 732c 2069  is.main, args, i
+00001ce0: 6e70 7574 3d42 7974 6573 494f 2873 6f75  nput=BytesIO(sou
+00001cf0: 7263 652e 656e 636f 6465 2822 7574 6638  rce.encode("utf8
+00001d00: 2229 290a 2020 2020 2020 2020 290a 2020  ")).        ).  
+00001d10: 2020 2020 2020 6163 7475 616c 203d 2072        actual = r
+00001d20: 6573 756c 742e 6f75 7470 7574 0a20 2020  esult.output.   
+00001d30: 2020 2020 2023 2041 6761 696e 2c20 7468       # Again, th
+00001d40: 6520 636f 6e74 656e 7473 2061 7265 2063  e contents are c
+00001d50: 6865 636b 6564 2069 6e20 6120 6469 6666  hecked in a diff
+00001d60: 6572 656e 7420 7465 7374 2c20 736f 206f  erent test, so o
+00001d70: 6e6c 7920 6c6f 6f6b 2066 6f72 2063 6f6c  nly look for col
+00001d80: 6f72 732e 0a20 2020 2020 2020 2073 656c  ors..        sel
+00001d90: 662e 6173 7365 7274 496e 2822 5c30 3333  f.assertIn("\033
+00001da0: 5b31 6d22 2c20 6163 7475 616c 290a 2020  [1m", actual).  
 00001db0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00001dc0: 7449 6e28 225c 3033 335b 316d 222c 2061  tIn("\033[1m", a
-00001dd0: 6374 7561 6c29 0a20 2020 2020 2020 2073  ctual).        s
-00001de0: 656c 662e 6173 7365 7274 496e 2822 5c30  elf.assertIn("\0
-00001df0: 3333 5b33 366d 222c 2061 6374 7561 6c29  33[36m", actual)
-00001e00: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-00001e10: 7365 7274 496e 2822 5c30 3333 5b33 326d  sertIn("\033[32m
-00001e20: 222c 2061 6374 7561 6c29 0a20 2020 2020  ", actual).     
-00001e30: 2020 2073 656c 662e 6173 7365 7274 496e     self.assertIn
-00001e40: 2822 5c30 3333 5b33 316d 222c 2061 6374  ("\033[31m", act
-00001e50: 7561 6c29 0a20 2020 2020 2020 2073 656c  ual).        sel
-00001e60: 662e 6173 7365 7274 496e 2822 5c30 3333  f.assertIn("\033
-00001e70: 5b30 6d22 2c20 6163 7475 616c 290a 0a20  [0m", actual).. 
-00001e80: 2020 2040 7061 7463 6828 2263 6572 6369     @patch("cerci
-00001e90: 732e 6475 6d70 5f74 6f5f 6669 6c65 222c  s.dump_to_file",
-00001ea0: 2064 756d 705f 746f 5f73 7464 6572 7229   dump_to_stderr)
-00001eb0: 0a20 2020 2064 6566 205f 7465 7374 5f77  .    def _test_w
-00001ec0: 6970 2873 656c 6629 202d 3e20 4e6f 6e65  ip(self) -> None
-00001ed0: 3a0a 2020 2020 2020 2020 736f 7572 6365  :.        source
-00001ee0: 2c20 6578 7065 6374 6564 203d 2072 6561  , expected = rea
-00001ef0: 645f 6461 7461 2822 6d69 7363 656c 6c61  d_data("miscella
-00001f00: 6e65 6f75 7322 2c20 2277 6970 2229 0a20  neous", "wip"). 
-00001f10: 2020 2020 2020 2073 7973 2e73 6574 7472         sys.settr
-00001f20: 6163 6528 7472 6163 6566 756e 6329 0a20  ace(tracefunc). 
-00001f30: 2020 2020 2020 206d 6f64 6520 3d20 7265         mode = re
-00001f40: 706c 6163 6528 0a20 2020 2020 2020 2020  place(.         
-00001f50: 2020 2044 4546 4155 4c54 5f4d 4f44 452c     DEFAULT_MODE,
-00001f60: 0a20 2020 2020 2020 2020 2020 2065 7870  .            exp
-00001f70: 6572 696d 656e 7461 6c5f 7374 7269 6e67  erimental_string
-00001f80: 5f70 726f 6365 7373 696e 673d 4661 6c73  _processing=Fals
-00001f90: 652c 0a20 2020 2020 2020 2020 2020 2074  e,.            t
-00001fa0: 6172 6765 745f 7665 7273 696f 6e73 3d7b  arget_versions={
-00001fb0: 6365 7263 6973 2e54 6172 6765 7456 6572  cercis.TargetVer
-00001fc0: 7369 6f6e 2e50 5933 387d 2c0a 2020 2020  sion.PY38},.    
-00001fd0: 2020 2020 290a 2020 2020 2020 2020 6163      ).        ac
-00001fe0: 7475 616c 203d 2066 7328 736f 7572 6365  tual = fs(source
-00001ff0: 2c20 6d6f 6465 3d6d 6f64 6529 0a20 2020  , mode=mode).   
-00002000: 2020 2020 2073 7973 2e73 6574 7472 6163       sys.settrac
-00002010: 6528 4e6f 6e65 290a 2020 2020 2020 2020  e(None).        
-00002020: 7365 6c66 2e61 7373 6572 7446 6f72 6d61  self.assertForma
-00002030: 7445 7175 616c 2865 7870 6563 7465 642c  tEqual(expected,
-00002040: 2061 6374 7561 6c29 0a20 2020 2020 2020   actual).       
-00002050: 2063 6572 6369 732e 6173 7365 7274 5f65   cercis.assert_e
-00002060: 7175 6976 616c 656e 7428 736f 7572 6365  quivalent(source
-00002070: 2c20 6163 7475 616c 290a 2020 2020 2020  , actual).      
-00002080: 2020 6365 7263 6973 2e61 7373 6572 745f    cercis.assert_
-00002090: 7374 6162 6c65 2873 6f75 7263 652c 2061  stable(source, a
-000020a0: 6374 7561 6c2c 2063 6572 6369 732e 4669  ctual, cercis.Fi
-000020b0: 6c65 4d6f 6465 2829 290a 0a20 2020 2064  leMode())..    d
-000020c0: 6566 2074 6573 745f 7065 705f 3537 325f  ef test_pep_572_
-000020d0: 7665 7273 696f 6e5f 6465 7465 6374 696f  version_detectio
-000020e0: 6e28 7365 6c66 2920 2d3e 204e 6f6e 653a  n(self) -> None:
-000020f0: 0a20 2020 2020 2020 2073 6f75 7263 652c  .        source,
-00002100: 205f 203d 2072 6561 645f 6461 7461 2822   _ = read_data("
-00002110: 7079 5f33 3822 2c20 2270 6570 5f35 3732  py_38", "pep_572
-00002120: 2229 0a20 2020 2020 2020 2072 6f6f 7420  ").        root 
-00002130: 3d20 6365 7263 6973 2e6c 6962 3274 6f33  = cercis.lib2to3
-00002140: 5f70 6172 7365 2873 6f75 7263 6529 0a20  _parse(source). 
-00002150: 2020 2020 2020 2066 6561 7475 7265 7320         features 
-00002160: 3d20 6365 7263 6973 2e67 6574 5f66 6561  = cercis.get_fea
-00002170: 7475 7265 735f 7573 6564 2872 6f6f 7429  tures_used(root)
-00002180: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-00002190: 7365 7274 496e 2863 6572 6369 732e 4665  sertIn(cercis.Fe
-000021a0: 6174 7572 652e 4153 5349 474e 4d45 4e54  ature.ASSIGNMENT
-000021b0: 5f45 5850 5245 5353 494f 4e53 2c20 6665  _EXPRESSIONS, fe
-000021c0: 6174 7572 6573 290a 2020 2020 2020 2020  atures).        
-000021d0: 7665 7273 696f 6e73 203d 2063 6572 6369  versions = cerci
-000021e0: 732e 6465 7465 6374 5f74 6172 6765 745f  s.detect_target_
-000021f0: 7665 7273 696f 6e73 2872 6f6f 7429 0a20  versions(root). 
-00002200: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00002210: 7274 496e 2863 6572 6369 732e 5461 7267  rtIn(cercis.Targ
-00002220: 6574 5665 7273 696f 6e2e 5059 3338 2c20  etVersion.PY38, 
-00002230: 7665 7273 696f 6e73 290a 0a20 2020 2064  versions)..    d
-00002240: 6566 2074 6573 745f 6578 7072 6573 7369  ef test_expressi
-00002250: 6f6e 5f66 6628 7365 6c66 2920 2d3e 204e  on_ff(self) -> N
-00002260: 6f6e 653a 0a20 2020 2020 2020 2073 6f75  one:.        sou
-00002270: 7263 652c 2065 7870 6563 7465 6420 3d20  rce, expected = 
-00002280: 7265 6164 5f64 6174 6128 2273 696d 706c  read_data("simpl
-00002290: 655f 6361 7365 7322 2c20 2265 7870 7265  e_cases", "expre
-000022a0: 7373 696f 6e2e 7079 2229 0a20 2020 2020  ssion.py").     
-000022b0: 2020 2074 6d70 5f66 696c 6520 3d20 5061     tmp_file = Pa
-000022c0: 7468 2863 6572 6369 732e 6475 6d70 5f74  th(cercis.dump_t
-000022d0: 6f5f 6669 6c65 2873 6f75 7263 6529 290a  o_file(source)).
-000022e0: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-000022f0: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
-00002300: 7365 7274 5472 7565 2866 6628 746d 705f  sertTrue(ff(tmp_
-00002310: 6669 6c65 2c20 7772 6974 655f 6261 636b  file, write_back
-00002320: 3d63 6572 6369 732e 5772 6974 6542 6163  =cercis.WriteBac
-00002330: 6b2e 5945 5329 290a 2020 2020 2020 2020  k.YES)).        
-00002340: 2020 2020 7769 7468 206f 7065 6e28 746d      with open(tm
-00002350: 705f 6669 6c65 2c20 656e 636f 6469 6e67  p_file, encoding
-00002360: 3d22 7574 6638 2229 2061 7320 663a 0a20  ="utf8") as f:. 
-00002370: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-00002380: 6374 7561 6c20 3d20 662e 7265 6164 2829  ctual = f.read()
-00002390: 0a20 2020 2020 2020 2066 696e 616c 6c79  .        finally
-000023a0: 3a0a 2020 2020 2020 2020 2020 2020 6f73  :.            os
-000023b0: 2e75 6e6c 696e 6b28 746d 705f 6669 6c65  .unlink(tmp_file
-000023c0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-000023d0: 7373 6572 7446 6f72 6d61 7445 7175 616c  ssertFormatEqual
-000023e0: 2865 7870 6563 7465 642c 2061 6374 7561  (expected, actua
-000023f0: 6c29 0a20 2020 2020 2020 2077 6974 6820  l).        with 
-00002400: 7061 7463 6828 2263 6572 6369 732e 6475  patch("cercis.du
-00002410: 6d70 5f74 6f5f 6669 6c65 222c 2064 756d  mp_to_file", dum
-00002420: 705f 746f 5f73 7464 6572 7229 3a0a 2020  p_to_stderr):.  
-00002430: 2020 2020 2020 2020 2020 6365 7263 6973            cercis
-00002440: 2e61 7373 6572 745f 6571 7569 7661 6c65  .assert_equivale
-00002450: 6e74 2873 6f75 7263 652c 2061 6374 7561  nt(source, actua
-00002460: 6c29 0a20 2020 2020 2020 2020 2020 2063  l).            c
-00002470: 6572 6369 732e 6173 7365 7274 5f73 7461  ercis.assert_sta
-00002480: 626c 6528 736f 7572 6365 2c20 6163 7475  ble(source, actu
-00002490: 616c 2c20 4445 4641 554c 545f 4d4f 4445  al, DEFAULT_MODE
-000024a0: 290a 0a20 2020 2064 6566 2074 6573 745f  )..    def test_
-000024b0: 6578 7072 6573 7369 6f6e 5f64 6966 6628  expression_diff(
-000024c0: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
-000024d0: 2020 2020 2020 2073 6f75 7263 652c 205f         source, _
-000024e0: 203d 2072 6561 645f 6461 7461 2822 7369   = read_data("si
-000024f0: 6d70 6c65 5f63 6173 6573 222c 2022 6578  mple_cases", "ex
-00002500: 7072 6573 7369 6f6e 2e70 7922 290a 2020  pression.py").  
-00002510: 2020 2020 2020 6578 7065 6374 6564 2c20        expected, 
-00002520: 5f20 3d20 7265 6164 5f64 6174 6128 2273  _ = read_data("s
-00002530: 696d 706c 655f 6361 7365 7322 2c20 2265  imple_cases", "e
-00002540: 7870 7265 7373 696f 6e2e 6469 6666 2229  xpression.diff")
-00002550: 0a20 2020 2020 2020 2074 6d70 5f66 696c  .        tmp_fil
-00002560: 6520 3d20 5061 7468 2863 6572 6369 732e  e = Path(cercis.
-00002570: 6475 6d70 5f74 6f5f 6669 6c65 2873 6f75  dump_to_file(sou
-00002580: 7263 6529 290a 2020 2020 2020 2020 6469  rce)).        di
-00002590: 6666 5f68 6561 6465 7220 3d20 7265 2e63  ff_header = re.c
-000025a0: 6f6d 7069 6c65 280a 2020 2020 2020 2020  ompile(.        
-000025b0: 2020 2020 7266 227b 7265 2e65 7363 6170      rf"{re.escap
-000025c0: 6528 7374 7228 746d 705f 6669 6c65 2929  e(str(tmp_file))
-000025d0: 7d5c 745c 645c 645c 645c 642d 5c64 5c64  }\t\d\d\d\d-\d\d
-000025e0: 2d5c 645c 6420 220a 2020 2020 2020 2020  -\d\d ".        
-000025f0: 2020 2020 7222 5c64 5c64 3a5c 645c 643a      r"\d\d:\d\d:
-00002600: 5c64 5c64 5c2e 5c64 5c64 5c64 5c64 5c64  \d\d\.\d\d\d\d\d
-00002610: 5c64 205c 2b5c 645c 645c 645c 6422 0a20  \d \+\d\d\d\d". 
-00002620: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00002630: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-00002640: 2020 7265 7375 6c74 203d 2042 6c61 636b    result = Black
-00002650: 5275 6e6e 6572 2829 2e69 6e76 6f6b 6528  Runner().invoke(
-00002660: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00002670: 2063 6572 6369 732e 6d61 696e 2c20 5b22   cercis.main, ["
-00002680: 2d2d 6469 6666 222c 2073 7472 2874 6d70  --diff", str(tmp
-00002690: 5f66 696c 6529 2c20 6622 2d2d 636f 6e66  _file), f"--conf
-000026a0: 6967 3d7b 454d 5054 595f 434f 4e46 4947  ig={EMPTY_CONFIG
-000026b0: 7d22 5d0a 2020 2020 2020 2020 2020 2020  }"].            
-000026c0: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-000026d0: 6c66 2e61 7373 6572 7445 7175 616c 2872  lf.assertEqual(r
-000026e0: 6573 756c 742e 6578 6974 5f63 6f64 652c  esult.exit_code,
-000026f0: 2030 290a 2020 2020 2020 2020 6669 6e61   0).        fina
-00002700: 6c6c 793a 0a20 2020 2020 2020 2020 2020  lly:.           
-00002710: 206f 732e 756e 6c69 6e6b 2874 6d70 5f66   os.unlink(tmp_f
-00002720: 696c 6529 0a20 2020 2020 2020 2061 6374  ile).        act
-00002730: 7561 6c20 3d20 7265 7375 6c74 2e6f 7574  ual = result.out
-00002740: 7075 740a 2020 2020 2020 2020 6163 7475  put.        actu
-00002750: 616c 203d 2064 6966 665f 6865 6164 6572  al = diff_header
-00002760: 2e73 7562 2844 4554 4552 4d49 4e49 5354  .sub(DETERMINIST
-00002770: 4943 5f48 4541 4445 522c 2061 6374 7561  IC_HEADER, actua
-00002780: 6c29 0a20 2020 2020 2020 2069 6620 6578  l).        if ex
-00002790: 7065 6374 6564 2021 3d20 6163 7475 616c  pected != actual
-000027a0: 3a0a 2020 2020 2020 2020 2020 2020 6475  :.            du
-000027b0: 6d70 203d 2063 6572 6369 732e 6475 6d70  mp = cercis.dump
-000027c0: 5f74 6f5f 6669 6c65 2861 6374 7561 6c29  _to_file(actual)
-000027d0: 0a20 2020 2020 2020 2020 2020 206d 7367  .            msg
-000027e0: 203d 2028 0a20 2020 2020 2020 2020 2020   = (.           
-000027f0: 2020 2020 2022 4578 7065 6374 6564 2064       "Expected d
-00002800: 6966 6620 6973 6e27 7420 6571 7561 6c20  iff isn't equal 
-00002810: 746f 2074 6865 2061 6374 7561 6c2e 2049  to the actual. I
-00002820: 6620 796f 7520 6d61 6465 2063 6861 6e67  f you made chang
-00002830: 6573 2074 6f22 0a20 2020 2020 2020 2020  es to".         
-00002840: 2020 2020 2020 2022 2065 7870 7265 7373         " express
-00002850: 696f 6e2e 7079 2061 6e64 2074 6869 7320  ion.py and this 
-00002860: 6973 2061 6e20 616e 7469 6369 7061 7465  is an anticipate
-00002870: 6420 6469 6666 6572 656e 6365 2c20 6f76  d difference, ov
-00002880: 6572 7772 6974 6522 0a20 2020 2020 2020  erwrite".       
-00002890: 2020 2020 2020 2020 2066 2220 7465 7374           f" test
-000028a0: 732f 6461 7461 2f65 7870 7265 7373 696f  s/data/expressio
-000028b0: 6e2e 6469 6666 2077 6974 6820 7b64 756d  n.diff with {dum
-000028c0: 707d 220a 2020 2020 2020 2020 2020 2020  p}".            
-000028d0: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-000028e0: 6c66 2e61 7373 6572 7445 7175 616c 2865  lf.assertEqual(e
-000028f0: 7870 6563 7465 642c 2061 6374 7561 6c2c  xpected, actual,
-00002900: 206d 7367 290a 0a20 2020 2064 6566 2074   msg)..    def t
-00002910: 6573 745f 6578 7072 6573 7369 6f6e 5f64  est_expression_d
-00002920: 6966 665f 7769 7468 5f63 6f6c 6f72 2873  iff_with_color(s
-00002930: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
-00002940: 2020 2020 2020 736f 7572 6365 2c20 5f20        source, _ 
-00002950: 3d20 7265 6164 5f64 6174 6128 2273 696d  = read_data("sim
-00002960: 706c 655f 6361 7365 7322 2c20 2265 7870  ple_cases", "exp
-00002970: 7265 7373 696f 6e2e 7079 2229 0a20 2020  ression.py").   
-00002980: 2020 2020 2065 7870 6563 7465 642c 205f       expected, _
-00002990: 203d 2072 6561 645f 6461 7461 2822 7369   = read_data("si
-000029a0: 6d70 6c65 5f63 6173 6573 222c 2022 6578  mple_cases", "ex
-000029b0: 7072 6573 7369 6f6e 2e64 6966 6622 290a  pression.diff").
-000029c0: 2020 2020 2020 2020 746d 705f 6669 6c65          tmp_file
-000029d0: 203d 2050 6174 6828 6365 7263 6973 2e64   = Path(cercis.d
-000029e0: 756d 705f 746f 5f66 696c 6528 736f 7572  ump_to_file(sour
-000029f0: 6365 2929 0a20 2020 2020 2020 2074 7279  ce)).        try
-00002a00: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00002a10: 7375 6c74 203d 2042 6c61 636b 5275 6e6e  sult = BlackRunn
-00002a20: 6572 2829 2e69 6e76 6f6b 6528 0a20 2020  er().invoke(.   
-00002a30: 2020 2020 2020 2020 2020 2020 2063 6572               cer
-00002a40: 6369 732e 6d61 696e 2c0a 2020 2020 2020  cis.main,.      
-00002a50: 2020 2020 2020 2020 2020 5b22 2d2d 6469            ["--di
-00002a60: 6666 222c 2022 2d2d 636f 6c6f 7222 2c20  ff", "--color", 
-00002a70: 7374 7228 746d 705f 6669 6c65 292c 2066  str(tmp_file), f
-00002a80: 222d 2d63 6f6e 6669 673d 7b45 4d50 5459  "--config={EMPTY
-00002a90: 5f43 4f4e 4649 477d 225d 2c0a 2020 2020  _CONFIG}"],.    
-00002aa0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00002ab0: 2020 6669 6e61 6c6c 793a 0a20 2020 2020    finally:.     
-00002ac0: 2020 2020 2020 206f 732e 756e 6c69 6e6b         os.unlink
-00002ad0: 2874 6d70 5f66 696c 6529 0a20 2020 2020  (tmp_file).     
-00002ae0: 2020 2061 6374 7561 6c20 3d20 7265 7375     actual = resu
-00002af0: 6c74 2e6f 7574 7075 740a 2020 2020 2020  lt.output.      
-00002b00: 2020 2320 5765 2063 6865 636b 2074 6865    # We check the
-00002b10: 2063 6f6e 7465 6e74 7320 6f66 2074 6865   contents of the
-00002b20: 2064 6966 6620 696e 2060 7465 7374 5f65   diff in `test_e
-00002b30: 7870 7265 7373 696f 6e5f 6469 6666 602e  xpression_diff`.
-00002b40: 2041 6c6c 0a20 2020 2020 2020 2023 2077   All.        # w
-00002b50: 6520 6e65 6564 2074 6f20 6368 6563 6b20  e need to check 
-00002b60: 6865 7265 2069 7320 7468 6174 2063 6f6c  here is that col
-00002b70: 6f72 2063 6f64 6573 2065 7869 7374 2069  or codes exist i
-00002b80: 6e20 7468 6520 7265 7375 6c74 2e0a 2020  n the result..  
-00002b90: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00002ba0: 7449 6e28 225c 3033 335b 316d 222c 2061  tIn("\033[1m", a
-00002bb0: 6374 7561 6c29 0a20 2020 2020 2020 2073  ctual).        s
-00002bc0: 656c 662e 6173 7365 7274 496e 2822 5c30  elf.assertIn("\0
-00002bd0: 3333 5b33 366d 222c 2061 6374 7561 6c29  33[36m", actual)
-00002be0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-00002bf0: 7365 7274 496e 2822 5c30 3333 5b33 326d  sertIn("\033[32m
-00002c00: 222c 2061 6374 7561 6c29 0a20 2020 2020  ", actual).     
-00002c10: 2020 2073 656c 662e 6173 7365 7274 496e     self.assertIn
-00002c20: 2822 5c30 3333 5b33 316d 222c 2061 6374  ("\033[31m", act
-00002c30: 7561 6c29 0a20 2020 2020 2020 2073 656c  ual).        sel
-00002c40: 662e 6173 7365 7274 496e 2822 5c30 3333  f.assertIn("\033
-00002c50: 5b30 6d22 2c20 6163 7475 616c 290a 0a20  [0m", actual).. 
-00002c60: 2020 2064 6566 2074 6573 745f 6465 7465     def test_dete
-00002c70: 6374 5f70 6f73 5f6f 6e6c 795f 6172 6775  ct_pos_only_argu
-00002c80: 6d65 6e74 7328 7365 6c66 2920 2d3e 204e  ments(self) -> N
-00002c90: 6f6e 653a 0a20 2020 2020 2020 2073 6f75  one:.        sou
-00002ca0: 7263 652c 205f 203d 2072 6561 645f 6461  rce, _ = read_da
-00002cb0: 7461 2822 7079 5f33 3822 2c20 2270 6570  ta("py_38", "pep
-00002cc0: 5f35 3730 2229 0a20 2020 2020 2020 2072  _570").        r
-00002cd0: 6f6f 7420 3d20 6365 7263 6973 2e6c 6962  oot = cercis.lib
-00002ce0: 3274 6f33 5f70 6172 7365 2873 6f75 7263  2to3_parse(sourc
-00002cf0: 6529 0a20 2020 2020 2020 2066 6561 7475  e).        featu
-00002d00: 7265 7320 3d20 6365 7263 6973 2e67 6574  res = cercis.get
-00002d10: 5f66 6561 7475 7265 735f 7573 6564 2872  _features_used(r
-00002d20: 6f6f 7429 0a20 2020 2020 2020 2073 656c  oot).        sel
-00002d30: 662e 6173 7365 7274 496e 2863 6572 6369  f.assertIn(cerci
-00002d40: 732e 4665 6174 7572 652e 504f 535f 4f4e  s.Feature.POS_ON
-00002d50: 4c59 5f41 5247 554d 454e 5453 2c20 6665  LY_ARGUMENTS, fe
-00002d60: 6174 7572 6573 290a 2020 2020 2020 2020  atures).        
-00002d70: 7665 7273 696f 6e73 203d 2063 6572 6369  versions = cerci
-00002d80: 732e 6465 7465 6374 5f74 6172 6765 745f  s.detect_target_
-00002d90: 7665 7273 696f 6e73 2872 6f6f 7429 0a20  versions(root). 
-00002da0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00002db0: 7274 496e 2863 6572 6369 732e 5461 7267  rtIn(cercis.Targ
-00002dc0: 6574 5665 7273 696f 6e2e 5059 3338 2c20  etVersion.PY38, 
-00002dd0: 7665 7273 696f 6e73 290a 0a20 2020 2064  versions)..    d
-00002de0: 6566 2074 6573 745f 6465 7465 6374 5f64  ef test_detect_d
-00002df0: 6562 7567 5f66 5f73 7472 696e 6773 2873  ebug_f_strings(s
-00002e00: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
-00002e10: 2020 2020 2020 726f 6f74 203d 2063 6572        root = cer
-00002e20: 6369 732e 6c69 6232 746f 335f 7061 7273  cis.lib2to3_pars
-00002e30: 6528 2222 2266 227b 783d 7d22 2022 2222  e("""f"{x=}" """
-00002e40: 290a 2020 2020 2020 2020 6665 6174 7572  ).        featur
-00002e50: 6573 203d 2063 6572 6369 732e 6765 745f  es = cercis.get_
-00002e60: 6665 6174 7572 6573 5f75 7365 6428 726f  features_used(ro
-00002e70: 6f74 290a 2020 2020 2020 2020 7365 6c66  ot).        self
-00002e80: 2e61 7373 6572 7449 6e28 6365 7263 6973  .assertIn(cercis
-00002e90: 2e46 6561 7475 7265 2e44 4542 5547 5f46  .Feature.DEBUG_F
-00002ea0: 5f53 5452 494e 4753 2c20 6665 6174 7572  _STRINGS, featur
-00002eb0: 6573 290a 2020 2020 2020 2020 7665 7273  es).        vers
-00002ec0: 696f 6e73 203d 2063 6572 6369 732e 6465  ions = cercis.de
-00002ed0: 7465 6374 5f74 6172 6765 745f 7665 7273  tect_target_vers
-00002ee0: 696f 6e73 2872 6f6f 7429 0a20 2020 2020  ions(root).     
-00002ef0: 2020 2073 656c 662e 6173 7365 7274 496e     self.assertIn
-00002f00: 2863 6572 6369 732e 5461 7267 6574 5665  (cercis.TargetVe
-00002f10: 7273 696f 6e2e 5059 3338 2c20 7665 7273  rsion.PY38, vers
-00002f20: 696f 6e73 290a 0a20 2020 2020 2020 2072  ions)..        r
-00002f30: 6f6f 7420 3d20 6365 7263 6973 2e6c 6962  oot = cercis.lib
-00002f40: 3274 6f33 5f70 6172 7365 280a 2020 2020  2to3_parse(.    
-00002f50: 2020 2020 2020 2020 2222 2266 227b 787d          """f"{x}
-00002f60: 225c 6e66 277b 223d 227d 275c 6e66 277b  "\nf'{"="}'\nf'{
-00002f70: 2878 3a3d 3529 7d27 5c6e 6627 7b66 2861  (x:=5)}'\nf'{f(a
-00002f80: 3d22 333d 2229 7d27 5c6e 6627 7b78 3a3d  ="3=")}'\nf'{x:=
-00002f90: 3130 7d27 5c6e 2222 220a 2020 2020 2020  10}'\n""".      
-00002fa0: 2020 290a 2020 2020 2020 2020 6665 6174    ).        feat
-00002fb0: 7572 6573 203d 2063 6572 6369 732e 6765  ures = cercis.ge
-00002fc0: 745f 6665 6174 7572 6573 5f75 7365 6428  t_features_used(
-00002fd0: 726f 6f74 290a 2020 2020 2020 2020 7365  root).        se
-00002fe0: 6c66 2e61 7373 6572 744e 6f74 496e 2863  lf.assertNotIn(c
-00002ff0: 6572 6369 732e 4665 6174 7572 652e 4445  ercis.Feature.DE
-00003000: 4255 475f 465f 5354 5249 4e47 532c 2066  BUG_F_STRINGS, f
-00003010: 6561 7475 7265 7329 0a0a 2020 2020 2020  eatures)..      
-00003020: 2020 2320 5765 2064 6f6e 2774 2079 6574    # We don't yet
-00003030: 2073 7570 706f 7274 2066 6561 7475 7265   support feature
-00003040: 2076 6572 7369 6f6e 2064 6574 6563 7469   version detecti
-00003050: 6f6e 2069 6e20 6e65 7374 6564 2066 2d73  on in nested f-s
-00003060: 7472 696e 6773 0a20 2020 2020 2020 2072  trings.        r
-00003070: 6f6f 7420 3d20 6365 7263 6973 2e6c 6962  oot = cercis.lib
-00003080: 3274 6f33 5f70 6172 7365 280a 2020 2020  2to3_parse(.    
-00003090: 2020 2020 2020 2020 2222 2266 2268 6561          """f"hea
-000030a0: 7264 2061 2072 756d 6f75 7220 7468 6174  rd a rumour that
-000030b0: 207b 2066 277b 312b 313d 7d27 207d 202e   { f'{1+1=}' } .
-000030c0: 2e2e 2073 6565 6d73 206c 696b 6520 6974  .. seems like it
-000030d0: 2063 6f75 6c64 2062 6520 7472 7565 2220   could be true" 
-000030e0: 2222 220a 2020 2020 2020 2020 290a 2020  """.        ).  
-000030f0: 2020 2020 2020 6665 6174 7572 6573 203d        features =
-00003100: 2063 6572 6369 732e 6765 745f 6665 6174   cercis.get_feat
-00003110: 7572 6573 5f75 7365 6428 726f 6f74 290a  ures_used(root).
-00003120: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00003130: 6572 744e 6f74 496e 2863 6572 6369 732e  ertNotIn(cercis.
-00003140: 4665 6174 7572 652e 4445 4255 475f 465f  Feature.DEBUG_F_
-00003150: 5354 5249 4e47 532c 2066 6561 7475 7265  STRINGS, feature
-00003160: 7329 0a0a 2020 2020 4070 6174 6368 2822  s)..    @patch("
-00003170: 6365 7263 6973 2e64 756d 705f 746f 5f66  cercis.dump_to_f
-00003180: 696c 6522 2c20 6475 6d70 5f74 6f5f 7374  ile", dump_to_st
-00003190: 6465 7272 290a 2020 2020 6465 6620 7465  derr).    def te
-000031a0: 7374 5f73 7472 696e 675f 7175 6f74 6573  st_string_quotes
-000031b0: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
-000031c0: 2020 2020 2020 2020 736f 7572 6365 2c20          source, 
-000031d0: 6578 7065 6374 6564 203d 2072 6561 645f  expected = read_
-000031e0: 6461 7461 2822 6d69 7363 656c 6c61 6e65  data("miscellane
-000031f0: 6f75 7322 2c20 2273 7472 696e 675f 7175  ous", "string_qu
-00003200: 6f74 6573 2229 0a20 2020 2020 2020 206d  otes").        m
-00003210: 6f64 6520 3d20 6365 7263 6973 2e4d 6f64  ode = cercis.Mod
-00003220: 6528 7072 6576 6965 773d 5472 7565 290a  e(preview=True).
-00003230: 2020 2020 2020 2020 6173 7365 7274 5f66          assert_f
-00003240: 6f72 6d61 7428 736f 7572 6365 2c20 6578  ormat(source, ex
-00003250: 7065 6374 6564 2c20 6d6f 6465 290a 2020  pected, mode).  
-00003260: 2020 2020 2020 6d6f 6465 203d 2072 6570        mode = rep
-00003270: 6c61 6365 286d 6f64 652c 2073 7472 696e  lace(mode, strin
-00003280: 675f 6e6f 726d 616c 697a 6174 696f 6e3d  g_normalization=
-00003290: 4661 6c73 6529 0a20 2020 2020 2020 206e  False).        n
-000032a0: 6f74 5f6e 6f72 6d61 6c69 7a65 6420 3d20  ot_normalized = 
-000032b0: 6673 2873 6f75 7263 652c 206d 6f64 653d  fs(source, mode=
-000032c0: 6d6f 6465 290a 2020 2020 2020 2020 7365  mode).        se
-000032d0: 6c66 2e61 7373 6572 7446 6f72 6d61 7445  lf.assertFormatE
-000032e0: 7175 616c 2873 6f75 7263 652e 7265 706c  qual(source.repl
-000032f0: 6163 6528 225c 5c5c 6e22 2c20 2222 292c  ace("\\\n", ""),
-00003300: 206e 6f74 5f6e 6f72 6d61 6c69 7a65 6429   not_normalized)
-00003310: 0a20 2020 2020 2020 2063 6572 6369 732e  .        cercis.
-00003320: 6173 7365 7274 5f65 7175 6976 616c 656e  assert_equivalen
-00003330: 7428 736f 7572 6365 2c20 6e6f 745f 6e6f  t(source, not_no
-00003340: 726d 616c 697a 6564 290a 2020 2020 2020  rmalized).      
-00003350: 2020 6365 7263 6973 2e61 7373 6572 745f    cercis.assert_
-00003360: 7374 6162 6c65 2873 6f75 7263 652c 206e  stable(source, n
-00003370: 6f74 5f6e 6f72 6d61 6c69 7a65 642c 206d  ot_normalized, m
-00003380: 6f64 653d 6d6f 6465 290a 0a20 2020 2064  ode=mode)..    d
-00003390: 6566 2074 6573 745f 736b 6970 5f73 6f75  ef test_skip_sou
-000033a0: 7263 655f 6669 7273 745f 6c69 6e65 2873  rce_first_line(s
-000033b0: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
-000033c0: 2020 2020 2020 736f 7572 6365 2c20 5f20        source, _ 
-000033d0: 3d20 7265 6164 5f64 6174 6128 226d 6973  = read_data("mis
-000033e0: 6365 6c6c 616e 656f 7573 222c 2022 696e  cellaneous", "in
-000033f0: 7661 6c69 645f 6865 6164 6572 2229 0a20  valid_header"). 
-00003400: 2020 2020 2020 2074 6d70 5f66 696c 6520         tmp_file 
-00003410: 3d20 5061 7468 2863 6572 6369 732e 6475  = Path(cercis.du
-00003420: 6d70 5f74 6f5f 6669 6c65 2873 6f75 7263  mp_to_file(sourc
-00003430: 6529 290a 2020 2020 2020 2020 2320 4675  e)).        # Fu
-00003440: 6c6c 2073 6f75 7263 6520 7368 6f75 6c64  ll source should
-00003450: 2066 6169 6c20 2869 6e76 616c 6964 2073   fail (invalid s
-00003460: 796e 7461 7820 6174 2068 6561 6465 7229  yntax at header)
-00003470: 0a20 2020 2020 2020 2073 656c 662e 696e  .        self.in
-00003480: 766f 6b65 426c 6163 6b28 5b73 7472 2874  vokeBlack([str(t
-00003490: 6d70 5f66 696c 6529 2c20 222d 2d64 6966  mp_file), "--dif
-000034a0: 6622 2c20 222d 2d63 6865 636b 225d 2c20  f", "--check"], 
-000034b0: 6578 6974 5f63 6f64 653d 3132 3329 0a20  exit_code=123). 
-000034c0: 2020 2020 2020 2023 2053 6f2c 2073 6b69         # So, ski
-000034d0: 7070 696e 6720 7468 6520 6669 7273 7420  pping the first 
-000034e0: 6c69 6e65 2073 686f 756c 6420 776f 726b  line should work
-000034f0: 0a20 2020 2020 2020 2072 6573 756c 7420  .        result 
-00003500: 3d20 426c 6163 6b52 756e 6e65 7228 292e  = BlackRunner().
-00003510: 696e 766f 6b65 280a 2020 2020 2020 2020  invoke(.        
-00003520: 2020 2020 6365 7263 6973 2e6d 6169 6e2c      cercis.main,
-00003530: 205b 7374 7228 746d 705f 6669 6c65 292c   [str(tmp_file),
-00003540: 2022 2d78 222c 2066 222d 2d63 6f6e 6669   "-x", f"--confi
-00003550: 673d 7b45 4d50 5459 5f43 4f4e 4649 477d  g={EMPTY_CONFIG}
-00003560: 225d 0a20 2020 2020 2020 2029 0a20 2020  "].        ).   
-00003570: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00003580: 4571 7561 6c28 7265 7375 6c74 2e65 7869  Equal(result.exi
-00003590: 745f 636f 6465 2c20 3029 0a20 2020 2020  t_code, 0).     
-000035a0: 2020 2077 6974 6820 6f70 656e 2874 6d70     with open(tmp
-000035b0: 5f66 696c 652c 2065 6e63 6f64 696e 673d  _file, encoding=
-000035c0: 2275 7466 3822 2920 6173 2066 3a0a 2020  "utf8") as f:.  
-000035d0: 2020 2020 2020 2020 2020 6163 7475 616c            actual
-000035e0: 203d 2066 2e72 6561 6428 290a 2020 2020   = f.read().    
-000035f0: 2020 2020 7365 6c66 2e61 7373 6572 7446      self.assertF
-00003600: 6f72 6d61 7445 7175 616c 2873 6f75 7263  ormatEqual(sourc
-00003610: 652c 2061 6374 7561 6c29 0a0a 2020 2020  e, actual)..    
-00003620: 6465 6620 7465 7374 5f73 6b69 705f 736f  def test_skip_so
-00003630: 7572 6365 5f66 6972 7374 5f6c 696e 655f  urce_first_line_
-00003640: 7768 656e 5f6d 6978 696e 675f 6e65 776c  when_mixing_newl
-00003650: 696e 6573 2873 656c 6629 202d 3e20 4e6f  ines(self) -> No
-00003660: 6e65 3a0a 2020 2020 2020 2020 636f 6465  ne:.        code
-00003670: 5f6d 6978 696e 675f 6e65 776c 696e 6573  _mixing_newlines
-00003680: 203d 2062 2248 6561 6465 7220 7769 6c6c   = b"Header will
-00003690: 2062 6520 736b 6970 7065 645c 725c 6e69   be skipped\r\ni
-000036a0: 203d 205b 312c 322c 335d 5c6e 6a20 3d20   = [1,2,3]\nj = 
-000036b0: 5b31 2c32 2c33 5d5c 6e22 0a20 2020 2020  [1,2,3]\n".     
-000036c0: 2020 2065 7870 6563 7465 6420 3d20 6222     expected = b"
-000036d0: 4865 6164 6572 2077 696c 6c20 6265 2073  Header will be s
-000036e0: 6b69 7070 6564 5c72 5c6e 6920 3d20 5b31  kipped\r\ni = [1
-000036f0: 2c20 322c 2033 5d5c 6e6a 203d 205b 312c  , 2, 3]\nj = [1,
-00003700: 2032 2c20 335d 5c6e 220a 2020 2020 2020   2, 3]\n".      
-00003710: 2020 7769 7468 2054 656d 706f 7261 7279    with Temporary
-00003720: 4469 7265 6374 6f72 7928 2920 6173 2077  Directory() as w
-00003730: 6f72 6b73 7061 6365 3a0a 2020 2020 2020  orkspace:.      
-00003740: 2020 2020 2020 7465 7374 5f66 696c 6520        test_file 
-00003750: 3d20 5061 7468 2877 6f72 6b73 7061 6365  = Path(workspace
-00003760: 2920 2f20 2273 6b69 705f 6865 6164 6572  ) / "skip_header
-00003770: 2e70 7922 0a20 2020 2020 2020 2020 2020  .py".           
-00003780: 2074 6573 745f 6669 6c65 2e77 7269 7465   test_file.write
-00003790: 5f62 7974 6573 2863 6f64 655f 6d69 7869  _bytes(code_mixi
-000037a0: 6e67 5f6e 6577 6c69 6e65 7329 0a20 2020  ng_newlines).   
-000037b0: 2020 2020 2020 2020 206d 6f64 6520 3d20           mode = 
-000037c0: 7265 706c 6163 6528 4445 4641 554c 545f  replace(DEFAULT_
-000037d0: 4d4f 4445 2c20 736b 6970 5f73 6f75 7263  MODE, skip_sourc
-000037e0: 655f 6669 7273 745f 6c69 6e65 3d54 7275  e_first_line=Tru
-000037f0: 6529 0a20 2020 2020 2020 2020 2020 2066  e).            f
-00003800: 6628 7465 7374 5f66 696c 652c 206d 6f64  f(test_file, mod
-00003810: 653d 6d6f 6465 2c20 7772 6974 655f 6261  e=mode, write_ba
-00003820: 636b 3d63 6572 6369 732e 5772 6974 6542  ck=cercis.WriteB
-00003830: 6163 6b2e 5945 5329 0a20 2020 2020 2020  ack.YES).       
-00003840: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00003850: 4571 7561 6c28 7465 7374 5f66 696c 652e  Equal(test_file.
-00003860: 7265 6164 5f62 7974 6573 2829 2c20 6578  read_bytes(), ex
-00003870: 7065 6374 6564 290a 0a20 2020 2064 6566  pected)..    def
-00003880: 2074 6573 745f 736b 6970 5f6d 6167 6963   test_skip_magic
-00003890: 5f74 7261 696c 696e 675f 636f 6d6d 6128  _trailing_comma(
-000038a0: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
-000038b0: 2020 2020 2020 2073 6f75 7263 652c 205f         source, _
-000038c0: 203d 2072 6561 645f 6461 7461 2822 7369   = read_data("si
-000038d0: 6d70 6c65 5f63 6173 6573 222c 2022 6578  mple_cases", "ex
-000038e0: 7072 6573 7369 6f6e 2229 0a20 2020 2020  pression").     
-000038f0: 2020 2065 7870 6563 7465 642c 205f 203d     expected, _ =
-00003900: 2072 6561 645f 6461 7461 280a 2020 2020   read_data(.    
-00003910: 2020 2020 2020 2020 226d 6973 6365 6c6c          "miscell
-00003920: 616e 656f 7573 222c 2022 6578 7072 6573  aneous", "expres
-00003930: 7369 6f6e 5f73 6b69 705f 6d61 6769 635f  sion_skip_magic_
-00003940: 7472 6169 6c69 6e67 5f63 6f6d 6d61 2e64  trailing_comma.d
-00003950: 6966 6622 0a20 2020 2020 2020 2029 0a20  iff".        ). 
-00003960: 2020 2020 2020 2074 6d70 5f66 696c 6520         tmp_file 
-00003970: 3d20 5061 7468 2863 6572 6369 732e 6475  = Path(cercis.du
-00003980: 6d70 5f74 6f5f 6669 6c65 2873 6f75 7263  mp_to_file(sourc
-00003990: 6529 290a 2020 2020 2020 2020 6469 6666  e)).        diff
-000039a0: 5f68 6561 6465 7220 3d20 7265 2e63 6f6d  _header = re.com
-000039b0: 7069 6c65 280a 2020 2020 2020 2020 2020  pile(.          
-000039c0: 2020 7266 227b 7265 2e65 7363 6170 6528    rf"{re.escape(
-000039d0: 7374 7228 746d 705f 6669 6c65 2929 7d5c  str(tmp_file))}\
-000039e0: 745c 645c 645c 645c 642d 5c64 5c64 2d5c  t\d\d\d\d-\d\d-\
-000039f0: 645c 6420 220a 2020 2020 2020 2020 2020  d\d ".          
-00003a00: 2020 7222 5c64 5c64 3a5c 645c 643a 5c64    r"\d\d:\d\d:\d
-00003a10: 5c64 5c2e 5c64 5c64 5c64 5c64 5c64 5c64  \d\.\d\d\d\d\d\d
-00003a20: 205c 2b5c 645c 645c 645c 6422 0a20 2020   \+\d\d\d\d".   
-00003a30: 2020 2020 2029 0a20 2020 2020 2020 2074       ).        t
-00003a40: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
-00003a50: 7265 7375 6c74 203d 2042 6c61 636b 5275  result = BlackRu
-00003a60: 6e6e 6572 2829 2e69 6e76 6f6b 6528 0a20  nner().invoke(. 
-00003a70: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00003a80: 6572 6369 732e 6d61 696e 2c20 5b22 2d43  ercis.main, ["-C
-00003a90: 222c 2022 2d2d 6469 6666 222c 2073 7472  ", "--diff", str
-00003aa0: 2874 6d70 5f66 696c 6529 2c20 6622 2d2d  (tmp_file), f"--
-00003ab0: 636f 6e66 6967 3d7b 454d 5054 595f 434f  config={EMPTY_CO
-00003ac0: 4e46 4947 7d22 5d0a 2020 2020 2020 2020  NFIG}"].        
-00003ad0: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-00003ae0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00003af0: 616c 2872 6573 756c 742e 6578 6974 5f63  al(result.exit_c
-00003b00: 6f64 652c 2030 290a 2020 2020 2020 2020  ode, 0).        
-00003b10: 6669 6e61 6c6c 793a 0a20 2020 2020 2020  finally:.       
-00003b20: 2020 2020 206f 732e 756e 6c69 6e6b 2874       os.unlink(t
-00003b30: 6d70 5f66 696c 6529 0a20 2020 2020 2020  mp_file).       
-00003b40: 2061 6374 7561 6c20 3d20 7265 7375 6c74   actual = result
-00003b50: 2e6f 7574 7075 740a 2020 2020 2020 2020  .output.        
-00003b60: 6163 7475 616c 203d 2064 6966 665f 6865  actual = diff_he
-00003b70: 6164 6572 2e73 7562 2844 4554 4552 4d49  ader.sub(DETERMI
-00003b80: 4e49 5354 4943 5f48 4541 4445 522c 2061  NISTIC_HEADER, a
-00003b90: 6374 7561 6c29 0a20 2020 2020 2020 2061  ctual).        a
-00003ba0: 6374 7561 6c20 3d20 6163 7475 616c 2e72  ctual = actual.r
-00003bb0: 7374 7269 7028 2920 2b20 225c 6e22 2020  strip() + "\n"  
-00003bc0: 2320 7468 6520 6469 6666 206f 7574 7075  # the diff outpu
-00003bd0: 7420 6861 7320 6120 7472 6169 6c69 6e67  t has a trailing
-00003be0: 2073 7061 6365 0a20 2020 2020 2020 2069   space.        i
-00003bf0: 6620 6578 7065 6374 6564 2021 3d20 6163  f expected != ac
-00003c00: 7475 616c 3a0a 2020 2020 2020 2020 2020  tual:.          
-00003c10: 2020 6475 6d70 203d 2063 6572 6369 732e    dump = cercis.
-00003c20: 6475 6d70 5f74 6f5f 6669 6c65 2861 6374  dump_to_file(act
-00003c30: 7561 6c29 0a20 2020 2020 2020 2020 2020  ual).           
-00003c40: 206d 7367 203d 2028 0a20 2020 2020 2020   msg = (.       
-00003c50: 2020 2020 2020 2020 2022 4578 7065 6374           "Expect
-00003c60: 6564 2064 6966 6620 6973 6e27 7420 6571  ed diff isn't eq
-00003c70: 7561 6c20 746f 2074 6865 2061 6374 7561  ual to the actua
-00003c80: 6c2e 2049 6620 796f 7520 6d61 6465 2063  l. If you made c
-00003c90: 6861 6e67 6573 2074 6f22 0a20 2020 2020  hanges to".     
-00003ca0: 2020 2020 2020 2020 2020 2022 2065 7870             " exp
-00003cb0: 7265 7373 696f 6e2e 7079 2061 6e64 2074  ression.py and t
-00003cc0: 6869 7320 6973 2061 6e20 616e 7469 6369  his is an antici
-00003cd0: 7061 7465 6420 6469 6666 6572 656e 6365  pated difference
-00003ce0: 2c20 6f76 6572 7772 6974 6522 0a20 2020  , overwrite".   
-00003cf0: 2020 2020 2020 2020 2020 2020 2022 2074               " t
-00003d00: 6573 7473 2f64 6174 612f 6d69 7363 656c  ests/data/miscel
-00003d10: 6c61 6e65 6f75 732f 6578 7072 6573 7369  laneous/expressi
-00003d20: 6f6e 5f73 6b69 705f 6d61 6769 635f 7472  on_skip_magic_tr
-00003d30: 6169 6c69 6e67 5f63 6f6d 6d61 2e64 6966  ailing_comma.dif
-00003d40: 6622 0a20 2020 2020 2020 2020 2020 2020  f".             
-00003d50: 2020 2066 2220 7769 7468 207b 6475 6d70     f" with {dump
-00003d60: 7d22 0a20 2020 2020 2020 2020 2020 2029  }".            )
-00003d70: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00003d80: 662e 6173 7365 7274 4571 7561 6c28 6578  f.assertEqual(ex
-00003d90: 7065 6374 6564 2c20 6163 7475 616c 2c20  pected, actual, 
-00003da0: 6d73 6729 0a0a 2020 2020 4070 6174 6368  msg)..    @patch
-00003db0: 2822 6365 7263 6973 2e64 756d 705f 746f  ("cercis.dump_to
-00003dc0: 5f66 696c 6522 2c20 6475 6d70 5f74 6f5f  _file", dump_to_
-00003dd0: 7374 6465 7272 290a 2020 2020 6465 6620  stderr).    def 
-00003de0: 7465 7374 5f61 7379 6e63 5f61 735f 6964  test_async_as_id
-00003df0: 656e 7469 6669 6572 2873 656c 6629 202d  entifier(self) -
-00003e00: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-00003e10: 736f 7572 6365 5f70 6174 6820 3d20 6765  source_path = ge
-00003e20: 745f 6361 7365 5f70 6174 6828 226d 6973  t_case_path("mis
-00003e30: 6365 6c6c 616e 656f 7573 222c 2022 6173  cellaneous", "as
-00003e40: 796e 635f 6173 5f69 6465 6e74 6966 6965  ync_as_identifie
-00003e50: 7222 290a 2020 2020 2020 2020 736f 7572  r").        sour
-00003e60: 6365 2c20 6578 7065 6374 6564 203d 2072  ce, expected = r
-00003e70: 6561 645f 6461 7461 5f66 726f 6d5f 6669  ead_data_from_fi
-00003e80: 6c65 2873 6f75 7263 655f 7061 7468 290a  le(source_path).
-00003e90: 2020 2020 2020 2020 6163 7475 616c 203d          actual =
-00003ea0: 2066 7328 736f 7572 6365 290a 2020 2020   fs(source).    
-00003eb0: 2020 2020 7365 6c66 2e61 7373 6572 7446      self.assertF
-00003ec0: 6f72 6d61 7445 7175 616c 2865 7870 6563  ormatEqual(expec
-00003ed0: 7465 642c 2061 6374 7561 6c29 0a20 2020  ted, actual).   
-00003ee0: 2020 2020 206d 616a 6f72 2c20 6d69 6e6f       major, mino
-00003ef0: 7220 3d20 7379 732e 7665 7273 696f 6e5f  r = sys.version_
-00003f00: 696e 666f 5b3a 325d 0a20 2020 2020 2020  info[:2].       
-00003f10: 2069 6620 6d61 6a6f 7220 3c20 3320 6f72   if major < 3 or
-00003f20: 2028 6d61 6a6f 7220 3c3d 2033 2061 6e64   (major <= 3 and
-00003f30: 206d 696e 6f72 203c 2037 293a 0a20 2020   minor < 7):.   
-00003f40: 2020 2020 2020 2020 2063 6572 6369 732e           cercis.
-00003f50: 6173 7365 7274 5f65 7175 6976 616c 656e  assert_equivalen
-00003f60: 7428 736f 7572 6365 2c20 6163 7475 616c  t(source, actual
-00003f70: 290a 2020 2020 2020 2020 6365 7263 6973  ).        cercis
-00003f80: 2e61 7373 6572 745f 7374 6162 6c65 2873  .assert_stable(s
-00003f90: 6f75 7263 652c 2061 6374 7561 6c2c 2044  ource, actual, D
-00003fa0: 4546 4155 4c54 5f4d 4f44 4529 0a20 2020  EFAULT_MODE).   
-00003fb0: 2020 2020 2023 2065 6e73 7572 6520 6365       # ensure ce
-00003fc0: 7263 6973 2063 616e 2070 6172 7365 2074  rcis can parse t
-00003fd0: 6869 7320 7768 656e 2074 6865 2074 6172  his when the tar
-00003fe0: 6765 7420 6973 2033 2e36 0a20 2020 2020  get is 3.6.     
-00003ff0: 2020 2073 656c 662e 696e 766f 6b65 426c     self.invokeBl
-00004000: 6163 6b28 5b73 7472 2873 6f75 7263 655f  ack([str(source_
-00004010: 7061 7468 292c 2022 2d2d 7461 7267 6574  path), "--target
-00004020: 2d76 6572 7369 6f6e 222c 2022 7079 3336  -version", "py36
-00004030: 225d 290a 2020 2020 2020 2020 2320 6275  "]).        # bu
-00004040: 7420 6e6f 7420 6f6e 2033 2e37 2c20 6265  t not on 3.7, be
-00004050: 6361 7573 6520 6173 796e 632f 6177 6169  cause async/awai
-00004060: 7420 6973 206e 6f20 6c6f 6e67 6572 2061  t is no longer a
-00004070: 6e20 6964 656e 7469 6669 6572 0a20 2020  n identifier.   
-00004080: 2020 2020 2073 656c 662e 696e 766f 6b65       self.invoke
-00004090: 426c 6163 6b28 5b73 7472 2873 6f75 7263  Black([str(sourc
-000040a0: 655f 7061 7468 292c 2022 2d2d 7461 7267  e_path), "--targ
-000040b0: 6574 2d76 6572 7369 6f6e 222c 2022 7079  et-version", "py
-000040c0: 3337 225d 2c20 6578 6974 5f63 6f64 653d  37"], exit_code=
-000040d0: 3132 3329 0a0a 2020 2020 4070 6174 6368  123)..    @patch
-000040e0: 2822 6365 7263 6973 2e64 756d 705f 746f  ("cercis.dump_to
-000040f0: 5f66 696c 6522 2c20 6475 6d70 5f74 6f5f  _file", dump_to_
-00004100: 7374 6465 7272 290a 2020 2020 6465 6620  stderr).    def 
-00004110: 7465 7374 5f70 7974 686f 6e33 3728 7365  test_python37(se
-00004120: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
-00004130: 2020 2020 2073 6f75 7263 655f 7061 7468       source_path
-00004140: 203d 2067 6574 5f63 6173 655f 7061 7468   = get_case_path
-00004150: 2822 7079 5f33 3722 2c20 2270 7974 686f  ("py_37", "pytho
-00004160: 6e33 3722 290a 2020 2020 2020 2020 736f  n37").        so
-00004170: 7572 6365 2c20 6578 7065 6374 6564 203d  urce, expected =
-00004180: 2072 6561 645f 6461 7461 5f66 726f 6d5f   read_data_from_
-00004190: 6669 6c65 2873 6f75 7263 655f 7061 7468  file(source_path
-000041a0: 290a 2020 2020 2020 2020 6163 7475 616c  ).        actual
-000041b0: 203d 2066 7328 736f 7572 6365 290a 2020   = fs(source).  
-000041c0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-000041d0: 7446 6f72 6d61 7445 7175 616c 2865 7870  tFormatEqual(exp
-000041e0: 6563 7465 642c 2061 6374 7561 6c29 0a20  ected, actual). 
-000041f0: 2020 2020 2020 206d 616a 6f72 2c20 6d69         major, mi
-00004200: 6e6f 7220 3d20 7379 732e 7665 7273 696f  nor = sys.versio
-00004210: 6e5f 696e 666f 5b3a 325d 0a20 2020 2020  n_info[:2].     
-00004220: 2020 2069 6620 6d61 6a6f 7220 3e20 3320     if major > 3 
-00004230: 6f72 2028 6d61 6a6f 7220 3d3d 2033 2061  or (major == 3 a
-00004240: 6e64 206d 696e 6f72 203e 3d20 3729 3a0a  nd minor >= 7):.
-00004250: 2020 2020 2020 2020 2020 2020 6365 7263              cerc
-00004260: 6973 2e61 7373 6572 745f 6571 7569 7661  is.assert_equiva
-00004270: 6c65 6e74 2873 6f75 7263 652c 2061 6374  lent(source, act
-00004280: 7561 6c29 0a20 2020 2020 2020 2063 6572  ual).        cer
-00004290: 6369 732e 6173 7365 7274 5f73 7461 626c  cis.assert_stabl
-000042a0: 6528 736f 7572 6365 2c20 6163 7475 616c  e(source, actual
-000042b0: 2c20 4445 4641 554c 545f 4d4f 4445 290a  , DEFAULT_MODE).
-000042c0: 2020 2020 2020 2020 2320 656e 7375 7265          # ensure
-000042d0: 2063 6572 6369 7320 6361 6e20 7061 7273   cercis can pars
-000042e0: 6520 7468 6973 2077 6865 6e20 7468 6520  e this when the 
-000042f0: 7461 7267 6574 2069 7320 332e 370a 2020  target is 3.7.  
-00004300: 2020 2020 2020 7365 6c66 2e69 6e76 6f6b        self.invok
-00004310: 6542 6c61 636b 285b 7374 7228 736f 7572  eBlack([str(sour
-00004320: 6365 5f70 6174 6829 2c20 222d 2d74 6172  ce_path), "--tar
-00004330: 6765 742d 7665 7273 696f 6e22 2c20 2270  get-version", "p
-00004340: 7933 3722 5d29 0a20 2020 2020 2020 2023  y37"]).        #
-00004350: 2062 7574 206e 6f74 206f 6e20 332e 362c   but not on 3.6,
-00004360: 2062 6563 6175 7365 2077 6520 7573 6520   because we use 
-00004370: 6173 796e 6320 6173 2061 2072 6573 6572  async as a reser
-00004380: 7665 6420 6b65 7977 6f72 640a 2020 2020  ved keyword.    
-00004390: 2020 2020 7365 6c66 2e69 6e76 6f6b 6542      self.invokeB
-000043a0: 6c61 636b 285b 7374 7228 736f 7572 6365  lack([str(source
-000043b0: 5f70 6174 6829 2c20 222d 2d74 6172 6765  _path), "--targe
-000043c0: 742d 7665 7273 696f 6e22 2c20 2270 7933  t-version", "py3
-000043d0: 3622 5d2c 2065 7869 745f 636f 6465 3d31  6"], exit_code=1
-000043e0: 3233 290a 0a20 2020 2064 6566 2074 6573  23)..    def tes
-000043f0: 745f 7461 625f 636f 6d6d 656e 745f 696e  t_tab_comment_in
-00004400: 6465 6e74 6174 696f 6e28 7365 6c66 2920  dentation(self) 
-00004410: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
-00004420: 2063 6f6e 7465 6e74 735f 7461 6220 3d20   contents_tab = 
-00004430: 2269 6620 313a 5c6e 5c74 6966 2032 3a5c  "if 1:\n\tif 2:\
-00004440: 6e5c 745c 7470 6173 735c 6e5c 7423 2063  n\t\tpass\n\t# c
-00004450: 6f6d 6d65 6e74 5c6e 5c74 7061 7373 5c6e  omment\n\tpass\n
-00004460: 220a 2020 2020 2020 2020 636f 6e74 656e  ".        conten
-00004470: 7473 5f73 7063 203d 2022 6966 2031 3a5c  ts_spc = "if 1:\
-00004480: 6e20 2020 2069 6620 323a 5c6e 2020 2020  n    if 2:\n    
-00004490: 2020 2020 7061 7373 5c6e 2020 2020 2320      pass\n    # 
-000044a0: 636f 6d6d 656e 745c 6e20 2020 2070 6173  comment\n    pas
-000044b0: 735c 6e22 0a20 2020 2020 2020 2073 656c  s\n".        sel
-000044c0: 662e 6173 7365 7274 466f 726d 6174 4571  f.assertFormatEq
-000044d0: 7561 6c28 636f 6e74 656e 7473 5f73 7063  ual(contents_spc
-000044e0: 2c20 6673 2863 6f6e 7465 6e74 735f 7370  , fs(contents_sp
-000044f0: 6329 290a 2020 2020 2020 2020 7365 6c66  c)).        self
-00004500: 2e61 7373 6572 7446 6f72 6d61 7445 7175  .assertFormatEqu
-00004510: 616c 2863 6f6e 7465 6e74 735f 7370 632c  al(contents_spc,
-00004520: 2066 7328 636f 6e74 656e 7473 5f74 6162   fs(contents_tab
-00004530: 2929 0a0a 2020 2020 2020 2020 636f 6e74  ))..        cont
-00004540: 656e 7473 5f74 6162 203d 2022 6966 2031  ents_tab = "if 1
-00004550: 3a5c 6e5c 7469 6620 323a 5c6e 5c74 5c74  :\n\tif 2:\n\t\t
-00004560: 7061 7373 5c6e 5c74 5c74 2320 636f 6d6d  pass\n\t\t# comm
-00004570: 656e 745c 6e5c 7470 6173 735c 6e22 0a20  ent\n\tpass\n". 
-00004580: 2020 2020 2020 2063 6f6e 7465 6e74 735f         contents_
-00004590: 7370 6320 3d20 2269 6620 313a 5c6e 2020  spc = "if 1:\n  
-000045a0: 2020 6966 2032 3a5c 6e20 2020 2020 2020    if 2:\n       
-000045b0: 2070 6173 735c 6e20 2020 2020 2020 2023   pass\n        #
-000045c0: 2063 6f6d 6d65 6e74 5c6e 2020 2020 7061   comment\n    pa
-000045d0: 7373 5c6e 220a 2020 2020 2020 2020 7365  ss\n".        se
-000045e0: 6c66 2e61 7373 6572 7446 6f72 6d61 7445  lf.assertFormatE
-000045f0: 7175 616c 2863 6f6e 7465 6e74 735f 7370  qual(contents_sp
-00004600: 632c 2066 7328 636f 6e74 656e 7473 5f73  c, fs(contents_s
-00004610: 7063 2929 0a20 2020 2020 2020 2073 656c  pc)).        sel
-00004620: 662e 6173 7365 7274 466f 726d 6174 4571  f.assertFormatEq
-00004630: 7561 6c28 636f 6e74 656e 7473 5f73 7063  ual(contents_spc
-00004640: 2c20 6673 2863 6f6e 7465 6e74 735f 7461  , fs(contents_ta
-00004650: 6229 290a 0a20 2020 2020 2020 2023 206d  b))..        # m
-00004660: 6978 6564 2074 6162 7320 616e 6420 7370  ixed tabs and sp
-00004670: 6163 6573 2028 7661 6c69 6420 5079 7468  aces (valid Pyth
-00004680: 6f6e 2032 2063 6f64 6529 0a20 2020 2020  on 2 code).     
-00004690: 2020 2063 6f6e 7465 6e74 735f 7461 6220     contents_tab 
-000046a0: 3d20 2269 6620 313a 5c6e 2020 2020 2020  = "if 1:\n      
-000046b0: 2020 6966 2032 3a5c 6e5c 745c 7470 6173    if 2:\n\t\tpas
-000046c0: 735c 6e5c 7423 2063 6f6d 6d65 6e74 5c6e  s\n\t# comment\n
-000046d0: 2020 2020 2020 2020 7061 7373 5c6e 220a          pass\n".
-000046e0: 2020 2020 2020 2020 636f 6e74 656e 7473          contents
-000046f0: 5f73 7063 203d 2022 6966 2031 3a5c 6e20  _spc = "if 1:\n 
-00004700: 2020 2069 6620 323a 5c6e 2020 2020 2020     if 2:\n      
-00004710: 2020 7061 7373 5c6e 2020 2020 2320 636f    pass\n    # co
-00004720: 6d6d 656e 745c 6e20 2020 2070 6173 735c  mment\n    pass\
-00004730: 6e22 0a20 2020 2020 2020 2073 656c 662e  n".        self.
-00004740: 6173 7365 7274 466f 726d 6174 4571 7561  assertFormatEqua
-00004750: 6c28 636f 6e74 656e 7473 5f73 7063 2c20  l(contents_spc, 
-00004760: 6673 2863 6f6e 7465 6e74 735f 7370 6329  fs(contents_spc)
-00004770: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-00004780: 7373 6572 7446 6f72 6d61 7445 7175 616c  ssertFormatEqual
-00004790: 2863 6f6e 7465 6e74 735f 7370 632c 2066  (contents_spc, f
-000047a0: 7328 636f 6e74 656e 7473 5f74 6162 2929  s(contents_tab))
-000047b0: 0a0a 2020 2020 2020 2020 636f 6e74 656e  ..        conten
-000047c0: 7473 5f74 6162 203d 2022 6966 2031 3a5c  ts_tab = "if 1:\
-000047d0: 6e20 2020 2020 2020 2069 6620 323a 5c6e  n        if 2:\n
-000047e0: 5c74 5c74 7061 7373 5c6e 5c74 5c74 2320  \t\tpass\n\t\t# 
-000047f0: 636f 6d6d 656e 745c 6e20 2020 2020 2020  comment\n       
-00004800: 2070 6173 735c 6e22 0a20 2020 2020 2020   pass\n".       
-00004810: 2063 6f6e 7465 6e74 735f 7370 6320 3d20   contents_spc = 
-00004820: 2269 6620 313a 5c6e 2020 2020 6966 2032  "if 1:\n    if 2
-00004830: 3a5c 6e20 2020 2020 2020 2070 6173 735c  :\n        pass\
-00004840: 6e20 2020 2020 2020 2023 2063 6f6d 6d65  n        # comme
-00004850: 6e74 5c6e 2020 2020 7061 7373 5c6e 220a  nt\n    pass\n".
-00004860: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00004870: 6572 7446 6f72 6d61 7445 7175 616c 2863  ertFormatEqual(c
-00004880: 6f6e 7465 6e74 735f 7370 632c 2066 7328  ontents_spc, fs(
-00004890: 636f 6e74 656e 7473 5f73 7063 2929 0a20  contents_spc)). 
-000048a0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-000048b0: 7274 466f 726d 6174 4571 7561 6c28 636f  rtFormatEqual(co
-000048c0: 6e74 656e 7473 5f73 7063 2c20 6673 2863  ntents_spc, fs(c
-000048d0: 6f6e 7465 6e74 735f 7461 6229 290a 0a20  ontents_tab)).. 
-000048e0: 2020 2064 6566 2074 6573 745f 6661 6c73     def test_fals
-000048f0: 655f 706f 7369 7469 7665 5f73 796d 6c69  e_positive_symli
-00004900: 6e6b 5f6f 7574 7075 745f 6973 7375 655f  nk_output_issue_
-00004910: 3333 3834 2873 656c 6629 202d 3e20 4e6f  3384(self) -> No
-00004920: 6e65 3a0a 2020 2020 2020 2020 2320 456d  ne:.        # Em
-00004930: 756c 6174 6520 7468 6520 6265 6861 7669  ulate the behavi
-00004940: 6f72 2077 6865 6e20 7573 696e 6720 7468  or when using th
-00004950: 6520 434c 4920 2860 6365 7263 6973 202e  e CLI (`cercis .
-00004960: 2f63 6869 6c64 2020 2d2d 7665 7262 6f73  /child  --verbos
-00004970: 6560 292c 2077 6869 6368 0a20 2020 2020  e`), which.     
-00004980: 2020 2023 2069 6e76 6f6c 7665 7320 7061     # involves pa
-00004990: 7463 6869 6e67 2073 6f6d 6520 6070 6174  tching some `pat
-000049a0: 686c 6962 2e50 6174 6860 206d 6574 686f  hlib.Path` metho
-000049b0: 6473 2e20 496e 2070 6172 7469 6375 6c61  ds. In particula
-000049c0: 722c 2060 6973 5f64 6972 6020 6973 0a20  r, `is_dir` is. 
-000049d0: 2020 2020 2020 2023 2070 6174 6368 6564         # patched
-000049e0: 206f 6e6c 7920 6f6e 2069 7473 2066 6972   only on its fir
-000049f0: 7374 2063 616c 6c3a 2077 6865 6e20 6368  st call: when ch
-00004a00: 6563 6b69 6e67 2069 6620 222e 2f63 6869  ecking if "./chi
-00004a10: 6c64 2220 6973 2061 2064 6972 6563 746f  ld" is a directo
-00004a20: 7279 2069 740a 2020 2020 2020 2020 2320  ry it.        # 
-00004a30: 7368 6f75 6c64 2072 6574 7572 6e20 5472  should return Tr
-00004a40: 7565 2e20 5468 6520 222e 2f63 6869 6c64  ue. The "./child
-00004a50: 2220 666f 6c64 6572 2065 7869 7374 7320  " folder exists 
-00004a60: 7265 6c61 7469 7665 2074 6f20 7468 6520  relative to the 
-00004a70: 6377 6420 7768 656e 0a20 2020 2020 2020  cwd when.       
-00004a80: 2023 2072 756e 6e69 6e67 2066 726f 6d20   # running from 
-00004a90: 434c 492c 2062 7574 2066 6169 6c73 2077  CLI, but fails w
-00004aa0: 6865 6e20 7275 6e6e 696e 6720 7468 6520  hen running the 
-00004ab0: 7465 7374 7320 6265 6361 7573 6520 6377  tests because cw
-00004ac0: 6420 6973 2064 6966 6665 7265 6e74 0a20  d is different. 
-00004ad0: 2020 2020 2020 2070 726f 6a65 6374 5f72         project_r
-00004ae0: 6f6f 7420 3d20 5061 7468 2854 4849 535f  oot = Path(THIS_
-00004af0: 4449 5220 2f20 2264 6174 6122 202f 2022  DIR / "data" / "
-00004b00: 6e65 7374 6564 5f67 6974 6967 6e6f 7265  nested_gitignore
-00004b10: 5f74 6573 7473 2229 0a20 2020 2020 2020  _tests").       
-00004b20: 2077 6f72 6b69 6e67 5f64 6972 6563 746f   working_directo
-00004b30: 7279 203d 2070 726f 6a65 6374 5f72 6f6f  ry = project_roo
-00004b40: 7420 2f20 2272 6f6f 7422 0a20 2020 2020  t / "root".     
-00004b50: 2020 2074 6172 6765 745f 6162 7370 6174     target_abspat
-00004b60: 6820 3d20 776f 726b 696e 675f 6469 7265  h = working_dire
-00004b70: 6374 6f72 7920 2f20 2263 6869 6c64 220a  ctory / "child".
-00004b80: 2020 2020 2020 2020 7461 7267 6574 5f63          target_c
-00004b90: 6f6e 7465 6e74 7320 3d20 280a 2020 2020  ontents = (.    
-00004ba0: 2020 2020 2020 2020 7372 632e 7265 6c61          src.rela
-00004bb0: 7469 7665 5f74 6f28 776f 726b 696e 675f  tive_to(working_
-00004bc0: 6469 7265 6374 6f72 7929 2066 6f72 2073  directory) for s
-00004bd0: 7263 2069 6e20 7461 7267 6574 5f61 6273  rc in target_abs
-00004be0: 7061 7468 2e69 7465 7264 6972 2829 0a20  path.iterdir(). 
-00004bf0: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
-00004c00: 2020 6465 6620 6d6f 636b 5f6e 5f63 616c    def mock_n_cal
-00004c10: 6c73 2872 6573 706f 6e73 6573 3a20 4c69  ls(responses: Li
-00004c20: 7374 5b62 6f6f 6c5d 2920 2d3e 2043 616c  st[bool]) -> Cal
-00004c30: 6c61 626c 655b 5b5d 2c20 626f 6f6c 5d3a  lable[[], bool]:
-00004c40: 0a20 2020 2020 2020 2020 2020 2064 6566  .            def
-00004c50: 205f 6d6f 636b 6564 5f63 616c 6c73 2829   _mocked_calls()
-00004c60: 202d 3e20 626f 6f6c 3a0a 2020 2020 2020   -> bool:.      
-00004c70: 2020 2020 2020 2020 2020 6966 2072 6573            if res
-00004c80: 706f 6e73 6573 3a0a 2020 2020 2020 2020  ponses:.        
-00004c90: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00004ca0: 726e 2072 6573 706f 6e73 6573 2e70 6f70  rn responses.pop
-00004cb0: 2830 290a 2020 2020 2020 2020 2020 2020  (0).            
-00004cc0: 2020 2020 7265 7475 726e 2046 616c 7365      return False
-00004cd0: 0a0a 2020 2020 2020 2020 2020 2020 7265  ..            re
-00004ce0: 7475 726e 205f 6d6f 636b 6564 5f63 616c  turn _mocked_cal
-00004cf0: 6c73 0a0a 2020 2020 2020 2020 7769 7468  ls..        with
-00004d00: 2070 6174 6368 2822 7061 7468 6c69 622e   patch("pathlib.
-00004d10: 5061 7468 2e69 7465 7264 6972 222c 2072  Path.iterdir", r
-00004d20: 6574 7572 6e5f 7661 6c75 653d 7461 7267  eturn_value=targ
-00004d30: 6574 5f63 6f6e 7465 6e74 7329 2c20 7061  et_contents), pa
-00004d40: 7463 6828 0a20 2020 2020 2020 2020 2020  tch(.           
-00004d50: 2022 7061 7468 6c69 622e 5061 7468 2e63   "pathlib.Path.c
-00004d60: 7764 222c 2072 6574 7572 6e5f 7661 6c75  wd", return_valu
-00004d70: 653d 776f 726b 696e 675f 6469 7265 6374  e=working_direct
-00004d80: 6f72 790a 2020 2020 2020 2020 292c 2070  ory.        ), p
-00004d90: 6174 6368 2822 7061 7468 6c69 622e 5061  atch("pathlib.Pa
-00004da0: 7468 2e69 735f 6469 7222 2c20 7369 6465  th.is_dir", side
-00004db0: 5f65 6666 6563 743d 6d6f 636b 5f6e 5f63  _effect=mock_n_c
-00004dc0: 616c 6c73 285b 5472 7565 5d29 293a 0a20  alls([True])):. 
-00004dd0: 2020 2020 2020 2020 2020 2063 7478 203d             ctx =
-00004de0: 2046 616b 6543 6f6e 7465 7874 2829 0a20   FakeContext(). 
-00004df0: 2020 2020 2020 2020 2020 2063 7478 2e6f             ctx.o
-00004e00: 626a 5b22 726f 6f74 225d 203d 2070 726f  bj["root"] = pro
-00004e10: 6a65 6374 5f72 6f6f 740a 2020 2020 2020  ject_root.      
-00004e20: 2020 2020 2020 7265 706f 7274 203d 204d        report = M
-00004e30: 6167 6963 4d6f 636b 2876 6572 626f 7365  agicMock(verbose
-00004e40: 3d54 7275 6529 0a20 2020 2020 2020 2020  =True).         
-00004e50: 2020 2063 6572 6369 732e 6765 745f 736f     cercis.get_so
-00004e60: 7572 6365 7328 0a20 2020 2020 2020 2020  urces(.         
-00004e70: 2020 2020 2020 2063 7478 3d63 7478 2c0a         ctx=ctx,.
-00004e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004e90: 7372 633d 2822 2e2f 6368 696c 6422 2c29  src=("./child",)
-00004ea0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00004eb0: 2020 7175 6965 743d 4661 6c73 652c 0a20    quiet=False,. 
-00004ec0: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-00004ed0: 6572 626f 7365 3d54 7275 652c 0a20 2020  erbose=True,.   
-00004ee0: 2020 2020 2020 2020 2020 2020 2069 6e63               inc
-00004ef0: 6c75 6465 3d44 4546 4155 4c54 5f49 4e43  lude=DEFAULT_INC
-00004f00: 4c55 4445 2c0a 2020 2020 2020 2020 2020  LUDE,.          
-00004f10: 2020 2020 2020 6578 636c 7564 653d 4e6f        exclude=No
-00004f20: 6e65 2c0a 2020 2020 2020 2020 2020 2020  ne,.            
-00004f30: 2020 2020 7265 706f 7274 3d72 6570 6f72      report=repor
-00004f40: 742c 0a20 2020 2020 2020 2020 2020 2020  t,.             
-00004f50: 2020 2065 7874 656e 645f 6578 636c 7564     extend_exclud
-00004f60: 653d 4e6f 6e65 2c0a 2020 2020 2020 2020  e=None,.        
-00004f70: 2020 2020 2020 2020 666f 7263 655f 6578          force_ex
-00004f80: 636c 7564 653d 4e6f 6e65 2c0a 2020 2020  clude=None,.    
-00004f90: 2020 2020 2020 2020 2020 2020 7374 6469              stdi
-00004fa0: 6e5f 6669 6c65 6e61 6d65 3d4e 6f6e 652c  n_filename=None,
-00004fb0: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-00004fc0: 2020 2020 2020 2061 7373 6572 7420 6e6f         assert no
-00004fd0: 7420 616e 7928 0a20 2020 2020 2020 2020  t any(.         
-00004fe0: 2020 206d 6f63 6b5f 6172 6773 5b31 5d2e     mock_args[1].
-00004ff0: 7374 6172 7473 7769 7468 2822 6973 2061  startswith("is a
-00005000: 2073 796d 626f 6c69 6320 6c69 6e6b 2074   symbolic link t
-00005010: 6861 7420 706f 696e 7473 206f 7574 7369  hat points outsi
-00005020: 6465 2229 0a20 2020 2020 2020 2020 2020  de").           
-00005030: 2066 6f72 205f 2c20 6d6f 636b 5f61 7267   for _, mock_arg
-00005040: 732c 205f 2069 6e20 7265 706f 7274 2e70  s, _ in report.p
-00005050: 6174 685f 6967 6e6f 7265 642e 6d6f 636b  ath_ignored.mock
-00005060: 5f63 616c 6c73 0a20 2020 2020 2020 2029  _calls.        )
-00005070: 2c20 2241 2073 796d 626f 6c69 6320 6c69  , "A symbolic li
-00005080: 6e6b 2077 6173 2072 6570 6f72 7465 642e  nk was reported.
-00005090: 220a 2020 2020 2020 2020 7265 706f 7274  ".        report
-000050a0: 2e70 6174 685f 6967 6e6f 7265 642e 6173  .path_ignored.as
-000050b0: 7365 7274 5f63 616c 6c65 645f 6f6e 6365  sert_called_once
-000050c0: 5f77 6974 6828 0a20 2020 2020 2020 2020  _with(.         
-000050d0: 2020 2050 6174 6828 2263 6869 6c64 222c     Path("child",
-000050e0: 2022 622e 7079 2229 2c20 226d 6174 6368   "b.py"), "match
-000050f0: 6573 2061 202e 6769 7469 676e 6f72 6520  es a .gitignore 
-00005100: 6669 6c65 2063 6f6e 7465 6e74 220a 2020  file content".  
-00005110: 2020 2020 2020 290a 0a20 2020 2064 6566        )..    def
-00005120: 2074 6573 745f 7265 706f 7274 5f76 6572   test_report_ver
-00005130: 626f 7365 2873 656c 6629 202d 3e20 4e6f  bose(self) -> No
-00005140: 6e65 3a0a 2020 2020 2020 2020 7265 706f  ne:.        repo
-00005150: 7274 203d 2052 6570 6f72 7428 7665 7262  rt = Report(verb
-00005160: 6f73 653d 5472 7565 290a 2020 2020 2020  ose=True).      
-00005170: 2020 6f75 745f 6c69 6e65 7320 3d20 5b5d    out_lines = []
-00005180: 0a20 2020 2020 2020 2065 7272 5f6c 696e  .        err_lin
-00005190: 6573 203d 205b 5d0a 0a20 2020 2020 2020  es = []..       
-000051a0: 2064 6566 206f 7574 286d 7367 3a20 7374   def out(msg: st
-000051b0: 722c 202a 2a6b 7761 7267 733a 2041 6e79  r, **kwargs: Any
-000051c0: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-000051d0: 2020 2020 2020 206f 7574 5f6c 696e 6573         out_lines
-000051e0: 2e61 7070 656e 6428 6d73 6729 0a0a 2020  .append(msg)..  
-000051f0: 2020 2020 2020 6465 6620 6572 7228 6d73        def err(ms
-00005200: 673a 2073 7472 2c20 2a2a 6b77 6172 6773  g: str, **kwargs
-00005210: 3a20 416e 7929 202d 3e20 4e6f 6e65 3a0a  : Any) -> None:.
-00005220: 2020 2020 2020 2020 2020 2020 6572 725f              err_
-00005230: 6c69 6e65 732e 6170 7065 6e64 286d 7367  lines.append(msg
-00005240: 290a 0a20 2020 2020 2020 2077 6974 6820  )..        with 
-00005250: 7061 7463 6828 2263 6572 6369 732e 6f75  patch("cercis.ou
-00005260: 7470 7574 2e5f 6f75 7422 2c20 6f75 7429  tput._out", out)
-00005270: 2c20 7061 7463 6828 2263 6572 6369 732e  , patch("cercis.
-00005280: 6f75 7470 7574 2e5f 6572 7222 2c20 6572  output._err", er
-00005290: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
-000052a0: 7265 706f 7274 2e64 6f6e 6528 5061 7468  report.done(Path
-000052b0: 2822 6631 2229 2c20 6365 7263 6973 2e43  ("f1"), cercis.C
-000052c0: 6861 6e67 6564 2e4e 4f29 0a20 2020 2020  hanged.NO).     
-000052d0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-000052e0: 7274 4571 7561 6c28 6c65 6e28 6f75 745f  rtEqual(len(out_
-000052f0: 6c69 6e65 7329 2c20 3129 0a20 2020 2020  lines), 1).     
-00005300: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00005310: 7274 4571 7561 6c28 6c65 6e28 6572 725f  rtEqual(len(err_
-00005320: 6c69 6e65 7329 2c20 3029 0a20 2020 2020  lines), 0).     
-00005330: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00005340: 7274 4571 7561 6c28 6f75 745f 6c69 6e65  rtEqual(out_line
-00005350: 735b 2d31 5d2c 2022 6631 2061 6c72 6561  s[-1], "f1 alrea
-00005360: 6479 2077 656c 6c20 666f 726d 6174 7465  dy well formatte
-00005370: 642c 2067 6f6f 6420 6a6f 622e 2229 0a20  d, good job."). 
-00005380: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00005390: 6173 7365 7274 4571 7561 6c28 756e 7374  assertEqual(unst
-000053a0: 796c 6528 7374 7228 7265 706f 7274 2929  yle(str(report))
-000053b0: 2c20 2231 2066 696c 6520 6c65 6674 2075  , "1 file left u
-000053c0: 6e63 6861 6e67 6564 2e22 290a 2020 2020  nchanged.").    
-000053d0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-000053e0: 6572 7445 7175 616c 2872 6570 6f72 742e  ertEqual(report.
-000053f0: 7265 7475 726e 5f63 6f64 652c 2030 290a  return_code, 0).
-00005400: 2020 2020 2020 2020 2020 2020 7265 706f              repo
-00005410: 7274 2e64 6f6e 6528 5061 7468 2822 6632  rt.done(Path("f2
-00005420: 2229 2c20 6365 7263 6973 2e43 6861 6e67  "), cercis.Chang
-00005430: 6564 2e59 4553 290a 2020 2020 2020 2020  ed.YES).        
-00005440: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00005450: 7175 616c 286c 656e 286f 7574 5f6c 696e  qual(len(out_lin
-00005460: 6573 292c 2032 290a 2020 2020 2020 2020  es), 2).        
-00005470: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00005480: 7175 616c 286c 656e 2865 7272 5f6c 696e  qual(len(err_lin
-00005490: 6573 292c 2030 290a 2020 2020 2020 2020  es), 0).        
-000054a0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-000054b0: 7175 616c 286f 7574 5f6c 696e 6573 5b2d  qual(out_lines[-
-000054c0: 315d 2c20 2272 6566 6f72 6d61 7474 6564  1], "reformatted
-000054d0: 2066 3222 290a 2020 2020 2020 2020 2020   f2").          
-000054e0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-000054f0: 616c 280a 2020 2020 2020 2020 2020 2020  al(.            
-00005500: 2020 2020 756e 7374 796c 6528 7374 7228      unstyle(str(
-00005510: 7265 706f 7274 2929 2c20 2231 2066 696c  report)), "1 fil
-00005520: 6520 7265 666f 726d 6174 7465 642c 2031  e reformatted, 1
-00005530: 2066 696c 6520 6c65 6674 2075 6e63 6861   file left uncha
-00005540: 6e67 6564 2e22 0a20 2020 2020 2020 2020  nged.".         
-00005550: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-00005560: 2072 6570 6f72 742e 646f 6e65 2850 6174   report.done(Pat
-00005570: 6828 2266 3322 292c 2063 6572 6369 732e  h("f3"), cercis.
-00005580: 4368 616e 6765 642e 4341 4348 4544 290a  Changed.CACHED).
-00005590: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000055a0: 2e61 7373 6572 7445 7175 616c 286c 656e  .assertEqual(len
-000055b0: 286f 7574 5f6c 696e 6573 292c 2033 290a  (out_lines), 3).
-000055c0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000055d0: 2e61 7373 6572 7445 7175 616c 286c 656e  .assertEqual(len
-000055e0: 2865 7272 5f6c 696e 6573 292c 2030 290a  (err_lines), 0).
-000055f0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00005600: 2e61 7373 6572 7445 7175 616c 280a 2020  .assertEqual(.  
-00005610: 2020 2020 2020 2020 2020 2020 2020 6f75                ou
-00005620: 745f 6c69 6e65 735b 2d31 5d2c 2022 6633  t_lines[-1], "f3
-00005630: 2077 6173 6e27 7420 6d6f 6469 6669 6564   wasn't modified
-00005640: 206f 6e20 6469 736b 2073 696e 6365 206c   on disk since l
-00005650: 6173 7420 7275 6e2e 220a 2020 2020 2020  ast run.".      
-00005660: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00005670: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00005680: 7175 616c 280a 2020 2020 2020 2020 2020  qual(.          
-00005690: 2020 2020 2020 756e 7374 796c 6528 7374        unstyle(st
-000056a0: 7228 7265 706f 7274 2929 2c20 2231 2066  r(report)), "1 f
-000056b0: 696c 6520 7265 666f 726d 6174 7465 642c  ile reformatted,
-000056c0: 2032 2066 696c 6573 206c 6566 7420 756e   2 files left un
-000056d0: 6368 616e 6765 642e 220a 2020 2020 2020  changed.".      
-000056e0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-000056f0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00005700: 7175 616c 2872 6570 6f72 742e 7265 7475  qual(report.retu
-00005710: 726e 5f63 6f64 652c 2030 290a 2020 2020  rn_code, 0).    
-00005720: 2020 2020 2020 2020 7265 706f 7274 2e63          report.c
-00005730: 6865 636b 203d 2054 7275 650a 2020 2020  heck = True.    
-00005740: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00005750: 6572 7445 7175 616c 2872 6570 6f72 742e  ertEqual(report.
-00005760: 7265 7475 726e 5f63 6f64 652c 2031 290a  return_code, 1).
-00005770: 2020 2020 2020 2020 2020 2020 7265 706f              repo
-00005780: 7274 2e63 6865 636b 203d 2046 616c 7365  rt.check = False
-00005790: 0a20 2020 2020 2020 2020 2020 2072 6570  .            rep
-000057a0: 6f72 742e 6661 696c 6564 2850 6174 6828  ort.failed(Path(
-000057b0: 2265 3122 292c 2022 626f 6f6d 2229 0a20  "e1"), "boom"). 
-000057c0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000057d0: 6173 7365 7274 4571 7561 6c28 6c65 6e28  assertEqual(len(
-000057e0: 6f75 745f 6c69 6e65 7329 2c20 3329 0a20  out_lines), 3). 
-000057f0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00005800: 6173 7365 7274 4571 7561 6c28 6c65 6e28  assertEqual(len(
-00005810: 6572 725f 6c69 6e65 7329 2c20 3129 0a20  err_lines), 1). 
-00005820: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00005830: 6173 7365 7274 4571 7561 6c28 6572 725f  assertEqual(err_
-00005840: 6c69 6e65 735b 2d31 5d2c 2022 6572 726f  lines[-1], "erro
-00005850: 723a 2063 616e 6e6f 7420 666f 726d 6174  r: cannot format
-00005860: 2065 313a 2062 6f6f 6d22 290a 2020 2020   e1: boom").    
-00005870: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00005880: 6572 7445 7175 616c 280a 2020 2020 2020  ertEqual(.      
-00005890: 2020 2020 2020 2020 2020 756e 7374 796c            unstyl
-000058a0: 6528 7374 7228 7265 706f 7274 2929 2c0a  e(str(report)),.
-000058b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000058c0: 2231 2066 696c 6520 7265 666f 726d 6174  "1 file reformat
-000058d0: 7465 642c 2032 2066 696c 6573 206c 6566  ted, 2 files lef
-000058e0: 7420 756e 6368 616e 6765 642c 2031 2066  t unchanged, 1 f
-000058f0: 696c 6520 6661 696c 6564 2074 6f22 0a20  ile failed to". 
-00005900: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00005910: 2072 6566 6f72 6d61 742e 222c 0a20 2020   reformat.",.   
-00005920: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-00005930: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00005940: 7274 4571 7561 6c28 7265 706f 7274 2e72  rtEqual(report.r
-00005950: 6574 7572 6e5f 636f 6465 2c20 3132 3329  eturn_code, 123)
-00005960: 0a20 2020 2020 2020 2020 2020 2072 6570  .            rep
-00005970: 6f72 742e 646f 6e65 2850 6174 6828 2266  ort.done(Path("f
-00005980: 3322 292c 2063 6572 6369 732e 4368 616e  3"), cercis.Chan
-00005990: 6765 642e 5945 5329 0a20 2020 2020 2020  ged.YES).       
-000059a0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-000059b0: 4571 7561 6c28 6c65 6e28 6f75 745f 6c69  Equal(len(out_li
-000059c0: 6e65 7329 2c20 3429 0a20 2020 2020 2020  nes), 4).       
-000059d0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-000059e0: 4571 7561 6c28 6c65 6e28 6572 725f 6c69  Equal(len(err_li
-000059f0: 6e65 7329 2c20 3129 0a20 2020 2020 2020  nes), 1).       
-00005a00: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00005a10: 4571 7561 6c28 6f75 745f 6c69 6e65 735b  Equal(out_lines[
-00005a20: 2d31 5d2c 2022 7265 666f 726d 6174 7465  -1], "reformatte
-00005a30: 6420 6633 2229 0a20 2020 2020 2020 2020  d f3").         
-00005a40: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-00005a50: 7561 6c28 0a20 2020 2020 2020 2020 2020  ual(.           
-00005a60: 2020 2020 2075 6e73 7479 6c65 2873 7472       unstyle(str
-00005a70: 2872 6570 6f72 7429 292c 0a20 2020 2020  (report)),.     
-00005a80: 2020 2020 2020 2020 2020 2022 3220 6669             "2 fi
-00005a90: 6c65 7320 7265 666f 726d 6174 7465 642c  les reformatted,
-00005aa0: 2032 2066 696c 6573 206c 6566 7420 756e   2 files left un
-00005ab0: 6368 616e 6765 642c 2031 2066 696c 6520  changed, 1 file 
-00005ac0: 6661 696c 6564 2074 6f22 0a20 2020 2020  failed to".     
-00005ad0: 2020 2020 2020 2020 2020 2022 2072 6566             " ref
-00005ae0: 6f72 6d61 742e 222c 0a20 2020 2020 2020  ormat.",.       
-00005af0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-00005b00: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-00005b10: 7561 6c28 7265 706f 7274 2e72 6574 7572  ual(report.retur
-00005b20: 6e5f 636f 6465 2c20 3132 3329 0a20 2020  n_code, 123).   
-00005b30: 2020 2020 2020 2020 2072 6570 6f72 742e           report.
-00005b40: 6661 696c 6564 2850 6174 6828 2265 3222  failed(Path("e2"
-00005b50: 292c 2022 626f 6f6d 2229 0a20 2020 2020  ), "boom").     
-00005b60: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00005b70: 7274 4571 7561 6c28 6c65 6e28 6f75 745f  rtEqual(len(out_
-00005b80: 6c69 6e65 7329 2c20 3429 0a20 2020 2020  lines), 4).     
-00005b90: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00005ba0: 7274 4571 7561 6c28 6c65 6e28 6572 725f  rtEqual(len(err_
-00005bb0: 6c69 6e65 7329 2c20 3229 0a20 2020 2020  lines), 2).     
-00005bc0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00005bd0: 7274 4571 7561 6c28 6572 725f 6c69 6e65  rtEqual(err_line
-00005be0: 735b 2d31 5d2c 2022 6572 726f 723a 2063  s[-1], "error: c
-00005bf0: 616e 6e6f 7420 666f 726d 6174 2065 323a  annot format e2:
-00005c00: 2062 6f6f 6d22 290a 2020 2020 2020 2020   boom").        
-00005c10: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00005c20: 7175 616c 280a 2020 2020 2020 2020 2020  qual(.          
-00005c30: 2020 2020 2020 756e 7374 796c 6528 7374        unstyle(st
-00005c40: 7228 7265 706f 7274 2929 2c0a 2020 2020  r(report)),.    
-00005c50: 2020 2020 2020 2020 2020 2020 2232 2066              "2 f
-00005c60: 696c 6573 2072 6566 6f72 6d61 7474 6564  iles reformatted
-00005c70: 2c20 3220 6669 6c65 7320 6c65 6674 2075  , 2 files left u
-00005c80: 6e63 6861 6e67 6564 2c20 3220 6669 6c65  nchanged, 2 file
-00005c90: 7320 6661 696c 6564 2074 6f22 0a20 2020  s failed to".   
-00005ca0: 2020 2020 2020 2020 2020 2020 2022 2072               " r
-00005cb0: 6566 6f72 6d61 742e 222c 0a20 2020 2020  eformat.",.     
-00005cc0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00005cd0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00005ce0: 4571 7561 6c28 7265 706f 7274 2e72 6574  Equal(report.ret
-00005cf0: 7572 6e5f 636f 6465 2c20 3132 3329 0a20  urn_code, 123). 
-00005d00: 2020 2020 2020 2020 2020 2072 6570 6f72             repor
-00005d10: 742e 7061 7468 5f69 676e 6f72 6564 2850  t.path_ignored(P
-00005d20: 6174 6828 2277 6174 2229 2c20 226e 6f20  ath("wat"), "no 
-00005d30: 6d61 7463 6822 290a 2020 2020 2020 2020  match").        
-00005d40: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00005d50: 7175 616c 286c 656e 286f 7574 5f6c 696e  qual(len(out_lin
-00005d60: 6573 292c 2035 290a 2020 2020 2020 2020  es), 5).        
-00005d70: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00005d80: 7175 616c 286c 656e 2865 7272 5f6c 696e  qual(len(err_lin
-00005d90: 6573 292c 2032 290a 2020 2020 2020 2020  es), 2).        
-00005da0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00005db0: 7175 616c 286f 7574 5f6c 696e 6573 5b2d  qual(out_lines[-
-00005dc0: 315d 2c20 2277 6174 2069 676e 6f72 6564  1], "wat ignored
-00005dd0: 3a20 6e6f 206d 6174 6368 2229 0a20 2020  : no match").   
-00005de0: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
-00005df0: 7365 7274 4571 7561 6c28 0a20 2020 2020  sertEqual(.     
-00005e00: 2020 2020 2020 2020 2020 2075 6e73 7479             unsty
-00005e10: 6c65 2873 7472 2872 6570 6f72 7429 292c  le(str(report)),
-00005e20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005e30: 2022 3220 6669 6c65 7320 7265 666f 726d   "2 files reform
-00005e40: 6174 7465 642c 2032 2066 696c 6573 206c  atted, 2 files l
-00005e50: 6566 7420 756e 6368 616e 6765 642c 2032  eft unchanged, 2
-00005e60: 2066 696c 6573 2066 6169 6c65 6420 746f   files failed to
-00005e70: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00005e80: 2020 2220 7265 666f 726d 6174 2e22 2c0a    " reformat.",.
-00005e90: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-00005ea0: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-00005eb0: 7373 6572 7445 7175 616c 2872 6570 6f72  ssertEqual(repor
-00005ec0: 742e 7265 7475 726e 5f63 6f64 652c 2031  t.return_code, 1
-00005ed0: 3233 290a 2020 2020 2020 2020 2020 2020  23).            
-00005ee0: 7265 706f 7274 2e64 6f6e 6528 5061 7468  report.done(Path
-00005ef0: 2822 6634 2229 2c20 6365 7263 6973 2e43  ("f4"), cercis.C
-00005f00: 6861 6e67 6564 2e4e 4f29 0a20 2020 2020  hanged.NO).     
-00005f10: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00005f20: 7274 4571 7561 6c28 6c65 6e28 6f75 745f  rtEqual(len(out_
-00005f30: 6c69 6e65 7329 2c20 3629 0a20 2020 2020  lines), 6).     
-00005f40: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00005f50: 7274 4571 7561 6c28 6c65 6e28 6572 725f  rtEqual(len(err_
-00005f60: 6c69 6e65 7329 2c20 3229 0a20 2020 2020  lines), 2).     
-00005f70: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00005f80: 7274 4571 7561 6c28 6f75 745f 6c69 6e65  rtEqual(out_line
-00005f90: 735b 2d31 5d2c 2022 6634 2061 6c72 6561  s[-1], "f4 alrea
-00005fa0: 6479 2077 656c 6c20 666f 726d 6174 7465  dy well formatte
-00005fb0: 642c 2067 6f6f 6420 6a6f 622e 2229 0a20  d, good job."). 
-00005fc0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00005fd0: 6173 7365 7274 4571 7561 6c28 0a20 2020  assertEqual(.   
-00005fe0: 2020 2020 2020 2020 2020 2020 2075 6e73               uns
-00005ff0: 7479 6c65 2873 7472 2872 6570 6f72 7429  tyle(str(report)
-00006000: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
-00006010: 2020 2022 3220 6669 6c65 7320 7265 666f     "2 files refo
-00006020: 726d 6174 7465 642c 2033 2066 696c 6573  rmatted, 3 files
-00006030: 206c 6566 7420 756e 6368 616e 6765 642c   left unchanged,
-00006040: 2032 2066 696c 6573 2066 6169 6c65 6420   2 files failed 
-00006050: 746f 220a 2020 2020 2020 2020 2020 2020  to".            
-00006060: 2020 2020 2220 7265 666f 726d 6174 2e22      " reformat."
-00006070: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
-00006080: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00006090: 2e61 7373 6572 7445 7175 616c 2872 6570  .assertEqual(rep
-000060a0: 6f72 742e 7265 7475 726e 5f63 6f64 652c  ort.return_code,
-000060b0: 2031 3233 290a 2020 2020 2020 2020 2020   123).          
-000060c0: 2020 7265 706f 7274 2e63 6865 636b 203d    report.check =
-000060d0: 2054 7275 650a 2020 2020 2020 2020 2020   True.          
-000060e0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-000060f0: 616c 280a 2020 2020 2020 2020 2020 2020  al(.            
-00006100: 2020 2020 756e 7374 796c 6528 7374 7228      unstyle(str(
-00006110: 7265 706f 7274 2929 2c0a 2020 2020 2020  report)),.      
-00006120: 2020 2020 2020 2020 2020 2232 2066 696c            "2 fil
-00006130: 6573 2077 6f75 6c64 2062 6520 7265 666f  es would be refo
-00006140: 726d 6174 7465 642c 2033 2066 696c 6573  rmatted, 3 files
-00006150: 2077 6f75 6c64 2062 6520 6c65 6674 2075   would be left u
-00006160: 6e63 6861 6e67 6564 2c20 3222 0a20 2020  nchanged, 2".   
-00006170: 2020 2020 2020 2020 2020 2020 2022 2066               " f
-00006180: 696c 6573 2077 6f75 6c64 2066 6169 6c20  iles would fail 
-00006190: 746f 2072 6566 6f72 6d61 742e 222c 0a20  to reformat.",. 
-000061a0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-000061b0: 2020 2020 2020 2020 2072 6570 6f72 742e           report.
-000061c0: 6368 6563 6b20 3d20 4661 6c73 650a 2020  check = False.  
-000061d0: 2020 2020 2020 2020 2020 7265 706f 7274            report
-000061e0: 2e64 6966 6620 3d20 5472 7565 0a20 2020  .diff = True.   
-000061f0: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
-00006200: 7365 7274 4571 7561 6c28 0a20 2020 2020  sertEqual(.     
-00006210: 2020 2020 2020 2020 2020 2075 6e73 7479             unsty
-00006220: 6c65 2873 7472 2872 6570 6f72 7429 292c  le(str(report)),
-00006230: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00006240: 2022 3220 6669 6c65 7320 776f 756c 6420   "2 files would 
-00006250: 6265 2072 6566 6f72 6d61 7474 6564 2c20  be reformatted, 
-00006260: 3320 6669 6c65 7320 776f 756c 6420 6265  3 files would be
-00006270: 206c 6566 7420 756e 6368 616e 6765 642c   left unchanged,
-00006280: 2032 220a 2020 2020 2020 2020 2020 2020   2".            
-00006290: 2020 2020 2220 6669 6c65 7320 776f 756c      " files woul
-000062a0: 6420 6661 696c 2074 6f20 7265 666f 726d  d fail to reform
-000062b0: 6174 2e22 2c0a 2020 2020 2020 2020 2020  at.",.          
-000062c0: 2020 290a 0a20 2020 2064 6566 2074 6573    )..    def tes
-000062d0: 745f 7265 706f 7274 5f71 7569 6574 2873  t_report_quiet(s
-000062e0: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
-000062f0: 2020 2020 2020 7265 706f 7274 203d 2052        report = R
-00006300: 6570 6f72 7428 7175 6965 743d 5472 7565  eport(quiet=True
-00006310: 290a 2020 2020 2020 2020 6f75 745f 6c69  ).        out_li
-00006320: 6e65 7320 3d20 5b5d 0a20 2020 2020 2020  nes = [].       
-00006330: 2065 7272 5f6c 696e 6573 203d 205b 5d0a   err_lines = [].
-00006340: 0a20 2020 2020 2020 2064 6566 206f 7574  .        def out
-00006350: 286d 7367 3a20 7374 722c 202a 2a6b 7761  (msg: str, **kwa
-00006360: 7267 733a 2041 6e79 2920 2d3e 204e 6f6e  rgs: Any) -> Non
-00006370: 653a 0a20 2020 2020 2020 2020 2020 206f  e:.            o
-00006380: 7574 5f6c 696e 6573 2e61 7070 656e 6428  ut_lines.append(
-00006390: 6d73 6729 0a0a 2020 2020 2020 2020 6465  msg)..        de
-000063a0: 6620 6572 7228 6d73 673a 2073 7472 2c20  f err(msg: str, 
-000063b0: 2a2a 6b77 6172 6773 3a20 416e 7929 202d  **kwargs: Any) -
-000063c0: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-000063d0: 2020 2020 6572 725f 6c69 6e65 732e 6170      err_lines.ap
-000063e0: 7065 6e64 286d 7367 290a 0a20 2020 2020  pend(msg)..     
-000063f0: 2020 2077 6974 6820 7061 7463 6828 2263     with patch("c
-00006400: 6572 6369 732e 6f75 7470 7574 2e5f 6f75  ercis.output._ou
-00006410: 7422 2c20 6f75 7429 2c20 7061 7463 6828  t", out), patch(
-00006420: 2263 6572 6369 732e 6f75 7470 7574 2e5f  "cercis.output._
-00006430: 6572 7222 2c20 6572 7229 3a0a 2020 2020  err", err):.    
-00006440: 2020 2020 2020 2020 7265 706f 7274 2e64          report.d
-00006450: 6f6e 6528 5061 7468 2822 6631 2229 2c20  one(Path("f1"), 
-00006460: 6365 7263 6973 2e43 6861 6e67 6564 2e4e  cercis.Changed.N
-00006470: 4f29 0a20 2020 2020 2020 2020 2020 2073  O).            s
-00006480: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-00006490: 6c65 6e28 6f75 745f 6c69 6e65 7329 2c20  len(out_lines), 
-000064a0: 3029 0a20 2020 2020 2020 2020 2020 2073  0).            s
-000064b0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-000064c0: 6c65 6e28 6572 725f 6c69 6e65 7329 2c20  len(err_lines), 
-000064d0: 3029 0a20 2020 2020 2020 2020 2020 2073  0).            s
-000064e0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-000064f0: 756e 7374 796c 6528 7374 7228 7265 706f  unstyle(str(repo
-00006500: 7274 2929 2c20 2231 2066 696c 6520 6c65  rt)), "1 file le
-00006510: 6674 2075 6e63 6861 6e67 6564 2e22 290a  ft unchanged.").
-00006520: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00006530: 2e61 7373 6572 7445 7175 616c 2872 6570  .assertEqual(rep
-00006540: 6f72 742e 7265 7475 726e 5f63 6f64 652c  ort.return_code,
-00006550: 2030 290a 2020 2020 2020 2020 2020 2020   0).            
-00006560: 7265 706f 7274 2e64 6f6e 6528 5061 7468  report.done(Path
-00006570: 2822 6632 2229 2c20 6365 7263 6973 2e43  ("f2"), cercis.C
-00006580: 6861 6e67 6564 2e59 4553 290a 2020 2020  hanged.YES).    
-00006590: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-000065a0: 6572 7445 7175 616c 286c 656e 286f 7574  ertEqual(len(out
-000065b0: 5f6c 696e 6573 292c 2030 290a 2020 2020  _lines), 0).    
-000065c0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-000065d0: 6572 7445 7175 616c 286c 656e 2865 7272  ertEqual(len(err
-000065e0: 5f6c 696e 6573 292c 2030 290a 2020 2020  _lines), 0).    
-000065f0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00006600: 6572 7445 7175 616c 280a 2020 2020 2020  ertEqual(.      
-00006610: 2020 2020 2020 2020 2020 756e 7374 796c            unstyl
-00006620: 6528 7374 7228 7265 706f 7274 2929 2c20  e(str(report)), 
-00006630: 2231 2066 696c 6520 7265 666f 726d 6174  "1 file reformat
-00006640: 7465 642c 2031 2066 696c 6520 6c65 6674  ted, 1 file left
-00006650: 2075 6e63 6861 6e67 6564 2e22 0a20 2020   unchanged.".   
-00006660: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-00006670: 2020 2020 2020 2072 6570 6f72 742e 646f         report.do
-00006680: 6e65 2850 6174 6828 2266 3322 292c 2063  ne(Path("f3"), c
-00006690: 6572 6369 732e 4368 616e 6765 642e 4341  ercis.Changed.CA
-000066a0: 4348 4544 290a 2020 2020 2020 2020 2020  CHED).          
-000066b0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-000066c0: 616c 286c 656e 286f 7574 5f6c 696e 6573  al(len(out_lines
-000066d0: 292c 2030 290a 2020 2020 2020 2020 2020  ), 0).          
-000066e0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-000066f0: 616c 286c 656e 2865 7272 5f6c 696e 6573  al(len(err_lines
-00006700: 292c 2030 290a 2020 2020 2020 2020 2020  ), 0).          
-00006710: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00006720: 616c 280a 2020 2020 2020 2020 2020 2020  al(.            
-00006730: 2020 2020 756e 7374 796c 6528 7374 7228      unstyle(str(
-00006740: 7265 706f 7274 2929 2c20 2231 2066 696c  report)), "1 fil
-00006750: 6520 7265 666f 726d 6174 7465 642c 2032  e reformatted, 2
-00006760: 2066 696c 6573 206c 6566 7420 756e 6368   files left unch
-00006770: 616e 6765 642e 220a 2020 2020 2020 2020  anged.".        
-00006780: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-00006790: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-000067a0: 616c 2872 6570 6f72 742e 7265 7475 726e  al(report.return
-000067b0: 5f63 6f64 652c 2030 290a 2020 2020 2020  _code, 0).      
-000067c0: 2020 2020 2020 7265 706f 7274 2e63 6865        report.che
-000067d0: 636b 203d 2054 7275 650a 2020 2020 2020  ck = True.      
-000067e0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-000067f0: 7445 7175 616c 2872 6570 6f72 742e 7265  tEqual(report.re
-00006800: 7475 726e 5f63 6f64 652c 2031 290a 2020  turn_code, 1).  
-00006810: 2020 2020 2020 2020 2020 7265 706f 7274            report
-00006820: 2e63 6865 636b 203d 2046 616c 7365 0a20  .check = False. 
-00006830: 2020 2020 2020 2020 2020 2072 6570 6f72             repor
-00006840: 742e 6661 696c 6564 2850 6174 6828 2265  t.failed(Path("e
-00006850: 3122 292c 2022 626f 6f6d 2229 0a20 2020  1"), "boom").   
-00006860: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
-00006870: 7365 7274 4571 7561 6c28 6c65 6e28 6f75  sertEqual(len(ou
-00006880: 745f 6c69 6e65 7329 2c20 3029 0a20 2020  t_lines), 0).   
-00006890: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
-000068a0: 7365 7274 4571 7561 6c28 6c65 6e28 6572  sertEqual(len(er
-000068b0: 725f 6c69 6e65 7329 2c20 3129 0a20 2020  r_lines), 1).   
-000068c0: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
-000068d0: 7365 7274 4571 7561 6c28 6572 725f 6c69  sertEqual(err_li
-000068e0: 6e65 735b 2d31 5d2c 2022 6572 726f 723a  nes[-1], "error:
-000068f0: 2063 616e 6e6f 7420 666f 726d 6174 2065   cannot format e
-00006900: 313a 2062 6f6f 6d22 290a 2020 2020 2020  1: boom").      
-00006910: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00006920: 7445 7175 616c 280a 2020 2020 2020 2020  tEqual(.        
-00006930: 2020 2020 2020 2020 756e 7374 796c 6528          unstyle(
-00006940: 7374 7228 7265 706f 7274 2929 2c0a 2020  str(report)),.  
-00006950: 2020 2020 2020 2020 2020 2020 2020 2231                "1
-00006960: 2066 696c 6520 7265 666f 726d 6174 7465   file reformatte
-00006970: 642c 2032 2066 696c 6573 206c 6566 7420  d, 2 files left 
-00006980: 756e 6368 616e 6765 642c 2031 2066 696c  unchanged, 1 fil
-00006990: 6520 6661 696c 6564 2074 6f22 0a20 2020  e failed to".   
-000069a0: 2020 2020 2020 2020 2020 2020 2022 2072               " r
-000069b0: 6566 6f72 6d61 742e 222c 0a20 2020 2020  eformat.",.     
-000069c0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-000069d0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-000069e0: 4571 7561 6c28 7265 706f 7274 2e72 6574  Equal(report.ret
-000069f0: 7572 6e5f 636f 6465 2c20 3132 3329 0a20  urn_code, 123). 
-00006a00: 2020 2020 2020 2020 2020 2072 6570 6f72             repor
-00006a10: 742e 646f 6e65 2850 6174 6828 2266 3322  t.done(Path("f3"
-00006a20: 292c 2063 6572 6369 732e 4368 616e 6765  ), cercis.Change
-00006a30: 642e 5945 5329 0a20 2020 2020 2020 2020  d.YES).         
-00006a40: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-00006a50: 7561 6c28 6c65 6e28 6f75 745f 6c69 6e65  ual(len(out_line
-00006a60: 7329 2c20 3029 0a20 2020 2020 2020 2020  s), 0).         
-00006a70: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-00006a80: 7561 6c28 6c65 6e28 6572 725f 6c69 6e65  ual(len(err_line
-00006a90: 7329 2c20 3129 0a20 2020 2020 2020 2020  s), 1).         
-00006aa0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-00006ab0: 7561 6c28 0a20 2020 2020 2020 2020 2020  ual(.           
-00006ac0: 2020 2020 2075 6e73 7479 6c65 2873 7472       unstyle(str
-00006ad0: 2872 6570 6f72 7429 292c 0a20 2020 2020  (report)),.     
-00006ae0: 2020 2020 2020 2020 2020 2022 3220 6669             "2 fi
-00006af0: 6c65 7320 7265 666f 726d 6174 7465 642c  les reformatted,
-00006b00: 2032 2066 696c 6573 206c 6566 7420 756e   2 files left un
-00006b10: 6368 616e 6765 642c 2031 2066 696c 6520  changed, 1 file 
-00006b20: 6661 696c 6564 2074 6f22 0a20 2020 2020  failed to".     
-00006b30: 2020 2020 2020 2020 2020 2022 2072 6566             " ref
-00006b40: 6f72 6d61 742e 222c 0a20 2020 2020 2020  ormat.",.       
-00006b50: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-00006b60: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-00006b70: 7561 6c28 7265 706f 7274 2e72 6574 7572  ual(report.retur
-00006b80: 6e5f 636f 6465 2c20 3132 3329 0a20 2020  n_code, 123).   
-00006b90: 2020 2020 2020 2020 2072 6570 6f72 742e           report.
-00006ba0: 6661 696c 6564 2850 6174 6828 2265 3222  failed(Path("e2"
-00006bb0: 292c 2022 626f 6f6d 2229 0a20 2020 2020  ), "boom").     
-00006bc0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00006bd0: 7274 4571 7561 6c28 6c65 6e28 6f75 745f  rtEqual(len(out_
-00006be0: 6c69 6e65 7329 2c20 3029 0a20 2020 2020  lines), 0).     
-00006bf0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00006c00: 7274 4571 7561 6c28 6c65 6e28 6572 725f  rtEqual(len(err_
-00006c10: 6c69 6e65 7329 2c20 3229 0a20 2020 2020  lines), 2).     
-00006c20: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00006c30: 7274 4571 7561 6c28 6572 725f 6c69 6e65  rtEqual(err_line
-00006c40: 735b 2d31 5d2c 2022 6572 726f 723a 2063  s[-1], "error: c
-00006c50: 616e 6e6f 7420 666f 726d 6174 2065 323a  annot format e2:
-00006c60: 2062 6f6f 6d22 290a 2020 2020 2020 2020   boom").        
-00006c70: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00006c80: 7175 616c 280a 2020 2020 2020 2020 2020  qual(.          
-00006c90: 2020 2020 2020 756e 7374 796c 6528 7374        unstyle(st
-00006ca0: 7228 7265 706f 7274 2929 2c0a 2020 2020  r(report)),.    
-00006cb0: 2020 2020 2020 2020 2020 2020 2232 2066              "2 f
-00006cc0: 696c 6573 2072 6566 6f72 6d61 7474 6564  iles reformatted
-00006cd0: 2c20 3220 6669 6c65 7320 6c65 6674 2075  , 2 files left u
-00006ce0: 6e63 6861 6e67 6564 2c20 3220 6669 6c65  nchanged, 2 file
-00006cf0: 7320 6661 696c 6564 2074 6f22 0a20 2020  s failed to".   
-00006d00: 2020 2020 2020 2020 2020 2020 2022 2072               " r
-00006d10: 6566 6f72 6d61 742e 222c 0a20 2020 2020  eformat.",.     
-00006d20: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00006d30: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00006d40: 4571 7561 6c28 7265 706f 7274 2e72 6574  Equal(report.ret
-00006d50: 7572 6e5f 636f 6465 2c20 3132 3329 0a20  urn_code, 123). 
-00006d60: 2020 2020 2020 2020 2020 2072 6570 6f72             repor
-00006d70: 742e 7061 7468 5f69 676e 6f72 6564 2850  t.path_ignored(P
-00006d80: 6174 6828 2277 6174 2229 2c20 226e 6f20  ath("wat"), "no 
-00006d90: 6d61 7463 6822 290a 2020 2020 2020 2020  match").        
-00006da0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00006db0: 7175 616c 286c 656e 286f 7574 5f6c 696e  qual(len(out_lin
-00006dc0: 6573 292c 2030 290a 2020 2020 2020 2020  es), 0).        
-00006dd0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00006de0: 7175 616c 286c 656e 2865 7272 5f6c 696e  qual(len(err_lin
-00006df0: 6573 292c 2032 290a 2020 2020 2020 2020  es), 2).        
-00006e00: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00006e10: 7175 616c 280a 2020 2020 2020 2020 2020  qual(.          
-00006e20: 2020 2020 2020 756e 7374 796c 6528 7374        unstyle(st
-00006e30: 7228 7265 706f 7274 2929 2c0a 2020 2020  r(report)),.    
-00006e40: 2020 2020 2020 2020 2020 2020 2232 2066              "2 f
-00006e50: 696c 6573 2072 6566 6f72 6d61 7474 6564  iles reformatted
-00006e60: 2c20 3220 6669 6c65 7320 6c65 6674 2075  , 2 files left u
-00006e70: 6e63 6861 6e67 6564 2c20 3220 6669 6c65  nchanged, 2 file
-00006e80: 7320 6661 696c 6564 2074 6f22 0a20 2020  s failed to".   
-00006e90: 2020 2020 2020 2020 2020 2020 2022 2072               " r
-00006ea0: 6566 6f72 6d61 742e 222c 0a20 2020 2020  eformat.",.     
-00006eb0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00006ec0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00006ed0: 4571 7561 6c28 7265 706f 7274 2e72 6574  Equal(report.ret
-00006ee0: 7572 6e5f 636f 6465 2c20 3132 3329 0a20  urn_code, 123). 
-00006ef0: 2020 2020 2020 2020 2020 2072 6570 6f72             repor
-00006f00: 742e 646f 6e65 2850 6174 6828 2266 3422  t.done(Path("f4"
-00006f10: 292c 2063 6572 6369 732e 4368 616e 6765  ), cercis.Change
-00006f20: 642e 4e4f 290a 2020 2020 2020 2020 2020  d.NO).          
-00006f30: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00006f40: 616c 286c 656e 286f 7574 5f6c 696e 6573  al(len(out_lines
-00006f50: 292c 2030 290a 2020 2020 2020 2020 2020  ), 0).          
-00006f60: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00006f70: 616c 286c 656e 2865 7272 5f6c 696e 6573  al(len(err_lines
-00006f80: 292c 2032 290a 2020 2020 2020 2020 2020  ), 2).          
-00006f90: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00006fa0: 616c 280a 2020 2020 2020 2020 2020 2020  al(.            
-00006fb0: 2020 2020 756e 7374 796c 6528 7374 7228      unstyle(str(
-00006fc0: 7265 706f 7274 2929 2c0a 2020 2020 2020  report)),.      
-00006fd0: 2020 2020 2020 2020 2020 2232 2066 696c            "2 fil
-00006fe0: 6573 2072 6566 6f72 6d61 7474 6564 2c20  es reformatted, 
-00006ff0: 3320 6669 6c65 7320 6c65 6674 2075 6e63  3 files left unc
-00007000: 6861 6e67 6564 2c20 3220 6669 6c65 7320  hanged, 2 files 
-00007010: 6661 696c 6564 2074 6f22 0a20 2020 2020  failed to".     
-00007020: 2020 2020 2020 2020 2020 2022 2072 6566             " ref
-00007030: 6f72 6d61 742e 222c 0a20 2020 2020 2020  ormat.",.       
-00007040: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-00007050: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-00007060: 7561 6c28 7265 706f 7274 2e72 6574 7572  ual(report.retur
-00007070: 6e5f 636f 6465 2c20 3132 3329 0a20 2020  n_code, 123).   
-00007080: 2020 2020 2020 2020 2072 6570 6f72 742e           report.
-00007090: 6368 6563 6b20 3d20 5472 7565 0a20 2020  check = True.   
+00001dc0: 7449 6e28 225c 3033 335b 3336 6d22 2c20  tIn("\033[36m", 
+00001dd0: 6163 7475 616c 290a 2020 2020 2020 2020  actual).        
+00001de0: 7365 6c66 2e61 7373 6572 7449 6e28 225c  self.assertIn("\
+00001df0: 3033 335b 3332 6d22 2c20 6163 7475 616c  033[32m", actual
+00001e00: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+00001e10: 7373 6572 7449 6e28 225c 3033 335b 3331  ssertIn("\033[31
+00001e20: 6d22 2c20 6163 7475 616c 290a 2020 2020  m", actual).    
+00001e30: 2020 2020 7365 6c66 2e61 7373 6572 7449      self.assertI
+00001e40: 6e28 225c 3033 335b 306d 222c 2061 6374  n("\033[0m", act
+00001e50: 7561 6c29 0a0a 2020 2020 4070 6174 6368  ual)..    @patch
+00001e60: 2822 6365 7263 6973 2e64 756d 705f 746f  ("cercis.dump_to
+00001e70: 5f66 696c 6522 2c20 6475 6d70 5f74 6f5f  _file", dump_to_
+00001e80: 7374 6465 7272 290a 2020 2020 6465 6620  stderr).    def 
+00001e90: 5f74 6573 745f 7769 7028 7365 6c66 2920  _test_wip(self) 
+00001ea0: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
+00001eb0: 2073 6f75 7263 652c 2065 7870 6563 7465   source, expecte
+00001ec0: 6420 3d20 7265 6164 5f64 6174 6128 226d  d = read_data("m
+00001ed0: 6973 6365 6c6c 616e 656f 7573 222c 2022  iscellaneous", "
+00001ee0: 7769 7022 290a 2020 2020 2020 2020 7379  wip").        sy
+00001ef0: 732e 7365 7474 7261 6365 2874 7261 6365  s.settrace(trace
+00001f00: 6675 6e63 290a 2020 2020 2020 2020 6d6f  func).        mo
+00001f10: 6465 203d 2072 6570 6c61 6365 280a 2020  de = replace(.  
+00001f20: 2020 2020 2020 2020 2020 4445 4641 554c            DEFAUL
+00001f30: 545f 4d4f 4445 2c0a 2020 2020 2020 2020  T_MODE,.        
+00001f40: 2020 2020 6578 7065 7269 6d65 6e74 616c      experimental
+00001f50: 5f73 7472 696e 675f 7072 6f63 6573 7369  _string_processi
+00001f60: 6e67 3d46 616c 7365 2c0a 2020 2020 2020  ng=False,.      
+00001f70: 2020 2020 2020 7461 7267 6574 5f76 6572        target_ver
+00001f80: 7369 6f6e 733d 7b63 6572 6369 732e 5461  sions={cercis.Ta
+00001f90: 7267 6574 5665 7273 696f 6e2e 5059 3338  rgetVersion.PY38
+00001fa0: 7d2c 0a20 2020 2020 2020 2029 0a20 2020  },.        ).   
+00001fb0: 2020 2020 2061 6374 7561 6c20 3d20 6673       actual = fs
+00001fc0: 2873 6f75 7263 652c 206d 6f64 653d 6d6f  (source, mode=mo
+00001fd0: 6465 290a 2020 2020 2020 2020 7379 732e  de).        sys.
+00001fe0: 7365 7474 7261 6365 284e 6f6e 6529 0a20  settrace(None). 
+00001ff0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00002000: 7274 466f 726d 6174 4571 7561 6c28 6578  rtFormatEqual(ex
+00002010: 7065 6374 6564 2c20 6163 7475 616c 290a  pected, actual).
+00002020: 2020 2020 2020 2020 6365 7263 6973 2e61          cercis.a
+00002030: 7373 6572 745f 6571 7569 7661 6c65 6e74  ssert_equivalent
+00002040: 2873 6f75 7263 652c 2061 6374 7561 6c29  (source, actual)
+00002050: 0a20 2020 2020 2020 2063 6572 6369 732e  .        cercis.
+00002060: 6173 7365 7274 5f73 7461 626c 6528 736f  assert_stable(so
+00002070: 7572 6365 2c20 6163 7475 616c 2c20 6365  urce, actual, ce
+00002080: 7263 6973 2e46 696c 654d 6f64 6528 2929  rcis.FileMode())
+00002090: 0a0a 2020 2020 6465 6620 7465 7374 5f70  ..    def test_p
+000020a0: 6570 5f35 3732 5f76 6572 7369 6f6e 5f64  ep_572_version_d
+000020b0: 6574 6563 7469 6f6e 2873 656c 6629 202d  etection(self) -
+000020c0: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+000020d0: 736f 7572 6365 2c20 5f20 3d20 7265 6164  source, _ = read
+000020e0: 5f64 6174 6128 2270 795f 3338 222c 2022  _data("py_38", "
+000020f0: 7065 705f 3537 3222 290a 2020 2020 2020  pep_572").      
+00002100: 2020 726f 6f74 203d 2063 6572 6369 732e    root = cercis.
+00002110: 6c69 6232 746f 335f 7061 7273 6528 736f  lib2to3_parse(so
+00002120: 7572 6365 290a 2020 2020 2020 2020 6665  urce).        fe
+00002130: 6174 7572 6573 203d 2063 6572 6369 732e  atures = cercis.
+00002140: 6765 745f 6665 6174 7572 6573 5f75 7365  get_features_use
+00002150: 6428 726f 6f74 290a 2020 2020 2020 2020  d(root).        
+00002160: 7365 6c66 2e61 7373 6572 7449 6e28 6365  self.assertIn(ce
+00002170: 7263 6973 2e46 6561 7475 7265 2e41 5353  rcis.Feature.ASS
+00002180: 4947 4e4d 454e 545f 4558 5052 4553 5349  IGNMENT_EXPRESSI
+00002190: 4f4e 532c 2066 6561 7475 7265 7329 0a20  ONS, features). 
+000021a0: 2020 2020 2020 2076 6572 7369 6f6e 7320         versions 
+000021b0: 3d20 6365 7263 6973 2e64 6574 6563 745f  = cercis.detect_
+000021c0: 7461 7267 6574 5f76 6572 7369 6f6e 7328  target_versions(
+000021d0: 726f 6f74 290a 2020 2020 2020 2020 7365  root).        se
+000021e0: 6c66 2e61 7373 6572 7449 6e28 6365 7263  lf.assertIn(cerc
+000021f0: 6973 2e54 6172 6765 7456 6572 7369 6f6e  is.TargetVersion
+00002200: 2e50 5933 382c 2076 6572 7369 6f6e 7329  .PY38, versions)
+00002210: 0a0a 2020 2020 6465 6620 7465 7374 5f65  ..    def test_e
+00002220: 7870 7265 7373 696f 6e5f 6666 2873 656c  xpression_ff(sel
+00002230: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
+00002240: 2020 2020 736f 7572 6365 2c20 6578 7065      source, expe
+00002250: 6374 6564 203d 2072 6561 645f 6461 7461  cted = read_data
+00002260: 2822 7369 6d70 6c65 5f63 6173 6573 222c  ("simple_cases",
+00002270: 2022 6578 7072 6573 7369 6f6e 2e70 7922   "expression.py"
+00002280: 290a 2020 2020 2020 2020 746d 705f 6669  ).        tmp_fi
+00002290: 6c65 203d 2050 6174 6828 6365 7263 6973  le = Path(cercis
+000022a0: 2e64 756d 705f 746f 5f66 696c 6528 736f  .dump_to_file(so
+000022b0: 7572 6365 2929 0a20 2020 2020 2020 206d  urce)).        m
+000022c0: 6f64 6520 3d20 7265 706c 6163 6528 4445  ode = replace(DE
+000022d0: 4641 554c 545f 4d4f 4445 2c20 6c69 6e65  FAULT_MODE, line
+000022e0: 5f6c 656e 6774 683d 3838 290a 2020 2020  _length=88).    
+000022f0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+00002300: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00002310: 5472 7565 2866 6628 746d 705f 6669 6c65  True(ff(tmp_file
+00002320: 2c20 7772 6974 655f 6261 636b 3d63 6572  , write_back=cer
+00002330: 6369 732e 5772 6974 6542 6163 6b2e 5945  cis.WriteBack.YE
+00002340: 532c 206d 6f64 653d 6d6f 6465 2929 0a20  S, mode=mode)). 
+00002350: 2020 2020 2020 2020 2020 2077 6974 6820             with 
+00002360: 6f70 656e 2874 6d70 5f66 696c 652c 2065  open(tmp_file, e
+00002370: 6e63 6f64 696e 673d 2275 7466 3822 2920  ncoding="utf8") 
+00002380: 6173 2066 3a0a 2020 2020 2020 2020 2020  as f:.          
+00002390: 2020 2020 2020 6163 7475 616c 203d 2066        actual = f
+000023a0: 2e72 6561 6428 290a 2020 2020 2020 2020  .read().        
+000023b0: 6669 6e61 6c6c 793a 0a20 2020 2020 2020  finally:.       
+000023c0: 2020 2020 206f 732e 756e 6c69 6e6b 2874       os.unlink(t
+000023d0: 6d70 5f66 696c 6529 0a20 2020 2020 2020  mp_file).       
+000023e0: 2073 656c 662e 6173 7365 7274 466f 726d   self.assertForm
+000023f0: 6174 4571 7561 6c28 6578 7065 6374 6564  atEqual(expected
+00002400: 2c20 6163 7475 616c 290a 2020 2020 2020  , actual).      
+00002410: 2020 7769 7468 2070 6174 6368 2822 6365    with patch("ce
+00002420: 7263 6973 2e64 756d 705f 746f 5f66 696c  rcis.dump_to_fil
+00002430: 6522 2c20 6475 6d70 5f74 6f5f 7374 6465  e", dump_to_stde
+00002440: 7272 293a 0a20 2020 2020 2020 2020 2020  rr):.           
+00002450: 2063 6572 6369 732e 6173 7365 7274 5f65   cercis.assert_e
+00002460: 7175 6976 616c 656e 7428 736f 7572 6365  quivalent(source
+00002470: 2c20 6163 7475 616c 290a 2020 2020 2020  , actual).      
+00002480: 2020 2020 2020 6365 7263 6973 2e61 7373        cercis.ass
+00002490: 6572 745f 7374 6162 6c65 2873 6f75 7263  ert_stable(sourc
+000024a0: 652c 2061 6374 7561 6c2c 206d 6f64 6529  e, actual, mode)
+000024b0: 0a0a 2020 2020 6465 6620 7465 7374 5f65  ..    def test_e
+000024c0: 7870 7265 7373 696f 6e5f 6469 6666 2873  xpression_diff(s
+000024d0: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
+000024e0: 2020 2020 2020 736f 7572 6365 2c20 5f20        source, _ 
+000024f0: 3d20 7265 6164 5f64 6174 6128 2273 696d  = read_data("sim
+00002500: 706c 655f 6361 7365 7322 2c20 2265 7870  ple_cases", "exp
+00002510: 7265 7373 696f 6e2e 7079 2229 0a20 2020  ression.py").   
+00002520: 2020 2020 2065 7870 6563 7465 642c 205f       expected, _
+00002530: 203d 2072 6561 645f 6461 7461 2822 7369   = read_data("si
+00002540: 6d70 6c65 5f63 6173 6573 222c 2022 6578  mple_cases", "ex
+00002550: 7072 6573 7369 6f6e 2e64 6966 6622 290a  pression.diff").
+00002560: 2020 2020 2020 2020 746d 705f 6669 6c65          tmp_file
+00002570: 203d 2050 6174 6828 6365 7263 6973 2e64   = Path(cercis.d
+00002580: 756d 705f 746f 5f66 696c 6528 736f 7572  ump_to_file(sour
+00002590: 6365 2929 0a20 2020 2020 2020 2064 6966  ce)).        dif
+000025a0: 665f 6865 6164 6572 203d 2072 652e 636f  f_header = re.co
+000025b0: 6d70 696c 6528 0a20 2020 2020 2020 2020  mpile(.         
+000025c0: 2020 2072 6622 7b72 652e 6573 6361 7065     rf"{re.escape
+000025d0: 2873 7472 2874 6d70 5f66 696c 6529 297d  (str(tmp_file))}
+000025e0: 5c74 5c64 5c64 5c64 5c64 2d5c 645c 642d  \t\d\d\d\d-\d\d-
+000025f0: 5c64 5c64 2022 0a20 2020 2020 2020 2020  \d\d ".         
+00002600: 2020 2072 225c 645c 643a 5c64 5c64 3a5c     r"\d\d:\d\d:\
+00002610: 645c 645c 2e5c 645c 645c 645c 645c 645c  d\d\.\d\d\d\d\d\
+00002620: 6420 5c2b 5c64 5c64 5c64 5c64 220a 2020  d \+\d\d\d\d".  
+00002630: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00002640: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+00002650: 2072 6573 756c 7420 3d20 426c 6163 6b52   result = BlackR
+00002660: 756e 6e65 7228 292e 696e 766f 6b65 280a  unner().invoke(.
+00002670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002680: 6365 7263 6973 2e6d 6169 6e2c 0a20 2020  cercis.main,.   
+00002690: 2020 2020 2020 2020 2020 2020 205b 0a20               [. 
+000026a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000026b0: 2020 2022 2d2d 6469 6666 222c 0a20 2020     "--diff",.   
+000026c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000026d0: 2073 7472 2874 6d70 5f66 696c 6529 2c0a   str(tmp_file),.
+000026e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000026f0: 2020 2020 6622 2d2d 636f 6e66 6967 3d7b      f"--config={
+00002700: 454d 5054 595f 434f 4e46 4947 7d22 2c0a  EMPTY_CONFIG}",.
+00002710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002720: 2020 2020 222d 2d6c 696e 652d 6c65 6e67      "--line-leng
+00002730: 7468 3d38 3822 2c0a 2020 2020 2020 2020  th=88",.        
+00002740: 2020 2020 2020 2020 5d2c 0a20 2020 2020          ],.     
+00002750: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00002760: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00002770: 4571 7561 6c28 7265 7375 6c74 2e65 7869  Equal(result.exi
+00002780: 745f 636f 6465 2c20 3029 0a20 2020 2020  t_code, 0).     
+00002790: 2020 2066 696e 616c 6c79 3a0a 2020 2020     finally:.    
+000027a0: 2020 2020 2020 2020 6f73 2e75 6e6c 696e          os.unlin
+000027b0: 6b28 746d 705f 6669 6c65 290a 2020 2020  k(tmp_file).    
+000027c0: 2020 2020 6163 7475 616c 203d 2072 6573      actual = res
+000027d0: 756c 742e 6f75 7470 7574 0a20 2020 2020  ult.output.     
+000027e0: 2020 2061 6374 7561 6c20 3d20 6469 6666     actual = diff
+000027f0: 5f68 6561 6465 722e 7375 6228 4445 5445  _header.sub(DETE
+00002800: 524d 494e 4953 5449 435f 4845 4144 4552  RMINISTIC_HEADER
+00002810: 2c20 6163 7475 616c 290a 2020 2020 2020  , actual).      
+00002820: 2020 6966 2065 7870 6563 7465 6420 213d    if expected !=
+00002830: 2061 6374 7561 6c3a 0a20 2020 2020 2020   actual:.       
+00002840: 2020 2020 2064 756d 7020 3d20 6365 7263       dump = cerc
+00002850: 6973 2e64 756d 705f 746f 5f66 696c 6528  is.dump_to_file(
+00002860: 6163 7475 616c 290a 2020 2020 2020 2020  actual).        
+00002870: 2020 2020 6d73 6720 3d20 280a 2020 2020      msg = (.    
+00002880: 2020 2020 2020 2020 2020 2020 2245 7870              "Exp
+00002890: 6563 7465 6420 6469 6666 2069 736e 2774  ected diff isn't
+000028a0: 2065 7175 616c 2074 6f20 7468 6520 6163   equal to the ac
+000028b0: 7475 616c 2e20 4966 2079 6f75 206d 6164  tual. If you mad
+000028c0: 6520 6368 616e 6765 7320 746f 220a 2020  e changes to".  
+000028d0: 2020 2020 2020 2020 2020 2020 2020 2220                " 
+000028e0: 6578 7072 6573 7369 6f6e 2e70 7920 616e  expression.py an
+000028f0: 6420 7468 6973 2069 7320 616e 2061 6e74  d this is an ant
+00002900: 6963 6970 6174 6564 2064 6966 6665 7265  icipated differe
+00002910: 6e63 652c 206f 7665 7277 7269 7465 220a  nce, overwrite".
+00002920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002930: 6622 2074 6573 7473 2f64 6174 612f 6578  f" tests/data/ex
+00002940: 7072 6573 7369 6f6e 2e64 6966 6620 7769  pression.diff wi
+00002950: 7468 207b 6475 6d70 7d22 0a20 2020 2020  th {dump}".     
+00002960: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00002970: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00002980: 4571 7561 6c28 6578 7065 6374 6564 2c20  Equal(expected, 
+00002990: 6163 7475 616c 2c20 6d73 6729 0a0a 2020  actual, msg)..  
+000029a0: 2020 6465 6620 7465 7374 5f65 7870 7265    def test_expre
+000029b0: 7373 696f 6e5f 6469 6666 5f77 6974 685f  ssion_diff_with_
+000029c0: 636f 6c6f 7228 7365 6c66 2920 2d3e 204e  color(self) -> N
+000029d0: 6f6e 653a 0a20 2020 2020 2020 2073 6f75  one:.        sou
+000029e0: 7263 652c 205f 203d 2072 6561 645f 6461  rce, _ = read_da
+000029f0: 7461 2822 7369 6d70 6c65 5f63 6173 6573  ta("simple_cases
+00002a00: 222c 2022 6578 7072 6573 7369 6f6e 2e70  ", "expression.p
+00002a10: 7922 290a 2020 2020 2020 2020 6578 7065  y").        expe
+00002a20: 6374 6564 2c20 5f20 3d20 7265 6164 5f64  cted, _ = read_d
+00002a30: 6174 6128 2273 696d 706c 655f 6361 7365  ata("simple_case
+00002a40: 7322 2c20 2265 7870 7265 7373 696f 6e2e  s", "expression.
+00002a50: 6469 6666 2229 0a20 2020 2020 2020 2074  diff").        t
+00002a60: 6d70 5f66 696c 6520 3d20 5061 7468 2863  mp_file = Path(c
+00002a70: 6572 6369 732e 6475 6d70 5f74 6f5f 6669  ercis.dump_to_fi
+00002a80: 6c65 2873 6f75 7263 6529 290a 2020 2020  le(source)).    
+00002a90: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+00002aa0: 2020 2020 2072 6573 756c 7420 3d20 426c       result = Bl
+00002ab0: 6163 6b52 756e 6e65 7228 292e 696e 766f  ackRunner().invo
+00002ac0: 6b65 280a 2020 2020 2020 2020 2020 2020  ke(.            
+00002ad0: 2020 2020 6365 7263 6973 2e6d 6169 6e2c      cercis.main,
+00002ae0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00002af0: 205b 222d 2d64 6966 6622 2c20 222d 2d63   ["--diff", "--c
+00002b00: 6f6c 6f72 222c 2073 7472 2874 6d70 5f66  olor", str(tmp_f
+00002b10: 696c 6529 2c20 6622 2d2d 636f 6e66 6967  ile), f"--config
+00002b20: 3d7b 454d 5054 595f 434f 4e46 4947 7d22  ={EMPTY_CONFIG}"
+00002b30: 5d2c 0a20 2020 2020 2020 2020 2020 2029  ],.            )
+00002b40: 0a20 2020 2020 2020 2066 696e 616c 6c79  .        finally
+00002b50: 3a0a 2020 2020 2020 2020 2020 2020 6f73  :.            os
+00002b60: 2e75 6e6c 696e 6b28 746d 705f 6669 6c65  .unlink(tmp_file
+00002b70: 290a 2020 2020 2020 2020 6163 7475 616c  ).        actual
+00002b80: 203d 2072 6573 756c 742e 6f75 7470 7574   = result.output
+00002b90: 0a20 2020 2020 2020 2023 2057 6520 6368  .        # We ch
+00002ba0: 6563 6b20 7468 6520 636f 6e74 656e 7473  eck the contents
+00002bb0: 206f 6620 7468 6520 6469 6666 2069 6e20   of the diff in 
+00002bc0: 6074 6573 745f 6578 7072 6573 7369 6f6e  `test_expression
+00002bd0: 5f64 6966 6660 2e20 416c 6c0a 2020 2020  _diff`. All.    
+00002be0: 2020 2020 2320 7765 206e 6565 6420 746f      # we need to
+00002bf0: 2063 6865 636b 2068 6572 6520 6973 2074   check here is t
+00002c00: 6861 7420 636f 6c6f 7220 636f 6465 7320  hat color codes 
+00002c10: 6578 6973 7420 696e 2074 6865 2072 6573  exist in the res
+00002c20: 756c 742e 0a20 2020 2020 2020 2073 656c  ult..        sel
+00002c30: 662e 6173 7365 7274 496e 2822 5c30 3333  f.assertIn("\033
+00002c40: 5b31 6d22 2c20 6163 7475 616c 290a 2020  [1m", actual).  
+00002c50: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00002c60: 7449 6e28 225c 3033 335b 3336 6d22 2c20  tIn("\033[36m", 
+00002c70: 6163 7475 616c 290a 2020 2020 2020 2020  actual).        
+00002c80: 7365 6c66 2e61 7373 6572 7449 6e28 225c  self.assertIn("\
+00002c90: 3033 335b 3332 6d22 2c20 6163 7475 616c  033[32m", actual
+00002ca0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+00002cb0: 7373 6572 7449 6e28 225c 3033 335b 3331  ssertIn("\033[31
+00002cc0: 6d22 2c20 6163 7475 616c 290a 2020 2020  m", actual).    
+00002cd0: 2020 2020 7365 6c66 2e61 7373 6572 7449      self.assertI
+00002ce0: 6e28 225c 3033 335b 306d 222c 2061 6374  n("\033[0m", act
+00002cf0: 7561 6c29 0a0a 2020 2020 6465 6620 7465  ual)..    def te
+00002d00: 7374 5f64 6574 6563 745f 706f 735f 6f6e  st_detect_pos_on
+00002d10: 6c79 5f61 7267 756d 656e 7473 2873 656c  ly_arguments(sel
+00002d20: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
+00002d30: 2020 2020 736f 7572 6365 2c20 5f20 3d20      source, _ = 
+00002d40: 7265 6164 5f64 6174 6128 2270 795f 3338  read_data("py_38
+00002d50: 222c 2022 7065 705f 3537 3022 290a 2020  ", "pep_570").  
+00002d60: 2020 2020 2020 726f 6f74 203d 2063 6572        root = cer
+00002d70: 6369 732e 6c69 6232 746f 335f 7061 7273  cis.lib2to3_pars
+00002d80: 6528 736f 7572 6365 290a 2020 2020 2020  e(source).      
+00002d90: 2020 6665 6174 7572 6573 203d 2063 6572    features = cer
+00002da0: 6369 732e 6765 745f 6665 6174 7572 6573  cis.get_features
+00002db0: 5f75 7365 6428 726f 6f74 290a 2020 2020  _used(root).    
+00002dc0: 2020 2020 7365 6c66 2e61 7373 6572 7449      self.assertI
+00002dd0: 6e28 6365 7263 6973 2e46 6561 7475 7265  n(cercis.Feature
+00002de0: 2e50 4f53 5f4f 4e4c 595f 4152 4755 4d45  .POS_ONLY_ARGUME
+00002df0: 4e54 532c 2066 6561 7475 7265 7329 0a20  NTS, features). 
+00002e00: 2020 2020 2020 2076 6572 7369 6f6e 7320         versions 
+00002e10: 3d20 6365 7263 6973 2e64 6574 6563 745f  = cercis.detect_
+00002e20: 7461 7267 6574 5f76 6572 7369 6f6e 7328  target_versions(
+00002e30: 726f 6f74 290a 2020 2020 2020 2020 7365  root).        se
+00002e40: 6c66 2e61 7373 6572 7449 6e28 6365 7263  lf.assertIn(cerc
+00002e50: 6973 2e54 6172 6765 7456 6572 7369 6f6e  is.TargetVersion
+00002e60: 2e50 5933 382c 2076 6572 7369 6f6e 7329  .PY38, versions)
+00002e70: 0a0a 2020 2020 6465 6620 7465 7374 5f64  ..    def test_d
+00002e80: 6574 6563 745f 6465 6275 675f 665f 7374  etect_debug_f_st
+00002e90: 7269 6e67 7328 7365 6c66 2920 2d3e 204e  rings(self) -> N
+00002ea0: 6f6e 653a 0a20 2020 2020 2020 2072 6f6f  one:.        roo
+00002eb0: 7420 3d20 6365 7263 6973 2e6c 6962 3274  t = cercis.lib2t
+00002ec0: 6f33 5f70 6172 7365 2822 2222 6622 7b78  o3_parse("""f"{x
+00002ed0: 3d7d 2220 2222 2229 0a20 2020 2020 2020  =}" """).       
+00002ee0: 2066 6561 7475 7265 7320 3d20 6365 7263   features = cerc
+00002ef0: 6973 2e67 6574 5f66 6561 7475 7265 735f  is.get_features_
+00002f00: 7573 6564 2872 6f6f 7429 0a20 2020 2020  used(root).     
+00002f10: 2020 2073 656c 662e 6173 7365 7274 496e     self.assertIn
+00002f20: 2863 6572 6369 732e 4665 6174 7572 652e  (cercis.Feature.
+00002f30: 4445 4255 475f 465f 5354 5249 4e47 532c  DEBUG_F_STRINGS,
+00002f40: 2066 6561 7475 7265 7329 0a20 2020 2020   features).     
+00002f50: 2020 2076 6572 7369 6f6e 7320 3d20 6365     versions = ce
+00002f60: 7263 6973 2e64 6574 6563 745f 7461 7267  rcis.detect_targ
+00002f70: 6574 5f76 6572 7369 6f6e 7328 726f 6f74  et_versions(root
+00002f80: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+00002f90: 7373 6572 7449 6e28 6365 7263 6973 2e54  ssertIn(cercis.T
+00002fa0: 6172 6765 7456 6572 7369 6f6e 2e50 5933  argetVersion.PY3
+00002fb0: 382c 2076 6572 7369 6f6e 7329 0a0a 2020  8, versions)..  
+00002fc0: 2020 2020 2020 726f 6f74 203d 2063 6572        root = cer
+00002fd0: 6369 732e 6c69 6232 746f 335f 7061 7273  cis.lib2to3_pars
+00002fe0: 6528 0a20 2020 2020 2020 2020 2020 2022  e(.            "
+00002ff0: 2222 6622 7b78 7d22 5c6e 6627 7b22 3d22  ""f"{x}"\nf'{"="
+00003000: 7d27 5c6e 6627 7b28 783a 3d35 297d 275c  }'\nf'{(x:=5)}'\
+00003010: 6e66 277b 6628 613d 2233 3d22 297d 275c  nf'{f(a="3=")}'\
+00003020: 6e66 277b 783a 3d31 307d 275c 6e22 2222  nf'{x:=10}'\n"""
+00003030: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
+00003040: 2020 2066 6561 7475 7265 7320 3d20 6365     features = ce
+00003050: 7263 6973 2e67 6574 5f66 6561 7475 7265  rcis.get_feature
+00003060: 735f 7573 6564 2872 6f6f 7429 0a20 2020  s_used(root).   
+00003070: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00003080: 4e6f 7449 6e28 6365 7263 6973 2e46 6561  NotIn(cercis.Fea
+00003090: 7475 7265 2e44 4542 5547 5f46 5f53 5452  ture.DEBUG_F_STR
+000030a0: 494e 4753 2c20 6665 6174 7572 6573 290a  INGS, features).
+000030b0: 0a20 2020 2020 2020 2023 2057 6520 646f  .        # We do
+000030c0: 6e27 7420 7965 7420 7375 7070 6f72 7420  n't yet support 
+000030d0: 6665 6174 7572 6520 7665 7273 696f 6e20  feature version 
+000030e0: 6465 7465 6374 696f 6e20 696e 206e 6573  detection in nes
+000030f0: 7465 6420 662d 7374 7269 6e67 730a 2020  ted f-strings.  
+00003100: 2020 2020 2020 726f 6f74 203d 2063 6572        root = cer
+00003110: 6369 732e 6c69 6232 746f 335f 7061 7273  cis.lib2to3_pars
+00003120: 6528 0a20 2020 2020 2020 2020 2020 2022  e(.            "
+00003130: 2222 6622 6865 6172 6420 6120 7275 6d6f  ""f"heard a rumo
+00003140: 7572 2074 6861 7420 7b20 6627 7b31 2b31  ur that { f'{1+1
+00003150: 3d7d 2720 7d20 2e2e 2e20 7365 656d 7320  =}' } ... seems 
+00003160: 6c69 6b65 2069 7420 636f 756c 6420 6265  like it could be
+00003170: 2074 7275 6522 2022 2222 0a20 2020 2020   true" """.     
+00003180: 2020 2029 0a20 2020 2020 2020 2066 6561     ).        fea
+00003190: 7475 7265 7320 3d20 6365 7263 6973 2e67  tures = cercis.g
+000031a0: 6574 5f66 6561 7475 7265 735f 7573 6564  et_features_used
+000031b0: 2872 6f6f 7429 0a20 2020 2020 2020 2073  (root).        s
+000031c0: 656c 662e 6173 7365 7274 4e6f 7449 6e28  elf.assertNotIn(
+000031d0: 6365 7263 6973 2e46 6561 7475 7265 2e44  cercis.Feature.D
+000031e0: 4542 5547 5f46 5f53 5452 494e 4753 2c20  EBUG_F_STRINGS, 
+000031f0: 6665 6174 7572 6573 290a 0a20 2020 2040  features)..    @
+00003200: 7061 7463 6828 2263 6572 6369 732e 6475  patch("cercis.du
+00003210: 6d70 5f74 6f5f 6669 6c65 222c 2064 756d  mp_to_file", dum
+00003220: 705f 746f 5f73 7464 6572 7229 0a20 2020  p_to_stderr).   
+00003230: 2064 6566 2074 6573 745f 7374 7269 6e67   def test_string
+00003240: 5f71 756f 7465 7328 7365 6c66 2920 2d3e  _quotes(self) ->
+00003250: 204e 6f6e 653a 0a20 2020 2020 2020 2073   None:.        s
+00003260: 6f75 7263 652c 2065 7870 6563 7465 6420  ource, expected 
+00003270: 3d20 7265 6164 5f64 6174 6128 226d 6973  = read_data("mis
+00003280: 6365 6c6c 616e 656f 7573 222c 2022 7374  cellaneous", "st
+00003290: 7269 6e67 5f71 756f 7465 7322 290a 2020  ring_quotes").  
+000032a0: 2020 2020 2020 6d6f 6465 203d 2063 6572        mode = cer
+000032b0: 6369 732e 4d6f 6465 2870 7265 7669 6577  cis.Mode(preview
+000032c0: 3d54 7275 652c 2073 696e 676c 655f 7175  =True, single_qu
+000032d0: 6f74 653d 4661 6c73 6529 0a20 2020 2020  ote=False).     
+000032e0: 2020 2061 7373 6572 745f 666f 726d 6174     assert_format
+000032f0: 2873 6f75 7263 652c 2065 7870 6563 7465  (source, expecte
+00003300: 642c 206d 6f64 6529 0a20 2020 2020 2020  d, mode).       
+00003310: 206d 6f64 6520 3d20 7265 706c 6163 6528   mode = replace(
+00003320: 6d6f 6465 2c20 7374 7269 6e67 5f6e 6f72  mode, string_nor
+00003330: 6d61 6c69 7a61 7469 6f6e 3d46 616c 7365  malization=False
+00003340: 290a 2020 2020 2020 2020 6e6f 745f 6e6f  ).        not_no
+00003350: 726d 616c 697a 6564 203d 2066 7328 736f  rmalized = fs(so
+00003360: 7572 6365 2c20 6d6f 6465 3d6d 6f64 6529  urce, mode=mode)
+00003370: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+00003380: 7365 7274 466f 726d 6174 4571 7561 6c28  sertFormatEqual(
+00003390: 736f 7572 6365 2e72 6570 6c61 6365 2822  source.replace("
+000033a0: 5c5c 5c6e 222c 2022 2229 2c20 6e6f 745f  \\\n", ""), not_
+000033b0: 6e6f 726d 616c 697a 6564 290a 2020 2020  normalized).    
+000033c0: 2020 2020 6365 7263 6973 2e61 7373 6572      cercis.asser
+000033d0: 745f 6571 7569 7661 6c65 6e74 2873 6f75  t_equivalent(sou
+000033e0: 7263 652c 206e 6f74 5f6e 6f72 6d61 6c69  rce, not_normali
+000033f0: 7a65 6429 0a20 2020 2020 2020 2063 6572  zed).        cer
+00003400: 6369 732e 6173 7365 7274 5f73 7461 626c  cis.assert_stabl
+00003410: 6528 736f 7572 6365 2c20 6e6f 745f 6e6f  e(source, not_no
+00003420: 726d 616c 697a 6564 2c20 6d6f 6465 3d6d  rmalized, mode=m
+00003430: 6f64 6529 0a0a 2020 2020 6465 6620 7465  ode)..    def te
+00003440: 7374 5f73 6b69 705f 736f 7572 6365 5f66  st_skip_source_f
+00003450: 6972 7374 5f6c 696e 6528 7365 6c66 2920  irst_line(self) 
+00003460: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
+00003470: 2073 6f75 7263 652c 205f 203d 2072 6561   source, _ = rea
+00003480: 645f 6461 7461 2822 6d69 7363 656c 6c61  d_data("miscella
+00003490: 6e65 6f75 7322 2c20 2269 6e76 616c 6964  neous", "invalid
+000034a0: 5f68 6561 6465 7222 290a 2020 2020 2020  _header").      
+000034b0: 2020 746d 705f 6669 6c65 203d 2050 6174    tmp_file = Pat
+000034c0: 6828 6365 7263 6973 2e64 756d 705f 746f  h(cercis.dump_to
+000034d0: 5f66 696c 6528 736f 7572 6365 2929 0a20  _file(source)). 
+000034e0: 2020 2020 2020 2023 2046 756c 6c20 736f         # Full so
+000034f0: 7572 6365 2073 686f 756c 6420 6661 696c  urce should fail
+00003500: 2028 696e 7661 6c69 6420 7379 6e74 6178   (invalid syntax
+00003510: 2061 7420 6865 6164 6572 290a 2020 2020   at header).    
+00003520: 2020 2020 7365 6c66 2e69 6e76 6f6b 6542      self.invokeB
+00003530: 6c61 636b 285b 7374 7228 746d 705f 6669  lack([str(tmp_fi
+00003540: 6c65 292c 2022 2d2d 6469 6666 222c 2022  le), "--diff", "
+00003550: 2d2d 6368 6563 6b22 5d2c 2065 7869 745f  --check"], exit_
+00003560: 636f 6465 3d31 3233 290a 2020 2020 2020  code=123).      
+00003570: 2020 2320 536f 2c20 736b 6970 7069 6e67    # So, skipping
+00003580: 2074 6865 2066 6972 7374 206c 696e 6520   the first line 
+00003590: 7368 6f75 6c64 2077 6f72 6b0a 2020 2020  should work.    
+000035a0: 2020 2020 7265 7375 6c74 203d 2042 6c61      result = Bla
+000035b0: 636b 5275 6e6e 6572 2829 2e69 6e76 6f6b  ckRunner().invok
+000035c0: 6528 0a20 2020 2020 2020 2020 2020 2063  e(.            c
+000035d0: 6572 6369 732e 6d61 696e 2c20 5b73 7472  ercis.main, [str
+000035e0: 2874 6d70 5f66 696c 6529 2c20 222d 7822  (tmp_file), "-x"
+000035f0: 2c20 6622 2d2d 636f 6e66 6967 3d7b 454d  , f"--config={EM
+00003600: 5054 595f 434f 4e46 4947 7d22 5d0a 2020  PTY_CONFIG}"].  
+00003610: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00003620: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+00003630: 2872 6573 756c 742e 6578 6974 5f63 6f64  (result.exit_cod
+00003640: 652c 2030 290a 2020 2020 2020 2020 7769  e, 0).        wi
+00003650: 7468 206f 7065 6e28 746d 705f 6669 6c65  th open(tmp_file
+00003660: 2c20 656e 636f 6469 6e67 3d22 7574 6638  , encoding="utf8
+00003670: 2229 2061 7320 663a 0a20 2020 2020 2020  ") as f:.       
+00003680: 2020 2020 2061 6374 7561 6c20 3d20 662e       actual = f.
+00003690: 7265 6164 2829 0a20 2020 2020 2020 2073  read().        s
+000036a0: 656c 662e 6173 7365 7274 466f 726d 6174  elf.assertFormat
+000036b0: 4571 7561 6c28 736f 7572 6365 2c20 6163  Equal(source, ac
+000036c0: 7475 616c 290a 0a20 2020 2064 6566 2074  tual)..    def t
+000036d0: 6573 745f 736b 6970 5f73 6f75 7263 655f  est_skip_source_
+000036e0: 6669 7273 745f 6c69 6e65 5f77 6865 6e5f  first_line_when_
+000036f0: 6d69 7869 6e67 5f6e 6577 6c69 6e65 7328  mixing_newlines(
+00003700: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
+00003710: 2020 2020 2020 2063 6f64 655f 6d69 7869         code_mixi
+00003720: 6e67 5f6e 6577 6c69 6e65 7320 3d20 6222  ng_newlines = b"
+00003730: 4865 6164 6572 2077 696c 6c20 6265 2073  Header will be s
+00003740: 6b69 7070 6564 5c72 5c6e 6920 3d20 5b31  kipped\r\ni = [1
+00003750: 2c32 2c33 5d5c 6e6a 203d 205b 312c 322c  ,2,3]\nj = [1,2,
+00003760: 335d 5c6e 220a 2020 2020 2020 2020 6578  3]\n".        ex
+00003770: 7065 6374 6564 203d 2062 2248 6561 6465  pected = b"Heade
+00003780: 7220 7769 6c6c 2062 6520 736b 6970 7065  r will be skippe
+00003790: 645c 725c 6e69 203d 205b 312c 2032 2c20  d\r\ni = [1, 2, 
+000037a0: 335d 5c6e 6a20 3d20 5b31 2c20 322c 2033  3]\nj = [1, 2, 3
+000037b0: 5d5c 6e22 0a20 2020 2020 2020 2077 6974  ]\n".        wit
+000037c0: 6820 5465 6d70 6f72 6172 7944 6972 6563  h TemporaryDirec
+000037d0: 746f 7279 2829 2061 7320 776f 726b 7370  tory() as worksp
+000037e0: 6163 653a 0a20 2020 2020 2020 2020 2020  ace:.           
+000037f0: 2074 6573 745f 6669 6c65 203d 2050 6174   test_file = Pat
+00003800: 6828 776f 726b 7370 6163 6529 202f 2022  h(workspace) / "
+00003810: 736b 6970 5f68 6561 6465 722e 7079 220a  skip_header.py".
+00003820: 2020 2020 2020 2020 2020 2020 7465 7374              test
+00003830: 5f66 696c 652e 7772 6974 655f 6279 7465  _file.write_byte
+00003840: 7328 636f 6465 5f6d 6978 696e 675f 6e65  s(code_mixing_ne
+00003850: 776c 696e 6573 290a 2020 2020 2020 2020  wlines).        
+00003860: 2020 2020 6d6f 6465 203d 2072 6570 6c61      mode = repla
+00003870: 6365 2844 4546 4155 4c54 5f4d 4f44 452c  ce(DEFAULT_MODE,
+00003880: 2073 6b69 705f 736f 7572 6365 5f66 6972   skip_source_fir
+00003890: 7374 5f6c 696e 653d 5472 7565 290a 2020  st_line=True).  
+000038a0: 2020 2020 2020 2020 2020 6666 2874 6573            ff(tes
+000038b0: 745f 6669 6c65 2c20 6d6f 6465 3d6d 6f64  t_file, mode=mod
+000038c0: 652c 2077 7269 7465 5f62 6163 6b3d 6365  e, write_back=ce
+000038d0: 7263 6973 2e57 7269 7465 4261 636b 2e59  rcis.WriteBack.Y
+000038e0: 4553 290a 2020 2020 2020 2020 2020 2020  ES).            
+000038f0: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+00003900: 2874 6573 745f 6669 6c65 2e72 6561 645f  (test_file.read_
+00003910: 6279 7465 7328 292c 2065 7870 6563 7465  bytes(), expecte
+00003920: 6429 0a0a 2020 2020 6465 6620 7465 7374  d)..    def test
+00003930: 5f73 6b69 705f 6d61 6769 635f 7472 6169  _skip_magic_trai
+00003940: 6c69 6e67 5f63 6f6d 6d61 2873 656c 6629  ling_comma(self)
+00003950: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
+00003960: 2020 736f 7572 6365 2c20 5f20 3d20 7265    source, _ = re
+00003970: 6164 5f64 6174 6128 2273 696d 706c 655f  ad_data("simple_
+00003980: 6361 7365 7322 2c20 2265 7870 7265 7373  cases", "express
+00003990: 696f 6e22 290a 2020 2020 2020 2020 6578  ion").        ex
+000039a0: 7065 6374 6564 2c20 5f20 3d20 7265 6164  pected, _ = read
+000039b0: 5f64 6174 6128 0a20 2020 2020 2020 2020  _data(.         
+000039c0: 2020 2022 6d69 7363 656c 6c61 6e65 6f75     "miscellaneou
+000039d0: 7322 2c20 2265 7870 7265 7373 696f 6e5f  s", "expression_
+000039e0: 736b 6970 5f6d 6167 6963 5f74 7261 696c  skip_magic_trail
+000039f0: 696e 675f 636f 6d6d 612e 6469 6666 220a  ing_comma.diff".
+00003a00: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00003a10: 2020 746d 705f 6669 6c65 203d 2050 6174    tmp_file = Pat
+00003a20: 6828 6365 7263 6973 2e64 756d 705f 746f  h(cercis.dump_to
+00003a30: 5f66 696c 6528 736f 7572 6365 2929 0a20  _file(source)). 
+00003a40: 2020 2020 2020 2064 6966 665f 6865 6164         diff_head
+00003a50: 6572 203d 2072 652e 636f 6d70 696c 6528  er = re.compile(
+00003a60: 0a20 2020 2020 2020 2020 2020 2072 6622  .            rf"
+00003a70: 7b72 652e 6573 6361 7065 2873 7472 2874  {re.escape(str(t
+00003a80: 6d70 5f66 696c 6529 297d 5c74 5c64 5c64  mp_file))}\t\d\d
+00003a90: 5c64 5c64 2d5c 645c 642d 5c64 5c64 2022  \d\d-\d\d-\d\d "
+00003aa0: 0a20 2020 2020 2020 2020 2020 2072 225c  .            r"\
+00003ab0: 645c 643a 5c64 5c64 3a5c 645c 645c 2e5c  d\d:\d\d:\d\d\.\
+00003ac0: 645c 645c 645c 645c 645c 6420 5c2b 5c64  d\d\d\d\d\d \+\d
+00003ad0: 5c64 5c64 5c64 220a 2020 2020 2020 2020  \d\d\d".        
+00003ae0: 290a 2020 2020 2020 2020 7472 793a 0a20  ).        try:. 
+00003af0: 2020 2020 2020 2020 2020 2072 6573 756c             resul
+00003b00: 7420 3d20 426c 6163 6b52 756e 6e65 7228  t = BlackRunner(
+00003b10: 292e 696e 766f 6b65 280a 2020 2020 2020  ).invoke(.      
+00003b20: 2020 2020 2020 2020 2020 6365 7263 6973            cercis
+00003b30: 2e6d 6169 6e2c 0a20 2020 2020 2020 2020  .main,.         
+00003b40: 2020 2020 2020 205b 0a20 2020 2020 2020         [.       
+00003b50: 2020 2020 2020 2020 2020 2020 2022 2d43               "-C
+00003b60: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
+00003b70: 2020 2020 2020 2022 2d2d 6469 6666 222c         "--diff",
+00003b80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00003b90: 2020 2020 2073 7472 2874 6d70 5f66 696c       str(tmp_fil
+00003ba0: 6529 2c0a 2020 2020 2020 2020 2020 2020  e),.            
+00003bb0: 2020 2020 2020 2020 6622 2d2d 636f 6e66          f"--conf
+00003bc0: 6967 3d7b 454d 5054 595f 434f 4e46 4947  ig={EMPTY_CONFIG
+00003bd0: 7d22 2c0a 2020 2020 2020 2020 2020 2020  }",.            
+00003be0: 2020 2020 2020 2020 222d 2d6c 696e 652d          "--line-
+00003bf0: 6c65 6e67 7468 3d38 3822 2c0a 2020 2020  length=88",.    
+00003c00: 2020 2020 2020 2020 2020 2020 5d2c 0a20              ],. 
+00003c10: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+00003c20: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
+00003c30: 7365 7274 4571 7561 6c28 7265 7375 6c74  sertEqual(result
+00003c40: 2e65 7869 745f 636f 6465 2c20 3029 0a20  .exit_code, 0). 
+00003c50: 2020 2020 2020 2066 696e 616c 6c79 3a0a         finally:.
+00003c60: 2020 2020 2020 2020 2020 2020 6f73 2e75              os.u
+00003c70: 6e6c 696e 6b28 746d 705f 6669 6c65 290a  nlink(tmp_file).
+00003c80: 2020 2020 2020 2020 6163 7475 616c 203d          actual =
+00003c90: 2072 6573 756c 742e 6f75 7470 7574 0a20   result.output. 
+00003ca0: 2020 2020 2020 2061 6374 7561 6c20 3d20         actual = 
+00003cb0: 6469 6666 5f68 6561 6465 722e 7375 6228  diff_header.sub(
+00003cc0: 4445 5445 524d 494e 4953 5449 435f 4845  DETERMINISTIC_HE
+00003cd0: 4144 4552 2c20 6163 7475 616c 290a 2020  ADER, actual).  
+00003ce0: 2020 2020 2020 6163 7475 616c 203d 2061        actual = a
+00003cf0: 6374 7561 6c2e 7273 7472 6970 2829 202b  ctual.rstrip() +
+00003d00: 2022 5c6e 2220 2023 2074 6865 2064 6966   "\n"  # the dif
+00003d10: 6620 6f75 7470 7574 2068 6173 2061 2074  f output has a t
+00003d20: 7261 696c 696e 6720 7370 6163 650a 2020  railing space.  
+00003d30: 2020 2020 2020 6966 2065 7870 6563 7465        if expecte
+00003d40: 6420 213d 2061 6374 7561 6c3a 0a20 2020  d != actual:.   
+00003d50: 2020 2020 2020 2020 2064 756d 7020 3d20           dump = 
+00003d60: 6365 7263 6973 2e64 756d 705f 746f 5f66  cercis.dump_to_f
+00003d70: 696c 6528 6163 7475 616c 290a 2020 2020  ile(actual).    
+00003d80: 2020 2020 2020 2020 6d73 6720 3d20 280a          msg = (.
+00003d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003da0: 2245 7870 6563 7465 6420 6469 6666 2069  "Expected diff i
+00003db0: 736e 2774 2065 7175 616c 2074 6f20 7468  sn't equal to th
+00003dc0: 6520 6163 7475 616c 2e20 4966 2079 6f75  e actual. If you
+00003dd0: 206d 6164 6520 6368 616e 6765 7320 746f   made changes to
+00003de0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00003df0: 2020 2220 6578 7072 6573 7369 6f6e 2e70    " expression.p
+00003e00: 7920 616e 6420 7468 6973 2069 7320 616e  y and this is an
+00003e10: 2061 6e74 6963 6970 6174 6564 2064 6966   anticipated dif
+00003e20: 6665 7265 6e63 652c 206f 7665 7277 7269  ference, overwri
+00003e30: 7465 220a 2020 2020 2020 2020 2020 2020  te".            
+00003e40: 2020 2020 2220 7465 7374 732f 6461 7461      " tests/data
+00003e50: 2f6d 6973 6365 6c6c 616e 656f 7573 2f65  /miscellaneous/e
+00003e60: 7870 7265 7373 696f 6e5f 736b 6970 5f6d  xpression_skip_m
+00003e70: 6167 6963 5f74 7261 696c 696e 675f 636f  agic_trailing_co
+00003e80: 6d6d 612e 6469 6666 220a 2020 2020 2020  mma.diff".      
+00003e90: 2020 2020 2020 2020 2020 6622 2077 6974            f" wit
+00003ea0: 6820 7b64 756d 707d 220a 2020 2020 2020  h {dump}".      
+00003eb0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00003ec0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+00003ed0: 7175 616c 2865 7870 6563 7465 642c 2061  qual(expected, a
+00003ee0: 6374 7561 6c2c 206d 7367 290a 0a20 2020  ctual, msg)..   
+00003ef0: 2040 7061 7463 6828 2263 6572 6369 732e   @patch("cercis.
+00003f00: 6475 6d70 5f74 6f5f 6669 6c65 222c 2064  dump_to_file", d
+00003f10: 756d 705f 746f 5f73 7464 6572 7229 0a20  ump_to_stderr). 
+00003f20: 2020 2064 6566 2074 6573 745f 6173 796e     def test_asyn
+00003f30: 635f 6173 5f69 6465 6e74 6966 6965 7228  c_as_identifier(
+00003f40: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
+00003f50: 2020 2020 2020 2073 6f75 7263 655f 7061         source_pa
+00003f60: 7468 203d 2067 6574 5f63 6173 655f 7061  th = get_case_pa
+00003f70: 7468 2822 6d69 7363 656c 6c61 6e65 6f75  th("miscellaneou
+00003f80: 7322 2c20 2261 7379 6e63 5f61 735f 6964  s", "async_as_id
+00003f90: 656e 7469 6669 6572 2229 0a20 2020 2020  entifier").     
+00003fa0: 2020 2073 6f75 7263 652c 2065 7870 6563     source, expec
+00003fb0: 7465 6420 3d20 7265 6164 5f64 6174 615f  ted = read_data_
+00003fc0: 6672 6f6d 5f66 696c 6528 736f 7572 6365  from_file(source
+00003fd0: 5f70 6174 6829 0a20 2020 2020 2020 2061  _path).        a
+00003fe0: 6374 7561 6c20 3d20 6673 2873 6f75 7263  ctual = fs(sourc
+00003ff0: 6529 0a20 2020 2020 2020 2073 656c 662e  e).        self.
+00004000: 6173 7365 7274 466f 726d 6174 4571 7561  assertFormatEqua
+00004010: 6c28 6578 7065 6374 6564 2c20 6163 7475  l(expected, actu
+00004020: 616c 290a 2020 2020 2020 2020 6d61 6a6f  al).        majo
+00004030: 722c 206d 696e 6f72 203d 2073 7973 2e76  r, minor = sys.v
+00004040: 6572 7369 6f6e 5f69 6e66 6f5b 3a32 5d0a  ersion_info[:2].
+00004050: 2020 2020 2020 2020 6966 206d 616a 6f72          if major
+00004060: 203c 2033 206f 7220 286d 616a 6f72 203c   < 3 or (major <
+00004070: 3d20 3320 616e 6420 6d69 6e6f 7220 3c20  = 3 and minor < 
+00004080: 3729 3a0a 2020 2020 2020 2020 2020 2020  7):.            
+00004090: 6365 7263 6973 2e61 7373 6572 745f 6571  cercis.assert_eq
+000040a0: 7569 7661 6c65 6e74 2873 6f75 7263 652c  uivalent(source,
+000040b0: 2061 6374 7561 6c29 0a20 2020 2020 2020   actual).       
+000040c0: 2063 6572 6369 732e 6173 7365 7274 5f73   cercis.assert_s
+000040d0: 7461 626c 6528 736f 7572 6365 2c20 6163  table(source, ac
+000040e0: 7475 616c 2c20 4445 4641 554c 545f 4d4f  tual, DEFAULT_MO
+000040f0: 4445 290a 2020 2020 2020 2020 2320 656e  DE).        # en
+00004100: 7375 7265 2063 6572 6369 7320 6361 6e20  sure cercis can 
+00004110: 7061 7273 6520 7468 6973 2077 6865 6e20  parse this when 
+00004120: 7468 6520 7461 7267 6574 2069 7320 332e  the target is 3.
+00004130: 360a 2020 2020 2020 2020 7365 6c66 2e69  6.        self.i
+00004140: 6e76 6f6b 6542 6c61 636b 285b 7374 7228  nvokeBlack([str(
+00004150: 736f 7572 6365 5f70 6174 6829 2c20 222d  source_path), "-
+00004160: 2d74 6172 6765 742d 7665 7273 696f 6e22  -target-version"
+00004170: 2c20 2270 7933 3622 5d29 0a20 2020 2020  , "py36"]).     
+00004180: 2020 2023 2062 7574 206e 6f74 206f 6e20     # but not on 
+00004190: 332e 372c 2062 6563 6175 7365 2061 7379  3.7, because asy
+000041a0: 6e63 2f61 7761 6974 2069 7320 6e6f 206c  nc/await is no l
+000041b0: 6f6e 6765 7220 616e 2069 6465 6e74 6966  onger an identif
+000041c0: 6965 720a 2020 2020 2020 2020 7365 6c66  ier.        self
+000041d0: 2e69 6e76 6f6b 6542 6c61 636b 285b 7374  .invokeBlack([st
+000041e0: 7228 736f 7572 6365 5f70 6174 6829 2c20  r(source_path), 
+000041f0: 222d 2d74 6172 6765 742d 7665 7273 696f  "--target-versio
+00004200: 6e22 2c20 2270 7933 3722 5d2c 2065 7869  n", "py37"], exi
+00004210: 745f 636f 6465 3d31 3233 290a 0a20 2020  t_code=123)..   
+00004220: 2040 7061 7463 6828 2263 6572 6369 732e   @patch("cercis.
+00004230: 6475 6d70 5f74 6f5f 6669 6c65 222c 2064  dump_to_file", d
+00004240: 756d 705f 746f 5f73 7464 6572 7229 0a20  ump_to_stderr). 
+00004250: 2020 2064 6566 2074 6573 745f 7079 7468     def test_pyth
+00004260: 6f6e 3337 2873 656c 6629 202d 3e20 4e6f  on37(self) -> No
+00004270: 6e65 3a0a 2020 2020 2020 2020 736f 7572  ne:.        sour
+00004280: 6365 5f70 6174 6820 3d20 6765 745f 6361  ce_path = get_ca
+00004290: 7365 5f70 6174 6828 2270 795f 3337 222c  se_path("py_37",
+000042a0: 2022 7079 7468 6f6e 3337 2229 0a20 2020   "python37").   
+000042b0: 2020 2020 2073 6f75 7263 652c 2065 7870       source, exp
+000042c0: 6563 7465 6420 3d20 7265 6164 5f64 6174  ected = read_dat
+000042d0: 615f 6672 6f6d 5f66 696c 6528 736f 7572  a_from_file(sour
+000042e0: 6365 5f70 6174 6829 0a20 2020 2020 2020  ce_path).       
+000042f0: 2061 6374 7561 6c20 3d20 6673 2873 6f75   actual = fs(sou
+00004300: 7263 6529 0a20 2020 2020 2020 2073 656c  rce).        sel
+00004310: 662e 6173 7365 7274 466f 726d 6174 4571  f.assertFormatEq
+00004320: 7561 6c28 6578 7065 6374 6564 2c20 6163  ual(expected, ac
+00004330: 7475 616c 290a 2020 2020 2020 2020 6d61  tual).        ma
+00004340: 6a6f 722c 206d 696e 6f72 203d 2073 7973  jor, minor = sys
+00004350: 2e76 6572 7369 6f6e 5f69 6e66 6f5b 3a32  .version_info[:2
+00004360: 5d0a 2020 2020 2020 2020 6966 206d 616a  ].        if maj
+00004370: 6f72 203e 2033 206f 7220 286d 616a 6f72  or > 3 or (major
+00004380: 203d 3d20 3320 616e 6420 6d69 6e6f 7220   == 3 and minor 
+00004390: 3e3d 2037 293a 0a20 2020 2020 2020 2020  >= 7):.         
+000043a0: 2020 2063 6572 6369 732e 6173 7365 7274     cercis.assert
+000043b0: 5f65 7175 6976 616c 656e 7428 736f 7572  _equivalent(sour
+000043c0: 6365 2c20 6163 7475 616c 290a 2020 2020  ce, actual).    
+000043d0: 2020 2020 6365 7263 6973 2e61 7373 6572      cercis.asser
+000043e0: 745f 7374 6162 6c65 2873 6f75 7263 652c  t_stable(source,
+000043f0: 2061 6374 7561 6c2c 2044 4546 4155 4c54   actual, DEFAULT
+00004400: 5f4d 4f44 4529 0a20 2020 2020 2020 2023  _MODE).        #
+00004410: 2065 6e73 7572 6520 6365 7263 6973 2063   ensure cercis c
+00004420: 616e 2070 6172 7365 2074 6869 7320 7768  an parse this wh
+00004430: 656e 2074 6865 2074 6172 6765 7420 6973  en the target is
+00004440: 2033 2e37 0a20 2020 2020 2020 2073 656c   3.7.        sel
+00004450: 662e 696e 766f 6b65 426c 6163 6b28 5b73  f.invokeBlack([s
+00004460: 7472 2873 6f75 7263 655f 7061 7468 292c  tr(source_path),
+00004470: 2022 2d2d 7461 7267 6574 2d76 6572 7369   "--target-versi
+00004480: 6f6e 222c 2022 7079 3337 225d 290a 2020  on", "py37"]).  
+00004490: 2020 2020 2020 2320 6275 7420 6e6f 7420        # but not 
+000044a0: 6f6e 2033 2e36 2c20 6265 6361 7573 6520  on 3.6, because 
+000044b0: 7765 2075 7365 2061 7379 6e63 2061 7320  we use async as 
+000044c0: 6120 7265 7365 7276 6564 206b 6579 776f  a reserved keywo
+000044d0: 7264 0a20 2020 2020 2020 2073 656c 662e  rd.        self.
+000044e0: 696e 766f 6b65 426c 6163 6b28 5b73 7472  invokeBlack([str
+000044f0: 2873 6f75 7263 655f 7061 7468 292c 2022  (source_path), "
+00004500: 2d2d 7461 7267 6574 2d76 6572 7369 6f6e  --target-version
+00004510: 222c 2022 7079 3336 225d 2c20 6578 6974  ", "py36"], exit
+00004520: 5f63 6f64 653d 3132 3329 0a0a 2020 2020  _code=123)..    
+00004530: 6465 6620 7465 7374 5f74 6162 5f63 6f6d  def test_tab_com
+00004540: 6d65 6e74 5f69 6e64 656e 7461 7469 6f6e  ment_indentation
+00004550: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
+00004560: 2020 2020 2020 2020 636f 6e74 656e 7473          contents
+00004570: 5f74 6162 203d 2022 6966 2031 3a5c 6e5c  _tab = "if 1:\n\
+00004580: 7469 6620 323a 5c6e 5c74 5c74 7061 7373  tif 2:\n\t\tpass
+00004590: 5c6e 5c74 2320 636f 6d6d 656e 745c 6e5c  \n\t# comment\n\
+000045a0: 7470 6173 735c 6e22 0a20 2020 2020 2020  tpass\n".       
+000045b0: 2063 6f6e 7465 6e74 735f 7370 6320 3d20   contents_spc = 
+000045c0: 2269 6620 313a 5c6e 2020 2020 6966 2032  "if 1:\n    if 2
+000045d0: 3a5c 6e20 2020 2020 2020 2070 6173 735c  :\n        pass\
+000045e0: 6e20 2020 2023 2063 6f6d 6d65 6e74 5c6e  n    # comment\n
+000045f0: 2020 2020 7061 7373 5c6e 220a 2020 2020      pass\n".    
+00004600: 2020 2020 7365 6c66 2e61 7373 6572 7446      self.assertF
+00004610: 6f72 6d61 7445 7175 616c 2863 6f6e 7465  ormatEqual(conte
+00004620: 6e74 735f 7370 632c 2066 7328 636f 6e74  nts_spc, fs(cont
+00004630: 656e 7473 5f73 7063 2929 0a20 2020 2020  ents_spc)).     
+00004640: 2020 2073 656c 662e 6173 7365 7274 466f     self.assertFo
+00004650: 726d 6174 4571 7561 6c28 636f 6e74 656e  rmatEqual(conten
+00004660: 7473 5f73 7063 2c20 6673 2863 6f6e 7465  ts_spc, fs(conte
+00004670: 6e74 735f 7461 6229 290a 0a20 2020 2020  nts_tab))..     
+00004680: 2020 2063 6f6e 7465 6e74 735f 7461 6220     contents_tab 
+00004690: 3d20 2269 6620 313a 5c6e 5c74 6966 2032  = "if 1:\n\tif 2
+000046a0: 3a5c 6e5c 745c 7470 6173 735c 6e5c 745c  :\n\t\tpass\n\t\
+000046b0: 7423 2063 6f6d 6d65 6e74 5c6e 5c74 7061  t# comment\n\tpa
+000046c0: 7373 5c6e 220a 2020 2020 2020 2020 636f  ss\n".        co
+000046d0: 6e74 656e 7473 5f73 7063 203d 2022 6966  ntents_spc = "if
+000046e0: 2031 3a5c 6e20 2020 2069 6620 323a 5c6e   1:\n    if 2:\n
+000046f0: 2020 2020 2020 2020 7061 7373 5c6e 2020          pass\n  
+00004700: 2020 2020 2020 2320 636f 6d6d 656e 745c        # comment\
+00004710: 6e20 2020 2070 6173 735c 6e22 0a20 2020  n    pass\n".   
+00004720: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00004730: 466f 726d 6174 4571 7561 6c28 636f 6e74  FormatEqual(cont
+00004740: 656e 7473 5f73 7063 2c20 6673 2863 6f6e  ents_spc, fs(con
+00004750: 7465 6e74 735f 7370 6329 290a 2020 2020  tents_spc)).    
+00004760: 2020 2020 7365 6c66 2e61 7373 6572 7446      self.assertF
+00004770: 6f72 6d61 7445 7175 616c 2863 6f6e 7465  ormatEqual(conte
+00004780: 6e74 735f 7370 632c 2066 7328 636f 6e74  nts_spc, fs(cont
+00004790: 656e 7473 5f74 6162 2929 0a0a 2020 2020  ents_tab))..    
+000047a0: 2020 2020 2320 6d69 7865 6420 7461 6273      # mixed tabs
+000047b0: 2061 6e64 2073 7061 6365 7320 2876 616c   and spaces (val
+000047c0: 6964 2050 7974 686f 6e20 3220 636f 6465  id Python 2 code
+000047d0: 290a 2020 2020 2020 2020 636f 6e74 656e  ).        conten
+000047e0: 7473 5f74 6162 203d 2022 6966 2031 3a5c  ts_tab = "if 1:\
+000047f0: 6e20 2020 2020 2020 2069 6620 323a 5c6e  n        if 2:\n
+00004800: 5c74 5c74 7061 7373 5c6e 5c74 2320 636f  \t\tpass\n\t# co
+00004810: 6d6d 656e 745c 6e20 2020 2020 2020 2070  mment\n        p
+00004820: 6173 735c 6e22 0a20 2020 2020 2020 2063  ass\n".        c
+00004830: 6f6e 7465 6e74 735f 7370 6320 3d20 2269  ontents_spc = "i
+00004840: 6620 313a 5c6e 2020 2020 6966 2032 3a5c  f 1:\n    if 2:\
+00004850: 6e20 2020 2020 2020 2070 6173 735c 6e20  n        pass\n 
+00004860: 2020 2023 2063 6f6d 6d65 6e74 5c6e 2020     # comment\n  
+00004870: 2020 7061 7373 5c6e 220a 2020 2020 2020    pass\n".      
+00004880: 2020 7365 6c66 2e61 7373 6572 7446 6f72    self.assertFor
+00004890: 6d61 7445 7175 616c 2863 6f6e 7465 6e74  matEqual(content
+000048a0: 735f 7370 632c 2066 7328 636f 6e74 656e  s_spc, fs(conten
+000048b0: 7473 5f73 7063 2929 0a20 2020 2020 2020  ts_spc)).       
+000048c0: 2073 656c 662e 6173 7365 7274 466f 726d   self.assertForm
+000048d0: 6174 4571 7561 6c28 636f 6e74 656e 7473  atEqual(contents
+000048e0: 5f73 7063 2c20 6673 2863 6f6e 7465 6e74  _spc, fs(content
+000048f0: 735f 7461 6229 290a 0a20 2020 2020 2020  s_tab))..       
+00004900: 2063 6f6e 7465 6e74 735f 7461 6220 3d20   contents_tab = 
+00004910: 2269 6620 313a 5c6e 2020 2020 2020 2020  "if 1:\n        
+00004920: 6966 2032 3a5c 6e5c 745c 7470 6173 735c  if 2:\n\t\tpass\
+00004930: 6e5c 745c 7423 2063 6f6d 6d65 6e74 5c6e  n\t\t# comment\n
+00004940: 2020 2020 2020 2020 7061 7373 5c6e 220a          pass\n".
+00004950: 2020 2020 2020 2020 636f 6e74 656e 7473          contents
+00004960: 5f73 7063 203d 2022 6966 2031 3a5c 6e20  _spc = "if 1:\n 
+00004970: 2020 2069 6620 323a 5c6e 2020 2020 2020     if 2:\n      
+00004980: 2020 7061 7373 5c6e 2020 2020 2020 2020    pass\n        
+00004990: 2320 636f 6d6d 656e 745c 6e20 2020 2070  # comment\n    p
+000049a0: 6173 735c 6e22 0a20 2020 2020 2020 2073  ass\n".        s
+000049b0: 656c 662e 6173 7365 7274 466f 726d 6174  elf.assertFormat
+000049c0: 4571 7561 6c28 636f 6e74 656e 7473 5f73  Equal(contents_s
+000049d0: 7063 2c20 6673 2863 6f6e 7465 6e74 735f  pc, fs(contents_
+000049e0: 7370 6329 290a 2020 2020 2020 2020 7365  spc)).        se
+000049f0: 6c66 2e61 7373 6572 7446 6f72 6d61 7445  lf.assertFormatE
+00004a00: 7175 616c 2863 6f6e 7465 6e74 735f 7370  qual(contents_sp
+00004a10: 632c 2066 7328 636f 6e74 656e 7473 5f74  c, fs(contents_t
+00004a20: 6162 2929 0a0a 2020 2020 6465 6620 7465  ab))..    def te
+00004a30: 7374 5f66 616c 7365 5f70 6f73 6974 6976  st_false_positiv
+00004a40: 655f 7379 6d6c 696e 6b5f 6f75 7470 7574  e_symlink_output
+00004a50: 5f69 7373 7565 5f33 3338 3428 7365 6c66  _issue_3384(self
+00004a60: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+00004a70: 2020 2023 2045 6d75 6c61 7465 2074 6865     # Emulate the
+00004a80: 2062 6568 6176 696f 7220 7768 656e 2075   behavior when u
+00004a90: 7369 6e67 2074 6865 2043 4c49 2028 6063  sing the CLI (`c
+00004aa0: 6572 6369 7320 2e2f 6368 696c 6420 202d  ercis ./child  -
+00004ab0: 2d76 6572 626f 7365 6029 2c20 7768 6963  -verbose`), whic
+00004ac0: 680a 2020 2020 2020 2020 2320 696e 766f  h.        # invo
+00004ad0: 6c76 6573 2070 6174 6368 696e 6720 736f  lves patching so
+00004ae0: 6d65 2060 7061 7468 6c69 622e 5061 7468  me `pathlib.Path
+00004af0: 6020 6d65 7468 6f64 732e 2049 6e20 7061  ` methods. In pa
+00004b00: 7274 6963 756c 6172 2c20 6069 735f 6469  rticular, `is_di
+00004b10: 7260 2069 730a 2020 2020 2020 2020 2320  r` is.        # 
+00004b20: 7061 7463 6865 6420 6f6e 6c79 206f 6e20  patched only on 
+00004b30: 6974 7320 6669 7273 7420 6361 6c6c 3a20  its first call: 
+00004b40: 7768 656e 2063 6865 636b 696e 6720 6966  when checking if
+00004b50: 2022 2e2f 6368 696c 6422 2069 7320 6120   "./child" is a 
+00004b60: 6469 7265 6374 6f72 7920 6974 0a20 2020  directory it.   
+00004b70: 2020 2020 2023 2073 686f 756c 6420 7265       # should re
+00004b80: 7475 726e 2054 7275 652e 2054 6865 2022  turn True. The "
+00004b90: 2e2f 6368 696c 6422 2066 6f6c 6465 7220  ./child" folder 
+00004ba0: 6578 6973 7473 2072 656c 6174 6976 6520  exists relative 
+00004bb0: 746f 2074 6865 2063 7764 2077 6865 6e0a  to the cwd when.
+00004bc0: 2020 2020 2020 2020 2320 7275 6e6e 696e          # runnin
+00004bd0: 6720 6672 6f6d 2043 4c49 2c20 6275 7420  g from CLI, but 
+00004be0: 6661 696c 7320 7768 656e 2072 756e 6e69  fails when runni
+00004bf0: 6e67 2074 6865 2074 6573 7473 2062 6563  ng the tests bec
+00004c00: 6175 7365 2063 7764 2069 7320 6469 6666  ause cwd is diff
+00004c10: 6572 656e 740a 2020 2020 2020 2020 7072  erent.        pr
+00004c20: 6f6a 6563 745f 726f 6f74 203d 2050 6174  oject_root = Pat
+00004c30: 6828 5448 4953 5f44 4952 202f 2022 6461  h(THIS_DIR / "da
+00004c40: 7461 2220 2f20 226e 6573 7465 645f 6769  ta" / "nested_gi
+00004c50: 7469 676e 6f72 655f 7465 7374 7322 290a  tignore_tests").
+00004c60: 2020 2020 2020 2020 776f 726b 696e 675f          working_
+00004c70: 6469 7265 6374 6f72 7920 3d20 7072 6f6a  directory = proj
+00004c80: 6563 745f 726f 6f74 202f 2022 726f 6f74  ect_root / "root
+00004c90: 220a 2020 2020 2020 2020 7461 7267 6574  ".        target
+00004ca0: 5f61 6273 7061 7468 203d 2077 6f72 6b69  _abspath = worki
+00004cb0: 6e67 5f64 6972 6563 746f 7279 202f 2022  ng_directory / "
+00004cc0: 6368 696c 6422 0a20 2020 2020 2020 2074  child".        t
+00004cd0: 6172 6765 745f 636f 6e74 656e 7473 203d  arget_contents =
+00004ce0: 2028 0a20 2020 2020 2020 2020 2020 2073   (.            s
+00004cf0: 7263 2e72 656c 6174 6976 655f 746f 2877  rc.relative_to(w
+00004d00: 6f72 6b69 6e67 5f64 6972 6563 746f 7279  orking_directory
+00004d10: 2920 666f 7220 7372 6320 696e 2074 6172  ) for src in tar
+00004d20: 6765 745f 6162 7370 6174 682e 6974 6572  get_abspath.iter
+00004d30: 6469 7228 290a 2020 2020 2020 2020 290a  dir().        ).
+00004d40: 0a20 2020 2020 2020 2064 6566 206d 6f63  .        def moc
+00004d50: 6b5f 6e5f 6361 6c6c 7328 7265 7370 6f6e  k_n_calls(respon
+00004d60: 7365 733a 204c 6973 745b 626f 6f6c 5d29  ses: List[bool])
+00004d70: 202d 3e20 4361 6c6c 6162 6c65 5b5b 5d2c   -> Callable[[],
+00004d80: 2062 6f6f 6c5d 3a0a 2020 2020 2020 2020   bool]:.        
+00004d90: 2020 2020 6465 6620 5f6d 6f63 6b65 645f      def _mocked_
+00004da0: 6361 6c6c 7328 2920 2d3e 2062 6f6f 6c3a  calls() -> bool:
+00004db0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004dc0: 2069 6620 7265 7370 6f6e 7365 733a 0a20   if responses:. 
+00004dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004de0: 2020 2072 6574 7572 6e20 7265 7370 6f6e     return respon
+00004df0: 7365 732e 706f 7028 3029 0a20 2020 2020  ses.pop(0).     
+00004e00: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00004e10: 6e20 4661 6c73 650a 0a20 2020 2020 2020  n False..       
+00004e20: 2020 2020 2072 6574 7572 6e20 5f6d 6f63       return _moc
+00004e30: 6b65 645f 6361 6c6c 730a 0a20 2020 2020  ked_calls..     
+00004e40: 2020 2077 6974 6820 7061 7463 6828 2270     with patch("p
+00004e50: 6174 686c 6962 2e50 6174 682e 6974 6572  athlib.Path.iter
+00004e60: 6469 7222 2c20 7265 7475 726e 5f76 616c  dir", return_val
+00004e70: 7565 3d74 6172 6765 745f 636f 6e74 656e  ue=target_conten
+00004e80: 7473 292c 2070 6174 6368 280a 2020 2020  ts), patch(.    
+00004e90: 2020 2020 2020 2020 2270 6174 686c 6962          "pathlib
+00004ea0: 2e50 6174 682e 6377 6422 2c20 7265 7475  .Path.cwd", retu
+00004eb0: 726e 5f76 616c 7565 3d77 6f72 6b69 6e67  rn_value=working
+00004ec0: 5f64 6972 6563 746f 7279 0a20 2020 2020  _directory.     
+00004ed0: 2020 2029 2c20 7061 7463 6828 2270 6174     ), patch("pat
+00004ee0: 686c 6962 2e50 6174 682e 6973 5f64 6972  hlib.Path.is_dir
+00004ef0: 222c 2073 6964 655f 6566 6665 6374 3d6d  ", side_effect=m
+00004f00: 6f63 6b5f 6e5f 6361 6c6c 7328 5b54 7275  ock_n_calls([Tru
+00004f10: 655d 2929 3a0a 2020 2020 2020 2020 2020  e])):.          
+00004f20: 2020 6374 7820 3d20 4661 6b65 436f 6e74    ctx = FakeCont
+00004f30: 6578 7428 290a 2020 2020 2020 2020 2020  ext().          
+00004f40: 2020 6374 782e 6f62 6a5b 2272 6f6f 7422    ctx.obj["root"
+00004f50: 5d20 3d20 7072 6f6a 6563 745f 726f 6f74  ] = project_root
+00004f60: 0a20 2020 2020 2020 2020 2020 2072 6570  .            rep
+00004f70: 6f72 7420 3d20 4d61 6769 634d 6f63 6b28  ort = MagicMock(
+00004f80: 7665 7262 6f73 653d 5472 7565 290a 2020  verbose=True).  
+00004f90: 2020 2020 2020 2020 2020 6365 7263 6973            cercis
+00004fa0: 2e67 6574 5f73 6f75 7263 6573 280a 2020  .get_sources(.  
+00004fb0: 2020 2020 2020 2020 2020 2020 2020 6374                ct
+00004fc0: 783d 6374 782c 0a20 2020 2020 2020 2020  x=ctx,.         
+00004fd0: 2020 2020 2020 2073 7263 3d28 222e 2f63         src=("./c
+00004fe0: 6869 6c64 222c 292c 0a20 2020 2020 2020  hild",),.       
+00004ff0: 2020 2020 2020 2020 2071 7569 6574 3d46           quiet=F
+00005000: 616c 7365 2c0a 2020 2020 2020 2020 2020  alse,.          
+00005010: 2020 2020 2020 7665 7262 6f73 653d 5472        verbose=Tr
+00005020: 7565 2c0a 2020 2020 2020 2020 2020 2020  ue,.            
+00005030: 2020 2020 696e 636c 7564 653d 4445 4641      include=DEFA
+00005040: 554c 545f 494e 434c 5544 452c 0a20 2020  ULT_INCLUDE,.   
+00005050: 2020 2020 2020 2020 2020 2020 2065 7863               exc
+00005060: 6c75 6465 3d4e 6f6e 652c 0a20 2020 2020  lude=None,.     
+00005070: 2020 2020 2020 2020 2020 2072 6570 6f72             repor
+00005080: 743d 7265 706f 7274 2c0a 2020 2020 2020  t=report,.      
+00005090: 2020 2020 2020 2020 2020 6578 7465 6e64            extend
+000050a0: 5f65 7863 6c75 6465 3d4e 6f6e 652c 0a20  _exclude=None,. 
+000050b0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+000050c0: 6f72 6365 5f65 7863 6c75 6465 3d4e 6f6e  orce_exclude=Non
+000050d0: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+000050e0: 2020 2073 7464 696e 5f66 696c 656e 616d     stdin_filenam
+000050f0: 653d 4e6f 6e65 2c0a 2020 2020 2020 2020  e=None,.        
+00005100: 2020 2020 290a 2020 2020 2020 2020 6173      ).        as
+00005110: 7365 7274 206e 6f74 2061 6e79 280a 2020  sert not any(.  
+00005120: 2020 2020 2020 2020 2020 6d6f 636b 5f61            mock_a
+00005130: 7267 735b 315d 2e73 7461 7274 7377 6974  rgs[1].startswit
+00005140: 6828 2269 7320 6120 7379 6d62 6f6c 6963  h("is a symbolic
+00005150: 206c 696e 6b20 7468 6174 2070 6f69 6e74   link that point
+00005160: 7320 6f75 7473 6964 6522 290a 2020 2020  s outside").    
+00005170: 2020 2020 2020 2020 666f 7220 5f2c 206d          for _, m
+00005180: 6f63 6b5f 6172 6773 2c20 5f20 696e 2072  ock_args, _ in r
+00005190: 6570 6f72 742e 7061 7468 5f69 676e 6f72  eport.path_ignor
+000051a0: 6564 2e6d 6f63 6b5f 6361 6c6c 730a 2020  ed.mock_calls.  
+000051b0: 2020 2020 2020 292c 2022 4120 7379 6d62        ), "A symb
+000051c0: 6f6c 6963 206c 696e 6b20 7761 7320 7265  olic link was re
+000051d0: 706f 7274 6564 2e22 0a20 2020 2020 2020  ported.".       
+000051e0: 2072 6570 6f72 742e 7061 7468 5f69 676e   report.path_ign
+000051f0: 6f72 6564 2e61 7373 6572 745f 6361 6c6c  ored.assert_call
+00005200: 6564 5f6f 6e63 655f 7769 7468 280a 2020  ed_once_with(.  
+00005210: 2020 2020 2020 2020 2020 5061 7468 2822            Path("
+00005220: 6368 696c 6422 2c20 2262 2e70 7922 292c  child", "b.py"),
+00005230: 2022 6d61 7463 6865 7320 6120 2e67 6974   "matches a .git
+00005240: 6967 6e6f 7265 2066 696c 6520 636f 6e74  ignore file cont
+00005250: 656e 7422 0a20 2020 2020 2020 2029 0a0a  ent".        )..
+00005260: 2020 2020 6465 6620 7465 7374 5f72 6570      def test_rep
+00005270: 6f72 745f 7665 7262 6f73 6528 7365 6c66  ort_verbose(self
+00005280: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+00005290: 2020 2072 6570 6f72 7420 3d20 5265 706f     report = Repo
+000052a0: 7274 2876 6572 626f 7365 3d54 7275 6529  rt(verbose=True)
+000052b0: 0a20 2020 2020 2020 206f 7574 5f6c 696e  .        out_lin
+000052c0: 6573 203d 205b 5d0a 2020 2020 2020 2020  es = [].        
+000052d0: 6572 725f 6c69 6e65 7320 3d20 5b5d 0a0a  err_lines = []..
+000052e0: 2020 2020 2020 2020 6465 6620 6f75 7428          def out(
+000052f0: 6d73 673a 2073 7472 2c20 2a2a 6b77 6172  msg: str, **kwar
+00005300: 6773 3a20 416e 7929 202d 3e20 4e6f 6e65  gs: Any) -> None
+00005310: 3a0a 2020 2020 2020 2020 2020 2020 6f75  :.            ou
+00005320: 745f 6c69 6e65 732e 6170 7065 6e64 286d  t_lines.append(m
+00005330: 7367 290a 0a20 2020 2020 2020 2064 6566  sg)..        def
+00005340: 2065 7272 286d 7367 3a20 7374 722c 202a   err(msg: str, *
+00005350: 2a6b 7761 7267 733a 2041 6e79 2920 2d3e  *kwargs: Any) ->
+00005360: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00005370: 2020 2065 7272 5f6c 696e 6573 2e61 7070     err_lines.app
+00005380: 656e 6428 6d73 6729 0a0a 2020 2020 2020  end(msg)..      
+00005390: 2020 7769 7468 2070 6174 6368 2822 6365    with patch("ce
+000053a0: 7263 6973 2e6f 7574 7075 742e 5f6f 7574  rcis.output._out
+000053b0: 222c 206f 7574 292c 2070 6174 6368 2822  ", out), patch("
+000053c0: 6365 7263 6973 2e6f 7574 7075 742e 5f65  cercis.output._e
+000053d0: 7272 222c 2065 7272 293a 0a20 2020 2020  rr", err):.     
+000053e0: 2020 2020 2020 2072 6570 6f72 742e 646f         report.do
+000053f0: 6e65 2850 6174 6828 2266 3122 292c 2063  ne(Path("f1"), c
+00005400: 6572 6369 732e 4368 616e 6765 642e 4e4f  ercis.Changed.NO
+00005410: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+00005420: 6c66 2e61 7373 6572 7445 7175 616c 286c  lf.assertEqual(l
+00005430: 656e 286f 7574 5f6c 696e 6573 292c 2031  en(out_lines), 1
+00005440: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+00005450: 6c66 2e61 7373 6572 7445 7175 616c 286c  lf.assertEqual(l
+00005460: 656e 2865 7272 5f6c 696e 6573 292c 2030  en(err_lines), 0
+00005470: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+00005480: 6c66 2e61 7373 6572 7445 7175 616c 286f  lf.assertEqual(o
+00005490: 7574 5f6c 696e 6573 5b2d 315d 2c20 2266  ut_lines[-1], "f
+000054a0: 3120 616c 7265 6164 7920 7765 6c6c 2066  1 already well f
+000054b0: 6f72 6d61 7474 6564 2c20 676f 6f64 206a  ormatted, good j
+000054c0: 6f62 2e22 290a 2020 2020 2020 2020 2020  ob.").          
+000054d0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+000054e0: 616c 2875 6e73 7479 6c65 2873 7472 2872  al(unstyle(str(r
+000054f0: 6570 6f72 7429 292c 2022 3120 6669 6c65  eport)), "1 file
+00005500: 206c 6566 7420 756e 6368 616e 6765 642e   left unchanged.
+00005510: 2229 0a20 2020 2020 2020 2020 2020 2073  ").            s
+00005520: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+00005530: 7265 706f 7274 2e72 6574 7572 6e5f 636f  report.return_co
+00005540: 6465 2c20 3029 0a20 2020 2020 2020 2020  de, 0).         
+00005550: 2020 2072 6570 6f72 742e 646f 6e65 2850     report.done(P
+00005560: 6174 6828 2266 3222 292c 2063 6572 6369  ath("f2"), cerci
+00005570: 732e 4368 616e 6765 642e 5945 5329 0a20  s.Changed.YES). 
+00005580: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00005590: 6173 7365 7274 4571 7561 6c28 6c65 6e28  assertEqual(len(
+000055a0: 6f75 745f 6c69 6e65 7329 2c20 3229 0a20  out_lines), 2). 
+000055b0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000055c0: 6173 7365 7274 4571 7561 6c28 6c65 6e28  assertEqual(len(
+000055d0: 6572 725f 6c69 6e65 7329 2c20 3029 0a20  err_lines), 0). 
+000055e0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000055f0: 6173 7365 7274 4571 7561 6c28 6f75 745f  assertEqual(out_
+00005600: 6c69 6e65 735b 2d31 5d2c 2022 7265 666f  lines[-1], "refo
+00005610: 726d 6174 7465 6420 6632 2229 0a20 2020  rmatted f2").   
+00005620: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
+00005630: 7365 7274 4571 7561 6c28 0a20 2020 2020  sertEqual(.     
+00005640: 2020 2020 2020 2020 2020 2075 6e73 7479             unsty
+00005650: 6c65 2873 7472 2872 6570 6f72 7429 292c  le(str(report)),
+00005660: 2022 3120 6669 6c65 2072 6566 6f72 6d61   "1 file reforma
+00005670: 7474 6564 2c20 3120 6669 6c65 206c 6566  tted, 1 file lef
+00005680: 7420 756e 6368 616e 6765 642e 220a 2020  t unchanged.".  
+00005690: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+000056a0: 2020 2020 2020 2020 7265 706f 7274 2e64          report.d
+000056b0: 6f6e 6528 5061 7468 2822 6633 2229 2c20  one(Path("f3"), 
+000056c0: 6365 7263 6973 2e43 6861 6e67 6564 2e43  cercis.Changed.C
+000056d0: 4143 4845 4429 0a20 2020 2020 2020 2020  ACHED).         
+000056e0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+000056f0: 7561 6c28 6c65 6e28 6f75 745f 6c69 6e65  ual(len(out_line
+00005700: 7329 2c20 3329 0a20 2020 2020 2020 2020  s), 3).         
+00005710: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+00005720: 7561 6c28 6c65 6e28 6572 725f 6c69 6e65  ual(len(err_line
+00005730: 7329 2c20 3029 0a20 2020 2020 2020 2020  s), 0).         
+00005740: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+00005750: 7561 6c28 0a20 2020 2020 2020 2020 2020  ual(.           
+00005760: 2020 2020 206f 7574 5f6c 696e 6573 5b2d       out_lines[-
+00005770: 315d 2c20 2266 3320 7761 736e 2774 206d  1], "f3 wasn't m
+00005780: 6f64 6966 6965 6420 6f6e 2064 6973 6b20  odified on disk 
+00005790: 7369 6e63 6520 6c61 7374 2072 756e 2e22  since last run."
+000057a0: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+000057b0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000057c0: 6173 7365 7274 4571 7561 6c28 0a20 2020  assertEqual(.   
+000057d0: 2020 2020 2020 2020 2020 2020 2075 6e73               uns
+000057e0: 7479 6c65 2873 7472 2872 6570 6f72 7429  tyle(str(report)
+000057f0: 292c 2022 3120 6669 6c65 2072 6566 6f72  ), "1 file refor
+00005800: 6d61 7474 6564 2c20 3220 6669 6c65 7320  matted, 2 files 
+00005810: 6c65 6674 2075 6e63 6861 6e67 6564 2e22  left unchanged."
+00005820: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+00005830: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00005840: 6173 7365 7274 4571 7561 6c28 7265 706f  assertEqual(repo
+00005850: 7274 2e72 6574 7572 6e5f 636f 6465 2c20  rt.return_code, 
+00005860: 3029 0a20 2020 2020 2020 2020 2020 2072  0).            r
+00005870: 6570 6f72 742e 6368 6563 6b20 3d20 5472  eport.check = Tr
+00005880: 7565 0a20 2020 2020 2020 2020 2020 2073  ue.            s
+00005890: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+000058a0: 7265 706f 7274 2e72 6574 7572 6e5f 636f  report.return_co
+000058b0: 6465 2c20 3129 0a20 2020 2020 2020 2020  de, 1).         
+000058c0: 2020 2072 6570 6f72 742e 6368 6563 6b20     report.check 
+000058d0: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
+000058e0: 2020 2020 7265 706f 7274 2e66 6169 6c65      report.faile
+000058f0: 6428 5061 7468 2822 6531 2229 2c20 2262  d(Path("e1"), "b
+00005900: 6f6f 6d22 290a 2020 2020 2020 2020 2020  oom").          
+00005910: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00005920: 616c 286c 656e 286f 7574 5f6c 696e 6573  al(len(out_lines
+00005930: 292c 2033 290a 2020 2020 2020 2020 2020  ), 3).          
+00005940: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00005950: 616c 286c 656e 2865 7272 5f6c 696e 6573  al(len(err_lines
+00005960: 292c 2031 290a 2020 2020 2020 2020 2020  ), 1).          
+00005970: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00005980: 616c 2865 7272 5f6c 696e 6573 5b2d 315d  al(err_lines[-1]
+00005990: 2c20 2265 7272 6f72 3a20 6361 6e6e 6f74  , "error: cannot
+000059a0: 2066 6f72 6d61 7420 6531 3a20 626f 6f6d   format e1: boom
+000059b0: 2229 0a20 2020 2020 2020 2020 2020 2073  ").            s
+000059c0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+000059d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000059e0: 2075 6e73 7479 6c65 2873 7472 2872 6570   unstyle(str(rep
+000059f0: 6f72 7429 292c 0a20 2020 2020 2020 2020  ort)),.         
+00005a00: 2020 2020 2020 2022 3120 6669 6c65 2072         "1 file r
+00005a10: 6566 6f72 6d61 7474 6564 2c20 3220 6669  eformatted, 2 fi
+00005a20: 6c65 7320 6c65 6674 2075 6e63 6861 6e67  les left unchang
+00005a30: 6564 2c20 3120 6669 6c65 2066 6169 6c65  ed, 1 file faile
+00005a40: 6420 746f 220a 2020 2020 2020 2020 2020  d to".          
+00005a50: 2020 2020 2020 2220 7265 666f 726d 6174        " reformat
+00005a60: 2e22 2c0a 2020 2020 2020 2020 2020 2020  .",.            
+00005a70: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+00005a80: 6c66 2e61 7373 6572 7445 7175 616c 2872  lf.assertEqual(r
+00005a90: 6570 6f72 742e 7265 7475 726e 5f63 6f64  eport.return_cod
+00005aa0: 652c 2031 3233 290a 2020 2020 2020 2020  e, 123).        
+00005ab0: 2020 2020 7265 706f 7274 2e64 6f6e 6528      report.done(
+00005ac0: 5061 7468 2822 6633 2229 2c20 6365 7263  Path("f3"), cerc
+00005ad0: 6973 2e43 6861 6e67 6564 2e59 4553 290a  is.Changed.YES).
+00005ae0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00005af0: 2e61 7373 6572 7445 7175 616c 286c 656e  .assertEqual(len
+00005b00: 286f 7574 5f6c 696e 6573 292c 2034 290a  (out_lines), 4).
+00005b10: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00005b20: 2e61 7373 6572 7445 7175 616c 286c 656e  .assertEqual(len
+00005b30: 2865 7272 5f6c 696e 6573 292c 2031 290a  (err_lines), 1).
+00005b40: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00005b50: 2e61 7373 6572 7445 7175 616c 286f 7574  .assertEqual(out
+00005b60: 5f6c 696e 6573 5b2d 315d 2c20 2272 6566  _lines[-1], "ref
+00005b70: 6f72 6d61 7474 6564 2066 3322 290a 2020  ormatted f3").  
+00005b80: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+00005b90: 7373 6572 7445 7175 616c 280a 2020 2020  ssertEqual(.    
+00005ba0: 2020 2020 2020 2020 2020 2020 756e 7374              unst
+00005bb0: 796c 6528 7374 7228 7265 706f 7274 2929  yle(str(report))
+00005bc0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00005bd0: 2020 2232 2066 696c 6573 2072 6566 6f72    "2 files refor
+00005be0: 6d61 7474 6564 2c20 3220 6669 6c65 7320  matted, 2 files 
+00005bf0: 6c65 6674 2075 6e63 6861 6e67 6564 2c20  left unchanged, 
+00005c00: 3120 6669 6c65 2066 6169 6c65 6420 746f  1 file failed to
+00005c10: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00005c20: 2020 2220 7265 666f 726d 6174 2e22 2c0a    " reformat.",.
+00005c30: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00005c40: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+00005c50: 7373 6572 7445 7175 616c 2872 6570 6f72  ssertEqual(repor
+00005c60: 742e 7265 7475 726e 5f63 6f64 652c 2031  t.return_code, 1
+00005c70: 3233 290a 2020 2020 2020 2020 2020 2020  23).            
+00005c80: 7265 706f 7274 2e66 6169 6c65 6428 5061  report.failed(Pa
+00005c90: 7468 2822 6532 2229 2c20 2262 6f6f 6d22  th("e2"), "boom"
+00005ca0: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+00005cb0: 6c66 2e61 7373 6572 7445 7175 616c 286c  lf.assertEqual(l
+00005cc0: 656e 286f 7574 5f6c 696e 6573 292c 2034  en(out_lines), 4
+00005cd0: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+00005ce0: 6c66 2e61 7373 6572 7445 7175 616c 286c  lf.assertEqual(l
+00005cf0: 656e 2865 7272 5f6c 696e 6573 292c 2032  en(err_lines), 2
+00005d00: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+00005d10: 6c66 2e61 7373 6572 7445 7175 616c 2865  lf.assertEqual(e
+00005d20: 7272 5f6c 696e 6573 5b2d 315d 2c20 2265  rr_lines[-1], "e
+00005d30: 7272 6f72 3a20 6361 6e6e 6f74 2066 6f72  rror: cannot for
+00005d40: 6d61 7420 6532 3a20 626f 6f6d 2229 0a20  mat e2: boom"). 
+00005d50: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00005d60: 6173 7365 7274 4571 7561 6c28 0a20 2020  assertEqual(.   
+00005d70: 2020 2020 2020 2020 2020 2020 2075 6e73               uns
+00005d80: 7479 6c65 2873 7472 2872 6570 6f72 7429  tyle(str(report)
+00005d90: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+00005da0: 2020 2022 3220 6669 6c65 7320 7265 666f     "2 files refo
+00005db0: 726d 6174 7465 642c 2032 2066 696c 6573  rmatted, 2 files
+00005dc0: 206c 6566 7420 756e 6368 616e 6765 642c   left unchanged,
+00005dd0: 2032 2066 696c 6573 2066 6169 6c65 6420   2 files failed 
+00005de0: 746f 220a 2020 2020 2020 2020 2020 2020  to".            
+00005df0: 2020 2020 2220 7265 666f 726d 6174 2e22      " reformat."
+00005e00: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
+00005e10: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00005e20: 2e61 7373 6572 7445 7175 616c 2872 6570  .assertEqual(rep
+00005e30: 6f72 742e 7265 7475 726e 5f63 6f64 652c  ort.return_code,
+00005e40: 2031 3233 290a 2020 2020 2020 2020 2020   123).          
+00005e50: 2020 7265 706f 7274 2e70 6174 685f 6967    report.path_ig
+00005e60: 6e6f 7265 6428 5061 7468 2822 7761 7422  nored(Path("wat"
+00005e70: 292c 2022 6e6f 206d 6174 6368 2229 0a20  ), "no match"). 
+00005e80: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00005e90: 6173 7365 7274 4571 7561 6c28 6c65 6e28  assertEqual(len(
+00005ea0: 6f75 745f 6c69 6e65 7329 2c20 3529 0a20  out_lines), 5). 
+00005eb0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00005ec0: 6173 7365 7274 4571 7561 6c28 6c65 6e28  assertEqual(len(
+00005ed0: 6572 725f 6c69 6e65 7329 2c20 3229 0a20  err_lines), 2). 
+00005ee0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00005ef0: 6173 7365 7274 4571 7561 6c28 6f75 745f  assertEqual(out_
+00005f00: 6c69 6e65 735b 2d31 5d2c 2022 7761 7420  lines[-1], "wat 
+00005f10: 6967 6e6f 7265 643a 206e 6f20 6d61 7463  ignored: no matc
+00005f20: 6822 290a 2020 2020 2020 2020 2020 2020  h").            
+00005f30: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+00005f40: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00005f50: 2020 756e 7374 796c 6528 7374 7228 7265    unstyle(str(re
+00005f60: 706f 7274 2929 2c0a 2020 2020 2020 2020  port)),.        
+00005f70: 2020 2020 2020 2020 2232 2066 696c 6573          "2 files
+00005f80: 2072 6566 6f72 6d61 7474 6564 2c20 3220   reformatted, 2 
+00005f90: 6669 6c65 7320 6c65 6674 2075 6e63 6861  files left uncha
+00005fa0: 6e67 6564 2c20 3220 6669 6c65 7320 6661  nged, 2 files fa
+00005fb0: 696c 6564 2074 6f22 0a20 2020 2020 2020  iled to".       
+00005fc0: 2020 2020 2020 2020 2022 2072 6566 6f72           " refor
+00005fd0: 6d61 742e 222c 0a20 2020 2020 2020 2020  mat.",.         
+00005fe0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+00005ff0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+00006000: 6c28 7265 706f 7274 2e72 6574 7572 6e5f  l(report.return_
+00006010: 636f 6465 2c20 3132 3329 0a20 2020 2020  code, 123).     
+00006020: 2020 2020 2020 2072 6570 6f72 742e 646f         report.do
+00006030: 6e65 2850 6174 6828 2266 3422 292c 2063  ne(Path("f4"), c
+00006040: 6572 6369 732e 4368 616e 6765 642e 4e4f  ercis.Changed.NO
+00006050: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+00006060: 6c66 2e61 7373 6572 7445 7175 616c 286c  lf.assertEqual(l
+00006070: 656e 286f 7574 5f6c 696e 6573 292c 2036  en(out_lines), 6
+00006080: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+00006090: 6c66 2e61 7373 6572 7445 7175 616c 286c  lf.assertEqual(l
+000060a0: 656e 2865 7272 5f6c 696e 6573 292c 2032  en(err_lines), 2
+000060b0: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+000060c0: 6c66 2e61 7373 6572 7445 7175 616c 286f  lf.assertEqual(o
+000060d0: 7574 5f6c 696e 6573 5b2d 315d 2c20 2266  ut_lines[-1], "f
+000060e0: 3420 616c 7265 6164 7920 7765 6c6c 2066  4 already well f
+000060f0: 6f72 6d61 7474 6564 2c20 676f 6f64 206a  ormatted, good j
+00006100: 6f62 2e22 290a 2020 2020 2020 2020 2020  ob.").          
+00006110: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00006120: 616c 280a 2020 2020 2020 2020 2020 2020  al(.            
+00006130: 2020 2020 756e 7374 796c 6528 7374 7228      unstyle(str(
+00006140: 7265 706f 7274 2929 2c0a 2020 2020 2020  report)),.      
+00006150: 2020 2020 2020 2020 2020 2232 2066 696c            "2 fil
+00006160: 6573 2072 6566 6f72 6d61 7474 6564 2c20  es reformatted, 
+00006170: 3320 6669 6c65 7320 6c65 6674 2075 6e63  3 files left unc
+00006180: 6861 6e67 6564 2c20 3220 6669 6c65 7320  hanged, 2 files 
+00006190: 6661 696c 6564 2074 6f22 0a20 2020 2020  failed to".     
+000061a0: 2020 2020 2020 2020 2020 2022 2072 6566             " ref
+000061b0: 6f72 6d61 742e 222c 0a20 2020 2020 2020  ormat.",.       
+000061c0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+000061d0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+000061e0: 7561 6c28 7265 706f 7274 2e72 6574 7572  ual(report.retur
+000061f0: 6e5f 636f 6465 2c20 3132 3329 0a20 2020  n_code, 123).   
+00006200: 2020 2020 2020 2020 2072 6570 6f72 742e           report.
+00006210: 6368 6563 6b20 3d20 5472 7565 0a20 2020  check = True.   
+00006220: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
+00006230: 7365 7274 4571 7561 6c28 0a20 2020 2020  sertEqual(.     
+00006240: 2020 2020 2020 2020 2020 2075 6e73 7479             unsty
+00006250: 6c65 2873 7472 2872 6570 6f72 7429 292c  le(str(report)),
+00006260: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00006270: 2022 3220 6669 6c65 7320 776f 756c 6420   "2 files would 
+00006280: 6265 2072 6566 6f72 6d61 7474 6564 2c20  be reformatted, 
+00006290: 3320 6669 6c65 7320 776f 756c 6420 6265  3 files would be
+000062a0: 206c 6566 7420 756e 6368 616e 6765 642c   left unchanged,
+000062b0: 2032 220a 2020 2020 2020 2020 2020 2020   2".            
+000062c0: 2020 2020 2220 6669 6c65 7320 776f 756c      " files woul
+000062d0: 6420 6661 696c 2074 6f20 7265 666f 726d  d fail to reform
+000062e0: 6174 2e22 2c0a 2020 2020 2020 2020 2020  at.",.          
+000062f0: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+00006300: 7265 706f 7274 2e63 6865 636b 203d 2046  report.check = F
+00006310: 616c 7365 0a20 2020 2020 2020 2020 2020  alse.           
+00006320: 2072 6570 6f72 742e 6469 6666 203d 2054   report.diff = T
+00006330: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
+00006340: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+00006350: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00006360: 2020 756e 7374 796c 6528 7374 7228 7265    unstyle(str(re
+00006370: 706f 7274 2929 2c0a 2020 2020 2020 2020  port)),.        
+00006380: 2020 2020 2020 2020 2232 2066 696c 6573          "2 files
+00006390: 2077 6f75 6c64 2062 6520 7265 666f 726d   would be reform
+000063a0: 6174 7465 642c 2033 2066 696c 6573 2077  atted, 3 files w
+000063b0: 6f75 6c64 2062 6520 6c65 6674 2075 6e63  ould be left unc
+000063c0: 6861 6e67 6564 2c20 3222 0a20 2020 2020  hanged, 2".     
+000063d0: 2020 2020 2020 2020 2020 2022 2066 696c             " fil
+000063e0: 6573 2077 6f75 6c64 2066 6169 6c20 746f  es would fail to
+000063f0: 2072 6566 6f72 6d61 742e 222c 0a20 2020   reformat.",.   
+00006400: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
+00006410: 6465 6620 7465 7374 5f72 6570 6f72 745f  def test_report_
+00006420: 7175 6965 7428 7365 6c66 2920 2d3e 204e  quiet(self) -> N
+00006430: 6f6e 653a 0a20 2020 2020 2020 2072 6570  one:.        rep
+00006440: 6f72 7420 3d20 5265 706f 7274 2871 7569  ort = Report(qui
+00006450: 6574 3d54 7275 6529 0a20 2020 2020 2020  et=True).       
+00006460: 206f 7574 5f6c 696e 6573 203d 205b 5d0a   out_lines = [].
+00006470: 2020 2020 2020 2020 6572 725f 6c69 6e65          err_line
+00006480: 7320 3d20 5b5d 0a0a 2020 2020 2020 2020  s = []..        
+00006490: 6465 6620 6f75 7428 6d73 673a 2073 7472  def out(msg: str
+000064a0: 2c20 2a2a 6b77 6172 6773 3a20 416e 7929  , **kwargs: Any)
+000064b0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
+000064c0: 2020 2020 2020 6f75 745f 6c69 6e65 732e        out_lines.
+000064d0: 6170 7065 6e64 286d 7367 290a 0a20 2020  append(msg)..   
+000064e0: 2020 2020 2064 6566 2065 7272 286d 7367       def err(msg
+000064f0: 3a20 7374 722c 202a 2a6b 7761 7267 733a  : str, **kwargs:
+00006500: 2041 6e79 2920 2d3e 204e 6f6e 653a 0a20   Any) -> None:. 
+00006510: 2020 2020 2020 2020 2020 2065 7272 5f6c             err_l
+00006520: 696e 6573 2e61 7070 656e 6428 6d73 6729  ines.append(msg)
+00006530: 0a0a 2020 2020 2020 2020 7769 7468 2070  ..        with p
+00006540: 6174 6368 2822 6365 7263 6973 2e6f 7574  atch("cercis.out
+00006550: 7075 742e 5f6f 7574 222c 206f 7574 292c  put._out", out),
+00006560: 2070 6174 6368 2822 6365 7263 6973 2e6f   patch("cercis.o
+00006570: 7574 7075 742e 5f65 7272 222c 2065 7272  utput._err", err
+00006580: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
+00006590: 6570 6f72 742e 646f 6e65 2850 6174 6828  eport.done(Path(
+000065a0: 2266 3122 292c 2063 6572 6369 732e 4368  "f1"), cercis.Ch
+000065b0: 616e 6765 642e 4e4f 290a 2020 2020 2020  anged.NO).      
+000065c0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+000065d0: 7445 7175 616c 286c 656e 286f 7574 5f6c  tEqual(len(out_l
+000065e0: 696e 6573 292c 2030 290a 2020 2020 2020  ines), 0).      
+000065f0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00006600: 7445 7175 616c 286c 656e 2865 7272 5f6c  tEqual(len(err_l
+00006610: 696e 6573 292c 2030 290a 2020 2020 2020  ines), 0).      
+00006620: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00006630: 7445 7175 616c 2875 6e73 7479 6c65 2873  tEqual(unstyle(s
+00006640: 7472 2872 6570 6f72 7429 292c 2022 3120  tr(report)), "1 
+00006650: 6669 6c65 206c 6566 7420 756e 6368 616e  file left unchan
+00006660: 6765 642e 2229 0a20 2020 2020 2020 2020  ged.").         
+00006670: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+00006680: 7561 6c28 7265 706f 7274 2e72 6574 7572  ual(report.retur
+00006690: 6e5f 636f 6465 2c20 3029 0a20 2020 2020  n_code, 0).     
+000066a0: 2020 2020 2020 2072 6570 6f72 742e 646f         report.do
+000066b0: 6e65 2850 6174 6828 2266 3222 292c 2063  ne(Path("f2"), c
+000066c0: 6572 6369 732e 4368 616e 6765 642e 5945  ercis.Changed.YE
+000066d0: 5329 0a20 2020 2020 2020 2020 2020 2073  S).            s
+000066e0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+000066f0: 6c65 6e28 6f75 745f 6c69 6e65 7329 2c20  len(out_lines), 
+00006700: 3029 0a20 2020 2020 2020 2020 2020 2073  0).            s
+00006710: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+00006720: 6c65 6e28 6572 725f 6c69 6e65 7329 2c20  len(err_lines), 
+00006730: 3029 0a20 2020 2020 2020 2020 2020 2073  0).            s
+00006740: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+00006750: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00006760: 2075 6e73 7479 6c65 2873 7472 2872 6570   unstyle(str(rep
+00006770: 6f72 7429 292c 2022 3120 6669 6c65 2072  ort)), "1 file r
+00006780: 6566 6f72 6d61 7474 6564 2c20 3120 6669  eformatted, 1 fi
+00006790: 6c65 206c 6566 7420 756e 6368 616e 6765  le left unchange
+000067a0: 642e 220a 2020 2020 2020 2020 2020 2020  d.".            
+000067b0: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
+000067c0: 706f 7274 2e64 6f6e 6528 5061 7468 2822  port.done(Path("
+000067d0: 6633 2229 2c20 6365 7263 6973 2e43 6861  f3"), cercis.Cha
+000067e0: 6e67 6564 2e43 4143 4845 4429 0a20 2020  nged.CACHED).   
+000067f0: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
+00006800: 7365 7274 4571 7561 6c28 6c65 6e28 6f75  sertEqual(len(ou
+00006810: 745f 6c69 6e65 7329 2c20 3029 0a20 2020  t_lines), 0).   
+00006820: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
+00006830: 7365 7274 4571 7561 6c28 6c65 6e28 6572  sertEqual(len(er
+00006840: 725f 6c69 6e65 7329 2c20 3029 0a20 2020  r_lines), 0).   
+00006850: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
+00006860: 7365 7274 4571 7561 6c28 0a20 2020 2020  sertEqual(.     
+00006870: 2020 2020 2020 2020 2020 2075 6e73 7479             unsty
+00006880: 6c65 2873 7472 2872 6570 6f72 7429 292c  le(str(report)),
+00006890: 2022 3120 6669 6c65 2072 6566 6f72 6d61   "1 file reforma
+000068a0: 7474 6564 2c20 3220 6669 6c65 7320 6c65  tted, 2 files le
+000068b0: 6674 2075 6e63 6861 6e67 6564 2e22 0a20  ft unchanged.". 
+000068c0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+000068d0: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
+000068e0: 7365 7274 4571 7561 6c28 7265 706f 7274  sertEqual(report
+000068f0: 2e72 6574 7572 6e5f 636f 6465 2c20 3029  .return_code, 0)
+00006900: 0a20 2020 2020 2020 2020 2020 2072 6570  .            rep
+00006910: 6f72 742e 6368 6563 6b20 3d20 5472 7565  ort.check = True
+00006920: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00006930: 662e 6173 7365 7274 4571 7561 6c28 7265  f.assertEqual(re
+00006940: 706f 7274 2e72 6574 7572 6e5f 636f 6465  port.return_code
+00006950: 2c20 3129 0a20 2020 2020 2020 2020 2020  , 1).           
+00006960: 2072 6570 6f72 742e 6368 6563 6b20 3d20   report.check = 
+00006970: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
+00006980: 2020 7265 706f 7274 2e66 6169 6c65 6428    report.failed(
+00006990: 5061 7468 2822 6531 2229 2c20 2262 6f6f  Path("e1"), "boo
+000069a0: 6d22 290a 2020 2020 2020 2020 2020 2020  m").            
+000069b0: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+000069c0: 286c 656e 286f 7574 5f6c 696e 6573 292c  (len(out_lines),
+000069d0: 2030 290a 2020 2020 2020 2020 2020 2020   0).            
+000069e0: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+000069f0: 286c 656e 2865 7272 5f6c 696e 6573 292c  (len(err_lines),
+00006a00: 2031 290a 2020 2020 2020 2020 2020 2020   1).            
+00006a10: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+00006a20: 2865 7272 5f6c 696e 6573 5b2d 315d 2c20  (err_lines[-1], 
+00006a30: 2265 7272 6f72 3a20 6361 6e6e 6f74 2066  "error: cannot f
+00006a40: 6f72 6d61 7420 6531 3a20 626f 6f6d 2229  ormat e1: boom")
+00006a50: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00006a60: 662e 6173 7365 7274 4571 7561 6c28 0a20  f.assertEqual(. 
+00006a70: 2020 2020 2020 2020 2020 2020 2020 2075                 u
+00006a80: 6e73 7479 6c65 2873 7472 2872 6570 6f72  nstyle(str(repor
+00006a90: 7429 292c 0a20 2020 2020 2020 2020 2020  t)),.           
+00006aa0: 2020 2020 2022 3120 6669 6c65 2072 6566       "1 file ref
+00006ab0: 6f72 6d61 7474 6564 2c20 3220 6669 6c65  ormatted, 2 file
+00006ac0: 7320 6c65 6674 2075 6e63 6861 6e67 6564  s left unchanged
+00006ad0: 2c20 3120 6669 6c65 2066 6169 6c65 6420  , 1 file failed 
+00006ae0: 746f 220a 2020 2020 2020 2020 2020 2020  to".            
+00006af0: 2020 2020 2220 7265 666f 726d 6174 2e22      " reformat."
+00006b00: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
+00006b10: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00006b20: 2e61 7373 6572 7445 7175 616c 2872 6570  .assertEqual(rep
+00006b30: 6f72 742e 7265 7475 726e 5f63 6f64 652c  ort.return_code,
+00006b40: 2031 3233 290a 2020 2020 2020 2020 2020   123).          
+00006b50: 2020 7265 706f 7274 2e64 6f6e 6528 5061    report.done(Pa
+00006b60: 7468 2822 6633 2229 2c20 6365 7263 6973  th("f3"), cercis
+00006b70: 2e43 6861 6e67 6564 2e59 4553 290a 2020  .Changed.YES).  
+00006b80: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+00006b90: 7373 6572 7445 7175 616c 286c 656e 286f  ssertEqual(len(o
+00006ba0: 7574 5f6c 696e 6573 292c 2030 290a 2020  ut_lines), 0).  
+00006bb0: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+00006bc0: 7373 6572 7445 7175 616c 286c 656e 2865  ssertEqual(len(e
+00006bd0: 7272 5f6c 696e 6573 292c 2031 290a 2020  rr_lines), 1).  
+00006be0: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+00006bf0: 7373 6572 7445 7175 616c 280a 2020 2020  ssertEqual(.    
+00006c00: 2020 2020 2020 2020 2020 2020 756e 7374              unst
+00006c10: 796c 6528 7374 7228 7265 706f 7274 2929  yle(str(report))
+00006c20: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00006c30: 2020 2232 2066 696c 6573 2072 6566 6f72    "2 files refor
+00006c40: 6d61 7474 6564 2c20 3220 6669 6c65 7320  matted, 2 files 
+00006c50: 6c65 6674 2075 6e63 6861 6e67 6564 2c20  left unchanged, 
+00006c60: 3120 6669 6c65 2066 6169 6c65 6420 746f  1 file failed to
+00006c70: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00006c80: 2020 2220 7265 666f 726d 6174 2e22 2c0a    " reformat.",.
+00006c90: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00006ca0: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+00006cb0: 7373 6572 7445 7175 616c 2872 6570 6f72  ssertEqual(repor
+00006cc0: 742e 7265 7475 726e 5f63 6f64 652c 2031  t.return_code, 1
+00006cd0: 3233 290a 2020 2020 2020 2020 2020 2020  23).            
+00006ce0: 7265 706f 7274 2e66 6169 6c65 6428 5061  report.failed(Pa
+00006cf0: 7468 2822 6532 2229 2c20 2262 6f6f 6d22  th("e2"), "boom"
+00006d00: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+00006d10: 6c66 2e61 7373 6572 7445 7175 616c 286c  lf.assertEqual(l
+00006d20: 656e 286f 7574 5f6c 696e 6573 292c 2030  en(out_lines), 0
+00006d30: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+00006d40: 6c66 2e61 7373 6572 7445 7175 616c 286c  lf.assertEqual(l
+00006d50: 656e 2865 7272 5f6c 696e 6573 292c 2032  en(err_lines), 2
+00006d60: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+00006d70: 6c66 2e61 7373 6572 7445 7175 616c 2865  lf.assertEqual(e
+00006d80: 7272 5f6c 696e 6573 5b2d 315d 2c20 2265  rr_lines[-1], "e
+00006d90: 7272 6f72 3a20 6361 6e6e 6f74 2066 6f72  rror: cannot for
+00006da0: 6d61 7420 6532 3a20 626f 6f6d 2229 0a20  mat e2: boom"). 
+00006db0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00006dc0: 6173 7365 7274 4571 7561 6c28 0a20 2020  assertEqual(.   
+00006dd0: 2020 2020 2020 2020 2020 2020 2075 6e73               uns
+00006de0: 7479 6c65 2873 7472 2872 6570 6f72 7429  tyle(str(report)
+00006df0: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+00006e00: 2020 2022 3220 6669 6c65 7320 7265 666f     "2 files refo
+00006e10: 726d 6174 7465 642c 2032 2066 696c 6573  rmatted, 2 files
+00006e20: 206c 6566 7420 756e 6368 616e 6765 642c   left unchanged,
+00006e30: 2032 2066 696c 6573 2066 6169 6c65 6420   2 files failed 
+00006e40: 746f 220a 2020 2020 2020 2020 2020 2020  to".            
+00006e50: 2020 2020 2220 7265 666f 726d 6174 2e22      " reformat."
+00006e60: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
+00006e70: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00006e80: 2e61 7373 6572 7445 7175 616c 2872 6570  .assertEqual(rep
+00006e90: 6f72 742e 7265 7475 726e 5f63 6f64 652c  ort.return_code,
+00006ea0: 2031 3233 290a 2020 2020 2020 2020 2020   123).          
+00006eb0: 2020 7265 706f 7274 2e70 6174 685f 6967    report.path_ig
+00006ec0: 6e6f 7265 6428 5061 7468 2822 7761 7422  nored(Path("wat"
+00006ed0: 292c 2022 6e6f 206d 6174 6368 2229 0a20  ), "no match"). 
+00006ee0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00006ef0: 6173 7365 7274 4571 7561 6c28 6c65 6e28  assertEqual(len(
+00006f00: 6f75 745f 6c69 6e65 7329 2c20 3029 0a20  out_lines), 0). 
+00006f10: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00006f20: 6173 7365 7274 4571 7561 6c28 6c65 6e28  assertEqual(len(
+00006f30: 6572 725f 6c69 6e65 7329 2c20 3229 0a20  err_lines), 2). 
+00006f40: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00006f50: 6173 7365 7274 4571 7561 6c28 0a20 2020  assertEqual(.   
+00006f60: 2020 2020 2020 2020 2020 2020 2075 6e73               uns
+00006f70: 7479 6c65 2873 7472 2872 6570 6f72 7429  tyle(str(report)
+00006f80: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+00006f90: 2020 2022 3220 6669 6c65 7320 7265 666f     "2 files refo
+00006fa0: 726d 6174 7465 642c 2032 2066 696c 6573  rmatted, 2 files
+00006fb0: 206c 6566 7420 756e 6368 616e 6765 642c   left unchanged,
+00006fc0: 2032 2066 696c 6573 2066 6169 6c65 6420   2 files failed 
+00006fd0: 746f 220a 2020 2020 2020 2020 2020 2020  to".            
+00006fe0: 2020 2020 2220 7265 666f 726d 6174 2e22      " reformat."
+00006ff0: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
+00007000: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00007010: 2e61 7373 6572 7445 7175 616c 2872 6570  .assertEqual(rep
+00007020: 6f72 742e 7265 7475 726e 5f63 6f64 652c  ort.return_code,
+00007030: 2031 3233 290a 2020 2020 2020 2020 2020   123).          
+00007040: 2020 7265 706f 7274 2e64 6f6e 6528 5061    report.done(Pa
+00007050: 7468 2822 6634 2229 2c20 6365 7263 6973  th("f4"), cercis
+00007060: 2e43 6861 6e67 6564 2e4e 4f29 0a20 2020  .Changed.NO).   
+00007070: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
+00007080: 7365 7274 4571 7561 6c28 6c65 6e28 6f75  sertEqual(len(ou
+00007090: 745f 6c69 6e65 7329 2c20 3029 0a20 2020  t_lines), 0).   
 000070a0: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
-000070b0: 7365 7274 4571 7561 6c28 0a20 2020 2020  sertEqual(.     
-000070c0: 2020 2020 2020 2020 2020 2075 6e73 7479             unsty
-000070d0: 6c65 2873 7472 2872 6570 6f72 7429 292c  le(str(report)),
-000070e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000070f0: 2022 3220 6669 6c65 7320 776f 756c 6420   "2 files would 
-00007100: 6265 2072 6566 6f72 6d61 7474 6564 2c20  be reformatted, 
-00007110: 3320 6669 6c65 7320 776f 756c 6420 6265  3 files would be
-00007120: 206c 6566 7420 756e 6368 616e 6765 642c   left unchanged,
-00007130: 2032 220a 2020 2020 2020 2020 2020 2020   2".            
-00007140: 2020 2020 2220 6669 6c65 7320 776f 756c      " files woul
-00007150: 6420 6661 696c 2074 6f20 7265 666f 726d  d fail to reform
-00007160: 6174 2e22 2c0a 2020 2020 2020 2020 2020  at.",.          
-00007170: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-00007180: 7265 706f 7274 2e63 6865 636b 203d 2046  report.check = F
-00007190: 616c 7365 0a20 2020 2020 2020 2020 2020  alse.           
-000071a0: 2072 6570 6f72 742e 6469 6666 203d 2054   report.diff = T
-000071b0: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
-000071c0: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-000071d0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-000071e0: 2020 756e 7374 796c 6528 7374 7228 7265    unstyle(str(re
-000071f0: 706f 7274 2929 2c0a 2020 2020 2020 2020  port)),.        
-00007200: 2020 2020 2020 2020 2232 2066 696c 6573          "2 files
-00007210: 2077 6f75 6c64 2062 6520 7265 666f 726d   would be reform
-00007220: 6174 7465 642c 2033 2066 696c 6573 2077  atted, 3 files w
-00007230: 6f75 6c64 2062 6520 6c65 6674 2075 6e63  ould be left unc
-00007240: 6861 6e67 6564 2c20 3222 0a20 2020 2020  hanged, 2".     
-00007250: 2020 2020 2020 2020 2020 2022 2066 696c             " fil
-00007260: 6573 2077 6f75 6c64 2066 6169 6c20 746f  es would fail to
-00007270: 2072 6566 6f72 6d61 742e 222c 0a20 2020   reformat.",.   
-00007280: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
-00007290: 6465 6620 7465 7374 5f72 6570 6f72 745f  def test_report_
-000072a0: 6e6f 726d 616c 2873 656c 6629 202d 3e20  normal(self) -> 
-000072b0: 4e6f 6e65 3a0a 2020 2020 2020 2020 7265  None:.        re
-000072c0: 706f 7274 203d 2063 6572 6369 732e 5265  port = cercis.Re
-000072d0: 706f 7274 2829 0a20 2020 2020 2020 206f  port().        o
-000072e0: 7574 5f6c 696e 6573 203d 205b 5d0a 2020  ut_lines = [].  
-000072f0: 2020 2020 2020 6572 725f 6c69 6e65 7320        err_lines 
-00007300: 3d20 5b5d 0a0a 2020 2020 2020 2020 6465  = []..        de
-00007310: 6620 6f75 7428 6d73 673a 2073 7472 2c20  f out(msg: str, 
-00007320: 2a2a 6b77 6172 6773 3a20 416e 7929 202d  **kwargs: Any) -
-00007330: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-00007340: 2020 2020 6f75 745f 6c69 6e65 732e 6170      out_lines.ap
-00007350: 7065 6e64 286d 7367 290a 0a20 2020 2020  pend(msg)..     
-00007360: 2020 2064 6566 2065 7272 286d 7367 3a20     def err(msg: 
-00007370: 7374 722c 202a 2a6b 7761 7267 733a 2041  str, **kwargs: A
-00007380: 6e79 2920 2d3e 204e 6f6e 653a 0a20 2020  ny) -> None:.   
-00007390: 2020 2020 2020 2020 2065 7272 5f6c 696e           err_lin
-000073a0: 6573 2e61 7070 656e 6428 6d73 6729 0a0a  es.append(msg)..
-000073b0: 2020 2020 2020 2020 7769 7468 2070 6174          with pat
-000073c0: 6368 2822 6365 7263 6973 2e6f 7574 7075  ch("cercis.outpu
-000073d0: 742e 5f6f 7574 222c 206f 7574 292c 2070  t._out", out), p
-000073e0: 6174 6368 2822 6365 7263 6973 2e6f 7574  atch("cercis.out
-000073f0: 7075 742e 5f65 7272 222c 2065 7272 293a  put._err", err):
-00007400: 0a20 2020 2020 2020 2020 2020 2072 6570  .            rep
-00007410: 6f72 742e 646f 6e65 2850 6174 6828 2266  ort.done(Path("f
-00007420: 3122 292c 2063 6572 6369 732e 4368 616e  1"), cercis.Chan
-00007430: 6765 642e 4e4f 290a 2020 2020 2020 2020  ged.NO).        
-00007440: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00007450: 7175 616c 286c 656e 286f 7574 5f6c 696e  qual(len(out_lin
-00007460: 6573 292c 2030 290a 2020 2020 2020 2020  es), 0).        
-00007470: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00007480: 7175 616c 286c 656e 2865 7272 5f6c 696e  qual(len(err_lin
-00007490: 6573 292c 2030 290a 2020 2020 2020 2020  es), 0).        
-000074a0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-000074b0: 7175 616c 2875 6e73 7479 6c65 2873 7472  qual(unstyle(str
-000074c0: 2872 6570 6f72 7429 292c 2022 3120 6669  (report)), "1 fi
-000074d0: 6c65 206c 6566 7420 756e 6368 616e 6765  le left unchange
-000074e0: 642e 2229 0a20 2020 2020 2020 2020 2020  d.").           
-000074f0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00007500: 6c28 7265 706f 7274 2e72 6574 7572 6e5f  l(report.return_
-00007510: 636f 6465 2c20 3029 0a20 2020 2020 2020  code, 0).       
-00007520: 2020 2020 2072 6570 6f72 742e 646f 6e65       report.done
-00007530: 2850 6174 6828 2266 3222 292c 2063 6572  (Path("f2"), cer
-00007540: 6369 732e 4368 616e 6765 642e 5945 5329  cis.Changed.YES)
-00007550: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00007560: 662e 6173 7365 7274 4571 7561 6c28 6c65  f.assertEqual(le
-00007570: 6e28 6f75 745f 6c69 6e65 7329 2c20 3129  n(out_lines), 1)
-00007580: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00007590: 662e 6173 7365 7274 4571 7561 6c28 6c65  f.assertEqual(le
-000075a0: 6e28 6572 725f 6c69 6e65 7329 2c20 3029  n(err_lines), 0)
-000075b0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-000075c0: 662e 6173 7365 7274 4571 7561 6c28 6f75  f.assertEqual(ou
-000075d0: 745f 6c69 6e65 735b 2d31 5d2c 2022 7265  t_lines[-1], "re
-000075e0: 666f 726d 6174 7465 6420 6632 2229 0a20  formatted f2"). 
-000075f0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00007600: 6173 7365 7274 4571 7561 6c28 0a20 2020  assertEqual(.   
-00007610: 2020 2020 2020 2020 2020 2020 2075 6e73               uns
-00007620: 7479 6c65 2873 7472 2872 6570 6f72 7429  tyle(str(report)
-00007630: 292c 2022 3120 6669 6c65 2072 6566 6f72  ), "1 file refor
-00007640: 6d61 7474 6564 2c20 3120 6669 6c65 206c  matted, 1 file l
-00007650: 6566 7420 756e 6368 616e 6765 642e 220a  eft unchanged.".
-00007660: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-00007670: 2020 2020 2020 2020 2020 7265 706f 7274            report
-00007680: 2e64 6f6e 6528 5061 7468 2822 6633 2229  .done(Path("f3")
-00007690: 2c20 6365 7263 6973 2e43 6861 6e67 6564  , cercis.Changed
-000076a0: 2e43 4143 4845 4429 0a20 2020 2020 2020  .CACHED).       
-000076b0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-000076c0: 4571 7561 6c28 6c65 6e28 6f75 745f 6c69  Equal(len(out_li
-000076d0: 6e65 7329 2c20 3129 0a20 2020 2020 2020  nes), 1).       
-000076e0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-000076f0: 4571 7561 6c28 6c65 6e28 6572 725f 6c69  Equal(len(err_li
-00007700: 6e65 7329 2c20 3029 0a20 2020 2020 2020  nes), 0).       
-00007710: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00007720: 4571 7561 6c28 6f75 745f 6c69 6e65 735b  Equal(out_lines[
-00007730: 2d31 5d2c 2022 7265 666f 726d 6174 7465  -1], "reformatte
-00007740: 6420 6632 2229 0a20 2020 2020 2020 2020  d f2").         
-00007750: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-00007760: 7561 6c28 0a20 2020 2020 2020 2020 2020  ual(.           
-00007770: 2020 2020 2075 6e73 7479 6c65 2873 7472       unstyle(str
-00007780: 2872 6570 6f72 7429 292c 2022 3120 6669  (report)), "1 fi
-00007790: 6c65 2072 6566 6f72 6d61 7474 6564 2c20  le reformatted, 
-000077a0: 3220 6669 6c65 7320 6c65 6674 2075 6e63  2 files left unc
-000077b0: 6861 6e67 6564 2e22 0a20 2020 2020 2020  hanged.".       
-000077c0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-000077d0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-000077e0: 7561 6c28 7265 706f 7274 2e72 6574 7572  ual(report.retur
-000077f0: 6e5f 636f 6465 2c20 3029 0a20 2020 2020  n_code, 0).     
-00007800: 2020 2020 2020 2072 6570 6f72 742e 6368         report.ch
-00007810: 6563 6b20 3d20 5472 7565 0a20 2020 2020  eck = True.     
-00007820: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00007830: 7274 4571 7561 6c28 7265 706f 7274 2e72  rtEqual(report.r
-00007840: 6574 7572 6e5f 636f 6465 2c20 3129 0a20  eturn_code, 1). 
-00007850: 2020 2020 2020 2020 2020 2072 6570 6f72             repor
-00007860: 742e 6368 6563 6b20 3d20 4661 6c73 650a  t.check = False.
-00007870: 2020 2020 2020 2020 2020 2020 7265 706f              repo
-00007880: 7274 2e66 6169 6c65 6428 5061 7468 2822  rt.failed(Path("
-00007890: 6531 2229 2c20 2262 6f6f 6d22 290a 2020  e1"), "boom").  
-000078a0: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-000078b0: 7373 6572 7445 7175 616c 286c 656e 286f  ssertEqual(len(o
-000078c0: 7574 5f6c 696e 6573 292c 2031 290a 2020  ut_lines), 1).  
-000078d0: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-000078e0: 7373 6572 7445 7175 616c 286c 656e 2865  ssertEqual(len(e
-000078f0: 7272 5f6c 696e 6573 292c 2031 290a 2020  rr_lines), 1).  
-00007900: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-00007910: 7373 6572 7445 7175 616c 2865 7272 5f6c  ssertEqual(err_l
-00007920: 696e 6573 5b2d 315d 2c20 2265 7272 6f72  ines[-1], "error
-00007930: 3a20 6361 6e6e 6f74 2066 6f72 6d61 7420  : cannot format 
-00007940: 6531 3a20 626f 6f6d 2229 0a20 2020 2020  e1: boom").     
-00007950: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00007960: 7274 4571 7561 6c28 0a20 2020 2020 2020  rtEqual(.       
-00007970: 2020 2020 2020 2020 2075 6e73 7479 6c65           unstyle
-00007980: 2873 7472 2872 6570 6f72 7429 292c 0a20  (str(report)),. 
-00007990: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-000079a0: 3120 6669 6c65 2072 6566 6f72 6d61 7474  1 file reformatt
-000079b0: 6564 2c20 3220 6669 6c65 7320 6c65 6674  ed, 2 files left
-000079c0: 2075 6e63 6861 6e67 6564 2c20 3120 6669   unchanged, 1 fi
-000079d0: 6c65 2066 6169 6c65 6420 746f 220a 2020  le failed to".  
-000079e0: 2020 2020 2020 2020 2020 2020 2020 2220                " 
-000079f0: 7265 666f 726d 6174 2e22 2c0a 2020 2020  reformat.",.    
-00007a00: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00007a10: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00007a20: 7445 7175 616c 2872 6570 6f72 742e 7265  tEqual(report.re
-00007a30: 7475 726e 5f63 6f64 652c 2031 3233 290a  turn_code, 123).
-00007a40: 2020 2020 2020 2020 2020 2020 7265 706f              repo
-00007a50: 7274 2e64 6f6e 6528 5061 7468 2822 6633  rt.done(Path("f3
-00007a60: 2229 2c20 6365 7263 6973 2e43 6861 6e67  "), cercis.Chang
-00007a70: 6564 2e59 4553 290a 2020 2020 2020 2020  ed.YES).        
-00007a80: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00007a90: 7175 616c 286c 656e 286f 7574 5f6c 696e  qual(len(out_lin
-00007aa0: 6573 292c 2032 290a 2020 2020 2020 2020  es), 2).        
-00007ab0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00007ac0: 7175 616c 286c 656e 2865 7272 5f6c 696e  qual(len(err_lin
-00007ad0: 6573 292c 2031 290a 2020 2020 2020 2020  es), 1).        
-00007ae0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00007af0: 7175 616c 286f 7574 5f6c 696e 6573 5b2d  qual(out_lines[-
-00007b00: 315d 2c20 2272 6566 6f72 6d61 7474 6564  1], "reformatted
-00007b10: 2066 3322 290a 2020 2020 2020 2020 2020   f3").          
-00007b20: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00007b30: 616c 280a 2020 2020 2020 2020 2020 2020  al(.            
-00007b40: 2020 2020 756e 7374 796c 6528 7374 7228      unstyle(str(
-00007b50: 7265 706f 7274 2929 2c0a 2020 2020 2020  report)),.      
-00007b60: 2020 2020 2020 2020 2020 2232 2066 696c            "2 fil
-00007b70: 6573 2072 6566 6f72 6d61 7474 6564 2c20  es reformatted, 
-00007b80: 3220 6669 6c65 7320 6c65 6674 2075 6e63  2 files left unc
-00007b90: 6861 6e67 6564 2c20 3120 6669 6c65 2066  hanged, 1 file f
-00007ba0: 6169 6c65 6420 746f 220a 2020 2020 2020  ailed to".      
-00007bb0: 2020 2020 2020 2020 2020 2220 7265 666f            " refo
-00007bc0: 726d 6174 2e22 2c0a 2020 2020 2020 2020  rmat.",.        
-00007bd0: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-00007be0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00007bf0: 616c 2872 6570 6f72 742e 7265 7475 726e  al(report.return
-00007c00: 5f63 6f64 652c 2031 3233 290a 2020 2020  _code, 123).    
-00007c10: 2020 2020 2020 2020 7265 706f 7274 2e66          report.f
-00007c20: 6169 6c65 6428 5061 7468 2822 6532 2229  ailed(Path("e2")
-00007c30: 2c20 2262 6f6f 6d22 290a 2020 2020 2020  , "boom").      
-00007c40: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00007c50: 7445 7175 616c 286c 656e 286f 7574 5f6c  tEqual(len(out_l
-00007c60: 696e 6573 292c 2032 290a 2020 2020 2020  ines), 2).      
-00007c70: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00007c80: 7445 7175 616c 286c 656e 2865 7272 5f6c  tEqual(len(err_l
-00007c90: 696e 6573 292c 2032 290a 2020 2020 2020  ines), 2).      
-00007ca0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00007cb0: 7445 7175 616c 2865 7272 5f6c 696e 6573  tEqual(err_lines
-00007cc0: 5b2d 315d 2c20 2265 7272 6f72 3a20 6361  [-1], "error: ca
-00007cd0: 6e6e 6f74 2066 6f72 6d61 7420 6532 3a20  nnot format e2: 
-00007ce0: 626f 6f6d 2229 0a20 2020 2020 2020 2020  boom").         
-00007cf0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-00007d00: 7561 6c28 0a20 2020 2020 2020 2020 2020  ual(.           
-00007d10: 2020 2020 2075 6e73 7479 6c65 2873 7472       unstyle(str
-00007d20: 2872 6570 6f72 7429 292c 0a20 2020 2020  (report)),.     
-00007d30: 2020 2020 2020 2020 2020 2022 3220 6669             "2 fi
-00007d40: 6c65 7320 7265 666f 726d 6174 7465 642c  les reformatted,
-00007d50: 2032 2066 696c 6573 206c 6566 7420 756e   2 files left un
-00007d60: 6368 616e 6765 642c 2032 2066 696c 6573  changed, 2 files
-00007d70: 2066 6169 6c65 6420 746f 220a 2020 2020   failed to".    
-00007d80: 2020 2020 2020 2020 2020 2020 2220 7265              " re
-00007d90: 666f 726d 6174 2e22 2c0a 2020 2020 2020  format.",.      
-00007da0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00007db0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00007dc0: 7175 616c 2872 6570 6f72 742e 7265 7475  qual(report.retu
-00007dd0: 726e 5f63 6f64 652c 2031 3233 290a 2020  rn_code, 123).  
-00007de0: 2020 2020 2020 2020 2020 7265 706f 7274            report
-00007df0: 2e70 6174 685f 6967 6e6f 7265 6428 5061  .path_ignored(Pa
-00007e00: 7468 2822 7761 7422 292c 2022 6e6f 206d  th("wat"), "no m
-00007e10: 6174 6368 2229 0a20 2020 2020 2020 2020  atch").         
-00007e20: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-00007e30: 7561 6c28 6c65 6e28 6f75 745f 6c69 6e65  ual(len(out_line
-00007e40: 7329 2c20 3229 0a20 2020 2020 2020 2020  s), 2).         
-00007e50: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-00007e60: 7561 6c28 6c65 6e28 6572 725f 6c69 6e65  ual(len(err_line
-00007e70: 7329 2c20 3229 0a20 2020 2020 2020 2020  s), 2).         
-00007e80: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-00007e90: 7561 6c28 0a20 2020 2020 2020 2020 2020  ual(.           
-00007ea0: 2020 2020 2075 6e73 7479 6c65 2873 7472       unstyle(str
-00007eb0: 2872 6570 6f72 7429 292c 0a20 2020 2020  (report)),.     
-00007ec0: 2020 2020 2020 2020 2020 2022 3220 6669             "2 fi
-00007ed0: 6c65 7320 7265 666f 726d 6174 7465 642c  les reformatted,
-00007ee0: 2032 2066 696c 6573 206c 6566 7420 756e   2 files left un
-00007ef0: 6368 616e 6765 642c 2032 2066 696c 6573  changed, 2 files
-00007f00: 2066 6169 6c65 6420 746f 220a 2020 2020   failed to".    
-00007f10: 2020 2020 2020 2020 2020 2020 2220 7265              " re
-00007f20: 666f 726d 6174 2e22 2c0a 2020 2020 2020  format.",.      
-00007f30: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00007f40: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00007f50: 7175 616c 2872 6570 6f72 742e 7265 7475  qual(report.retu
-00007f60: 726e 5f63 6f64 652c 2031 3233 290a 2020  rn_code, 123).  
-00007f70: 2020 2020 2020 2020 2020 7265 706f 7274            report
-00007f80: 2e64 6f6e 6528 5061 7468 2822 6634 2229  .done(Path("f4")
-00007f90: 2c20 6365 7263 6973 2e43 6861 6e67 6564  , cercis.Changed
-00007fa0: 2e4e 4f29 0a20 2020 2020 2020 2020 2020  .NO).           
-00007fb0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00007fc0: 6c28 6c65 6e28 6f75 745f 6c69 6e65 7329  l(len(out_lines)
-00007fd0: 2c20 3229 0a20 2020 2020 2020 2020 2020  , 2).           
-00007fe0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00007ff0: 6c28 6c65 6e28 6572 725f 6c69 6e65 7329  l(len(err_lines)
-00008000: 2c20 3229 0a20 2020 2020 2020 2020 2020  , 2).           
-00008010: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00008020: 6c28 0a20 2020 2020 2020 2020 2020 2020  l(.             
-00008030: 2020 2075 6e73 7479 6c65 2873 7472 2872     unstyle(str(r
-00008040: 6570 6f72 7429 292c 0a20 2020 2020 2020  eport)),.       
-00008050: 2020 2020 2020 2020 2022 3220 6669 6c65           "2 file
-00008060: 7320 7265 666f 726d 6174 7465 642c 2033  s reformatted, 3
-00008070: 2066 696c 6573 206c 6566 7420 756e 6368   files left unch
-00008080: 616e 6765 642c 2032 2066 696c 6573 2066  anged, 2 files f
-00008090: 6169 6c65 6420 746f 220a 2020 2020 2020  ailed to".      
-000080a0: 2020 2020 2020 2020 2020 2220 7265 666f            " refo
-000080b0: 726d 6174 2e22 2c0a 2020 2020 2020 2020  rmat.",.        
-000080c0: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-000080d0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-000080e0: 616c 2872 6570 6f72 742e 7265 7475 726e  al(report.return
-000080f0: 5f63 6f64 652c 2031 3233 290a 2020 2020  _code, 123).    
-00008100: 2020 2020 2020 2020 7265 706f 7274 2e63          report.c
-00008110: 6865 636b 203d 2054 7275 650a 2020 2020  heck = True.    
+000070b0: 7365 7274 4571 7561 6c28 6c65 6e28 6572  sertEqual(len(er
+000070c0: 725f 6c69 6e65 7329 2c20 3229 0a20 2020  r_lines), 2).   
+000070d0: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
+000070e0: 7365 7274 4571 7561 6c28 0a20 2020 2020  sertEqual(.     
+000070f0: 2020 2020 2020 2020 2020 2075 6e73 7479             unsty
+00007100: 6c65 2873 7472 2872 6570 6f72 7429 292c  le(str(report)),
+00007110: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00007120: 2022 3220 6669 6c65 7320 7265 666f 726d   "2 files reform
+00007130: 6174 7465 642c 2033 2066 696c 6573 206c  atted, 3 files l
+00007140: 6566 7420 756e 6368 616e 6765 642c 2032  eft unchanged, 2
+00007150: 2066 696c 6573 2066 6169 6c65 6420 746f   files failed to
+00007160: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00007170: 2020 2220 7265 666f 726d 6174 2e22 2c0a    " reformat.",.
+00007180: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00007190: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+000071a0: 7373 6572 7445 7175 616c 2872 6570 6f72  ssertEqual(repor
+000071b0: 742e 7265 7475 726e 5f63 6f64 652c 2031  t.return_code, 1
+000071c0: 3233 290a 2020 2020 2020 2020 2020 2020  23).            
+000071d0: 7265 706f 7274 2e63 6865 636b 203d 2054  report.check = T
+000071e0: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
+000071f0: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+00007200: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00007210: 2020 756e 7374 796c 6528 7374 7228 7265    unstyle(str(re
+00007220: 706f 7274 2929 2c0a 2020 2020 2020 2020  port)),.        
+00007230: 2020 2020 2020 2020 2232 2066 696c 6573          "2 files
+00007240: 2077 6f75 6c64 2062 6520 7265 666f 726d   would be reform
+00007250: 6174 7465 642c 2033 2066 696c 6573 2077  atted, 3 files w
+00007260: 6f75 6c64 2062 6520 6c65 6674 2075 6e63  ould be left unc
+00007270: 6861 6e67 6564 2c20 3222 0a20 2020 2020  hanged, 2".     
+00007280: 2020 2020 2020 2020 2020 2022 2066 696c             " fil
+00007290: 6573 2077 6f75 6c64 2066 6169 6c20 746f  es would fail to
+000072a0: 2072 6566 6f72 6d61 742e 222c 0a20 2020   reformat.",.   
+000072b0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+000072c0: 2020 2020 2020 2072 6570 6f72 742e 6368         report.ch
+000072d0: 6563 6b20 3d20 4661 6c73 650a 2020 2020  eck = False.    
+000072e0: 2020 2020 2020 2020 7265 706f 7274 2e64          report.d
+000072f0: 6966 6620 3d20 5472 7565 0a20 2020 2020  iff = True.     
+00007300: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00007310: 7274 4571 7561 6c28 0a20 2020 2020 2020  rtEqual(.       
+00007320: 2020 2020 2020 2020 2075 6e73 7479 6c65           unstyle
+00007330: 2873 7472 2872 6570 6f72 7429 292c 0a20  (str(report)),. 
+00007340: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00007350: 3220 6669 6c65 7320 776f 756c 6420 6265  2 files would be
+00007360: 2072 6566 6f72 6d61 7474 6564 2c20 3320   reformatted, 3 
+00007370: 6669 6c65 7320 776f 756c 6420 6265 206c  files would be l
+00007380: 6566 7420 756e 6368 616e 6765 642c 2032  eft unchanged, 2
+00007390: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+000073a0: 2020 2220 6669 6c65 7320 776f 756c 6420    " files would 
+000073b0: 6661 696c 2074 6f20 7265 666f 726d 6174  fail to reformat
+000073c0: 2e22 2c0a 2020 2020 2020 2020 2020 2020  .",.            
+000073d0: 290a 0a20 2020 2064 6566 2074 6573 745f  )..    def test_
+000073e0: 7265 706f 7274 5f6e 6f72 6d61 6c28 7365  report_normal(se
+000073f0: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
+00007400: 2020 2020 2072 6570 6f72 7420 3d20 6365       report = ce
+00007410: 7263 6973 2e52 6570 6f72 7428 290a 2020  rcis.Report().  
+00007420: 2020 2020 2020 6f75 745f 6c69 6e65 7320        out_lines 
+00007430: 3d20 5b5d 0a20 2020 2020 2020 2065 7272  = [].        err
+00007440: 5f6c 696e 6573 203d 205b 5d0a 0a20 2020  _lines = []..   
+00007450: 2020 2020 2064 6566 206f 7574 286d 7367       def out(msg
+00007460: 3a20 7374 722c 202a 2a6b 7761 7267 733a  : str, **kwargs:
+00007470: 2041 6e79 2920 2d3e 204e 6f6e 653a 0a20   Any) -> None:. 
+00007480: 2020 2020 2020 2020 2020 206f 7574 5f6c             out_l
+00007490: 696e 6573 2e61 7070 656e 6428 6d73 6729  ines.append(msg)
+000074a0: 0a0a 2020 2020 2020 2020 6465 6620 6572  ..        def er
+000074b0: 7228 6d73 673a 2073 7472 2c20 2a2a 6b77  r(msg: str, **kw
+000074c0: 6172 6773 3a20 416e 7929 202d 3e20 4e6f  args: Any) -> No
+000074d0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+000074e0: 6572 725f 6c69 6e65 732e 6170 7065 6e64  err_lines.append
+000074f0: 286d 7367 290a 0a20 2020 2020 2020 2077  (msg)..        w
+00007500: 6974 6820 7061 7463 6828 2263 6572 6369  ith patch("cerci
+00007510: 732e 6f75 7470 7574 2e5f 6f75 7422 2c20  s.output._out", 
+00007520: 6f75 7429 2c20 7061 7463 6828 2263 6572  out), patch("cer
+00007530: 6369 732e 6f75 7470 7574 2e5f 6572 7222  cis.output._err"
+00007540: 2c20 6572 7229 3a0a 2020 2020 2020 2020  , err):.        
+00007550: 2020 2020 7265 706f 7274 2e64 6f6e 6528      report.done(
+00007560: 5061 7468 2822 6631 2229 2c20 6365 7263  Path("f1"), cerc
+00007570: 6973 2e43 6861 6e67 6564 2e4e 4f29 0a20  is.Changed.NO). 
+00007580: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00007590: 6173 7365 7274 4571 7561 6c28 6c65 6e28  assertEqual(len(
+000075a0: 6f75 745f 6c69 6e65 7329 2c20 3029 0a20  out_lines), 0). 
+000075b0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000075c0: 6173 7365 7274 4571 7561 6c28 6c65 6e28  assertEqual(len(
+000075d0: 6572 725f 6c69 6e65 7329 2c20 3029 0a20  err_lines), 0). 
+000075e0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000075f0: 6173 7365 7274 4571 7561 6c28 756e 7374  assertEqual(unst
+00007600: 796c 6528 7374 7228 7265 706f 7274 2929  yle(str(report))
+00007610: 2c20 2231 2066 696c 6520 6c65 6674 2075  , "1 file left u
+00007620: 6e63 6861 6e67 6564 2e22 290a 2020 2020  nchanged.").    
+00007630: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00007640: 6572 7445 7175 616c 2872 6570 6f72 742e  ertEqual(report.
+00007650: 7265 7475 726e 5f63 6f64 652c 2030 290a  return_code, 0).
+00007660: 2020 2020 2020 2020 2020 2020 7265 706f              repo
+00007670: 7274 2e64 6f6e 6528 5061 7468 2822 6632  rt.done(Path("f2
+00007680: 2229 2c20 6365 7263 6973 2e43 6861 6e67  "), cercis.Chang
+00007690: 6564 2e59 4553 290a 2020 2020 2020 2020  ed.YES).        
+000076a0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+000076b0: 7175 616c 286c 656e 286f 7574 5f6c 696e  qual(len(out_lin
+000076c0: 6573 292c 2031 290a 2020 2020 2020 2020  es), 1).        
+000076d0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+000076e0: 7175 616c 286c 656e 2865 7272 5f6c 696e  qual(len(err_lin
+000076f0: 6573 292c 2030 290a 2020 2020 2020 2020  es), 0).        
+00007700: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+00007710: 7175 616c 286f 7574 5f6c 696e 6573 5b2d  qual(out_lines[-
+00007720: 315d 2c20 2272 6566 6f72 6d61 7474 6564  1], "reformatted
+00007730: 2066 3222 290a 2020 2020 2020 2020 2020   f2").          
+00007740: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00007750: 616c 280a 2020 2020 2020 2020 2020 2020  al(.            
+00007760: 2020 2020 756e 7374 796c 6528 7374 7228      unstyle(str(
+00007770: 7265 706f 7274 2929 2c20 2231 2066 696c  report)), "1 fil
+00007780: 6520 7265 666f 726d 6174 7465 642c 2031  e reformatted, 1
+00007790: 2066 696c 6520 6c65 6674 2075 6e63 6861   file left uncha
+000077a0: 6e67 6564 2e22 0a20 2020 2020 2020 2020  nged.".         
+000077b0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+000077c0: 2072 6570 6f72 742e 646f 6e65 2850 6174   report.done(Pat
+000077d0: 6828 2266 3322 292c 2063 6572 6369 732e  h("f3"), cercis.
+000077e0: 4368 616e 6765 642e 4341 4348 4544 290a  Changed.CACHED).
+000077f0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00007800: 2e61 7373 6572 7445 7175 616c 286c 656e  .assertEqual(len
+00007810: 286f 7574 5f6c 696e 6573 292c 2031 290a  (out_lines), 1).
+00007820: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00007830: 2e61 7373 6572 7445 7175 616c 286c 656e  .assertEqual(len
+00007840: 2865 7272 5f6c 696e 6573 292c 2030 290a  (err_lines), 0).
+00007850: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00007860: 2e61 7373 6572 7445 7175 616c 286f 7574  .assertEqual(out
+00007870: 5f6c 696e 6573 5b2d 315d 2c20 2272 6566  _lines[-1], "ref
+00007880: 6f72 6d61 7474 6564 2066 3222 290a 2020  ormatted f2").  
+00007890: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+000078a0: 7373 6572 7445 7175 616c 280a 2020 2020  ssertEqual(.    
+000078b0: 2020 2020 2020 2020 2020 2020 756e 7374              unst
+000078c0: 796c 6528 7374 7228 7265 706f 7274 2929  yle(str(report))
+000078d0: 2c20 2231 2066 696c 6520 7265 666f 726d  , "1 file reform
+000078e0: 6174 7465 642c 2032 2066 696c 6573 206c  atted, 2 files l
+000078f0: 6566 7420 756e 6368 616e 6765 642e 220a  eft unchanged.".
+00007900: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00007910: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+00007920: 7373 6572 7445 7175 616c 2872 6570 6f72  ssertEqual(repor
+00007930: 742e 7265 7475 726e 5f63 6f64 652c 2030  t.return_code, 0
+00007940: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
+00007950: 706f 7274 2e63 6865 636b 203d 2054 7275  port.check = Tru
+00007960: 650a 2020 2020 2020 2020 2020 2020 7365  e.            se
+00007970: 6c66 2e61 7373 6572 7445 7175 616c 2872  lf.assertEqual(r
+00007980: 6570 6f72 742e 7265 7475 726e 5f63 6f64  eport.return_cod
+00007990: 652c 2031 290a 2020 2020 2020 2020 2020  e, 1).          
+000079a0: 2020 7265 706f 7274 2e63 6865 636b 203d    report.check =
+000079b0: 2046 616c 7365 0a20 2020 2020 2020 2020   False.         
+000079c0: 2020 2072 6570 6f72 742e 6661 696c 6564     report.failed
+000079d0: 2850 6174 6828 2265 3122 292c 2022 626f  (Path("e1"), "bo
+000079e0: 6f6d 2229 0a20 2020 2020 2020 2020 2020  om").           
+000079f0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+00007a00: 6c28 6c65 6e28 6f75 745f 6c69 6e65 7329  l(len(out_lines)
+00007a10: 2c20 3129 0a20 2020 2020 2020 2020 2020  , 1).           
+00007a20: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+00007a30: 6c28 6c65 6e28 6572 725f 6c69 6e65 7329  l(len(err_lines)
+00007a40: 2c20 3129 0a20 2020 2020 2020 2020 2020  , 1).           
+00007a50: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+00007a60: 6c28 6572 725f 6c69 6e65 735b 2d31 5d2c  l(err_lines[-1],
+00007a70: 2022 6572 726f 723a 2063 616e 6e6f 7420   "error: cannot 
+00007a80: 666f 726d 6174 2065 313a 2062 6f6f 6d22  format e1: boom"
+00007a90: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+00007aa0: 6c66 2e61 7373 6572 7445 7175 616c 280a  lf.assertEqual(.
+00007ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007ac0: 756e 7374 796c 6528 7374 7228 7265 706f  unstyle(str(repo
+00007ad0: 7274 2929 2c0a 2020 2020 2020 2020 2020  rt)),.          
+00007ae0: 2020 2020 2020 2231 2066 696c 6520 7265        "1 file re
+00007af0: 666f 726d 6174 7465 642c 2032 2066 696c  formatted, 2 fil
+00007b00: 6573 206c 6566 7420 756e 6368 616e 6765  es left unchange
+00007b10: 642c 2031 2066 696c 6520 6661 696c 6564  d, 1 file failed
+00007b20: 2074 6f22 0a20 2020 2020 2020 2020 2020   to".           
+00007b30: 2020 2020 2022 2072 6566 6f72 6d61 742e       " reformat.
+00007b40: 222c 0a20 2020 2020 2020 2020 2020 2029  ",.            )
+00007b50: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00007b60: 662e 6173 7365 7274 4571 7561 6c28 7265  f.assertEqual(re
+00007b70: 706f 7274 2e72 6574 7572 6e5f 636f 6465  port.return_code
+00007b80: 2c20 3132 3329 0a20 2020 2020 2020 2020  , 123).         
+00007b90: 2020 2072 6570 6f72 742e 646f 6e65 2850     report.done(P
+00007ba0: 6174 6828 2266 3322 292c 2063 6572 6369  ath("f3"), cerci
+00007bb0: 732e 4368 616e 6765 642e 5945 5329 0a20  s.Changed.YES). 
+00007bc0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00007bd0: 6173 7365 7274 4571 7561 6c28 6c65 6e28  assertEqual(len(
+00007be0: 6f75 745f 6c69 6e65 7329 2c20 3229 0a20  out_lines), 2). 
+00007bf0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00007c00: 6173 7365 7274 4571 7561 6c28 6c65 6e28  assertEqual(len(
+00007c10: 6572 725f 6c69 6e65 7329 2c20 3129 0a20  err_lines), 1). 
+00007c20: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00007c30: 6173 7365 7274 4571 7561 6c28 6f75 745f  assertEqual(out_
+00007c40: 6c69 6e65 735b 2d31 5d2c 2022 7265 666f  lines[-1], "refo
+00007c50: 726d 6174 7465 6420 6633 2229 0a20 2020  rmatted f3").   
+00007c60: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
+00007c70: 7365 7274 4571 7561 6c28 0a20 2020 2020  sertEqual(.     
+00007c80: 2020 2020 2020 2020 2020 2075 6e73 7479             unsty
+00007c90: 6c65 2873 7472 2872 6570 6f72 7429 292c  le(str(report)),
+00007ca0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00007cb0: 2022 3220 6669 6c65 7320 7265 666f 726d   "2 files reform
+00007cc0: 6174 7465 642c 2032 2066 696c 6573 206c  atted, 2 files l
+00007cd0: 6566 7420 756e 6368 616e 6765 642c 2031  eft unchanged, 1
+00007ce0: 2066 696c 6520 6661 696c 6564 2074 6f22   file failed to"
+00007cf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00007d00: 2022 2072 6566 6f72 6d61 742e 222c 0a20   " reformat.",. 
+00007d10: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+00007d20: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
+00007d30: 7365 7274 4571 7561 6c28 7265 706f 7274  sertEqual(report
+00007d40: 2e72 6574 7572 6e5f 636f 6465 2c20 3132  .return_code, 12
+00007d50: 3329 0a20 2020 2020 2020 2020 2020 2072  3).            r
+00007d60: 6570 6f72 742e 6661 696c 6564 2850 6174  eport.failed(Pat
+00007d70: 6828 2265 3222 292c 2022 626f 6f6d 2229  h("e2"), "boom")
+00007d80: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00007d90: 662e 6173 7365 7274 4571 7561 6c28 6c65  f.assertEqual(le
+00007da0: 6e28 6f75 745f 6c69 6e65 7329 2c20 3229  n(out_lines), 2)
+00007db0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00007dc0: 662e 6173 7365 7274 4571 7561 6c28 6c65  f.assertEqual(le
+00007dd0: 6e28 6572 725f 6c69 6e65 7329 2c20 3229  n(err_lines), 2)
+00007de0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00007df0: 662e 6173 7365 7274 4571 7561 6c28 6572  f.assertEqual(er
+00007e00: 725f 6c69 6e65 735b 2d31 5d2c 2022 6572  r_lines[-1], "er
+00007e10: 726f 723a 2063 616e 6e6f 7420 666f 726d  ror: cannot form
+00007e20: 6174 2065 323a 2062 6f6f 6d22 290a 2020  at e2: boom").  
+00007e30: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+00007e40: 7373 6572 7445 7175 616c 280a 2020 2020  ssertEqual(.    
+00007e50: 2020 2020 2020 2020 2020 2020 756e 7374              unst
+00007e60: 796c 6528 7374 7228 7265 706f 7274 2929  yle(str(report))
+00007e70: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00007e80: 2020 2232 2066 696c 6573 2072 6566 6f72    "2 files refor
+00007e90: 6d61 7474 6564 2c20 3220 6669 6c65 7320  matted, 2 files 
+00007ea0: 6c65 6674 2075 6e63 6861 6e67 6564 2c20  left unchanged, 
+00007eb0: 3220 6669 6c65 7320 6661 696c 6564 2074  2 files failed t
+00007ec0: 6f22 0a20 2020 2020 2020 2020 2020 2020  o".             
+00007ed0: 2020 2022 2072 6566 6f72 6d61 742e 222c     " reformat.",
+00007ee0: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+00007ef0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00007f00: 6173 7365 7274 4571 7561 6c28 7265 706f  assertEqual(repo
+00007f10: 7274 2e72 6574 7572 6e5f 636f 6465 2c20  rt.return_code, 
+00007f20: 3132 3329 0a20 2020 2020 2020 2020 2020  123).           
+00007f30: 2072 6570 6f72 742e 7061 7468 5f69 676e   report.path_ign
+00007f40: 6f72 6564 2850 6174 6828 2277 6174 2229  ored(Path("wat")
+00007f50: 2c20 226e 6f20 6d61 7463 6822 290a 2020  , "no match").  
+00007f60: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+00007f70: 7373 6572 7445 7175 616c 286c 656e 286f  ssertEqual(len(o
+00007f80: 7574 5f6c 696e 6573 292c 2032 290a 2020  ut_lines), 2).  
+00007f90: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+00007fa0: 7373 6572 7445 7175 616c 286c 656e 2865  ssertEqual(len(e
+00007fb0: 7272 5f6c 696e 6573 292c 2032 290a 2020  rr_lines), 2).  
+00007fc0: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+00007fd0: 7373 6572 7445 7175 616c 280a 2020 2020  ssertEqual(.    
+00007fe0: 2020 2020 2020 2020 2020 2020 756e 7374              unst
+00007ff0: 796c 6528 7374 7228 7265 706f 7274 2929  yle(str(report))
+00008000: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00008010: 2020 2232 2066 696c 6573 2072 6566 6f72    "2 files refor
+00008020: 6d61 7474 6564 2c20 3220 6669 6c65 7320  matted, 2 files 
+00008030: 6c65 6674 2075 6e63 6861 6e67 6564 2c20  left unchanged, 
+00008040: 3220 6669 6c65 7320 6661 696c 6564 2074  2 files failed t
+00008050: 6f22 0a20 2020 2020 2020 2020 2020 2020  o".             
+00008060: 2020 2022 2072 6566 6f72 6d61 742e 222c     " reformat.",
+00008070: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+00008080: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00008090: 6173 7365 7274 4571 7561 6c28 7265 706f  assertEqual(repo
+000080a0: 7274 2e72 6574 7572 6e5f 636f 6465 2c20  rt.return_code, 
+000080b0: 3132 3329 0a20 2020 2020 2020 2020 2020  123).           
+000080c0: 2072 6570 6f72 742e 646f 6e65 2850 6174   report.done(Pat
+000080d0: 6828 2266 3422 292c 2063 6572 6369 732e  h("f4"), cercis.
+000080e0: 4368 616e 6765 642e 4e4f 290a 2020 2020  Changed.NO).    
+000080f0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00008100: 6572 7445 7175 616c 286c 656e 286f 7574  ertEqual(len(out
+00008110: 5f6c 696e 6573 292c 2032 290a 2020 2020  _lines), 2).    
 00008120: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00008130: 6572 7445 7175 616c 280a 2020 2020 2020  ertEqual(.      
-00008140: 2020 2020 2020 2020 2020 756e 7374 796c            unstyl
-00008150: 6528 7374 7228 7265 706f 7274 2929 2c0a  e(str(report)),.
-00008160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008170: 2232 2066 696c 6573 2077 6f75 6c64 2062  "2 files would b
-00008180: 6520 7265 666f 726d 6174 7465 642c 2033  e reformatted, 3
-00008190: 2066 696c 6573 2077 6f75 6c64 2062 6520   files would be 
-000081a0: 6c65 6674 2075 6e63 6861 6e67 6564 2c20  left unchanged, 
-000081b0: 3222 0a20 2020 2020 2020 2020 2020 2020  2".             
-000081c0: 2020 2022 2066 696c 6573 2077 6f75 6c64     " files would
-000081d0: 2066 6169 6c20 746f 2072 6566 6f72 6d61   fail to reforma
-000081e0: 742e 222c 0a20 2020 2020 2020 2020 2020  t.",.           
-000081f0: 2029 0a20 2020 2020 2020 2020 2020 2072   ).            r
-00008200: 6570 6f72 742e 6368 6563 6b20 3d20 4661  eport.check = Fa
-00008210: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
-00008220: 7265 706f 7274 2e64 6966 6620 3d20 5472  report.diff = Tr
-00008230: 7565 0a20 2020 2020 2020 2020 2020 2073  ue.            s
-00008240: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-00008250: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008260: 2075 6e73 7479 6c65 2873 7472 2872 6570   unstyle(str(rep
-00008270: 6f72 7429 292c 0a20 2020 2020 2020 2020  ort)),.         
-00008280: 2020 2020 2020 2022 3220 6669 6c65 7320         "2 files 
-00008290: 776f 756c 6420 6265 2072 6566 6f72 6d61  would be reforma
-000082a0: 7474 6564 2c20 3320 6669 6c65 7320 776f  tted, 3 files wo
-000082b0: 756c 6420 6265 206c 6566 7420 756e 6368  uld be left unch
-000082c0: 616e 6765 642c 2032 220a 2020 2020 2020  anged, 2".      
-000082d0: 2020 2020 2020 2020 2020 2220 6669 6c65            " file
-000082e0: 7320 776f 756c 6420 6661 696c 2074 6f20  s would fail to 
-000082f0: 7265 666f 726d 6174 2e22 2c0a 2020 2020  reformat.",.    
-00008300: 2020 2020 2020 2020 290a 0a20 2020 2064          )..    d
-00008310: 6566 2074 6573 745f 6c69 6232 746f 335f  ef test_lib2to3_
-00008320: 7061 7273 6528 7365 6c66 2920 2d3e 204e  parse(self) -> N
-00008330: 6f6e 653a 0a20 2020 2020 2020 2077 6974  one:.        wit
-00008340: 6820 7365 6c66 2e61 7373 6572 7452 6169  h self.assertRai
-00008350: 7365 7328 6365 7263 6973 2e49 6e76 616c  ses(cercis.Inval
-00008360: 6964 496e 7075 7429 3a0a 2020 2020 2020  idInput):.      
-00008370: 2020 2020 2020 6365 7263 6973 2e6c 6962        cercis.lib
-00008380: 3274 6f33 5f70 6172 7365 2822 696e 7661  2to3_parse("inva
-00008390: 6c69 6420 7379 6e74 6178 2229 0a0a 2020  lid syntax")..  
-000083a0: 2020 2020 2020 7374 7261 6464 6c69 6e67        straddling
-000083b0: 203d 2022 7820 2b20 7922 0a20 2020 2020   = "x + y".     
-000083c0: 2020 2063 6572 6369 732e 6c69 6232 746f     cercis.lib2to
-000083d0: 335f 7061 7273 6528 7374 7261 6464 6c69  3_parse(straddli
-000083e0: 6e67 290a 2020 2020 2020 2020 6365 7263  ng).        cerc
-000083f0: 6973 2e6c 6962 3274 6f33 5f70 6172 7365  is.lib2to3_parse
-00008400: 2873 7472 6164 646c 696e 672c 207b 5461  (straddling, {Ta
-00008410: 7267 6574 5665 7273 696f 6e2e 5059 3336  rgetVersion.PY36
-00008420: 7d29 0a0a 2020 2020 2020 2020 7079 325f  })..        py2_
-00008430: 6f6e 6c79 203d 2022 7072 696e 7420 7822  only = "print x"
-00008440: 0a20 2020 2020 2020 2077 6974 6820 7365  .        with se
-00008450: 6c66 2e61 7373 6572 7452 6169 7365 7328  lf.assertRaises(
-00008460: 6365 7263 6973 2e49 6e76 616c 6964 496e  cercis.InvalidIn
-00008470: 7075 7429 3a0a 2020 2020 2020 2020 2020  put):.          
-00008480: 2020 6365 7263 6973 2e6c 6962 3274 6f33    cercis.lib2to3
-00008490: 5f70 6172 7365 2870 7932 5f6f 6e6c 792c  _parse(py2_only,
-000084a0: 207b 5461 7267 6574 5665 7273 696f 6e2e   {TargetVersion.
-000084b0: 5059 3336 7d29 0a0a 2020 2020 2020 2020  PY36})..        
-000084c0: 7079 335f 6f6e 6c79 203d 2022 6578 6563  py3_only = "exec
-000084d0: 2878 2c20 656e 643d 7929 220a 2020 2020  (x, end=y)".    
-000084e0: 2020 2020 6365 7263 6973 2e6c 6962 3274      cercis.lib2t
-000084f0: 6f33 5f70 6172 7365 2870 7933 5f6f 6e6c  o3_parse(py3_onl
-00008500: 7929 0a20 2020 2020 2020 2063 6572 6369  y).        cerci
-00008510: 732e 6c69 6232 746f 335f 7061 7273 6528  s.lib2to3_parse(
-00008520: 7079 335f 6f6e 6c79 2c20 7b54 6172 6765  py3_only, {Targe
-00008530: 7456 6572 7369 6f6e 2e50 5933 367d 290a  tVersion.PY36}).
-00008540: 0a20 2020 2064 6566 2074 6573 745f 6765  .    def test_ge
-00008550: 745f 6665 6174 7572 6573 5f75 7365 645f  t_features_used_
-00008560: 6465 636f 7261 746f 7228 7365 6c66 2920  decorator(self) 
-00008570: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
-00008580: 2023 2054 6573 7420 7468 6520 6665 6174   # Test the feat
-00008590: 7572 6520 6465 7465 6374 696f 6e20 6f66  ure detection of
-000085a0: 206e 6577 2064 6563 6f72 6174 6f72 2073   new decorator s
-000085b0: 796e 7461 780a 2020 2020 2020 2020 2320  yntax.        # 
-000085c0: 7369 6e63 6520 7468 6973 206d 616b 6573  since this makes
-000085d0: 2073 6f6d 6520 7465 7374 2063 6173 6573   some test cases
-000085e0: 206f 6620 7465 7374 5f67 6574 5f66 6561   of test_get_fea
-000085f0: 7475 7265 735f 7573 6564 2829 0a20 2020  tures_used().   
-00008600: 2020 2020 2023 2066 6169 6c73 2069 6620       # fails if 
-00008610: 6974 2066 6169 6c73 2c20 7468 6973 2069  it fails, this i
-00008620: 7320 7465 7374 6564 2066 6972 7374 2073  s tested first s
-00008630: 6f20 7468 6174 2061 2075 7365 6675 6c20  o that a useful 
-00008640: 6361 7365 0a20 2020 2020 2020 2023 2069  case.        # i
-00008650: 7320 6964 656e 7469 6669 6564 0a20 2020  s identified.   
-00008660: 2020 2020 2073 696d 706c 6573 2c20 7265       simples, re
-00008670: 6c61 7865 6420 3d20 7265 6164 5f64 6174  laxed = read_dat
-00008680: 6128 226d 6973 6365 6c6c 616e 656f 7573  a("miscellaneous
-00008690: 222c 2022 6465 636f 7261 746f 7273 2229  ", "decorators")
-000086a0: 0a20 2020 2020 2020 2023 2073 6b69 7020  .        # skip 
-000086b0: 6578 706c 616e 6174 696f 6e20 636f 6d6d  explanation comm
-000086c0: 656e 7473 2061 7420 7468 6520 746f 7020  ents at the top 
-000086d0: 6f66 2074 6865 2066 696c 650a 2020 2020  of the file.    
-000086e0: 2020 2020 666f 7220 7369 6d70 6c65 5f74      for simple_t
-000086f0: 6573 7420 696e 2073 696d 706c 6573 2e73  est in simples.s
-00008700: 706c 6974 2822 2323 2229 5b31 3a5d 3a0a  plit("##")[1:]:.
-00008710: 2020 2020 2020 2020 2020 2020 6e6f 6465              node
-00008720: 203d 2063 6572 6369 732e 6c69 6232 746f   = cercis.lib2to
-00008730: 335f 7061 7273 6528 7369 6d70 6c65 5f74  3_parse(simple_t
-00008740: 6573 7429 0a20 2020 2020 2020 2020 2020  est).           
-00008750: 2064 6563 6f72 6174 6f72 203d 2073 7472   decorator = str
-00008760: 286e 6f64 652e 6368 696c 6472 656e 5b30  (node.children[0
-00008770: 5d2e 6368 696c 6472 656e 5b30 5d29 2e73  ].children[0]).s
-00008780: 7472 6970 2829 0a20 2020 2020 2020 2020  trip().         
-00008790: 2020 2073 656c 662e 6173 7365 7274 4e6f     self.assertNo
-000087a0: 7449 6e28 0a20 2020 2020 2020 2020 2020  tIn(.           
-000087b0: 2020 2020 2046 6561 7475 7265 2e52 454c       Feature.REL
-000087c0: 4158 4544 5f44 4543 4f52 4154 4f52 532c  AXED_DECORATORS,
-000087d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000087e0: 2063 6572 6369 732e 6765 745f 6665 6174   cercis.get_feat
-000087f0: 7572 6573 5f75 7365 6428 6e6f 6465 292c  ures_used(node),
-00008800: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008810: 206d 7367 3d28 0a20 2020 2020 2020 2020   msg=(.         
-00008820: 2020 2020 2020 2020 2020 2066 2264 6563             f"dec
-00008830: 6f72 6174 6f72 2027 7b64 6563 6f72 6174  orator '{decorat
-00008840: 6f72 7d27 2066 6f6c 6c6f 7773 2070 7974  or}' follows pyt
-00008850: 686f 6e3c 3d33 2e38 2073 796e 7461 7822  hon<=3.8 syntax"
-00008860: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008870: 2020 2020 2022 6275 7420 6973 2064 6574       "but is det
-00008880: 6563 7465 6420 6173 2033 2e39 2b22 0a20  ected as 3.9+". 
-00008890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000088a0: 2020 2023 2066 2254 6865 2066 756c 6c20     # f"The full 
-000088b0: 6e6f 6465 2069 735c 6e7b 6e6f 6465 2172  node is\n{node!r
-000088c0: 7d22 0a20 2020 2020 2020 2020 2020 2020  }".             
-000088d0: 2020 2029 2c0a 2020 2020 2020 2020 2020     ),.          
-000088e0: 2020 290a 2020 2020 2020 2020 2320 736b    ).        # sk
-000088f0: 6970 2074 6865 2027 2320 6f75 7470 7574  ip the '# output
-00008900: 2720 636f 6d6d 656e 7420 6174 2074 6865  ' comment at the
-00008910: 2074 6f70 206f 6620 7468 6520 6f75 7470   top of the outp
-00008920: 7574 2070 6172 740a 2020 2020 2020 2020  ut part.        
-00008930: 666f 7220 7265 6c61 7865 645f 7465 7374  for relaxed_test
-00008940: 2069 6e20 7265 6c61 7865 642e 7370 6c69   in relaxed.spli
-00008950: 7428 2223 2322 295b 313a 5d3a 0a20 2020  t("##")[1:]:.   
-00008960: 2020 2020 2020 2020 206e 6f64 6520 3d20           node = 
-00008970: 6365 7263 6973 2e6c 6962 3274 6f33 5f70  cercis.lib2to3_p
-00008980: 6172 7365 2872 656c 6178 6564 5f74 6573  arse(relaxed_tes
-00008990: 7429 0a20 2020 2020 2020 2020 2020 2064  t).            d
-000089a0: 6563 6f72 6174 6f72 203d 2073 7472 286e  ecorator = str(n
-000089b0: 6f64 652e 6368 696c 6472 656e 5b30 5d2e  ode.children[0].
-000089c0: 6368 696c 6472 656e 5b30 5d29 2e73 7472  children[0]).str
-000089d0: 6970 2829 0a20 2020 2020 2020 2020 2020  ip().           
-000089e0: 2073 656c 662e 6173 7365 7274 496e 280a   self.assertIn(.
-000089f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008a00: 4665 6174 7572 652e 5245 4c41 5845 445f  Feature.RELAXED_
-00008a10: 4445 434f 5241 544f 5253 2c0a 2020 2020  DECORATORS,.    
-00008a20: 2020 2020 2020 2020 2020 2020 6365 7263              cerc
-00008a30: 6973 2e67 6574 5f66 6561 7475 7265 735f  is.get_features_
-00008a40: 7573 6564 286e 6f64 6529 2c0a 2020 2020  used(node),.    
-00008a50: 2020 2020 2020 2020 2020 2020 6d73 673d              msg=
-00008a60: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00008a70: 2020 2020 2020 6622 6465 636f 7261 746f        f"decorato
-00008a80: 7220 277b 6465 636f 7261 746f 727d 2720  r '{decorator}' 
-00008a90: 7573 6573 2070 7974 686f 6e33 2e39 2b20  uses python3.9+ 
-00008aa0: 7379 6e74 6178 220a 2020 2020 2020 2020  syntax".        
-00008ab0: 2020 2020 2020 2020 2020 2020 2262 7574              "but
-00008ac0: 2069 7320 6465 7465 6374 6564 2061 7320   is detected as 
-00008ad0: 7079 7468 6f6e 3c3d 332e 3822 0a20 2020  python<=3.8".   
-00008ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008af0: 2023 2066 2254 6865 2066 756c 6c20 6e6f   # f"The full no
-00008b00: 6465 2069 735c 6e7b 6e6f 6465 2172 7d22  de is\n{node!r}"
-00008b10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008b20: 2029 2c0a 2020 2020 2020 2020 2020 2020   ),.            
-00008b30: 290a 0a20 2020 2064 6566 2074 6573 745f  )..    def test_
-00008b40: 6765 745f 6665 6174 7572 6573 5f75 7365  get_features_use
-00008b50: 6428 7365 6c66 2920 2d3e 204e 6f6e 653a  d(self) -> None:
-00008b60: 0a20 2020 2020 2020 206e 6f64 6520 3d20  .        node = 
-00008b70: 6365 7263 6973 2e6c 6962 3274 6f33 5f70  cercis.lib2to3_p
-00008b80: 6172 7365 2822 6465 6620 6628 2a2c 2061  arse("def f(*, a
-00008b90: 7267 293a 202e 2e2e 5c6e 2229 0a20 2020  rg): ...\n").   
-00008ba0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00008bb0: 4571 7561 6c28 6365 7263 6973 2e67 6574  Equal(cercis.get
-00008bc0: 5f66 6561 7475 7265 735f 7573 6564 286e  _features_used(n
-00008bd0: 6f64 6529 2c20 7365 7428 2929 0a20 2020  ode), set()).   
-00008be0: 2020 2020 206e 6f64 6520 3d20 6365 7263       node = cerc
-00008bf0: 6973 2e6c 6962 3274 6f33 5f70 6172 7365  is.lib2to3_parse
-00008c00: 2822 6465 6620 6628 2a2c 2061 7267 2c29  ("def f(*, arg,)
-00008c10: 3a20 2e2e 2e5c 6e22 290a 2020 2020 2020  : ...\n").      
-00008c20: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00008c30: 616c 280a 2020 2020 2020 2020 2020 2020  al(.            
-00008c40: 6365 7263 6973 2e67 6574 5f66 6561 7475  cercis.get_featu
-00008c50: 7265 735f 7573 6564 286e 6f64 6529 2c20  res_used(node), 
-00008c60: 7b46 6561 7475 7265 2e54 5241 494c 494e  {Feature.TRAILIN
-00008c70: 475f 434f 4d4d 415f 494e 5f44 4546 7d0a  G_COMMA_IN_DEF}.
-00008c80: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00008c90: 2020 6e6f 6465 203d 2063 6572 6369 732e    node = cercis.
-00008ca0: 6c69 6232 746f 335f 7061 7273 6528 2266  lib2to3_parse("f
-00008cb0: 282a 6172 672c 295c 6e22 290a 2020 2020  (*arg,)\n").    
-00008cc0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00008cd0: 7175 616c 280a 2020 2020 2020 2020 2020  qual(.          
-00008ce0: 2020 6365 7263 6973 2e67 6574 5f66 6561    cercis.get_fea
-00008cf0: 7475 7265 735f 7573 6564 286e 6f64 6529  tures_used(node)
-00008d00: 2c20 7b46 6561 7475 7265 2e54 5241 494c  , {Feature.TRAIL
-00008d10: 494e 475f 434f 4d4d 415f 494e 5f43 414c  ING_COMMA_IN_CAL
-00008d20: 4c7d 0a20 2020 2020 2020 2029 0a20 2020  L}.        ).   
-00008d30: 2020 2020 206e 6f64 6520 3d20 6365 7263       node = cerc
-00008d40: 6973 2e6c 6962 3274 6f33 5f70 6172 7365  is.lib2to3_parse
-00008d50: 2822 6465 6620 6628 2a2c 2061 7267 293a  ("def f(*, arg):
-00008d60: 2066 2773 7472 696e 6727 5c6e 2229 0a20   f'string'\n"). 
-00008d70: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00008d80: 7274 4571 7561 6c28 6365 7263 6973 2e67  rtEqual(cercis.g
-00008d90: 6574 5f66 6561 7475 7265 735f 7573 6564  et_features_used
-00008da0: 286e 6f64 6529 2c20 7b46 6561 7475 7265  (node), {Feature
-00008db0: 2e46 5f53 5452 494e 4753 7d29 0a20 2020  .F_STRINGS}).   
-00008dc0: 2020 2020 206e 6f64 6520 3d20 6365 7263       node = cerc
-00008dd0: 6973 2e6c 6962 3274 6f33 5f70 6172 7365  is.lib2to3_parse
-00008de0: 2822 3132 335f 3435 365c 6e22 290a 2020  ("123_456\n").  
-00008df0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00008e00: 7445 7175 616c 2863 6572 6369 732e 6765  tEqual(cercis.ge
-00008e10: 745f 6665 6174 7572 6573 5f75 7365 6428  t_features_used(
-00008e20: 6e6f 6465 292c 207b 4665 6174 7572 652e  node), {Feature.
-00008e30: 4e55 4d45 5249 435f 554e 4445 5253 434f  NUMERIC_UNDERSCO
-00008e40: 5245 537d 290a 2020 2020 2020 2020 6e6f  RES}).        no
-00008e50: 6465 203d 2063 6572 6369 732e 6c69 6232  de = cercis.lib2
-00008e60: 746f 335f 7061 7273 6528 2231 3233 3435  to3_parse("12345
-00008e70: 365c 6e22 290a 2020 2020 2020 2020 7365  6\n").        se
-00008e80: 6c66 2e61 7373 6572 7445 7175 616c 2863  lf.assertEqual(c
-00008e90: 6572 6369 732e 6765 745f 6665 6174 7572  ercis.get_featur
-00008ea0: 6573 5f75 7365 6428 6e6f 6465 292c 2073  es_used(node), s
-00008eb0: 6574 2829 290a 2020 2020 2020 2020 736f  et()).        so
-00008ec0: 7572 6365 2c20 6578 7065 6374 6564 203d  urce, expected =
-00008ed0: 2072 6561 645f 6461 7461 2822 7369 6d70   read_data("simp
-00008ee0: 6c65 5f63 6173 6573 222c 2022 6675 6e63  le_cases", "func
-00008ef0: 7469 6f6e 2229 0a20 2020 2020 2020 206e  tion").        n
-00008f00: 6f64 6520 3d20 6365 7263 6973 2e6c 6962  ode = cercis.lib
-00008f10: 3274 6f33 5f70 6172 7365 2873 6f75 7263  2to3_parse(sourc
-00008f20: 6529 0a20 2020 2020 2020 2065 7870 6563  e).        expec
-00008f30: 7465 645f 6665 6174 7572 6573 203d 207b  ted_features = {
-00008f40: 0a20 2020 2020 2020 2020 2020 2046 6561  .            Fea
-00008f50: 7475 7265 2e54 5241 494c 494e 475f 434f  ture.TRAILING_CO
-00008f60: 4d4d 415f 494e 5f43 414c 4c2c 0a20 2020  MMA_IN_CALL,.   
-00008f70: 2020 2020 2020 2020 2046 6561 7475 7265           Feature
-00008f80: 2e54 5241 494c 494e 475f 434f 4d4d 415f  .TRAILING_COMMA_
-00008f90: 494e 5f44 4546 2c0a 2020 2020 2020 2020  IN_DEF,.        
-00008fa0: 2020 2020 4665 6174 7572 652e 465f 5354      Feature.F_ST
-00008fb0: 5249 4e47 532c 0a20 2020 2020 2020 207d  RINGS,.        }
-00008fc0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-00008fd0: 7365 7274 4571 7561 6c28 6365 7263 6973  sertEqual(cercis
-00008fe0: 2e67 6574 5f66 6561 7475 7265 735f 7573  .get_features_us
-00008ff0: 6564 286e 6f64 6529 2c20 6578 7065 6374  ed(node), expect
-00009000: 6564 5f66 6561 7475 7265 7329 0a20 2020  ed_features).   
-00009010: 2020 2020 206e 6f64 6520 3d20 6365 7263       node = cerc
-00009020: 6973 2e6c 6962 3274 6f33 5f70 6172 7365  is.lib2to3_parse
-00009030: 2865 7870 6563 7465 6429 0a20 2020 2020  (expected).     
-00009040: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-00009050: 7561 6c28 6365 7263 6973 2e67 6574 5f66  ual(cercis.get_f
-00009060: 6561 7475 7265 735f 7573 6564 286e 6f64  eatures_used(nod
-00009070: 6529 2c20 6578 7065 6374 6564 5f66 6561  e), expected_fea
-00009080: 7475 7265 7329 0a20 2020 2020 2020 2073  tures).        s
-00009090: 6f75 7263 652c 2065 7870 6563 7465 6420  ource, expected 
-000090a0: 3d20 7265 6164 5f64 6174 6128 2273 696d  = read_data("sim
-000090b0: 706c 655f 6361 7365 7322 2c20 2265 7870  ple_cases", "exp
-000090c0: 7265 7373 696f 6e22 290a 2020 2020 2020  ression").      
-000090d0: 2020 6e6f 6465 203d 2063 6572 6369 732e    node = cercis.
-000090e0: 6c69 6232 746f 335f 7061 7273 6528 736f  lib2to3_parse(so
-000090f0: 7572 6365 290a 2020 2020 2020 2020 7365  urce).        se
-00009100: 6c66 2e61 7373 6572 7445 7175 616c 2863  lf.assertEqual(c
-00009110: 6572 6369 732e 6765 745f 6665 6174 7572  ercis.get_featur
-00009120: 6573 5f75 7365 6428 6e6f 6465 292c 2073  es_used(node), s
-00009130: 6574 2829 290a 2020 2020 2020 2020 6e6f  et()).        no
-00009140: 6465 203d 2063 6572 6369 732e 6c69 6232  de = cercis.lib2
-00009150: 746f 335f 7061 7273 6528 6578 7065 6374  to3_parse(expect
-00009160: 6564 290a 2020 2020 2020 2020 7365 6c66  ed).        self
-00009170: 2e61 7373 6572 7445 7175 616c 2863 6572  .assertEqual(cer
-00009180: 6369 732e 6765 745f 6665 6174 7572 6573  cis.get_features
-00009190: 5f75 7365 6428 6e6f 6465 292c 2073 6574  _used(node), set
-000091a0: 2829 290a 2020 2020 2020 2020 6e6f 6465  ()).        node
-000091b0: 203d 2063 6572 6369 732e 6c69 6232 746f   = cercis.lib2to
-000091c0: 335f 7061 7273 6528 226c 616d 6264 6120  3_parse("lambda 
-000091d0: 612c 202f 2c20 623a 202e 2e2e 2229 0a20  a, /, b: ..."). 
-000091e0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-000091f0: 7274 4571 7561 6c28 6365 7263 6973 2e67  rtEqual(cercis.g
-00009200: 6574 5f66 6561 7475 7265 735f 7573 6564  et_features_used
-00009210: 286e 6f64 6529 2c20 7b46 6561 7475 7265  (node), {Feature
-00009220: 2e50 4f53 5f4f 4e4c 595f 4152 4755 4d45  .POS_ONLY_ARGUME
-00009230: 4e54 537d 290a 2020 2020 2020 2020 6e6f  NTS}).        no
-00009240: 6465 203d 2063 6572 6369 732e 6c69 6232  de = cercis.lib2
-00009250: 746f 335f 7061 7273 6528 2264 6566 2066  to3_parse("def f
-00009260: 6e28 612c 202f 2c20 6229 3a20 2e2e 2e22  n(a, /, b): ..."
-00009270: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-00009280: 7373 6572 7445 7175 616c 2863 6572 6369  ssertEqual(cerci
-00009290: 732e 6765 745f 6665 6174 7572 6573 5f75  s.get_features_u
-000092a0: 7365 6428 6e6f 6465 292c 207b 4665 6174  sed(node), {Feat
-000092b0: 7572 652e 504f 535f 4f4e 4c59 5f41 5247  ure.POS_ONLY_ARG
-000092c0: 554d 454e 5453 7d29 0a20 2020 2020 2020  UMENTS}).       
-000092d0: 206e 6f64 6520 3d20 6365 7263 6973 2e6c   node = cercis.l
-000092e0: 6962 3274 6f33 5f70 6172 7365 2822 6465  ib2to3_parse("de
-000092f0: 6620 666e 2829 3a20 7969 656c 6420 612c  f fn(): yield a,
-00009300: 2062 2229 0a20 2020 2020 2020 2073 656c   b").        sel
-00009310: 662e 6173 7365 7274 4571 7561 6c28 6365  f.assertEqual(ce
-00009320: 7263 6973 2e67 6574 5f66 6561 7475 7265  rcis.get_feature
-00009330: 735f 7573 6564 286e 6f64 6529 2c20 7365  s_used(node), se
-00009340: 7428 2929 0a20 2020 2020 2020 206e 6f64  t()).        nod
-00009350: 6520 3d20 6365 7263 6973 2e6c 6962 3274  e = cercis.lib2t
-00009360: 6f33 5f70 6172 7365 2822 6465 6620 666e  o3_parse("def fn
-00009370: 2829 3a20 7265 7475 726e 2061 2c20 6222  (): return a, b"
-00009380: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-00009390: 7373 6572 7445 7175 616c 2863 6572 6369  ssertEqual(cerci
-000093a0: 732e 6765 745f 6665 6174 7572 6573 5f75  s.get_features_u
-000093b0: 7365 6428 6e6f 6465 292c 2073 6574 2829  sed(node), set()
-000093c0: 290a 2020 2020 2020 2020 6e6f 6465 203d  ).        node =
-000093d0: 2063 6572 6369 732e 6c69 6232 746f 335f   cercis.lib2to3_
-000093e0: 7061 7273 6528 2264 6566 2066 6e28 293a  parse("def fn():
-000093f0: 2079 6965 6c64 202a 622c 2063 2229 0a20   yield *b, c"). 
-00009400: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00009410: 7274 4571 7561 6c28 6365 7263 6973 2e67  rtEqual(cercis.g
-00009420: 6574 5f66 6561 7475 7265 735f 7573 6564  et_features_used
-00009430: 286e 6f64 6529 2c20 7b46 6561 7475 7265  (node), {Feature
-00009440: 2e55 4e50 4143 4b49 4e47 5f4f 4e5f 464c  .UNPACKING_ON_FL
-00009450: 4f57 7d29 0a20 2020 2020 2020 206e 6f64  OW}).        nod
-00009460: 6520 3d20 6365 7263 6973 2e6c 6962 3274  e = cercis.lib2t
-00009470: 6f33 5f70 6172 7365 2822 6465 6620 666e  o3_parse("def fn
-00009480: 2829 3a20 7265 7475 726e 2061 2c20 2a62  (): return a, *b
-00009490: 2c20 6322 290a 2020 2020 2020 2020 7365  , c").        se
-000094a0: 6c66 2e61 7373 6572 7445 7175 616c 2863  lf.assertEqual(c
-000094b0: 6572 6369 732e 6765 745f 6665 6174 7572  ercis.get_featur
-000094c0: 6573 5f75 7365 6428 6e6f 6465 292c 207b  es_used(node), {
-000094d0: 4665 6174 7572 652e 554e 5041 434b 494e  Feature.UNPACKIN
-000094e0: 475f 4f4e 5f46 4c4f 577d 290a 2020 2020  G_ON_FLOW}).    
-000094f0: 2020 2020 6e6f 6465 203d 2063 6572 6369      node = cerci
-00009500: 732e 6c69 6232 746f 335f 7061 7273 6528  s.lib2to3_parse(
-00009510: 2278 203d 2061 2c20 2a62 2c20 6322 290a  "x = a, *b, c").
-00009520: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00009530: 6572 7445 7175 616c 2863 6572 6369 732e  ertEqual(cercis.
-00009540: 6765 745f 6665 6174 7572 6573 5f75 7365  get_features_use
-00009550: 6428 6e6f 6465 292c 2073 6574 2829 290a  d(node), set()).
-00009560: 2020 2020 2020 2020 6e6f 6465 203d 2063          node = c
-00009570: 6572 6369 732e 6c69 6232 746f 335f 7061  ercis.lib2to3_pa
-00009580: 7273 6528 2278 3a20 416e 7920 3d20 7265  rse("x: Any = re
-00009590: 6775 6c61 7222 290a 2020 2020 2020 2020  gular").        
-000095a0: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-000095b0: 2863 6572 6369 732e 6765 745f 6665 6174  (cercis.get_feat
-000095c0: 7572 6573 5f75 7365 6428 6e6f 6465 292c  ures_used(node),
-000095d0: 2073 6574 2829 290a 2020 2020 2020 2020   set()).        
-000095e0: 6e6f 6465 203d 2063 6572 6369 732e 6c69  node = cercis.li
-000095f0: 6232 746f 335f 7061 7273 6528 2278 3a20  b2to3_parse("x: 
-00009600: 416e 7920 3d20 2872 6567 756c 6172 2c20  Any = (regular, 
-00009610: 7265 6775 6c61 7229 2229 0a20 2020 2020  regular)").     
-00009620: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-00009630: 7561 6c28 6365 7263 6973 2e67 6574 5f66  ual(cercis.get_f
-00009640: 6561 7475 7265 735f 7573 6564 286e 6f64  eatures_used(nod
-00009650: 6529 2c20 7365 7428 2929 0a20 2020 2020  e), set()).     
-00009660: 2020 206e 6f64 6520 3d20 6365 7263 6973     node = cercis
-00009670: 2e6c 6962 3274 6f33 5f70 6172 7365 2822  .lib2to3_parse("
-00009680: 783a 2041 6e79 203d 2043 6f6d 706c 6578  x: Any = Complex
-00009690: 2854 7970 6528 3129 295b 736f 6d65 7468  (Type(1))[someth
-000096a0: 696e 675d 2229 0a20 2020 2020 2020 2073  ing]").        s
-000096b0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-000096c0: 6365 7263 6973 2e67 6574 5f66 6561 7475  cercis.get_featu
-000096d0: 7265 735f 7573 6564 286e 6f64 6529 2c20  res_used(node), 
-000096e0: 7365 7428 2929 0a20 2020 2020 2020 206e  set()).        n
-000096f0: 6f64 6520 3d20 6365 7263 6973 2e6c 6962  ode = cercis.lib
-00009700: 3274 6f33 5f70 6172 7365 2822 783a 2054  2to3_parse("x: T
-00009710: 7570 6c65 5b69 6e74 2c20 2e2e 2e5d 203d  uple[int, ...] =
-00009720: 2061 2c20 622c 2063 2229 0a20 2020 2020   a, b, c").     
-00009730: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-00009740: 7561 6c28 0a20 2020 2020 2020 2020 2020  ual(.           
-00009750: 2063 6572 6369 732e 6765 745f 6665 6174   cercis.get_feat
-00009760: 7572 6573 5f75 7365 6428 6e6f 6465 292c  ures_used(node),
-00009770: 207b 4665 6174 7572 652e 414e 4e5f 4153   {Feature.ANN_AS
-00009780: 5349 474e 5f45 5854 454e 4445 445f 5248  SIGN_EXTENDED_RH
-00009790: 537d 0a20 2020 2020 2020 2029 0a20 2020  S}.        ).   
-000097a0: 2020 2020 206e 6f64 6520 3d20 6365 7263       node = cerc
-000097b0: 6973 2e6c 6962 3274 6f33 5f70 6172 7365  is.lib2to3_parse
-000097c0: 2822 7472 793a 2070 6173 735c 6e65 7863  ("try: pass\nexc
-000097d0: 6570 7420 536f 6d65 7468 696e 673a 2070  ept Something: p
-000097e0: 6173 7322 290a 2020 2020 2020 2020 7365  ass").        se
-000097f0: 6c66 2e61 7373 6572 7445 7175 616c 2863  lf.assertEqual(c
-00009800: 6572 6369 732e 6765 745f 6665 6174 7572  ercis.get_featur
-00009810: 6573 5f75 7365 6428 6e6f 6465 292c 2073  es_used(node), s
-00009820: 6574 2829 290a 2020 2020 2020 2020 6e6f  et()).        no
-00009830: 6465 203d 2063 6572 6369 732e 6c69 6232  de = cercis.lib2
-00009840: 746f 335f 7061 7273 6528 2274 7279 3a20  to3_parse("try: 
-00009850: 7061 7373 5c6e 6578 6365 7074 2028 2a53  pass\nexcept (*S
-00009860: 6f6d 6574 6869 6e67 2c29 3a20 7061 7373  omething,): pass
-00009870: 2229 0a20 2020 2020 2020 2073 656c 662e  ").        self.
-00009880: 6173 7365 7274 4571 7561 6c28 6365 7263  assertEqual(cerc
-00009890: 6973 2e67 6574 5f66 6561 7475 7265 735f  is.get_features_
-000098a0: 7573 6564 286e 6f64 6529 2c20 7365 7428  used(node), set(
-000098b0: 2929 0a20 2020 2020 2020 206e 6f64 6520  )).        node 
-000098c0: 3d20 6365 7263 6973 2e6c 6962 3274 6f33  = cercis.lib2to3
-000098d0: 5f70 6172 7365 2822 7472 793a 2070 6173  _parse("try: pas
-000098e0: 735c 6e65 7863 6570 7420 2a47 726f 7570  s\nexcept *Group
-000098f0: 3a20 7061 7373 2229 0a20 2020 2020 2020  : pass").       
-00009900: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00009910: 6c28 6365 7263 6973 2e67 6574 5f66 6561  l(cercis.get_fea
-00009920: 7475 7265 735f 7573 6564 286e 6f64 6529  tures_used(node)
-00009930: 2c20 7b46 6561 7475 7265 2e45 5843 4550  , {Feature.EXCEP
-00009940: 545f 5354 4152 7d29 0a20 2020 2020 2020  T_STAR}).       
-00009950: 206e 6f64 6520 3d20 6365 7263 6973 2e6c   node = cercis.l
-00009960: 6962 3274 6f33 5f70 6172 7365 2822 615b  ib2to3_parse("a[
-00009970: 2a62 5d22 290a 2020 2020 2020 2020 7365  *b]").        se
-00009980: 6c66 2e61 7373 6572 7445 7175 616c 2863  lf.assertEqual(c
-00009990: 6572 6369 732e 6765 745f 6665 6174 7572  ercis.get_featur
-000099a0: 6573 5f75 7365 6428 6e6f 6465 292c 207b  es_used(node), {
-000099b0: 4665 6174 7572 652e 5641 5249 4144 4943  Feature.VARIADIC
-000099c0: 5f47 454e 4552 4943 537d 290a 2020 2020  _GENERICS}).    
-000099d0: 2020 2020 6e6f 6465 203d 2063 6572 6369      node = cerci
-000099e0: 732e 6c69 6232 746f 335f 7061 7273 6528  s.lib2to3_parse(
-000099f0: 2261 5b78 2c20 2a79 2829 2c20 7a5d 203d  "a[x, *y(), z] =
-00009a00: 2074 2229 0a20 2020 2020 2020 2073 656c   t").        sel
-00009a10: 662e 6173 7365 7274 4571 7561 6c28 6365  f.assertEqual(ce
-00009a20: 7263 6973 2e67 6574 5f66 6561 7475 7265  rcis.get_feature
-00009a30: 735f 7573 6564 286e 6f64 6529 2c20 7b46  s_used(node), {F
-00009a40: 6561 7475 7265 2e56 4152 4941 4449 435f  eature.VARIADIC_
-00009a50: 4745 4e45 5249 4353 7d29 0a20 2020 2020  GENERICS}).     
-00009a60: 2020 206e 6f64 6520 3d20 6365 7263 6973     node = cercis
-00009a70: 2e6c 6962 3274 6f33 5f70 6172 7365 2822  .lib2to3_parse("
-00009a80: 6465 6620 666e 282a 6172 6773 3a20 2a54  def fn(*args: *T
-00009a90: 293a 2070 6173 7322 290a 2020 2020 2020  ): pass").      
-00009aa0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00009ab0: 616c 2863 6572 6369 732e 6765 745f 6665  al(cercis.get_fe
-00009ac0: 6174 7572 6573 5f75 7365 6428 6e6f 6465  atures_used(node
-00009ad0: 292c 207b 4665 6174 7572 652e 5641 5249  ), {Feature.VARI
-00009ae0: 4144 4943 5f47 454e 4552 4943 537d 290a  ADIC_GENERICS}).
-00009af0: 0a20 2020 2064 6566 2074 6573 745f 6765  .    def test_ge
-00009b00: 745f 6665 6174 7572 6573 5f75 7365 645f  t_features_used_
-00009b10: 666f 725f 6675 7475 7265 5f66 6c61 6773  for_future_flags
-00009b20: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
-00009b30: 2020 2020 2020 2020 666f 7220 7372 632c          for src,
-00009b40: 2066 6561 7475 7265 7320 696e 205b 0a20   features in [. 
-00009b50: 2020 2020 2020 2020 2020 2028 2266 726f             ("fro
-00009b60: 6d20 5f5f 6675 7475 7265 5f5f 2069 6d70  m __future__ imp
-00009b70: 6f72 7420 616e 6e6f 7461 7469 6f6e 7322  ort annotations"
-00009b80: 2c20 7b46 6561 7475 7265 2e46 5554 5552  , {Feature.FUTUR
-00009b90: 455f 414e 4e4f 5441 5449 4f4e 537d 292c  E_ANNOTATIONS}),
-00009ba0: 0a20 2020 2020 2020 2020 2020 2028 0a20  .            (. 
-00009bb0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00009bc0: 6672 6f6d 205f 5f66 7574 7572 655f 5f20  from __future__ 
-00009bd0: 696d 706f 7274 2028 6f74 6865 722c 2061  import (other, a
-00009be0: 6e6e 6f74 6174 696f 6e73 2922 2c0a 2020  nnotations)",.  
-00009bf0: 2020 2020 2020 2020 2020 2020 2020 7b46                {F
-00009c00: 6561 7475 7265 2e46 5554 5552 455f 414e  eature.FUTURE_AN
-00009c10: 4e4f 5441 5449 4f4e 537d 2c0a 2020 2020  NOTATIONS},.    
-00009c20: 2020 2020 2020 2020 292c 0a20 2020 2020          ),.     
-00009c30: 2020 2020 2020 2028 2261 203d 2031 202b         ("a = 1 +
-00009c40: 2032 5c6e 6672 6f6d 2073 6f6d 6574 6869   2\nfrom somethi
-00009c50: 6e67 2069 6d70 6f72 7420 616e 6e6f 7461  ng import annota
-00009c60: 7469 6f6e 7322 2c20 7365 7428 2929 2c0a  tions", set()),.
-00009c70: 2020 2020 2020 2020 2020 2020 2822 6672              ("fr
-00009c80: 6f6d 205f 5f66 7574 7572 655f 5f20 696d  om __future__ im
-00009c90: 706f 7274 2078 2c20 7922 2c20 7365 7428  port x, y", set(
-00009ca0: 2929 2c0a 2020 2020 2020 2020 5d3a 0a20  )),.        ]:. 
-00009cb0: 2020 2020 2020 2020 2020 2077 6974 6820             with 
-00009cc0: 7365 6c66 2e73 7562 5465 7374 2873 7263  self.subTest(src
-00009cd0: 3d73 7263 2c20 6665 6174 7572 6573 3d66  =src, features=f
-00009ce0: 6561 7475 7265 7329 3a0a 2020 2020 2020  eatures):.      
-00009cf0: 2020 2020 2020 2020 2020 6e6f 6465 203d            node =
-00009d00: 2063 6572 6369 732e 6c69 6232 746f 335f   cercis.lib2to3_
-00009d10: 7061 7273 6528 7372 6329 0a20 2020 2020  parse(src).     
-00009d20: 2020 2020 2020 2020 2020 2066 7574 7572             futur
-00009d30: 655f 696d 706f 7274 7320 3d20 6365 7263  e_imports = cerc
-00009d40: 6973 2e67 6574 5f66 7574 7572 655f 696d  is.get_future_im
-00009d50: 706f 7274 7328 6e6f 6465 290a 2020 2020  ports(node).    
-00009d60: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00009d70: 2e61 7373 6572 7445 7175 616c 280a 2020  .assertEqual(.  
-00009d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009d90: 2020 6365 7263 6973 2e67 6574 5f66 6561    cercis.get_fea
-00009da0: 7475 7265 735f 7573 6564 286e 6f64 652c  tures_used(node,
-00009db0: 2066 7574 7572 655f 696d 706f 7274 733d   future_imports=
-00009dc0: 6675 7475 7265 5f69 6d70 6f72 7473 292c  future_imports),
-00009dd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009de0: 2020 2020 2066 6561 7475 7265 732c 0a20       features,. 
-00009df0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-00009e00: 0a0a 2020 2020 6465 6620 7465 7374 5f67  ..    def test_g
-00009e10: 6574 5f66 7574 7572 655f 696d 706f 7274  et_future_import
-00009e20: 7328 7365 6c66 2920 2d3e 204e 6f6e 653a  s(self) -> None:
-00009e30: 0a20 2020 2020 2020 206e 6f64 6520 3d20  .        node = 
-00009e40: 6365 7263 6973 2e6c 6962 3274 6f33 5f70  cercis.lib2to3_p
-00009e50: 6172 7365 2822 5c6e 2229 0a20 2020 2020  arse("\n").     
-00009e60: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-00009e70: 7561 6c28 7365 7428 292c 2063 6572 6369  ual(set(), cerci
-00009e80: 732e 6765 745f 6675 7475 7265 5f69 6d70  s.get_future_imp
-00009e90: 6f72 7473 286e 6f64 6529 290a 2020 2020  orts(node)).    
-00009ea0: 2020 2020 6e6f 6465 203d 2063 6572 6369      node = cerci
-00009eb0: 732e 6c69 6232 746f 335f 7061 7273 6528  s.lib2to3_parse(
-00009ec0: 2266 726f 6d20 5f5f 6675 7475 7265 5f5f  "from __future__
-00009ed0: 2069 6d70 6f72 7420 6365 7263 6973 5c6e   import cercis\n
-00009ee0: 2229 0a20 2020 2020 2020 2073 656c 662e  ").        self.
-00009ef0: 6173 7365 7274 4571 7561 6c28 7b22 6365  assertEqual({"ce
-00009f00: 7263 6973 227d 2c20 6365 7263 6973 2e67  rcis"}, cercis.g
-00009f10: 6574 5f66 7574 7572 655f 696d 706f 7274  et_future_import
-00009f20: 7328 6e6f 6465 2929 0a20 2020 2020 2020  s(node)).       
-00009f30: 206e 6f64 6520 3d20 6365 7263 6973 2e6c   node = cercis.l
-00009f40: 6962 3274 6f33 5f70 6172 7365 2822 6672  ib2to3_parse("fr
-00009f50: 6f6d 205f 5f66 7574 7572 655f 5f20 696d  om __future__ im
-00009f60: 706f 7274 206d 756c 7469 706c 652c 2069  port multiple, i
-00009f70: 6d70 6f72 7473 5c6e 2229 0a20 2020 2020  mports\n").     
-00009f80: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-00009f90: 7561 6c28 7b22 6d75 6c74 6970 6c65 222c  ual({"multiple",
-00009fa0: 2022 696d 706f 7274 7322 7d2c 2063 6572   "imports"}, cer
-00009fb0: 6369 732e 6765 745f 6675 7475 7265 5f69  cis.get_future_i
-00009fc0: 6d70 6f72 7473 286e 6f64 6529 290a 2020  mports(node)).  
-00009fd0: 2020 2020 2020 6e6f 6465 203d 2063 6572        node = cer
-00009fe0: 6369 732e 6c69 6232 746f 335f 7061 7273  cis.lib2to3_pars
-00009ff0: 6528 2266 726f 6d20 5f5f 6675 7475 7265  e("from __future
-0000a000: 5f5f 2069 6d70 6f72 7420 2870 6172 656e  __ import (paren
-0000a010: 7468 6573 697a 6564 2c20 696d 706f 7274  thesized, import
-0000a020: 7329 5c6e 2229 0a20 2020 2020 2020 2073  s)\n").        s
-0000a030: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-0000a040: 7b22 7061 7265 6e74 6865 7369 7a65 6422  {"parenthesized"
-0000a050: 2c20 2269 6d70 6f72 7473 227d 2c20 6365  , "imports"}, ce
-0000a060: 7263 6973 2e67 6574 5f66 7574 7572 655f  rcis.get_future_
-0000a070: 696d 706f 7274 7328 6e6f 6465 2929 0a20  imports(node)). 
-0000a080: 2020 2020 2020 206e 6f64 6520 3d20 6365         node = ce
-0000a090: 7263 6973 2e6c 6962 3274 6f33 5f70 6172  rcis.lib2to3_par
-0000a0a0: 7365 280a 2020 2020 2020 2020 2020 2020  se(.            
-0000a0b0: 2266 726f 6d20 5f5f 6675 7475 7265 5f5f  "from __future__
-0000a0c0: 2069 6d70 6f72 7420 6d75 6c74 6970 6c65   import multiple
-0000a0d0: 5c6e 6672 6f6d 205f 5f66 7574 7572 655f  \nfrom __future_
-0000a0e0: 5f20 696d 706f 7274 2069 6d70 6f72 7473  _ import imports
-0000a0f0: 5c6e 220a 2020 2020 2020 2020 290a 2020  \n".        ).  
-0000a100: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-0000a110: 7445 7175 616c 287b 226d 756c 7469 706c  tEqual({"multipl
-0000a120: 6522 2c20 2269 6d70 6f72 7473 227d 2c20  e", "imports"}, 
-0000a130: 6365 7263 6973 2e67 6574 5f66 7574 7572  cercis.get_futur
-0000a140: 655f 696d 706f 7274 7328 6e6f 6465 2929  e_imports(node))
-0000a150: 0a20 2020 2020 2020 206e 6f64 6520 3d20  .        node = 
-0000a160: 6365 7263 6973 2e6c 6962 3274 6f33 5f70  cercis.lib2to3_p
-0000a170: 6172 7365 2822 2320 636f 6d6d 656e 745c  arse("# comment\
-0000a180: 6e66 726f 6d20 5f5f 6675 7475 7265 5f5f  nfrom __future__
-0000a190: 2069 6d70 6f72 7420 6365 7263 6973 5c6e   import cercis\n
-0000a1a0: 2229 0a20 2020 2020 2020 2073 656c 662e  ").        self.
-0000a1b0: 6173 7365 7274 4571 7561 6c28 7b22 6365  assertEqual({"ce
-0000a1c0: 7263 6973 227d 2c20 6365 7263 6973 2e67  rcis"}, cercis.g
-0000a1d0: 6574 5f66 7574 7572 655f 696d 706f 7274  et_future_import
-0000a1e0: 7328 6e6f 6465 2929 0a20 2020 2020 2020  s(node)).       
-0000a1f0: 206e 6f64 6520 3d20 6365 7263 6973 2e6c   node = cercis.l
-0000a200: 6962 3274 6f33 5f70 6172 7365 2827 2222  ib2to3_parse('""
-0000a210: 2264 6f63 7374 7269 6e67 2222 225c 6e66  "docstring"""\nf
-0000a220: 726f 6d20 5f5f 6675 7475 7265 5f5f 2069  rom __future__ i
-0000a230: 6d70 6f72 7420 6365 7263 6973 5c6e 2729  mport cercis\n')
-0000a240: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-0000a250: 7365 7274 4571 7561 6c28 7b22 6365 7263  sertEqual({"cerc
-0000a260: 6973 227d 2c20 6365 7263 6973 2e67 6574  is"}, cercis.get
-0000a270: 5f66 7574 7572 655f 696d 706f 7274 7328  _future_imports(
-0000a280: 6e6f 6465 2929 0a20 2020 2020 2020 206e  node)).        n
-0000a290: 6f64 6520 3d20 6365 7263 6973 2e6c 6962  ode = cercis.lib
-0000a2a0: 3274 6f33 5f70 6172 7365 280a 2020 2020  2to3_parse(.    
-0000a2b0: 2020 2020 2020 2020 2273 6f6d 6528 6f74          "some(ot
-0000a2c0: 6865 722c 2063 6f64 6529 5c6e 6672 6f6d  her, code)\nfrom
-0000a2d0: 205f 5f66 7574 7572 655f 5f20 696d 706f   __future__ impo
-0000a2e0: 7274 2063 6572 6369 735c 6e22 0a20 2020  rt cercis\n".   
-0000a2f0: 2020 2020 2029 0a20 2020 2020 2020 2073       ).        s
-0000a300: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-0000a310: 7365 7428 292c 2063 6572 6369 732e 6765  set(), cercis.ge
-0000a320: 745f 6675 7475 7265 5f69 6d70 6f72 7473  t_future_imports
-0000a330: 286e 6f64 6529 290a 2020 2020 2020 2020  (node)).        
-0000a340: 6e6f 6465 203d 2063 6572 6369 732e 6c69  node = cercis.li
-0000a350: 6232 746f 335f 7061 7273 6528 2266 726f  b2to3_parse("fro
-0000a360: 6d20 736f 6d65 2e6d 6f64 756c 6520 696d  m some.module im
-0000a370: 706f 7274 2063 6572 6369 735c 6e22 290a  port cercis\n").
-0000a380: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-0000a390: 6572 7445 7175 616c 2873 6574 2829 2c20  ertEqual(set(), 
-0000a3a0: 6365 7263 6973 2e67 6574 5f66 7574 7572  cercis.get_futur
-0000a3b0: 655f 696d 706f 7274 7328 6e6f 6465 2929  e_imports(node))
-0000a3c0: 0a20 2020 2020 2020 206e 6f64 6520 3d20  .        node = 
-0000a3d0: 6365 7263 6973 2e6c 6962 3274 6f33 5f70  cercis.lib2to3_p
-0000a3e0: 6172 7365 280a 2020 2020 2020 2020 2020  arse(.          
-0000a3f0: 2020 2266 726f 6d20 5f5f 6675 7475 7265    "from __future
-0000a400: 5f5f 2069 6d70 6f72 7420 756e 6963 6f64  __ import unicod
-0000a410: 655f 6c69 7465 7261 6c73 2061 7320 5f75  e_literals as _u
-0000a420: 6e69 636f 6465 5f6c 6974 6572 616c 7322  nicode_literals"
-0000a430: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
-0000a440: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-0000a450: 7561 6c28 7b22 756e 6963 6f64 655f 6c69  ual({"unicode_li
-0000a460: 7465 7261 6c73 227d 2c20 6365 7263 6973  terals"}, cercis
-0000a470: 2e67 6574 5f66 7574 7572 655f 696d 706f  .get_future_impo
-0000a480: 7274 7328 6e6f 6465 2929 0a20 2020 2020  rts(node)).     
-0000a490: 2020 206e 6f64 6520 3d20 6365 7263 6973     node = cercis
-0000a4a0: 2e6c 6962 3274 6f33 5f70 6172 7365 280a  .lib2to3_parse(.
-0000a4b0: 2020 2020 2020 2020 2020 2020 2266 726f              "fro
-0000a4c0: 6d20 5f5f 6675 7475 7265 5f5f 2069 6d70  m __future__ imp
-0000a4d0: 6f72 7420 756e 6963 6f64 655f 6c69 7465  ort unicode_lite
-0000a4e0: 7261 6c73 2061 7320 5f6c 6f6c 2c20 7072  rals as _lol, pr
-0000a4f0: 696e 7422 0a20 2020 2020 2020 2029 0a20  int".        ). 
-0000a500: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-0000a510: 7274 4571 7561 6c28 7b22 756e 6963 6f64  rtEqual({"unicod
-0000a520: 655f 6c69 7465 7261 6c73 222c 2022 7072  e_literals", "pr
-0000a530: 696e 7422 7d2c 2063 6572 6369 732e 6765  int"}, cercis.ge
-0000a540: 745f 6675 7475 7265 5f69 6d70 6f72 7473  t_future_imports
-0000a550: 286e 6f64 6529 290a 0a20 2020 2040 7079  (node))..    @py
-0000a560: 7465 7374 2e6d 6172 6b2e 696e 636f 6d70  test.mark.incomp
-0000a570: 6174 6962 6c65 5f77 6974 685f 6d79 7079  atible_with_mypy
-0000a580: 630a 2020 2020 6465 6620 7465 7374 5f64  c.    def test_d
-0000a590: 6562 7567 5f76 6973 6974 6f72 2873 656c  ebug_visitor(sel
-0000a5a0: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
-0000a5b0: 2020 2020 736f 7572 6365 2c20 5f20 3d20      source, _ = 
-0000a5c0: 7265 6164 5f64 6174 6128 226d 6973 6365  read_data("misce
-0000a5d0: 6c6c 616e 656f 7573 222c 2022 6465 6275  llaneous", "debu
-0000a5e0: 675f 7669 7369 746f 7222 290a 2020 2020  g_visitor").    
-0000a5f0: 2020 2020 6578 7065 6374 6564 2c20 5f20      expected, _ 
-0000a600: 3d20 7265 6164 5f64 6174 6128 226d 6973  = read_data("mis
-0000a610: 6365 6c6c 616e 656f 7573 222c 2022 6465  cellaneous", "de
-0000a620: 6275 675f 7669 7369 746f 722e 6f75 7422  bug_visitor.out"
-0000a630: 290a 2020 2020 2020 2020 6f75 745f 6c69  ).        out_li
-0000a640: 6e65 7320 3d20 5b5d 0a20 2020 2020 2020  nes = [].       
-0000a650: 2065 7272 5f6c 696e 6573 203d 205b 5d0a   err_lines = [].
-0000a660: 0a20 2020 2020 2020 2064 6566 206f 7574  .        def out
-0000a670: 286d 7367 3a20 7374 722c 202a 2a6b 7761  (msg: str, **kwa
-0000a680: 7267 733a 2041 6e79 2920 2d3e 204e 6f6e  rgs: Any) -> Non
-0000a690: 653a 0a20 2020 2020 2020 2020 2020 206f  e:.            o
-0000a6a0: 7574 5f6c 696e 6573 2e61 7070 656e 6428  ut_lines.append(
-0000a6b0: 6d73 6729 0a0a 2020 2020 2020 2020 6465  msg)..        de
-0000a6c0: 6620 6572 7228 6d73 673a 2073 7472 2c20  f err(msg: str, 
-0000a6d0: 2a2a 6b77 6172 6773 3a20 416e 7929 202d  **kwargs: Any) -
-0000a6e0: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-0000a6f0: 2020 2020 6572 725f 6c69 6e65 732e 6170      err_lines.ap
-0000a700: 7065 6e64 286d 7367 290a 0a20 2020 2020  pend(msg)..     
-0000a710: 2020 2077 6974 6820 7061 7463 6828 2263     with patch("c
-0000a720: 6572 6369 732e 6465 6275 672e 6f75 7422  ercis.debug.out"
-0000a730: 2c20 6f75 7429 3a0a 2020 2020 2020 2020  , out):.        
-0000a740: 2020 2020 4465 6275 6756 6973 6974 6f72      DebugVisitor
-0000a750: 2e73 686f 7728 736f 7572 6365 290a 2020  .show(source).  
-0000a760: 2020 2020 2020 6163 7475 616c 203d 2022        actual = "
-0000a770: 5c6e 222e 6a6f 696e 286f 7574 5f6c 696e  \n".join(out_lin
-0000a780: 6573 2920 2b20 225c 6e22 0a20 2020 2020  es) + "\n".     
-0000a790: 2020 206c 6f67 5f6e 616d 6520 3d20 2222     log_name = ""
-0000a7a0: 0a20 2020 2020 2020 2069 6620 6578 7065  .        if expe
-0000a7b0: 6374 6564 2021 3d20 6163 7475 616c 3a0a  cted != actual:.
-0000a7c0: 2020 2020 2020 2020 2020 2020 6c6f 675f              log_
-0000a7d0: 6e61 6d65 203d 2063 6572 6369 732e 6475  name = cercis.du
-0000a7e0: 6d70 5f74 6f5f 6669 6c65 282a 6f75 745f  mp_to_file(*out_
-0000a7f0: 6c69 6e65 7329 0a20 2020 2020 2020 2073  lines).        s
-0000a800: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-0000a810: 0a20 2020 2020 2020 2020 2020 2065 7870  .            exp
-0000a820: 6563 7465 642c 0a20 2020 2020 2020 2020  ected,.         
-0000a830: 2020 2061 6374 7561 6c2c 0a20 2020 2020     actual,.     
-0000a840: 2020 2020 2020 2066 2241 5354 2070 7269         f"AST pri
-0000a850: 6e74 206f 7574 2069 7320 6469 6666 6572  nt out is differ
-0000a860: 656e 742e 2041 6374 7561 6c20 7665 7273  ent. Actual vers
-0000a870: 696f 6e20 6475 6d70 6564 2074 6f20 7b6c  ion dumped to {l
-0000a880: 6f67 5f6e 616d 657d 222c 0a20 2020 2020  og_name}",.     
-0000a890: 2020 2029 0a0a 2020 2020 6465 6620 7465     )..    def te
-0000a8a0: 7374 5f66 6f72 6d61 745f 6669 6c65 5f63  st_format_file_c
-0000a8b0: 6f6e 7465 6e74 7328 7365 6c66 2920 2d3e  ontents(self) ->
-0000a8c0: 204e 6f6e 653a 0a20 2020 2020 2020 206d   None:.        m
-0000a8d0: 6f64 6520 3d20 4445 4641 554c 545f 4d4f  ode = DEFAULT_MO
-0000a8e0: 4445 0a20 2020 2020 2020 2065 6d70 7479  DE.        empty
-0000a8f0: 203d 2022 220a 2020 2020 2020 2020 7769   = "".        wi
-0000a900: 7468 2073 656c 662e 6173 7365 7274 5261  th self.assertRa
-0000a910: 6973 6573 2863 6572 6369 732e 4e6f 7468  ises(cercis.Noth
-0000a920: 696e 6743 6861 6e67 6564 293a 0a20 2020  ingChanged):.   
-0000a930: 2020 2020 2020 2020 2063 6572 6369 732e           cercis.
-0000a940: 666f 726d 6174 5f66 696c 655f 636f 6e74  format_file_cont
-0000a950: 656e 7473 2865 6d70 7479 2c20 6d6f 6465  ents(empty, mode
-0000a960: 3d6d 6f64 652c 2066 6173 743d 4661 6c73  =mode, fast=Fals
-0000a970: 6529 0a20 2020 2020 2020 206a 7573 745f  e).        just_
-0000a980: 6e6c 203d 2022 5c6e 220a 2020 2020 2020  nl = "\n".      
-0000a990: 2020 7769 7468 2073 656c 662e 6173 7365    with self.asse
-0000a9a0: 7274 5261 6973 6573 2863 6572 6369 732e  rtRaises(cercis.
-0000a9b0: 4e6f 7468 696e 6743 6861 6e67 6564 293a  NothingChanged):
-0000a9c0: 0a20 2020 2020 2020 2020 2020 2063 6572  .            cer
-0000a9d0: 6369 732e 666f 726d 6174 5f66 696c 655f  cis.format_file_
-0000a9e0: 636f 6e74 656e 7473 286a 7573 745f 6e6c  contents(just_nl
-0000a9f0: 2c20 6d6f 6465 3d6d 6f64 652c 2066 6173  , mode=mode, fas
-0000aa00: 743d 4661 6c73 6529 0a20 2020 2020 2020  t=False).       
-0000aa10: 2073 616d 6520 3d20 226a 203d 205b 312c   same = "j = [1,
-0000aa20: 2032 2c20 335d 5c6e 220a 2020 2020 2020   2, 3]\n".      
-0000aa30: 2020 7769 7468 2073 656c 662e 6173 7365    with self.asse
-0000aa40: 7274 5261 6973 6573 2863 6572 6369 732e  rtRaises(cercis.
-0000aa50: 4e6f 7468 696e 6743 6861 6e67 6564 293a  NothingChanged):
-0000aa60: 0a20 2020 2020 2020 2020 2020 2063 6572  .            cer
-0000aa70: 6369 732e 666f 726d 6174 5f66 696c 655f  cis.format_file_
-0000aa80: 636f 6e74 656e 7473 2873 616d 652c 206d  contents(same, m
-0000aa90: 6f64 653d 6d6f 6465 2c20 6661 7374 3d46  ode=mode, fast=F
-0000aaa0: 616c 7365 290a 2020 2020 2020 2020 6469  alse).        di
-0000aab0: 6666 6572 656e 7420 3d20 226a 203d 205b  fferent = "j = [
-0000aac0: 312c 322c 335d 220a 2020 2020 2020 2020  1,2,3]".        
-0000aad0: 6578 7065 6374 6564 203d 2073 616d 650a  expected = same.
-0000aae0: 2020 2020 2020 2020 6163 7475 616c 203d          actual =
-0000aaf0: 2063 6572 6369 732e 666f 726d 6174 5f66   cercis.format_f
-0000ab00: 696c 655f 636f 6e74 656e 7473 2864 6966  ile_contents(dif
-0000ab10: 6665 7265 6e74 2c20 6d6f 6465 3d6d 6f64  ferent, mode=mod
-0000ab20: 652c 2066 6173 743d 4661 6c73 6529 0a20  e, fast=False). 
-0000ab30: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-0000ab40: 7274 4571 7561 6c28 6578 7065 6374 6564  rtEqual(expected
-0000ab50: 2c20 6163 7475 616c 290a 2020 2020 2020  , actual).      
-0000ab60: 2020 696e 7661 6c69 6420 3d20 2272 6574    invalid = "ret
-0000ab70: 7572 6e20 6966 2079 6f75 2063 616e 220a  urn if you can".
-0000ab80: 2020 2020 2020 2020 7769 7468 2073 656c          with sel
-0000ab90: 662e 6173 7365 7274 5261 6973 6573 2863  f.assertRaises(c
-0000aba0: 6572 6369 732e 496e 7661 6c69 6449 6e70  ercis.InvalidInp
-0000abb0: 7574 2920 6173 2065 3a0a 2020 2020 2020  ut) as e:.      
-0000abc0: 2020 2020 2020 6365 7263 6973 2e66 6f72        cercis.for
-0000abd0: 6d61 745f 6669 6c65 5f63 6f6e 7465 6e74  mat_file_content
-0000abe0: 7328 696e 7661 6c69 642c 206d 6f64 653d  s(invalid, mode=
-0000abf0: 6d6f 6465 2c20 6661 7374 3d46 616c 7365  mode, fast=False
-0000ac00: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-0000ac10: 7373 6572 7445 7175 616c 2873 7472 2865  ssertEqual(str(e
-0000ac20: 2e65 7863 6570 7469 6f6e 292c 2022 4361  .exception), "Ca
-0000ac30: 6e6e 6f74 2070 6172 7365 3a20 313a 373a  nnot parse: 1:7:
-0000ac40: 2072 6574 7572 6e20 6966 2079 6f75 2063   return if you c
-0000ac50: 616e 2229 0a0a 2020 2020 2020 2020 6d6f  an")..        mo
-0000ac60: 6465 203d 2063 6572 6369 732e 4d6f 6465  de = cercis.Mode
-0000ac70: 2870 7265 7669 6577 3d54 7275 6529 0a20  (preview=True). 
-0000ac80: 2020 2020 2020 206a 7573 745f 6372 6c66         just_crlf
-0000ac90: 203d 2022 5c72 5c6e 220a 2020 2020 2020   = "\r\n".      
-0000aca0: 2020 7769 7468 2073 656c 662e 6173 7365    with self.asse
-0000acb0: 7274 5261 6973 6573 2863 6572 6369 732e  rtRaises(cercis.
-0000acc0: 4e6f 7468 696e 6743 6861 6e67 6564 293a  NothingChanged):
-0000acd0: 0a20 2020 2020 2020 2020 2020 2063 6572  .            cer
-0000ace0: 6369 732e 666f 726d 6174 5f66 696c 655f  cis.format_file_
-0000acf0: 636f 6e74 656e 7473 286a 7573 745f 6372  contents(just_cr
-0000ad00: 6c66 2c20 6d6f 6465 3d6d 6f64 652c 2066  lf, mode=mode, f
-0000ad10: 6173 743d 4661 6c73 6529 0a20 2020 2020  ast=False).     
-0000ad20: 2020 206a 7573 745f 7768 6974 6573 7061     just_whitespa
-0000ad30: 6365 5f6e 6c20 3d20 225c 6e5c 745c 6e20  ce_nl = "\n\t\n 
-0000ad40: 5c6e 5c74 205c 6e20 5c74 5c6e 5c6e 220a  \n\t \n \t\n\n".
-0000ad50: 2020 2020 2020 2020 6163 7475 616c 203d          actual =
-0000ad60: 2063 6572 6369 732e 666f 726d 6174 5f66   cercis.format_f
-0000ad70: 696c 655f 636f 6e74 656e 7473 286a 7573  ile_contents(jus
-0000ad80: 745f 7768 6974 6573 7061 6365 5f6e 6c2c  t_whitespace_nl,
-0000ad90: 206d 6f64 653d 6d6f 6465 2c20 6661 7374   mode=mode, fast
-0000ada0: 3d46 616c 7365 290a 2020 2020 2020 2020  =False).        
-0000adb0: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-0000adc0: 2822 5c6e 222c 2061 6374 7561 6c29 0a20  ("\n", actual). 
-0000add0: 2020 2020 2020 206a 7573 745f 7768 6974         just_whit
-0000ade0: 6573 7061 6365 5f63 726c 6620 3d20 225c  espace_crlf = "\
-0000adf0: 725c 6e5c 745c 725c 6e20 5c72 5c6e 5c74  r\n\t\r\n \r\n\t
-0000ae00: 205c 725c 6e20 5c74 5c72 5c6e 5c72 5c6e   \r\n \t\r\n\r\n
-0000ae10: 220a 2020 2020 2020 2020 6163 7475 616c  ".        actual
-0000ae20: 203d 2063 6572 6369 732e 666f 726d 6174   = cercis.format
-0000ae30: 5f66 696c 655f 636f 6e74 656e 7473 280a  _file_contents(.
-0000ae40: 2020 2020 2020 2020 2020 2020 6a75 7374              just
-0000ae50: 5f77 6869 7465 7370 6163 655f 6372 6c66  _whitespace_crlf
-0000ae60: 2c20 6d6f 6465 3d6d 6f64 652c 2066 6173  , mode=mode, fas
-0000ae70: 743d 4661 6c73 650a 2020 2020 2020 2020  t=False.        
-0000ae80: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-0000ae90: 7373 6572 7445 7175 616c 2822 5c72 5c6e  ssertEqual("\r\n
-0000aea0: 222c 2061 6374 7561 6c29 0a0a 2020 2020  ", actual)..    
-0000aeb0: 6465 6620 7465 7374 5f65 6e64 6d61 726b  def test_endmark
-0000aec0: 6572 2873 656c 6629 202d 3e20 4e6f 6e65  er(self) -> None
-0000aed0: 3a0a 2020 2020 2020 2020 6e20 3d20 6365  :.        n = ce
-0000aee0: 7263 6973 2e6c 6962 3274 6f33 5f70 6172  rcis.lib2to3_par
-0000aef0: 7365 2822 5c6e 2229 0a20 2020 2020 2020  se("\n").       
-0000af00: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-0000af10: 6c28 6e2e 7479 7065 2c20 6365 7263 6973  l(n.type, cercis
-0000af20: 2e73 796d 732e 6669 6c65 5f69 6e70 7574  .syms.file_input
-0000af30: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-0000af40: 7373 6572 7445 7175 616c 286c 656e 286e  ssertEqual(len(n
-0000af50: 2e63 6869 6c64 7265 6e29 2c20 3129 0a20  .children), 1). 
-0000af60: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-0000af70: 7274 4571 7561 6c28 6e2e 6368 696c 6472  rtEqual(n.childr
-0000af80: 656e 5b30 5d2e 7479 7065 2c20 6365 7263  en[0].type, cerc
-0000af90: 6973 2e74 6f6b 656e 2e45 4e44 4d41 524b  is.token.ENDMARK
-0000afa0: 4552 290a 0a20 2020 2040 7079 7465 7374  ER)..    @pytest
-0000afb0: 2e6d 6172 6b2e 696e 636f 6d70 6174 6962  .mark.incompatib
-0000afc0: 6c65 5f77 6974 685f 6d79 7079 630a 2020  le_with_mypyc.  
-0000afd0: 2020 4075 6e69 7474 6573 742e 736b 6970    @unittest.skip
-0000afe0: 4966 286f 732e 656e 7669 726f 6e2e 6765  If(os.environ.ge
-0000aff0: 7428 2253 4b49 505f 4153 545f 5052 494e  t("SKIP_AST_PRIN
-0000b000: 5422 292c 2022 7573 6572 2073 6574 2053  T"), "user set S
-0000b010: 4b49 505f 4153 545f 5052 494e 5422 290a  KIP_AST_PRINT").
-0000b020: 2020 2020 6465 6620 7465 7374 5f61 7373      def test_ass
-0000b030: 6572 7446 6f72 6d61 7445 7175 616c 2873  ertFormatEqual(s
-0000b040: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
-0000b050: 2020 2020 2020 6f75 745f 6c69 6e65 7320        out_lines 
-0000b060: 3d20 5b5d 0a20 2020 2020 2020 2065 7272  = [].        err
-0000b070: 5f6c 696e 6573 203d 205b 5d0a 0a20 2020  _lines = []..   
-0000b080: 2020 2020 2064 6566 206f 7574 286d 7367       def out(msg
-0000b090: 3a20 7374 722c 202a 2a6b 7761 7267 733a  : str, **kwargs:
-0000b0a0: 2041 6e79 2920 2d3e 204e 6f6e 653a 0a20   Any) -> None:. 
-0000b0b0: 2020 2020 2020 2020 2020 206f 7574 5f6c             out_l
-0000b0c0: 696e 6573 2e61 7070 656e 6428 6d73 6729  ines.append(msg)
-0000b0d0: 0a0a 2020 2020 2020 2020 6465 6620 6572  ..        def er
-0000b0e0: 7228 6d73 673a 2073 7472 2c20 2a2a 6b77  r(msg: str, **kw
-0000b0f0: 6172 6773 3a20 416e 7929 202d 3e20 4e6f  args: Any) -> No
-0000b100: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-0000b110: 6572 725f 6c69 6e65 732e 6170 7065 6e64  err_lines.append
-0000b120: 286d 7367 290a 0a20 2020 2020 2020 2077  (msg)..        w
-0000b130: 6974 6820 7061 7463 6828 2263 6572 6369  ith patch("cerci
-0000b140: 732e 6f75 7470 7574 2e5f 6f75 7422 2c20  s.output._out", 
-0000b150: 6f75 7429 2c20 7061 7463 6828 2263 6572  out), patch("cer
-0000b160: 6369 732e 6f75 7470 7574 2e5f 6572 7222  cis.output._err"
-0000b170: 2c20 6572 7229 3a0a 2020 2020 2020 2020  , err):.        
-0000b180: 2020 2020 7769 7468 2073 656c 662e 6173      with self.as
-0000b190: 7365 7274 5261 6973 6573 2841 7373 6572  sertRaises(Asser
-0000b1a0: 7469 6f6e 4572 726f 7229 3a0a 2020 2020  tionError):.    
-0000b1b0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000b1c0: 2e61 7373 6572 7446 6f72 6d61 7445 7175  .assertFormatEqu
-0000b1d0: 616c 2822 6a20 3d20 5b31 2c20 322c 2033  al("j = [1, 2, 3
-0000b1e0: 5d22 2c20 226a 203d 205b 312c 2032 2c20  ]", "j = [1, 2, 
-0000b1f0: 332c 5d22 290a 0a20 2020 2020 2020 206f  3,]")..        o
-0000b200: 7574 5f73 7472 203d 2022 222e 6a6f 696e  ut_str = "".join
-0000b210: 286f 7574 5f6c 696e 6573 290a 2020 2020  (out_lines).    
-0000b220: 2020 2020 7365 6c66 2e61 7373 6572 7449      self.assertI
-0000b230: 6e28 2245 7870 6563 7465 6420 7472 6565  n("Expected tree
-0000b240: 3a22 2c20 6f75 745f 7374 7229 0a20 2020  :", out_str).   
-0000b250: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-0000b260: 496e 2822 4163 7475 616c 2074 7265 653a  In("Actual tree:
-0000b270: 222c 206f 7574 5f73 7472 290a 2020 2020  ", out_str).    
-0000b280: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-0000b290: 7175 616c 2822 222e 6a6f 696e 2865 7272  qual("".join(err
-0000b2a0: 5f6c 696e 6573 292c 2022 2229 0a0a 2020  _lines), "")..  
-0000b2b0: 2020 4065 7665 6e74 5f6c 6f6f 7028 290a    @event_loop().
-0000b2c0: 2020 2020 4070 6174 6368 2822 636f 6e63      @patch("conc
-0000b2d0: 7572 7265 6e74 2e66 7574 7572 6573 2e50  urrent.futures.P
-0000b2e0: 726f 6365 7373 506f 6f6c 4578 6563 7574  rocessPoolExecut
-0000b2f0: 6f72 222c 204d 6167 6963 4d6f 636b 2873  or", MagicMock(s
-0000b300: 6964 655f 6566 6665 6374 3d4f 5345 7272  ide_effect=OSErr
-0000b310: 6f72 2929 0a20 2020 2064 6566 2074 6573  or)).    def tes
-0000b320: 745f 776f 726b 735f 696e 5f6d 6f6e 6f5f  t_works_in_mono_
-0000b330: 7072 6f63 6573 735f 6f6e 6c79 5f65 6e76  process_only_env
-0000b340: 6972 6f6e 6d65 6e74 2873 656c 6629 202d  ironment(self) -
-0000b350: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-0000b360: 7769 7468 2063 6163 6865 5f64 6972 2829  with cache_dir()
-0000b370: 2061 7320 776f 726b 7370 6163 653a 0a20   as workspace:. 
-0000b380: 2020 2020 2020 2020 2020 2066 6f72 2066             for f
-0000b390: 2069 6e20 5b0a 2020 2020 2020 2020 2020   in [.          
-0000b3a0: 2020 2020 2020 2877 6f72 6b73 7061 6365        (workspace
-0000b3b0: 202f 2022 6f6e 652e 7079 2229 2e72 6573   / "one.py").res
-0000b3c0: 6f6c 7665 2829 2c0a 2020 2020 2020 2020  olve(),.        
-0000b3d0: 2020 2020 2020 2020 2877 6f72 6b73 7061          (workspa
-0000b3e0: 6365 202f 2022 7477 6f2e 7079 2229 2e72  ce / "two.py").r
-0000b3f0: 6573 6f6c 7665 2829 2c0a 2020 2020 2020  esolve(),.      
-0000b400: 2020 2020 2020 5d3a 0a20 2020 2020 2020        ]:.       
-0000b410: 2020 2020 2020 2020 2066 2e77 7269 7465           f.write
-0000b420: 5f74 6578 7428 2770 7269 6e74 2822 6865  _text('print("he
-0000b430: 6c6c 6f22 295c 6e27 290a 2020 2020 2020  llo")\n').      
-0000b440: 2020 2020 2020 7365 6c66 2e69 6e76 6f6b        self.invok
-0000b450: 6542 6c61 636b 285b 7374 7228 776f 726b  eBlack([str(work
-0000b460: 7370 6163 6529 5d29 0a0a 2020 2020 4065  space)])..    @e
-0000b470: 7665 6e74 5f6c 6f6f 7028 290a 2020 2020  vent_loop().    
-0000b480: 6465 6620 7465 7374 5f63 6865 636b 5f64  def test_check_d
-0000b490: 6966 665f 7573 655f 746f 6765 7468 6572  iff_use_together
-0000b4a0: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
-0000b4b0: 2020 2020 2020 2020 7769 7468 2063 6163          with cac
-0000b4c0: 6865 5f64 6972 2829 3a0a 2020 2020 2020  he_dir():.      
-0000b4d0: 2020 2020 2020 2320 4669 6c65 7320 7768        # Files wh
-0000b4e0: 6963 6820 7769 6c6c 2062 6520 7265 666f  ich will be refo
-0000b4f0: 726d 6174 7465 642e 0a20 2020 2020 2020  rmatted..       
-0000b500: 2020 2020 2073 7263 3120 3d20 6765 745f       src1 = get_
-0000b510: 6361 7365 5f70 6174 6828 226d 6973 6365  case_path("misce
-0000b520: 6c6c 616e 656f 7573 222c 2022 7374 7269  llaneous", "stri
-0000b530: 6e67 5f71 756f 7465 7322 290a 2020 2020  ng_quotes").    
-0000b540: 2020 2020 2020 2020 7365 6c66 2e69 6e76          self.inv
-0000b550: 6f6b 6542 6c61 636b 285b 7374 7228 7372  okeBlack([str(sr
-0000b560: 6331 292c 2022 2d2d 6469 6666 222c 2022  c1), "--diff", "
-0000b570: 2d2d 6368 6563 6b22 5d2c 2065 7869 745f  --check"], exit_
-0000b580: 636f 6465 3d31 290a 2020 2020 2020 2020  code=1).        
-0000b590: 2020 2020 2320 4669 6c65 7320 7768 6963      # Files whic
-0000b5a0: 6820 7769 6c6c 206e 6f74 2062 6520 7265  h will not be re
-0000b5b0: 666f 726d 6174 7465 642e 0a20 2020 2020  formatted..     
-0000b5c0: 2020 2020 2020 2073 7263 3220 3d20 6765         src2 = ge
-0000b5d0: 745f 6361 7365 5f70 6174 6828 2273 696d  t_case_path("sim
-0000b5e0: 706c 655f 6361 7365 7322 2c20 2263 6f6d  ple_cases", "com
-0000b5f0: 706f 7369 7469 6f6e 2229 0a20 2020 2020  position").     
-0000b600: 2020 2020 2020 2073 656c 662e 696e 766f         self.invo
-0000b610: 6b65 426c 6163 6b28 5b73 7472 2873 7263  keBlack([str(src
-0000b620: 3229 2c20 222d 2d64 6966 6622 2c20 222d  2), "--diff", "-
-0000b630: 2d63 6865 636b 225d 290a 2020 2020 2020  -check"]).      
-0000b640: 2020 2020 2020 2320 4d75 6c74 6920 6669        # Multi fi
-0000b650: 6c65 2063 6f6d 6d61 6e64 2e0a 2020 2020  le command..    
-0000b660: 2020 2020 2020 2020 7365 6c66 2e69 6e76          self.inv
-0000b670: 6f6b 6542 6c61 636b 285b 7374 7228 7372  okeBlack([str(sr
-0000b680: 6331 292c 2073 7472 2873 7263 3229 2c20  c1), str(src2), 
-0000b690: 222d 2d64 6966 6622 2c20 222d 2d63 6865  "--diff", "--che
-0000b6a0: 636b 225d 2c20 6578 6974 5f63 6f64 653d  ck"], exit_code=
-0000b6b0: 3129 0a0a 2020 2020 6465 6620 7465 7374  1)..    def test
-0000b6c0: 5f6e 6f5f 7372 635f 6661 696c 7328 7365  _no_src_fails(se
-0000b6d0: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
-0000b6e0: 2020 2020 2077 6974 6820 6361 6368 655f       with cache_
-0000b6f0: 6469 7228 293a 0a20 2020 2020 2020 2020  dir():.         
-0000b700: 2020 2073 656c 662e 696e 766f 6b65 426c     self.invokeBl
-0000b710: 6163 6b28 5b5d 2c20 6578 6974 5f63 6f64  ack([], exit_cod
-0000b720: 653d 3129 0a0a 2020 2020 6465 6620 7465  e=1)..    def te
-0000b730: 7374 5f73 7263 5f61 6e64 5f63 6f64 655f  st_src_and_code_
-0000b740: 6661 696c 7328 7365 6c66 2920 2d3e 204e  fails(self) -> N
-0000b750: 6f6e 653a 0a20 2020 2020 2020 2077 6974  one:.        wit
-0000b760: 6820 6361 6368 655f 6469 7228 293a 0a20  h cache_dir():. 
-0000b770: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000b780: 696e 766f 6b65 426c 6163 6b28 5b22 2e22  invokeBlack(["."
-0000b790: 2c20 222d 6322 2c20 2230 225d 2c20 6578  , "-c", "0"], ex
-0000b7a0: 6974 5f63 6f64 653d 3129 0a0a 2020 2020  it_code=1)..    
-0000b7b0: 6465 6620 7465 7374 5f62 726f 6b65 6e5f  def test_broken_
-0000b7c0: 7379 6d6c 696e 6b28 7365 6c66 2920 2d3e  symlink(self) ->
-0000b7d0: 204e 6f6e 653a 0a20 2020 2020 2020 2077   None:.        w
-0000b7e0: 6974 6820 6361 6368 655f 6469 7228 2920  ith cache_dir() 
-0000b7f0: 6173 2077 6f72 6b73 7061 6365 3a0a 2020  as workspace:.  
-0000b800: 2020 2020 2020 2020 2020 7379 6d6c 696e            symlin
-0000b810: 6b20 3d20 776f 726b 7370 6163 6520 2f20  k = workspace / 
-0000b820: 2262 726f 6b65 6e5f 6c69 6e6b 2e70 7922  "broken_link.py"
-0000b830: 0a20 2020 2020 2020 2020 2020 2074 7279  .            try
-0000b840: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000b850: 2020 7379 6d6c 696e 6b2e 7379 6d6c 696e    symlink.symlin
-0000b860: 6b5f 746f 2822 6e6f 6e65 7869 7374 656e  k_to("nonexisten
-0000b870: 742e 7079 2229 0a20 2020 2020 2020 2020  t.py").         
-0000b880: 2020 2065 7863 6570 7420 284f 5345 7272     except (OSErr
-0000b890: 6f72 2c20 4e6f 7449 6d70 6c65 6d65 6e74  or, NotImplement
-0000b8a0: 6564 4572 726f 7229 2061 7320 653a 0a20  edError) as e:. 
-0000b8b0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000b8c0: 656c 662e 736b 6970 5465 7374 2866 2243  elf.skipTest(f"C
-0000b8d0: 616e 2774 2063 7265 6174 6520 7379 6d6c  an't create syml
-0000b8e0: 696e 6b73 3a20 7b65 7d22 290a 2020 2020  inks: {e}").    
-0000b8f0: 2020 2020 2020 2020 7365 6c66 2e69 6e76          self.inv
-0000b900: 6f6b 6542 6c61 636b 285b 7374 7228 776f  okeBlack([str(wo
-0000b910: 726b 7370 6163 652e 7265 736f 6c76 6528  rkspace.resolve(
-0000b920: 2929 5d29 0a0a 2020 2020 6465 6620 7465  ))])..    def te
-0000b930: 7374 5f73 696e 676c 655f 6669 6c65 5f66  st_single_file_f
-0000b940: 6f72 6365 5f70 7969 2873 656c 6629 202d  orce_pyi(self) -
-0000b950: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-0000b960: 7079 695f 6d6f 6465 203d 2072 6570 6c61  pyi_mode = repla
-0000b970: 6365 2844 4546 4155 4c54 5f4d 4f44 452c  ce(DEFAULT_MODE,
-0000b980: 2069 735f 7079 693d 5472 7565 290a 2020   is_pyi=True).  
-0000b990: 2020 2020 2020 636f 6e74 656e 7473 2c20        contents, 
-0000b9a0: 6578 7065 6374 6564 203d 2072 6561 645f  expected = read_
-0000b9b0: 6461 7461 2822 6d69 7363 656c 6c61 6e65  data("miscellane
-0000b9c0: 6f75 7322 2c20 2266 6f72 6365 5f70 7969  ous", "force_pyi
-0000b9d0: 2229 0a20 2020 2020 2020 2077 6974 6820  ").        with 
-0000b9e0: 6361 6368 655f 6469 7228 2920 6173 2077  cache_dir() as w
-0000b9f0: 6f72 6b73 7061 6365 3a0a 2020 2020 2020  orkspace:.      
-0000ba00: 2020 2020 2020 7061 7468 203d 2028 776f        path = (wo
-0000ba10: 726b 7370 6163 6520 2f20 2266 696c 652e  rkspace / "file.
-0000ba20: 7079 2229 2e72 6573 6f6c 7665 2829 0a20  py").resolve(). 
-0000ba30: 2020 2020 2020 2020 2020 2077 6974 6820             with 
-0000ba40: 6f70 656e 2870 6174 682c 2022 7722 2920  open(path, "w") 
-0000ba50: 6173 2066 683a 0a20 2020 2020 2020 2020  as fh:.         
-0000ba60: 2020 2020 2020 2066 682e 7772 6974 6528         fh.write(
-0000ba70: 636f 6e74 656e 7473 290a 2020 2020 2020  contents).      
-0000ba80: 2020 2020 2020 7365 6c66 2e69 6e76 6f6b        self.invok
-0000ba90: 6542 6c61 636b 285b 7374 7228 7061 7468  eBlack([str(path
-0000baa0: 292c 2022 2d2d 7079 6922 5d29 0a20 2020  ), "--pyi"]).   
-0000bab0: 2020 2020 2020 2020 2077 6974 6820 6f70           with op
-0000bac0: 656e 2870 6174 682c 2022 7222 2920 6173  en(path, "r") as
-0000bad0: 2066 683a 0a20 2020 2020 2020 2020 2020   fh:.           
-0000bae0: 2020 2020 2061 6374 7561 6c20 3d20 6668       actual = fh
-0000baf0: 2e72 6561 6428 290a 2020 2020 2020 2020  .read().        
-0000bb00: 2020 2020 2320 7665 7269 6679 2063 6163      # verify cac
-0000bb10: 6865 2077 6974 6820 2d2d 7079 6920 6973  he with --pyi is
-0000bb20: 2073 6570 6172 6174 650a 2020 2020 2020   separate.      
-0000bb30: 2020 2020 2020 7079 695f 6361 6368 6520        pyi_cache 
-0000bb40: 3d20 6365 7263 6973 2e72 6561 645f 6361  = cercis.read_ca
-0000bb50: 6368 6528 7079 695f 6d6f 6465 290a 2020  che(pyi_mode).  
-0000bb60: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-0000bb70: 7373 6572 7449 6e28 7374 7228 7061 7468  ssertIn(str(path
-0000bb80: 292c 2070 7969 5f63 6163 6865 290a 2020  ), pyi_cache).  
-0000bb90: 2020 2020 2020 2020 2020 6e6f 726d 616c            normal
-0000bba0: 5f63 6163 6865 203d 2063 6572 6369 732e  _cache = cercis.
-0000bbb0: 7265 6164 5f63 6163 6865 2844 4546 4155  read_cache(DEFAU
-0000bbc0: 4c54 5f4d 4f44 4529 0a20 2020 2020 2020  LT_MODE).       
-0000bbd0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-0000bbe0: 4e6f 7449 6e28 7374 7228 7061 7468 292c  NotIn(str(path),
-0000bbf0: 206e 6f72 6d61 6c5f 6361 6368 6529 0a20   normal_cache). 
-0000bc00: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-0000bc10: 7274 466f 726d 6174 4571 7561 6c28 6578  rtFormatEqual(ex
-0000bc20: 7065 6374 6564 2c20 6163 7475 616c 290a  pected, actual).
-0000bc30: 2020 2020 2020 2020 6365 7263 6973 2e61          cercis.a
-0000bc40: 7373 6572 745f 6571 7569 7661 6c65 6e74  ssert_equivalent
-0000bc50: 2863 6f6e 7465 6e74 732c 2061 6374 7561  (contents, actua
-0000bc60: 6c29 0a20 2020 2020 2020 2063 6572 6369  l).        cerci
-0000bc70: 732e 6173 7365 7274 5f73 7461 626c 6528  s.assert_stable(
-0000bc80: 636f 6e74 656e 7473 2c20 6163 7475 616c  contents, actual
-0000bc90: 2c20 7079 695f 6d6f 6465 290a 0a20 2020  , pyi_mode)..   
-0000bca0: 2040 6576 656e 745f 6c6f 6f70 2829 0a20   @event_loop(). 
-0000bcb0: 2020 2064 6566 2074 6573 745f 6d75 6c74     def test_mult
-0000bcc0: 695f 6669 6c65 5f66 6f72 6365 5f70 7969  i_file_force_pyi
-0000bcd0: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
-0000bce0: 2020 2020 2020 2020 7265 675f 6d6f 6465          reg_mode
-0000bcf0: 203d 2044 4546 4155 4c54 5f4d 4f44 450a   = DEFAULT_MODE.
-0000bd00: 2020 2020 2020 2020 7079 695f 6d6f 6465          pyi_mode
-0000bd10: 203d 2072 6570 6c61 6365 2844 4546 4155   = replace(DEFAU
-0000bd20: 4c54 5f4d 4f44 452c 2069 735f 7079 693d  LT_MODE, is_pyi=
-0000bd30: 5472 7565 290a 2020 2020 2020 2020 636f  True).        co
-0000bd40: 6e74 656e 7473 2c20 6578 7065 6374 6564  ntents, expected
-0000bd50: 203d 2072 6561 645f 6461 7461 2822 6d69   = read_data("mi
-0000bd60: 7363 656c 6c61 6e65 6f75 7322 2c20 2266  scellaneous", "f
-0000bd70: 6f72 6365 5f70 7969 2229 0a20 2020 2020  orce_pyi").     
-0000bd80: 2020 2077 6974 6820 6361 6368 655f 6469     with cache_di
-0000bd90: 7228 2920 6173 2077 6f72 6b73 7061 6365  r() as workspace
-0000bda0: 3a0a 2020 2020 2020 2020 2020 2020 7061  :.            pa
-0000bdb0: 7468 7320 3d20 5b0a 2020 2020 2020 2020  ths = [.        
-0000bdc0: 2020 2020 2020 2020 2877 6f72 6b73 7061          (workspa
-0000bdd0: 6365 202f 2022 6669 6c65 312e 7079 2229  ce / "file1.py")
-0000bde0: 2e72 6573 6f6c 7665 2829 2c0a 2020 2020  .resolve(),.    
-0000bdf0: 2020 2020 2020 2020 2020 2020 2877 6f72              (wor
-0000be00: 6b73 7061 6365 202f 2022 6669 6c65 322e  kspace / "file2.
-0000be10: 7079 2229 2e72 6573 6f6c 7665 2829 2c0a  py").resolve(),.
-0000be20: 2020 2020 2020 2020 2020 2020 5d0a 2020              ].  
-0000be30: 2020 2020 2020 2020 2020 666f 7220 7061            for pa
-0000be40: 7468 2069 6e20 7061 7468 733a 0a20 2020  th in paths:.   
-0000be50: 2020 2020 2020 2020 2020 2020 2077 6974               wit
-0000be60: 6820 6f70 656e 2870 6174 682c 2022 7722  h open(path, "w"
-0000be70: 2920 6173 2066 683a 0a20 2020 2020 2020  ) as fh:.       
-0000be80: 2020 2020 2020 2020 2020 2020 2066 682e               fh.
-0000be90: 7772 6974 6528 636f 6e74 656e 7473 290a  write(contents).
-0000bea0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000beb0: 2e69 6e76 6f6b 6542 6c61 636b 285b 7374  .invokeBlack([st
-0000bec0: 7228 7029 2066 6f72 2070 2069 6e20 7061  r(p) for p in pa
-0000bed0: 7468 735d 202b 205b 222d 2d70 7969 225d  ths] + ["--pyi"]
-0000bee0: 290a 2020 2020 2020 2020 2020 2020 666f  ).            fo
-0000bef0: 7220 7061 7468 2069 6e20 7061 7468 733a  r path in paths:
-0000bf00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000bf10: 2077 6974 6820 6f70 656e 2870 6174 682c   with open(path,
-0000bf20: 2022 7222 2920 6173 2066 683a 0a20 2020   "r") as fh:.   
-0000bf30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bf40: 2061 6374 7561 6c20 3d20 6668 2e72 6561   actual = fh.rea
-0000bf50: 6428 290a 2020 2020 2020 2020 2020 2020  d().            
-0000bf60: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-0000bf70: 7175 616c 2861 6374 7561 6c2c 2065 7870  qual(actual, exp
-0000bf80: 6563 7465 6429 0a20 2020 2020 2020 2020  ected).         
-0000bf90: 2020 2023 2076 6572 6966 7920 6361 6368     # verify cach
-0000bfa0: 6520 7769 7468 202d 2d70 7969 2069 7320  e with --pyi is 
-0000bfb0: 7365 7061 7261 7465 0a20 2020 2020 2020  separate.       
-0000bfc0: 2020 2020 2070 7969 5f63 6163 6865 203d       pyi_cache =
-0000bfd0: 2063 6572 6369 732e 7265 6164 5f63 6163   cercis.read_cac
-0000bfe0: 6865 2870 7969 5f6d 6f64 6529 0a20 2020  he(pyi_mode).   
-0000bff0: 2020 2020 2020 2020 206e 6f72 6d61 6c5f           normal_
-0000c000: 6361 6368 6520 3d20 6365 7263 6973 2e72  cache = cercis.r
-0000c010: 6561 645f 6361 6368 6528 7265 675f 6d6f  ead_cache(reg_mo
-0000c020: 6465 290a 2020 2020 2020 2020 2020 2020  de).            
-0000c030: 666f 7220 7061 7468 2069 6e20 7061 7468  for path in path
-0000c040: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-0000c050: 2020 2073 656c 662e 6173 7365 7274 496e     self.assertIn
-0000c060: 2873 7472 2870 6174 6829 2c20 7079 695f  (str(path), pyi_
-0000c070: 6361 6368 6529 0a20 2020 2020 2020 2020  cache).         
-0000c080: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-0000c090: 7274 4e6f 7449 6e28 7374 7228 7061 7468  rtNotIn(str(path
-0000c0a0: 292c 206e 6f72 6d61 6c5f 6361 6368 6529  ), normal_cache)
-0000c0b0: 0a0a 2020 2020 6465 6620 7465 7374 5f70  ..    def test_p
-0000c0c0: 6970 655f 666f 7263 655f 7079 6928 7365  ipe_force_pyi(se
-0000c0d0: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
-0000c0e0: 2020 2020 2073 6f75 7263 652c 2065 7870       source, exp
-0000c0f0: 6563 7465 6420 3d20 7265 6164 5f64 6174  ected = read_dat
-0000c100: 6128 226d 6973 6365 6c6c 616e 656f 7573  a("miscellaneous
-0000c110: 222c 2022 666f 7263 655f 7079 6922 290a  ", "force_pyi").
-0000c120: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
-0000c130: 2043 6c69 5275 6e6e 6572 2829 2e69 6e76   CliRunner().inv
-0000c140: 6f6b 6528 0a20 2020 2020 2020 2020 2020  oke(.           
-0000c150: 2063 6572 6369 732e 6d61 696e 2c20 5b22   cercis.main, ["
-0000c160: 2d22 2c20 222d 7122 2c20 222d 2d70 7969  -", "-q", "--pyi
-0000c170: 225d 2c20 696e 7075 743d 4279 7465 7349  "], input=BytesI
-0000c180: 4f28 736f 7572 6365 2e65 6e63 6f64 6528  O(source.encode(
-0000c190: 2275 7466 3822 2929 0a20 2020 2020 2020  "utf8")).       
-0000c1a0: 2029 0a20 2020 2020 2020 2073 656c 662e   ).        self.
-0000c1b0: 6173 7365 7274 4571 7561 6c28 7265 7375  assertEqual(resu
-0000c1c0: 6c74 2e65 7869 745f 636f 6465 2c20 3029  lt.exit_code, 0)
-0000c1d0: 0a20 2020 2020 2020 2061 6374 7561 6c20  .        actual 
-0000c1e0: 3d20 7265 7375 6c74 2e6f 7574 7075 740a  = result.output.
-0000c1f0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-0000c200: 6572 7446 6f72 6d61 7445 7175 616c 2861  ertFormatEqual(a
-0000c210: 6374 7561 6c2c 2065 7870 6563 7465 6429  ctual, expected)
-0000c220: 0a0a 2020 2020 6465 6620 7465 7374 5f73  ..    def test_s
-0000c230: 696e 676c 655f 6669 6c65 5f66 6f72 6365  ingle_file_force
-0000c240: 5f70 7933 3628 7365 6c66 2920 2d3e 204e  _py36(self) -> N
-0000c250: 6f6e 653a 0a20 2020 2020 2020 2072 6567  one:.        reg
-0000c260: 5f6d 6f64 6520 3d20 4445 4641 554c 545f  _mode = DEFAULT_
-0000c270: 4d4f 4445 0a20 2020 2020 2020 2070 7933  MODE.        py3
-0000c280: 365f 6d6f 6465 203d 2072 6570 6c61 6365  6_mode = replace
-0000c290: 2844 4546 4155 4c54 5f4d 4f44 452c 2074  (DEFAULT_MODE, t
-0000c2a0: 6172 6765 745f 7665 7273 696f 6e73 3d50  arget_versions=P
-0000c2b0: 5933 365f 5645 5253 494f 4e53 290a 2020  Y36_VERSIONS).  
-0000c2c0: 2020 2020 2020 736f 7572 6365 2c20 6578        source, ex
-0000c2d0: 7065 6374 6564 203d 2072 6561 645f 6461  pected = read_da
-0000c2e0: 7461 2822 6d69 7363 656c 6c61 6e65 6f75  ta("miscellaneou
-0000c2f0: 7322 2c20 2266 6f72 6365 5f70 7933 3622  s", "force_py36"
-0000c300: 290a 2020 2020 2020 2020 7769 7468 2063  ).        with c
-0000c310: 6163 6865 5f64 6972 2829 2061 7320 776f  ache_dir() as wo
-0000c320: 726b 7370 6163 653a 0a20 2020 2020 2020  rkspace:.       
-0000c330: 2020 2020 2070 6174 6820 3d20 2877 6f72       path = (wor
-0000c340: 6b73 7061 6365 202f 2022 6669 6c65 2e70  kspace / "file.p
-0000c350: 7922 292e 7265 736f 6c76 6528 290a 2020  y").resolve().  
-0000c360: 2020 2020 2020 2020 2020 7769 7468 206f            with o
-0000c370: 7065 6e28 7061 7468 2c20 2277 2229 2061  pen(path, "w") a
-0000c380: 7320 6668 3a0a 2020 2020 2020 2020 2020  s fh:.          
-0000c390: 2020 2020 2020 6668 2e77 7269 7465 2873        fh.write(s
-0000c3a0: 6f75 7263 6529 0a20 2020 2020 2020 2020  ource).         
-0000c3b0: 2020 2073 656c 662e 696e 766f 6b65 426c     self.invokeBl
-0000c3c0: 6163 6b28 5b73 7472 2870 6174 6829 2c20  ack([str(path), 
-0000c3d0: 2a50 5933 365f 4152 4753 5d29 0a20 2020  *PY36_ARGS]).   
-0000c3e0: 2020 2020 2020 2020 2077 6974 6820 6f70           with op
-0000c3f0: 656e 2870 6174 682c 2022 7222 2920 6173  en(path, "r") as
-0000c400: 2066 683a 0a20 2020 2020 2020 2020 2020   fh:.           
-0000c410: 2020 2020 2061 6374 7561 6c20 3d20 6668       actual = fh
-0000c420: 2e72 6561 6428 290a 2020 2020 2020 2020  .read().        
-0000c430: 2020 2020 2320 7665 7269 6679 2063 6163      # verify cac
-0000c440: 6865 2077 6974 6820 2d2d 7461 7267 6574  he with --target
-0000c450: 2d76 6572 7369 6f6e 2069 7320 7365 7061  -version is sepa
-0000c460: 7261 7465 0a20 2020 2020 2020 2020 2020  rate.           
-0000c470: 2070 7933 365f 6361 6368 6520 3d20 6365   py36_cache = ce
-0000c480: 7263 6973 2e72 6561 645f 6361 6368 6528  rcis.read_cache(
-0000c490: 7079 3336 5f6d 6f64 6529 0a20 2020 2020  py36_mode).     
-0000c4a0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-0000c4b0: 7274 496e 2873 7472 2870 6174 6829 2c20  rtIn(str(path), 
-0000c4c0: 7079 3336 5f63 6163 6865 290a 2020 2020  py36_cache).    
-0000c4d0: 2020 2020 2020 2020 6e6f 726d 616c 5f63          normal_c
-0000c4e0: 6163 6865 203d 2063 6572 6369 732e 7265  ache = cercis.re
-0000c4f0: 6164 5f63 6163 6865 2872 6567 5f6d 6f64  ad_cache(reg_mod
-0000c500: 6529 0a20 2020 2020 2020 2020 2020 2073  e).            s
-0000c510: 656c 662e 6173 7365 7274 4e6f 7449 6e28  elf.assertNotIn(
-0000c520: 7374 7228 7061 7468 292c 206e 6f72 6d61  str(path), norma
-0000c530: 6c5f 6361 6368 6529 0a20 2020 2020 2020  l_cache).       
-0000c540: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-0000c550: 6c28 6163 7475 616c 2c20 6578 7065 6374  l(actual, expect
-0000c560: 6564 290a 0a20 2020 2040 6576 656e 745f  ed)..    @event_
-0000c570: 6c6f 6f70 2829 0a20 2020 2064 6566 2074  loop().    def t
-0000c580: 6573 745f 6d75 6c74 695f 6669 6c65 5f66  est_multi_file_f
-0000c590: 6f72 6365 5f70 7933 3628 7365 6c66 2920  orce_py36(self) 
-0000c5a0: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
-0000c5b0: 2072 6567 5f6d 6f64 6520 3d20 4445 4641   reg_mode = DEFA
-0000c5c0: 554c 545f 4d4f 4445 0a20 2020 2020 2020  ULT_MODE.       
-0000c5d0: 2070 7933 365f 6d6f 6465 203d 2072 6570   py36_mode = rep
-0000c5e0: 6c61 6365 2844 4546 4155 4c54 5f4d 4f44  lace(DEFAULT_MOD
-0000c5f0: 452c 2074 6172 6765 745f 7665 7273 696f  E, target_versio
-0000c600: 6e73 3d50 5933 365f 5645 5253 494f 4e53  ns=PY36_VERSIONS
-0000c610: 290a 2020 2020 2020 2020 736f 7572 6365  ).        source
-0000c620: 2c20 6578 7065 6374 6564 203d 2072 6561  , expected = rea
-0000c630: 645f 6461 7461 2822 6d69 7363 656c 6c61  d_data("miscella
-0000c640: 6e65 6f75 7322 2c20 2266 6f72 6365 5f70  neous", "force_p
-0000c650: 7933 3622 290a 2020 2020 2020 2020 7769  y36").        wi
-0000c660: 7468 2063 6163 6865 5f64 6972 2829 2061  th cache_dir() a
-0000c670: 7320 776f 726b 7370 6163 653a 0a20 2020  s workspace:.   
-0000c680: 2020 2020 2020 2020 2070 6174 6873 203d           paths =
-0000c690: 205b 0a20 2020 2020 2020 2020 2020 2020   [.             
-0000c6a0: 2020 2028 776f 726b 7370 6163 6520 2f20     (workspace / 
-0000c6b0: 2266 696c 6531 2e70 7922 292e 7265 736f  "file1.py").reso
-0000c6c0: 6c76 6528 292c 0a20 2020 2020 2020 2020  lve(),.         
-0000c6d0: 2020 2020 2020 2028 776f 726b 7370 6163         (workspac
-0000c6e0: 6520 2f20 2266 696c 6532 2e70 7922 292e  e / "file2.py").
-0000c6f0: 7265 736f 6c76 6528 292c 0a20 2020 2020  resolve(),.     
-0000c700: 2020 2020 2020 205d 0a20 2020 2020 2020         ].       
-0000c710: 2020 2020 2066 6f72 2070 6174 6820 696e       for path in
-0000c720: 2070 6174 6873 3a0a 2020 2020 2020 2020   paths:.        
-0000c730: 2020 2020 2020 2020 7769 7468 206f 7065          with ope
-0000c740: 6e28 7061 7468 2c20 2277 2229 2061 7320  n(path, "w") as 
-0000c750: 6668 3a0a 2020 2020 2020 2020 2020 2020  fh:.            
-0000c760: 2020 2020 2020 2020 6668 2e77 7269 7465          fh.write
-0000c770: 2873 6f75 7263 6529 0a20 2020 2020 2020  (source).       
-0000c780: 2020 2020 2073 656c 662e 696e 766f 6b65       self.invoke
-0000c790: 426c 6163 6b28 5b73 7472 2870 2920 666f  Black([str(p) fo
-0000c7a0: 7220 7020 696e 2070 6174 6873 5d20 2b20  r p in paths] + 
-0000c7b0: 5059 3336 5f41 5247 5329 0a20 2020 2020  PY36_ARGS).     
-0000c7c0: 2020 2020 2020 2066 6f72 2070 6174 6820         for path 
-0000c7d0: 696e 2070 6174 6873 3a0a 2020 2020 2020  in paths:.      
-0000c7e0: 2020 2020 2020 2020 2020 7769 7468 206f            with o
-0000c7f0: 7065 6e28 7061 7468 2c20 2272 2229 2061  pen(path, "r") a
-0000c800: 7320 6668 3a0a 2020 2020 2020 2020 2020  s fh:.          
-0000c810: 2020 2020 2020 2020 2020 6163 7475 616c            actual
-0000c820: 203d 2066 682e 7265 6164 2829 0a20 2020   = fh.read().   
-0000c830: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0000c840: 662e 6173 7365 7274 4571 7561 6c28 6163  f.assertEqual(ac
-0000c850: 7475 616c 2c20 6578 7065 6374 6564 290a  tual, expected).
-0000c860: 2020 2020 2020 2020 2020 2020 2320 7665              # ve
-0000c870: 7269 6679 2063 6163 6865 2077 6974 6820  rify cache with 
-0000c880: 2d2d 7461 7267 6574 2d76 6572 7369 6f6e  --target-version
-0000c890: 2069 7320 7365 7061 7261 7465 0a20 2020   is separate.   
-0000c8a0: 2020 2020 2020 2020 2070 7969 5f63 6163           pyi_cac
-0000c8b0: 6865 203d 2063 6572 6369 732e 7265 6164  he = cercis.read
-0000c8c0: 5f63 6163 6865 2870 7933 365f 6d6f 6465  _cache(py36_mode
-0000c8d0: 290a 2020 2020 2020 2020 2020 2020 6e6f  ).            no
-0000c8e0: 726d 616c 5f63 6163 6865 203d 2063 6572  rmal_cache = cer
-0000c8f0: 6369 732e 7265 6164 5f63 6163 6865 2872  cis.read_cache(r
-0000c900: 6567 5f6d 6f64 6529 0a20 2020 2020 2020  eg_mode).       
-0000c910: 2020 2020 2066 6f72 2070 6174 6820 696e       for path in
-0000c920: 2070 6174 6873 3a0a 2020 2020 2020 2020   paths:.        
-0000c930: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-0000c940: 6572 7449 6e28 7374 7228 7061 7468 292c  ertIn(str(path),
-0000c950: 2070 7969 5f63 6163 6865 290a 2020 2020   pyi_cache).    
-0000c960: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000c970: 2e61 7373 6572 744e 6f74 496e 2873 7472  .assertNotIn(str
-0000c980: 2870 6174 6829 2c20 6e6f 726d 616c 5f63  (path), normal_c
-0000c990: 6163 6865 290a 0a20 2020 2064 6566 2074  ache)..    def t
-0000c9a0: 6573 745f 7069 7065 5f66 6f72 6365 5f70  est_pipe_force_p
-0000c9b0: 7933 3628 7365 6c66 2920 2d3e 204e 6f6e  y36(self) -> Non
-0000c9c0: 653a 0a20 2020 2020 2020 2073 6f75 7263  e:.        sourc
-0000c9d0: 652c 2065 7870 6563 7465 6420 3d20 7265  e, expected = re
-0000c9e0: 6164 5f64 6174 6128 226d 6973 6365 6c6c  ad_data("miscell
-0000c9f0: 616e 656f 7573 222c 2022 666f 7263 655f  aneous", "force_
-0000ca00: 7079 3336 2229 0a20 2020 2020 2020 2072  py36").        r
-0000ca10: 6573 756c 7420 3d20 436c 6952 756e 6e65  esult = CliRunne
-0000ca20: 7228 292e 696e 766f 6b65 280a 2020 2020  r().invoke(.    
-0000ca30: 2020 2020 2020 2020 6365 7263 6973 2e6d          cercis.m
-0000ca40: 6169 6e2c 0a20 2020 2020 2020 2020 2020  ain,.           
-0000ca50: 205b 222d 222c 2022 2d71 222c 2022 2d2d   ["-", "-q", "--
-0000ca60: 7461 7267 6574 2d76 6572 7369 6f6e 3d70  target-version=p
-0000ca70: 7933 3622 5d2c 0a20 2020 2020 2020 2020  y36"],.         
-0000ca80: 2020 2069 6e70 7574 3d42 7974 6573 494f     input=BytesIO
-0000ca90: 2873 6f75 7263 652e 656e 636f 6465 2822  (source.encode("
-0000caa0: 7574 6638 2229 292c 0a20 2020 2020 2020  utf8")),.       
-0000cab0: 2029 0a20 2020 2020 2020 2073 656c 662e   ).        self.
-0000cac0: 6173 7365 7274 4571 7561 6c28 7265 7375  assertEqual(resu
-0000cad0: 6c74 2e65 7869 745f 636f 6465 2c20 3029  lt.exit_code, 0)
-0000cae0: 0a20 2020 2020 2020 2061 6374 7561 6c20  .        actual 
-0000caf0: 3d20 7265 7375 6c74 2e6f 7574 7075 740a  = result.output.
-0000cb00: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-0000cb10: 6572 7446 6f72 6d61 7445 7175 616c 2861  ertFormatEqual(a
-0000cb20: 6374 7561 6c2c 2065 7870 6563 7465 6429  ctual, expected)
-0000cb30: 0a0a 2020 2020 4070 7974 6573 742e 6d61  ..    @pytest.ma
-0000cb40: 726b 2e69 6e63 6f6d 7061 7469 626c 655f  rk.incompatible_
-0000cb50: 7769 7468 5f6d 7970 7963 0a20 2020 2064  with_mypyc.    d
-0000cb60: 6566 2074 6573 745f 7265 666f 726d 6174  ef test_reformat
-0000cb70: 5f6f 6e65 5f77 6974 685f 7374 6469 6e28  _one_with_stdin(
-0000cb80: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
-0000cb90: 2020 2020 2020 2077 6974 6820 7061 7463         with patc
-0000cba0: 6828 0a20 2020 2020 2020 2020 2020 2022  h(.            "
-0000cbb0: 6365 7263 6973 2e66 6f72 6d61 745f 7374  cercis.format_st
-0000cbc0: 6469 6e5f 746f 5f73 7464 6f75 7422 2c0a  din_to_stdout",.
-0000cbd0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0000cbe0: 726e 5f76 616c 7565 3d6c 616d 6264 6120  rn_value=lambda 
-0000cbf0: 2a61 7267 732c 202a 2a6b 7761 7267 733a  *args, **kwargs:
-0000cc00: 2063 6572 6369 732e 4368 616e 6765 642e   cercis.Changed.
-0000cc10: 5945 532c 0a20 2020 2020 2020 2029 2061  YES,.        ) a
-0000cc20: 7320 6673 7473 3a0a 2020 2020 2020 2020  s fsts:.        
-0000cc30: 2020 2020 7265 706f 7274 203d 204d 6167      report = Mag
-0000cc40: 6963 4d6f 636b 2829 0a20 2020 2020 2020  icMock().       
-0000cc50: 2020 2020 2070 6174 6820 3d20 5061 7468       path = Path
-0000cc60: 2822 2d22 290a 2020 2020 2020 2020 2020  ("-").          
-0000cc70: 2020 6365 7263 6973 2e72 6566 6f72 6d61    cercis.reforma
-0000cc80: 745f 6f6e 6528 0a20 2020 2020 2020 2020  t_one(.         
-0000cc90: 2020 2020 2020 2070 6174 682c 0a20 2020         path,.   
-0000cca0: 2020 2020 2020 2020 2020 2020 2066 6173               fas
-0000ccb0: 743d 5472 7565 2c0a 2020 2020 2020 2020  t=True,.        
-0000ccc0: 2020 2020 2020 2020 7772 6974 655f 6261          write_ba
-0000ccd0: 636b 3d63 6572 6369 732e 5772 6974 6542  ck=cercis.WriteB
-0000cce0: 6163 6b2e 5945 532c 0a20 2020 2020 2020  ack.YES,.       
-0000ccf0: 2020 2020 2020 2020 206d 6f64 653d 4445           mode=DE
-0000cd00: 4641 554c 545f 4d4f 4445 2c0a 2020 2020  FAULT_MODE,.    
-0000cd10: 2020 2020 2020 2020 2020 2020 7265 706f              repo
-0000cd20: 7274 3d72 6570 6f72 742c 0a20 2020 2020  rt=report,.     
-0000cd30: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0000cd40: 2020 2020 2066 7374 732e 6173 7365 7274       fsts.assert
-0000cd50: 5f63 616c 6c65 645f 6f6e 6365 2829 0a20  _called_once(). 
-0000cd60: 2020 2020 2020 2020 2020 2072 6570 6f72             repor
-0000cd70: 742e 646f 6e65 2e61 7373 6572 745f 6361  t.done.assert_ca
-0000cd80: 6c6c 6564 5f77 6974 6828 7061 7468 2c20  lled_with(path, 
-0000cd90: 6365 7263 6973 2e43 6861 6e67 6564 2e59  cercis.Changed.Y
-0000cda0: 4553 290a 0a20 2020 2040 7079 7465 7374  ES)..    @pytest
-0000cdb0: 2e6d 6172 6b2e 696e 636f 6d70 6174 6962  .mark.incompatib
-0000cdc0: 6c65 5f77 6974 685f 6d79 7079 630a 2020  le_with_mypyc.  
-0000cdd0: 2020 6465 6620 7465 7374 5f72 6566 6f72    def test_refor
-0000cde0: 6d61 745f 6f6e 655f 7769 7468 5f73 7464  mat_one_with_std
-0000cdf0: 696e 5f66 696c 656e 616d 6528 7365 6c66  in_filename(self
-0000ce00: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-0000ce10: 2020 2077 6974 6820 7061 7463 6828 0a20     with patch(. 
-0000ce20: 2020 2020 2020 2020 2020 2022 6365 7263             "cerc
-0000ce30: 6973 2e66 6f72 6d61 745f 7374 6469 6e5f  is.format_stdin_
-0000ce40: 746f 5f73 7464 6f75 7422 2c0a 2020 2020  to_stdout",.    
-0000ce50: 2020 2020 2020 2020 7265 7475 726e 5f76          return_v
-0000ce60: 616c 7565 3d6c 616d 6264 6120 2a61 7267  alue=lambda *arg
-0000ce70: 732c 202a 2a6b 7761 7267 733a 2063 6572  s, **kwargs: cer
-0000ce80: 6369 732e 4368 616e 6765 642e 5945 532c  cis.Changed.YES,
-0000ce90: 0a20 2020 2020 2020 2029 2061 7320 6673  .        ) as fs
-0000cea0: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
-0000ceb0: 7265 706f 7274 203d 204d 6167 6963 4d6f  report = MagicMo
-0000cec0: 636b 2829 0a20 2020 2020 2020 2020 2020  ck().           
-0000ced0: 2070 203d 2022 666f 6f2e 7079 220a 2020   p = "foo.py".  
-0000cee0: 2020 2020 2020 2020 2020 7061 7468 203d            path =
-0000cef0: 2050 6174 6828 6622 5f5f 424c 4143 4b5f   Path(f"__BLACK_
-0000cf00: 5354 4449 4e5f 4649 4c45 4e41 4d45 5f5f  STDIN_FILENAME__
-0000cf10: 7b70 7d22 290a 2020 2020 2020 2020 2020  {p}").          
-0000cf20: 2020 6578 7065 6374 6564 203d 2050 6174    expected = Pat
-0000cf30: 6828 7029 0a20 2020 2020 2020 2020 2020  h(p).           
-0000cf40: 2063 6572 6369 732e 7265 666f 726d 6174   cercis.reformat
-0000cf50: 5f6f 6e65 280a 2020 2020 2020 2020 2020  _one(.          
-0000cf60: 2020 2020 2020 7061 7468 2c0a 2020 2020        path,.    
-0000cf70: 2020 2020 2020 2020 2020 2020 6661 7374              fast
-0000cf80: 3d54 7275 652c 0a20 2020 2020 2020 2020  =True,.         
-0000cf90: 2020 2020 2020 2077 7269 7465 5f62 6163         write_bac
-0000cfa0: 6b3d 6365 7263 6973 2e57 7269 7465 4261  k=cercis.WriteBa
-0000cfb0: 636b 2e59 4553 2c0a 2020 2020 2020 2020  ck.YES,.        
-0000cfc0: 2020 2020 2020 2020 6d6f 6465 3d44 4546          mode=DEF
-0000cfd0: 4155 4c54 5f4d 4f44 452c 0a20 2020 2020  AULT_MODE,.     
-0000cfe0: 2020 2020 2020 2020 2020 2072 6570 6f72             repor
-0000cff0: 743d 7265 706f 7274 2c0a 2020 2020 2020  t=report,.      
-0000d000: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-0000d010: 2020 2020 6673 7473 2e61 7373 6572 745f      fsts.assert_
-0000d020: 6361 6c6c 6564 5f6f 6e63 655f 7769 7468  called_once_with
-0000d030: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0000d040: 2020 6661 7374 3d54 7275 652c 2077 7269    fast=True, wri
-0000d050: 7465 5f62 6163 6b3d 6365 7263 6973 2e57  te_back=cercis.W
-0000d060: 7269 7465 4261 636b 2e59 4553 2c20 6d6f  riteBack.YES, mo
-0000d070: 6465 3d44 4546 4155 4c54 5f4d 4f44 450a  de=DEFAULT_MODE.
-0000d080: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-0000d090: 2020 2020 2020 2020 2020 2320 5f5f 424c            # __BL
-0000d0a0: 4143 4b5f 5354 4449 4e5f 4649 4c45 4e41  ACK_STDIN_FILENA
-0000d0b0: 4d45 5f5f 2073 686f 756c 6420 6861 7665  ME__ should have
-0000d0c0: 2062 6565 6e20 7374 7269 7070 6564 0a20   been stripped. 
-0000d0d0: 2020 2020 2020 2020 2020 2072 6570 6f72             repor
-0000d0e0: 742e 646f 6e65 2e61 7373 6572 745f 6361  t.done.assert_ca
-0000d0f0: 6c6c 6564 5f77 6974 6828 6578 7065 6374  lled_with(expect
-0000d100: 6564 2c20 6365 7263 6973 2e43 6861 6e67  ed, cercis.Chang
-0000d110: 6564 2e59 4553 290a 0a20 2020 2040 7079  ed.YES)..    @py
-0000d120: 7465 7374 2e6d 6172 6b2e 696e 636f 6d70  test.mark.incomp
-0000d130: 6174 6962 6c65 5f77 6974 685f 6d79 7079  atible_with_mypy
-0000d140: 630a 2020 2020 6465 6620 7465 7374 5f72  c.    def test_r
-0000d150: 6566 6f72 6d61 745f 6f6e 655f 7769 7468  eformat_one_with
-0000d160: 5f73 7464 696e 5f66 696c 656e 616d 655f  _stdin_filename_
-0000d170: 7079 6928 7365 6c66 2920 2d3e 204e 6f6e  pyi(self) -> Non
-0000d180: 653a 0a20 2020 2020 2020 2077 6974 6820  e:.        with 
-0000d190: 7061 7463 6828 0a20 2020 2020 2020 2020  patch(.         
-0000d1a0: 2020 2022 6365 7263 6973 2e66 6f72 6d61     "cercis.forma
-0000d1b0: 745f 7374 6469 6e5f 746f 5f73 7464 6f75  t_stdin_to_stdou
-0000d1c0: 7422 2c0a 2020 2020 2020 2020 2020 2020  t",.            
-0000d1d0: 7265 7475 726e 5f76 616c 7565 3d6c 616d  return_value=lam
-0000d1e0: 6264 6120 2a61 7267 732c 202a 2a6b 7761  bda *args, **kwa
-0000d1f0: 7267 733a 2063 6572 6369 732e 4368 616e  rgs: cercis.Chan
-0000d200: 6765 642e 5945 532c 0a20 2020 2020 2020  ged.YES,.       
-0000d210: 2029 2061 7320 6673 7473 3a0a 2020 2020   ) as fsts:.    
-0000d220: 2020 2020 2020 2020 7265 706f 7274 203d          report =
-0000d230: 204d 6167 6963 4d6f 636b 2829 0a20 2020   MagicMock().   
-0000d240: 2020 2020 2020 2020 2070 203d 2022 666f           p = "fo
-0000d250: 6f2e 7079 6922 0a20 2020 2020 2020 2020  o.pyi".         
-0000d260: 2020 2070 6174 6820 3d20 5061 7468 2866     path = Path(f
-0000d270: 225f 5f42 4c41 434b 5f53 5444 494e 5f46  "__BLACK_STDIN_F
-0000d280: 494c 454e 414d 455f 5f7b 707d 2229 0a20  ILENAME__{p}"). 
-0000d290: 2020 2020 2020 2020 2020 2065 7870 6563             expec
-0000d2a0: 7465 6420 3d20 5061 7468 2870 290a 2020  ted = Path(p).  
-0000d2b0: 2020 2020 2020 2020 2020 6365 7263 6973            cercis
-0000d2c0: 2e72 6566 6f72 6d61 745f 6f6e 6528 0a20  .reformat_one(. 
-0000d2d0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0000d2e0: 6174 682c 0a20 2020 2020 2020 2020 2020  ath,.           
-0000d2f0: 2020 2020 2066 6173 743d 5472 7565 2c0a       fast=True,.
-0000d300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d310: 7772 6974 655f 6261 636b 3d63 6572 6369  write_back=cerci
-0000d320: 732e 5772 6974 6542 6163 6b2e 5945 532c  s.WriteBack.YES,
-0000d330: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d340: 206d 6f64 653d 4445 4641 554c 545f 4d4f   mode=DEFAULT_MO
-0000d350: 4445 2c0a 2020 2020 2020 2020 2020 2020  DE,.            
-0000d360: 2020 2020 7265 706f 7274 3d72 6570 6f72      report=repor
-0000d370: 742c 0a20 2020 2020 2020 2020 2020 2029  t,.            )
-0000d380: 0a20 2020 2020 2020 2020 2020 2066 7374  .            fst
-0000d390: 732e 6173 7365 7274 5f63 616c 6c65 645f  s.assert_called_
-0000d3a0: 6f6e 6365 5f77 6974 6828 0a20 2020 2020  once_with(.     
-0000d3b0: 2020 2020 2020 2020 2020 2066 6173 743d             fast=
-0000d3c0: 5472 7565 2c0a 2020 2020 2020 2020 2020  True,.          
-0000d3d0: 2020 2020 2020 7772 6974 655f 6261 636b        write_back
-0000d3e0: 3d63 6572 6369 732e 5772 6974 6542 6163  =cercis.WriteBac
-0000d3f0: 6b2e 5945 532c 0a20 2020 2020 2020 2020  k.YES,.         
-0000d400: 2020 2020 2020 206d 6f64 653d 7265 706c         mode=repl
-0000d410: 6163 6528 4445 4641 554c 545f 4d4f 4445  ace(DEFAULT_MODE
-0000d420: 2c20 6973 5f70 7969 3d54 7275 6529 2c0a  , is_pyi=True),.
-0000d430: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-0000d440: 2020 2020 2020 2020 2020 2320 5f5f 424c            # __BL
-0000d450: 4143 4b5f 5354 4449 4e5f 4649 4c45 4e41  ACK_STDIN_FILENA
-0000d460: 4d45 5f5f 2073 686f 756c 6420 6861 7665  ME__ should have
-0000d470: 2062 6565 6e20 7374 7269 7070 6564 0a20   been stripped. 
-0000d480: 2020 2020 2020 2020 2020 2072 6570 6f72             repor
-0000d490: 742e 646f 6e65 2e61 7373 6572 745f 6361  t.done.assert_ca
-0000d4a0: 6c6c 6564 5f77 6974 6828 6578 7065 6374  lled_with(expect
-0000d4b0: 6564 2c20 6365 7263 6973 2e43 6861 6e67  ed, cercis.Chang
-0000d4c0: 6564 2e59 4553 290a 0a20 2020 2040 7079  ed.YES)..    @py
-0000d4d0: 7465 7374 2e6d 6172 6b2e 696e 636f 6d70  test.mark.incomp
-0000d4e0: 6174 6962 6c65 5f77 6974 685f 6d79 7079  atible_with_mypy
-0000d4f0: 630a 2020 2020 6465 6620 7465 7374 5f72  c.    def test_r
-0000d500: 6566 6f72 6d61 745f 6f6e 655f 7769 7468  eformat_one_with
-0000d510: 5f73 7464 696e 5f66 696c 656e 616d 655f  _stdin_filename_
-0000d520: 6970 796e 6228 7365 6c66 2920 2d3e 204e  ipynb(self) -> N
-0000d530: 6f6e 653a 0a20 2020 2020 2020 2077 6974  one:.        wit
-0000d540: 6820 7061 7463 6828 0a20 2020 2020 2020  h patch(.       
-0000d550: 2020 2020 2022 6365 7263 6973 2e66 6f72       "cercis.for
-0000d560: 6d61 745f 7374 6469 6e5f 746f 5f73 7464  mat_stdin_to_std
-0000d570: 6f75 7422 2c0a 2020 2020 2020 2020 2020  out",.          
-0000d580: 2020 7265 7475 726e 5f76 616c 7565 3d6c    return_value=l
-0000d590: 616d 6264 6120 2a61 7267 732c 202a 2a6b  ambda *args, **k
-0000d5a0: 7761 7267 733a 2063 6572 6369 732e 4368  wargs: cercis.Ch
-0000d5b0: 616e 6765 642e 5945 532c 0a20 2020 2020  anged.YES,.     
-0000d5c0: 2020 2029 2061 7320 6673 7473 3a0a 2020     ) as fsts:.  
-0000d5d0: 2020 2020 2020 2020 2020 7265 706f 7274            report
-0000d5e0: 203d 204d 6167 6963 4d6f 636b 2829 0a20   = MagicMock(). 
-0000d5f0: 2020 2020 2020 2020 2020 2070 203d 2022             p = "
-0000d600: 666f 6f2e 6970 796e 6222 0a20 2020 2020  foo.ipynb".     
-0000d610: 2020 2020 2020 2070 6174 6820 3d20 5061         path = Pa
-0000d620: 7468 2866 225f 5f42 4c41 434b 5f53 5444  th(f"__BLACK_STD
-0000d630: 494e 5f46 494c 454e 414d 455f 5f7b 707d  IN_FILENAME__{p}
-0000d640: 2229 0a20 2020 2020 2020 2020 2020 2065  ").            e
-0000d650: 7870 6563 7465 6420 3d20 5061 7468 2870  xpected = Path(p
-0000d660: 290a 2020 2020 2020 2020 2020 2020 6365  ).            ce
-0000d670: 7263 6973 2e72 6566 6f72 6d61 745f 6f6e  rcis.reformat_on
-0000d680: 6528 0a20 2020 2020 2020 2020 2020 2020  e(.             
-0000d690: 2020 2070 6174 682c 0a20 2020 2020 2020     path,.       
-0000d6a0: 2020 2020 2020 2020 2066 6173 743d 5472           fast=Tr
-0000d6b0: 7565 2c0a 2020 2020 2020 2020 2020 2020  ue,.            
-0000d6c0: 2020 2020 7772 6974 655f 6261 636b 3d63      write_back=c
-0000d6d0: 6572 6369 732e 5772 6974 6542 6163 6b2e  ercis.WriteBack.
-0000d6e0: 5945 532c 0a20 2020 2020 2020 2020 2020  YES,.           
-0000d6f0: 2020 2020 206d 6f64 653d 4445 4641 554c       mode=DEFAUL
-0000d700: 545f 4d4f 4445 2c0a 2020 2020 2020 2020  T_MODE,.        
-0000d710: 2020 2020 2020 2020 7265 706f 7274 3d72          report=r
-0000d720: 6570 6f72 742c 0a20 2020 2020 2020 2020  eport,.         
-0000d730: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-0000d740: 2066 7374 732e 6173 7365 7274 5f63 616c   fsts.assert_cal
-0000d750: 6c65 645f 6f6e 6365 5f77 6974 6828 0a20  led_once_with(. 
-0000d760: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0000d770: 6173 743d 5472 7565 2c0a 2020 2020 2020  ast=True,.      
-0000d780: 2020 2020 2020 2020 2020 7772 6974 655f            write_
-0000d790: 6261 636b 3d63 6572 6369 732e 5772 6974  back=cercis.Writ
-0000d7a0: 6542 6163 6b2e 5945 532c 0a20 2020 2020  eBack.YES,.     
-0000d7b0: 2020 2020 2020 2020 2020 206d 6f64 653d             mode=
-0000d7c0: 7265 706c 6163 6528 4445 4641 554c 545f  replace(DEFAULT_
-0000d7d0: 4d4f 4445 2c20 6973 5f69 7079 6e62 3d54  MODE, is_ipynb=T
-0000d7e0: 7275 6529 2c0a 2020 2020 2020 2020 2020  rue),.          
-0000d7f0: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-0000d800: 2320 5f5f 424c 4143 4b5f 5354 4449 4e5f  # __BLACK_STDIN_
-0000d810: 4649 4c45 4e41 4d45 5f5f 2073 686f 756c  FILENAME__ shoul
-0000d820: 6420 6861 7665 2062 6565 6e20 7374 7269  d have been stri
-0000d830: 7070 6564 0a20 2020 2020 2020 2020 2020  pped.           
-0000d840: 2072 6570 6f72 742e 646f 6e65 2e61 7373   report.done.ass
-0000d850: 6572 745f 6361 6c6c 6564 5f77 6974 6828  ert_called_with(
-0000d860: 6578 7065 6374 6564 2c20 6365 7263 6973  expected, cercis
-0000d870: 2e43 6861 6e67 6564 2e59 4553 290a 0a20  .Changed.YES).. 
-0000d880: 2020 2040 7079 7465 7374 2e6d 6172 6b2e     @pytest.mark.
-0000d890: 696e 636f 6d70 6174 6962 6c65 5f77 6974  incompatible_wit
-0000d8a0: 685f 6d79 7079 630a 2020 2020 6465 6620  h_mypyc.    def 
-0000d8b0: 7465 7374 5f72 6566 6f72 6d61 745f 6f6e  test_reformat_on
-0000d8c0: 655f 7769 7468 5f73 7464 696e 5f61 6e64  e_with_stdin_and
-0000d8d0: 5f65 7869 7374 696e 675f 7061 7468 2873  _existing_path(s
-0000d8e0: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
-0000d8f0: 2020 2020 2020 7769 7468 2070 6174 6368        with patch
-0000d900: 280a 2020 2020 2020 2020 2020 2020 2263  (.            "c
-0000d910: 6572 6369 732e 666f 726d 6174 5f73 7464  ercis.format_std
-0000d920: 696e 5f74 6f5f 7374 646f 7574 222c 0a20  in_to_stdout",. 
-0000d930: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0000d940: 6e5f 7661 6c75 653d 6c61 6d62 6461 202a  n_value=lambda *
-0000d950: 6172 6773 2c20 2a2a 6b77 6172 6773 3a20  args, **kwargs: 
-0000d960: 6365 7263 6973 2e43 6861 6e67 6564 2e59  cercis.Changed.Y
-0000d970: 4553 2c0a 2020 2020 2020 2020 2920 6173  ES,.        ) as
-0000d980: 2066 7374 733a 0a20 2020 2020 2020 2020   fsts:.         
-0000d990: 2020 2072 6570 6f72 7420 3d20 4d61 6769     report = Magi
-0000d9a0: 634d 6f63 6b28 290a 2020 2020 2020 2020  cMock().        
-0000d9b0: 2020 2020 2320 4576 656e 2077 6974 6820      # Even with 
-0000d9c0: 616e 2065 7869 7374 696e 6720 6669 6c65  an existing file
-0000d9d0: 2c20 7369 6e63 6520 7765 2061 7265 2066  , since we are f
-0000d9e0: 6f72 6369 6e67 2073 7464 696e 2c20 6365  orcing stdin, ce
-0000d9f0: 7263 6973 0a20 2020 2020 2020 2020 2020  rcis.           
-0000da00: 2023 2073 686f 756c 6420 6f75 7470 7574   # should output
-0000da10: 2074 6f20 7374 646f 7574 2061 6e64 206e   to stdout and n
-0000da20: 6f74 206d 6f64 6966 7920 7468 6520 6669  ot modify the fi
-0000da30: 6c65 2069 6e70 6c61 6365 0a20 2020 2020  le inplace.     
-0000da40: 2020 2020 2020 2070 203d 2054 4849 535f         p = THIS_
-0000da50: 4449 5220 2f20 2264 6174 6122 202f 2022  DIR / "data" / "
-0000da60: 7369 6d70 6c65 5f63 6173 6573 2220 2f20  simple_cases" / 
-0000da70: 2263 6f6c 6c65 6374 696f 6e73 2e70 7922  "collections.py"
-0000da80: 0a20 2020 2020 2020 2020 2020 2023 204d  .            # M
-0000da90: 616b 6520 7375 7265 2069 735f 6669 6c65  ake sure is_file
-0000daa0: 2061 6374 7561 6c6c 7920 7265 7475 726e   actually return
-0000dab0: 7320 5472 7565 0a20 2020 2020 2020 2020  s True.         
-0000dac0: 2020 2073 656c 662e 6173 7365 7274 5472     self.assertTr
-0000dad0: 7565 2870 2e69 735f 6669 6c65 2829 290a  ue(p.is_file()).
-0000dae0: 2020 2020 2020 2020 2020 2020 7061 7468              path
-0000daf0: 203d 2050 6174 6828 6622 5f5f 424c 4143   = Path(f"__BLAC
-0000db00: 4b5f 5354 4449 4e5f 4649 4c45 4e41 4d45  K_STDIN_FILENAME
-0000db10: 5f5f 7b70 7d22 290a 2020 2020 2020 2020  __{p}").        
-0000db20: 2020 2020 6578 7065 6374 6564 203d 2050      expected = P
-0000db30: 6174 6828 7029 0a20 2020 2020 2020 2020  ath(p).         
-0000db40: 2020 2063 6572 6369 732e 7265 666f 726d     cercis.reform
-0000db50: 6174 5f6f 6e65 280a 2020 2020 2020 2020  at_one(.        
-0000db60: 2020 2020 2020 2020 7061 7468 2c0a 2020          path,.  
-0000db70: 2020 2020 2020 2020 2020 2020 2020 6661                fa
-0000db80: 7374 3d54 7275 652c 0a20 2020 2020 2020  st=True,.       
-0000db90: 2020 2020 2020 2020 2077 7269 7465 5f62           write_b
-0000dba0: 6163 6b3d 6365 7263 6973 2e57 7269 7465  ack=cercis.Write
-0000dbb0: 4261 636b 2e59 4553 2c0a 2020 2020 2020  Back.YES,.      
-0000dbc0: 2020 2020 2020 2020 2020 6d6f 6465 3d44            mode=D
-0000dbd0: 4546 4155 4c54 5f4d 4f44 452c 0a20 2020  EFAULT_MODE,.   
-0000dbe0: 2020 2020 2020 2020 2020 2020 2072 6570               rep
-0000dbf0: 6f72 743d 7265 706f 7274 2c0a 2020 2020  ort=report,.    
-0000dc00: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-0000dc10: 2020 2020 2020 6673 7473 2e61 7373 6572        fsts.asser
-0000dc20: 745f 6361 6c6c 6564 5f6f 6e63 6528 290a  t_called_once().
-0000dc30: 2020 2020 2020 2020 2020 2020 2320 5f5f              # __
-0000dc40: 424c 4143 4b5f 5354 4449 4e5f 4649 4c45  BLACK_STDIN_FILE
-0000dc50: 4e41 4d45 5f5f 2073 686f 756c 6420 6861  NAME__ should ha
-0000dc60: 7665 2062 6565 6e20 7374 7269 7070 6564  ve been stripped
-0000dc70: 0a20 2020 2020 2020 2020 2020 2072 6570  .            rep
-0000dc80: 6f72 742e 646f 6e65 2e61 7373 6572 745f  ort.done.assert_
-0000dc90: 6361 6c6c 6564 5f77 6974 6828 6578 7065  called_with(expe
-0000dca0: 6374 6564 2c20 6365 7263 6973 2e43 6861  cted, cercis.Cha
-0000dcb0: 6e67 6564 2e59 4553 290a 0a20 2020 2064  nged.YES)..    d
-0000dcc0: 6566 2074 6573 745f 7265 666f 726d 6174  ef test_reformat
-0000dcd0: 5f6f 6e65 5f77 6974 685f 7374 6469 6e5f  _one_with_stdin_
-0000dce0: 656d 7074 7928 7365 6c66 2920 2d3e 204e  empty(self) -> N
-0000dcf0: 6f6e 653a 0a20 2020 2020 2020 2063 6173  one:.        cas
-0000dd00: 6573 203d 205b 0a20 2020 2020 2020 2020  es = [.         
-0000dd10: 2020 2028 2222 2c20 2222 292c 0a20 2020     ("", ""),.   
-0000dd20: 2020 2020 2020 2020 2028 225c 6e22 2c20           ("\n", 
-0000dd30: 225c 6e22 292c 0a20 2020 2020 2020 2020  "\n"),.         
-0000dd40: 2020 2028 225c 725c 6e22 2c20 225c 725c     ("\r\n", "\r\
-0000dd50: 6e22 292c 0a20 2020 2020 2020 2020 2020  n"),.           
-0000dd60: 2028 2220 5c74 222c 2022 2229 2c0a 2020   (" \t", ""),.  
-0000dd70: 2020 2020 2020 2020 2020 2822 205c 745c            (" \t\
-0000dd80: 6e5c 7420 222c 2022 5c6e 2229 2c0a 2020  n\t ", "\n"),.  
-0000dd90: 2020 2020 2020 2020 2020 2822 205c 745c            (" \t\
-0000dda0: 725c 6e5c 7420 222c 2022 5c72 5c6e 2229  r\n\t ", "\r\n")
-0000ddb0: 2c0a 2020 2020 2020 2020 5d0a 0a20 2020  ,.        ]..   
-0000ddc0: 2020 2020 2064 6566 205f 6e65 775f 7772       def _new_wr
-0000ddd0: 6170 7065 7228 0a20 2020 2020 2020 2020  apper(.         
-0000dde0: 2020 2020 2020 206f 7574 7075 743a 2069         output: i
-0000ddf0: 6f2e 5374 7269 6e67 494f 2c20 696f 5f54  o.StringIO, io_T
-0000de00: 6578 7449 4f57 7261 7070 6572 3a20 5479  extIOWrapper: Ty
-0000de10: 7065 5b69 6f2e 5465 7874 494f 5772 6170  pe[io.TextIOWrap
-0000de20: 7065 725d 0a20 2020 2020 2020 2029 202d  per].        ) -
-0000de30: 3e20 4361 6c6c 6162 6c65 5b5b 416e 792c  > Callable[[Any,
-0000de40: 2041 6e79 5d2c 2069 6f2e 5465 7874 494f   Any], io.TextIO
-0000de50: 5772 6170 7065 725d 3a0a 2020 2020 2020  Wrapper]:.      
-0000de60: 2020 2020 2020 6465 6620 6765 745f 6f75        def get_ou
-0000de70: 7470 7574 282a 6172 6773 3a20 416e 792c  tput(*args: Any,
-0000de80: 202a 2a6b 7761 7267 733a 2041 6e79 2920   **kwargs: Any) 
-0000de90: 2d3e 2069 6f2e 5465 7874 494f 5772 6170  -> io.TextIOWrap
-0000dea0: 7065 723a 0a20 2020 2020 2020 2020 2020  per:.           
-0000deb0: 2020 2020 2069 6620 6172 6773 203d 3d20       if args == 
-0000dec0: 2873 7973 2e73 7464 6f75 742e 6275 6666  (sys.stdout.buff
-0000ded0: 6572 2c29 3a0a 2020 2020 2020 2020 2020  er,):.          
-0000dee0: 2020 2020 2020 2020 2020 2320 4974 2773            # It's
-0000def0: 2060 666f 726d 6174 5f73 7464 696e 5f74   `format_stdin_t
-0000df00: 6f5f 7374 646f 7574 2829 6020 6361 6c6c  o_stdout()` call
-0000df10: 696e 6720 6069 6f2e 5465 7874 494f 5772  ing `io.TextIOWr
-0000df20: 6170 7065 7228 2960 2c0a 2020 2020 2020  apper()`,.      
-0000df30: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0000df40: 7265 7475 726e 206f 7572 206d 6f63 6b20  return our mock 
-0000df50: 6f62 6a65 6374 2e0a 2020 2020 2020 2020  object..        
-0000df60: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0000df70: 726e 206f 7574 7075 740a 2020 2020 2020  rn output.      
-0000df80: 2020 2020 2020 2020 2020 2320 4974 2773            # It's
-0000df90: 2073 6f6d 6574 6869 6e67 2065 6c73 6520   something else 
-0000dfa0: 2869 2e65 2e20 6064 6563 6f64 655f 6279  (i.e. `decode_by
-0000dfb0: 7465 7328 2960 2920 6361 6c6c 696e 670a  tes()`) calling.
-0000dfc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dfd0: 2320 6069 6f2e 5465 7874 494f 5772 6170  # `io.TextIOWrap
-0000dfe0: 7065 7228 2960 2c20 7061 7373 2074 6872  per()`, pass thr
-0000dff0: 6f75 6768 2074 6f20 7468 6520 6f72 6967  ough to the orig
-0000e000: 696e 616c 2069 6d70 6c65 6d65 6e74 6174  inal implementat
-0000e010: 696f 6e2e 0a20 2020 2020 2020 2020 2020  ion..           
-0000e020: 2020 2020 2023 2053 6565 2064 6973 6375       # See discu
-0000e030: 7373 696f 6e20 696e 2068 7474 7073 3a2f  ssion in https:/
-0000e040: 2f67 6974 6875 622e 636f 6d2f 7073 662f  /github.com/psf/
-0000e050: 626c 6163 6b2f 7075 6c6c 2f32 3438 390a  black/pull/2489.
-0000e060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e070: 7265 7475 726e 2069 6f5f 5465 7874 494f  return io_TextIO
-0000e080: 5772 6170 7065 7228 2a61 7267 732c 202a  Wrapper(*args, *
-0000e090: 2a6b 7761 7267 7329 0a0a 2020 2020 2020  *kwargs)..      
-0000e0a0: 2020 2020 2020 7265 7475 726e 2067 6574        return get
-0000e0b0: 5f6f 7574 7075 740a 0a20 2020 2020 2020  _output..       
-0000e0c0: 206d 6f64 6520 3d20 6365 7263 6973 2e4d   mode = cercis.M
-0000e0d0: 6f64 6528 7072 6576 6965 773d 5472 7565  ode(preview=True
-0000e0e0: 290a 2020 2020 2020 2020 666f 7220 636f  ).        for co
-0000e0f0: 6e74 656e 742c 2065 7870 6563 7465 6420  ntent, expected 
-0000e100: 696e 2063 6173 6573 3a0a 2020 2020 2020  in cases:.      
-0000e110: 2020 2020 2020 6f75 7470 7574 203d 2069        output = i
-0000e120: 6f2e 5374 7269 6e67 494f 2829 0a20 2020  o.StringIO().   
-0000e130: 2020 2020 2020 2020 2069 6f5f 5465 7874           io_Text
-0000e140: 494f 5772 6170 7065 7220 3d20 696f 2e54  IOWrapper = io.T
-0000e150: 6578 7449 4f57 7261 7070 6572 0a0a 2020  extIOWrapper..  
-0000e160: 2020 2020 2020 2020 2020 7769 7468 2070            with p
-0000e170: 6174 6368 2822 696f 2e54 6578 7449 4f57  atch("io.TextIOW
-0000e180: 7261 7070 6572 222c 205f 6e65 775f 7772  rapper", _new_wr
-0000e190: 6170 7065 7228 6f75 7470 7574 2c20 696f  apper(output, io
-0000e1a0: 5f54 6578 7449 4f57 7261 7070 6572 2929  _TextIOWrapper))
-0000e1b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000e1c0: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
-0000e1d0: 2020 2020 2020 2020 2020 2063 6572 6369             cerci
-0000e1e0: 732e 666f 726d 6174 5f73 7464 696e 5f74  s.format_stdin_t
-0000e1f0: 6f5f 7374 646f 7574 280a 2020 2020 2020  o_stdout(.      
-0000e200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e210: 2020 6661 7374 3d54 7275 652c 0a20 2020    fast=True,.   
-0000e220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e230: 2020 2020 2063 6f6e 7465 6e74 3d63 6f6e       content=con
-0000e240: 7465 6e74 2c0a 2020 2020 2020 2020 2020  tent,.          
-0000e250: 2020 2020 2020 2020 2020 2020 2020 7772                wr
-0000e260: 6974 655f 6261 636b 3d63 6572 6369 732e  ite_back=cercis.
-0000e270: 5772 6974 6542 6163 6b2e 5945 532c 0a20  WriteBack.YES,. 
-0000e280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e290: 2020 2020 2020 206d 6f64 653d 6d6f 6465         mode=mode
-0000e2a0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000e2b0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-0000e2c0: 2020 2020 2020 2020 6578 6365 7074 2069          except i
-0000e2d0: 6f2e 556e 7375 7070 6f72 7465 644f 7065  o.UnsupportedOpe
-0000e2e0: 7261 7469 6f6e 3a0a 2020 2020 2020 2020  ration:.        
-0000e2f0: 2020 2020 2020 2020 2020 2020 7061 7373              pass
-0000e300: 2020 2320 5374 7269 6e67 494f 2064 6f65    # StringIO doe
-0000e310: 7320 6e6f 7420 7375 7070 6f72 7420 6465  s not support de
-0000e320: 7461 6368 0a20 2020 2020 2020 2020 2020  tach.           
-0000e330: 2020 2020 2061 7373 6572 7420 6f75 7470       assert outp
-0000e340: 7574 2e67 6574 7661 6c75 6528 2920 3d3d  ut.getvalue() ==
-0000e350: 2065 7870 6563 7465 640a 0a20 2020 2020   expected..     
-0000e360: 2020 2023 2041 6e20 656d 7074 7920 7374     # An empty st
-0000e370: 7269 6e67 2069 7320 7468 6520 6f6e 6c79  ring is the only
-0000e380: 2074 6573 7420 6361 7365 2066 6f72 2060   test case for `
-0000e390: 7072 6576 6965 773d 4661 6c73 6560 0a20  preview=False`. 
-0000e3a0: 2020 2020 2020 206f 7574 7075 7420 3d20         output = 
-0000e3b0: 696f 2e53 7472 696e 6749 4f28 290a 2020  io.StringIO().  
-0000e3c0: 2020 2020 2020 696f 5f54 6578 7449 4f57        io_TextIOW
-0000e3d0: 7261 7070 6572 203d 2069 6f2e 5465 7874  rapper = io.Text
-0000e3e0: 494f 5772 6170 7065 720a 2020 2020 2020  IOWrapper.      
-0000e3f0: 2020 7769 7468 2070 6174 6368 2822 696f    with patch("io
-0000e400: 2e54 6578 7449 4f57 7261 7070 6572 222c  .TextIOWrapper",
-0000e410: 205f 6e65 775f 7772 6170 7065 7228 6f75   _new_wrapper(ou
-0000e420: 7470 7574 2c20 696f 5f54 6578 7449 4f57  tput, io_TextIOW
-0000e430: 7261 7070 6572 2929 3a0a 2020 2020 2020  rapper)):.      
-0000e440: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-0000e450: 2020 2020 2020 2020 2020 2063 6572 6369             cerci
-0000e460: 732e 666f 726d 6174 5f73 7464 696e 5f74  s.format_stdin_t
-0000e470: 6f5f 7374 646f 7574 280a 2020 2020 2020  o_stdout(.      
-0000e480: 2020 2020 2020 2020 2020 2020 2020 6661                fa
-0000e490: 7374 3d54 7275 652c 0a20 2020 2020 2020  st=True,.       
-0000e4a0: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
-0000e4b0: 7465 6e74 3d22 222c 0a20 2020 2020 2020  tent="",.       
-0000e4c0: 2020 2020 2020 2020 2020 2020 2077 7269               wri
-0000e4d0: 7465 5f62 6163 6b3d 6365 7263 6973 2e57  te_back=cercis.W
-0000e4e0: 7269 7465 4261 636b 2e59 4553 2c0a 2020  riteBack.YES,.  
-0000e4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e500: 2020 6d6f 6465 3d44 4546 4155 4c54 5f4d    mode=DEFAULT_M
-0000e510: 4f44 452c 0a20 2020 2020 2020 2020 2020  ODE,.           
-0000e520: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-0000e530: 2020 2065 7863 6570 7420 696f 2e55 6e73     except io.Uns
-0000e540: 7570 706f 7274 6564 4f70 6572 6174 696f  upportedOperatio
-0000e550: 6e3a 0a20 2020 2020 2020 2020 2020 2020  n:.             
-0000e560: 2020 2070 6173 7320 2023 2053 7472 696e     pass  # Strin
-0000e570: 6749 4f20 646f 6573 206e 6f74 2073 7570  gIO does not sup
-0000e580: 706f 7274 2064 6574 6163 680a 2020 2020  port detach.    
-0000e590: 2020 2020 2020 2020 6173 7365 7274 206f          assert o
-0000e5a0: 7574 7075 742e 6765 7476 616c 7565 2829  utput.getvalue()
-0000e5b0: 203d 3d20 2222 0a0a 2020 2020 6465 6620   == ""..    def 
-0000e5c0: 7465 7374 5f69 6e76 616c 6964 5f63 6c69  test_invalid_cli
-0000e5d0: 5f72 6567 6578 2873 656c 6629 202d 3e20  _regex(self) -> 
-0000e5e0: 4e6f 6e65 3a0a 2020 2020 2020 2020 666f  None:.        fo
-0000e5f0: 7220 6f70 7469 6f6e 2069 6e20 5b22 2d2d  r option in ["--
-0000e600: 696e 636c 7564 6522 2c20 222d 2d65 7863  include", "--exc
-0000e610: 6c75 6465 222c 2022 2d2d 6578 7465 6e64  lude", "--extend
-0000e620: 2d65 7863 6c75 6465 222c 2022 2d2d 666f  -exclude", "--fo
-0000e630: 7263 652d 6578 636c 7564 6522 5d3a 0a20  rce-exclude"]:. 
-0000e640: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000e650: 696e 766f 6b65 426c 6163 6b28 5b22 2d22  invokeBlack(["-"
-0000e660: 2c20 6f70 7469 6f6e 2c20 222a 2a28 2928  , option, "**()(
-0000e670: 2121 2a29 225d 2c20 6578 6974 5f63 6f64  !!*)"], exit_cod
-0000e680: 653d 3229 0a0a 2020 2020 6465 6620 7465  e=2)..    def te
-0000e690: 7374 5f72 6571 7569 7265 645f 7665 7273  st_required_vers
-0000e6a0: 696f 6e5f 6d61 7463 6865 735f 7665 7273  ion_matches_vers
-0000e6b0: 696f 6e28 7365 6c66 2920 2d3e 204e 6f6e  ion(self) -> Non
-0000e6c0: 653a 0a20 2020 2020 2020 2073 656c 662e  e:.        self.
-0000e6d0: 696e 766f 6b65 426c 6163 6b28 0a20 2020  invokeBlack(.   
-0000e6e0: 2020 2020 2020 2020 205b 222d 2d72 6571           ["--req
-0000e6f0: 7569 7265 642d 7665 7273 696f 6e22 2c20  uired-version", 
-0000e700: 6365 7263 6973 2e5f 5f76 6572 7369 6f6e  cercis.__version
-0000e710: 5f5f 2c20 222d 6322 2c20 2230 225d 2c0a  __, "-c", "0"],.
-0000e720: 2020 2020 2020 2020 2020 2020 6578 6974              exit
-0000e730: 5f63 6f64 653d 302c 0a20 2020 2020 2020  _code=0,.       
-0000e740: 2020 2020 2069 676e 6f72 655f 636f 6e66       ignore_conf
-0000e750: 6967 3d54 7275 652c 0a20 2020 2020 2020  ig=True,.       
-0000e760: 2029 0a0a 2020 2020 6465 6620 7465 7374   )..    def test
-0000e770: 5f72 6571 7569 7265 645f 7665 7273 696f  _required_versio
-0000e780: 6e5f 6d61 7463 6865 735f 7061 7274 6961  n_matches_partia
-0000e790: 6c5f 7665 7273 696f 6e28 7365 6c66 2920  l_version(self) 
-0000e7a0: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
-0000e7b0: 2073 656c 662e 696e 766f 6b65 426c 6163   self.invokeBlac
-0000e7c0: 6b28 0a20 2020 2020 2020 2020 2020 205b  k(.            [
-0000e7d0: 222d 2d72 6571 7569 7265 642d 7665 7273  "--required-vers
-0000e7e0: 696f 6e22 2c20 6365 7263 6973 2e5f 5f76  ion", cercis.__v
-0000e7f0: 6572 7369 6f6e 5f5f 2e73 706c 6974 2822  ersion__.split("
-0000e800: 2e22 295b 305d 2c20 222d 6322 2c20 2230  .")[0], "-c", "0
-0000e810: 225d 2c0a 2020 2020 2020 2020 2020 2020  "],.            
-0000e820: 6578 6974 5f63 6f64 653d 302c 0a20 2020  exit_code=0,.   
-0000e830: 2020 2020 2020 2020 2069 676e 6f72 655f           ignore_
-0000e840: 636f 6e66 6967 3d54 7275 652c 0a20 2020  config=True,.   
-0000e850: 2020 2020 2029 0a0a 2020 2020 6465 6620       )..    def 
+00008130: 6572 7445 7175 616c 286c 656e 2865 7272  ertEqual(len(err
+00008140: 5f6c 696e 6573 292c 2032 290a 2020 2020  _lines), 2).    
+00008150: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00008160: 6572 7445 7175 616c 280a 2020 2020 2020  ertEqual(.      
+00008170: 2020 2020 2020 2020 2020 756e 7374 796c            unstyl
+00008180: 6528 7374 7228 7265 706f 7274 2929 2c0a  e(str(report)),.
+00008190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000081a0: 2232 2066 696c 6573 2072 6566 6f72 6d61  "2 files reforma
+000081b0: 7474 6564 2c20 3320 6669 6c65 7320 6c65  tted, 3 files le
+000081c0: 6674 2075 6e63 6861 6e67 6564 2c20 3220  ft unchanged, 2 
+000081d0: 6669 6c65 7320 6661 696c 6564 2074 6f22  files failed to"
+000081e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000081f0: 2022 2072 6566 6f72 6d61 742e 222c 0a20   " reformat.",. 
+00008200: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+00008210: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
+00008220: 7365 7274 4571 7561 6c28 7265 706f 7274  sertEqual(report
+00008230: 2e72 6574 7572 6e5f 636f 6465 2c20 3132  .return_code, 12
+00008240: 3329 0a20 2020 2020 2020 2020 2020 2072  3).            r
+00008250: 6570 6f72 742e 6368 6563 6b20 3d20 5472  eport.check = Tr
+00008260: 7565 0a20 2020 2020 2020 2020 2020 2073  ue.            s
+00008270: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+00008280: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00008290: 2075 6e73 7479 6c65 2873 7472 2872 6570   unstyle(str(rep
+000082a0: 6f72 7429 292c 0a20 2020 2020 2020 2020  ort)),.         
+000082b0: 2020 2020 2020 2022 3220 6669 6c65 7320         "2 files 
+000082c0: 776f 756c 6420 6265 2072 6566 6f72 6d61  would be reforma
+000082d0: 7474 6564 2c20 3320 6669 6c65 7320 776f  tted, 3 files wo
+000082e0: 756c 6420 6265 206c 6566 7420 756e 6368  uld be left unch
+000082f0: 616e 6765 642c 2032 220a 2020 2020 2020  anged, 2".      
+00008300: 2020 2020 2020 2020 2020 2220 6669 6c65            " file
+00008310: 7320 776f 756c 6420 6661 696c 2074 6f20  s would fail to 
+00008320: 7265 666f 726d 6174 2e22 2c0a 2020 2020  reformat.",.    
+00008330: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00008340: 2020 2020 2020 7265 706f 7274 2e63 6865        report.che
+00008350: 636b 203d 2046 616c 7365 0a20 2020 2020  ck = False.     
+00008360: 2020 2020 2020 2072 6570 6f72 742e 6469         report.di
+00008370: 6666 203d 2054 7275 650a 2020 2020 2020  ff = True.      
+00008380: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00008390: 7445 7175 616c 280a 2020 2020 2020 2020  tEqual(.        
+000083a0: 2020 2020 2020 2020 756e 7374 796c 6528          unstyle(
+000083b0: 7374 7228 7265 706f 7274 2929 2c0a 2020  str(report)),.  
+000083c0: 2020 2020 2020 2020 2020 2020 2020 2232                "2
+000083d0: 2066 696c 6573 2077 6f75 6c64 2062 6520   files would be 
+000083e0: 7265 666f 726d 6174 7465 642c 2033 2066  reformatted, 3 f
+000083f0: 696c 6573 2077 6f75 6c64 2062 6520 6c65  iles would be le
+00008400: 6674 2075 6e63 6861 6e67 6564 2c20 3222  ft unchanged, 2"
+00008410: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00008420: 2022 2066 696c 6573 2077 6f75 6c64 2066   " files would f
+00008430: 6169 6c20 746f 2072 6566 6f72 6d61 742e  ail to reformat.
+00008440: 222c 0a20 2020 2020 2020 2020 2020 2029  ",.            )
+00008450: 0a0a 2020 2020 6465 6620 7465 7374 5f6c  ..    def test_l
+00008460: 6962 3274 6f33 5f70 6172 7365 2873 656c  ib2to3_parse(sel
+00008470: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
+00008480: 2020 2020 7769 7468 2073 656c 662e 6173      with self.as
+00008490: 7365 7274 5261 6973 6573 2863 6572 6369  sertRaises(cerci
+000084a0: 732e 496e 7661 6c69 6449 6e70 7574 293a  s.InvalidInput):
+000084b0: 0a20 2020 2020 2020 2020 2020 2063 6572  .            cer
+000084c0: 6369 732e 6c69 6232 746f 335f 7061 7273  cis.lib2to3_pars
+000084d0: 6528 2269 6e76 616c 6964 2073 796e 7461  e("invalid synta
+000084e0: 7822 290a 0a20 2020 2020 2020 2073 7472  x")..        str
+000084f0: 6164 646c 696e 6720 3d20 2278 202b 2079  addling = "x + y
+00008500: 220a 2020 2020 2020 2020 6365 7263 6973  ".        cercis
+00008510: 2e6c 6962 3274 6f33 5f70 6172 7365 2873  .lib2to3_parse(s
+00008520: 7472 6164 646c 696e 6729 0a20 2020 2020  traddling).     
+00008530: 2020 2063 6572 6369 732e 6c69 6232 746f     cercis.lib2to
+00008540: 335f 7061 7273 6528 7374 7261 6464 6c69  3_parse(straddli
+00008550: 6e67 2c20 7b54 6172 6765 7456 6572 7369  ng, {TargetVersi
+00008560: 6f6e 2e50 5933 367d 290a 0a20 2020 2020  on.PY36})..     
+00008570: 2020 2070 7932 5f6f 6e6c 7920 3d20 2270     py2_only = "p
+00008580: 7269 6e74 2078 220a 2020 2020 2020 2020  rint x".        
+00008590: 7769 7468 2073 656c 662e 6173 7365 7274  with self.assert
+000085a0: 5261 6973 6573 2863 6572 6369 732e 496e  Raises(cercis.In
+000085b0: 7661 6c69 6449 6e70 7574 293a 0a20 2020  validInput):.   
+000085c0: 2020 2020 2020 2020 2063 6572 6369 732e           cercis.
+000085d0: 6c69 6232 746f 335f 7061 7273 6528 7079  lib2to3_parse(py
+000085e0: 325f 6f6e 6c79 2c20 7b54 6172 6765 7456  2_only, {TargetV
+000085f0: 6572 7369 6f6e 2e50 5933 367d 290a 0a20  ersion.PY36}).. 
+00008600: 2020 2020 2020 2070 7933 5f6f 6e6c 7920         py3_only 
+00008610: 3d20 2265 7865 6328 782c 2065 6e64 3d79  = "exec(x, end=y
+00008620: 2922 0a20 2020 2020 2020 2063 6572 6369  )".        cerci
+00008630: 732e 6c69 6232 746f 335f 7061 7273 6528  s.lib2to3_parse(
+00008640: 7079 335f 6f6e 6c79 290a 2020 2020 2020  py3_only).      
+00008650: 2020 6365 7263 6973 2e6c 6962 3274 6f33    cercis.lib2to3
+00008660: 5f70 6172 7365 2870 7933 5f6f 6e6c 792c  _parse(py3_only,
+00008670: 207b 5461 7267 6574 5665 7273 696f 6e2e   {TargetVersion.
+00008680: 5059 3336 7d29 0a0a 2020 2020 6465 6620  PY36})..    def 
+00008690: 7465 7374 5f67 6574 5f66 6561 7475 7265  test_get_feature
+000086a0: 735f 7573 6564 5f64 6563 6f72 6174 6f72  s_used_decorator
+000086b0: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
+000086c0: 2020 2020 2020 2020 2320 5465 7374 2074          # Test t
+000086d0: 6865 2066 6561 7475 7265 2064 6574 6563  he feature detec
+000086e0: 7469 6f6e 206f 6620 6e65 7720 6465 636f  tion of new deco
+000086f0: 7261 746f 7220 7379 6e74 6178 0a20 2020  rator syntax.   
+00008700: 2020 2020 2023 2073 696e 6365 2074 6869       # since thi
+00008710: 7320 6d61 6b65 7320 736f 6d65 2074 6573  s makes some tes
+00008720: 7420 6361 7365 7320 6f66 2074 6573 745f  t cases of test_
+00008730: 6765 745f 6665 6174 7572 6573 5f75 7365  get_features_use
+00008740: 6428 290a 2020 2020 2020 2020 2320 6661  d().        # fa
+00008750: 696c 7320 6966 2069 7420 6661 696c 732c  ils if it fails,
+00008760: 2074 6869 7320 6973 2074 6573 7465 6420   this is tested 
+00008770: 6669 7273 7420 736f 2074 6861 7420 6120  first so that a 
+00008780: 7573 6566 756c 2063 6173 650a 2020 2020  useful case.    
+00008790: 2020 2020 2320 6973 2069 6465 6e74 6966      # is identif
+000087a0: 6965 640a 2020 2020 2020 2020 7369 6d70  ied.        simp
+000087b0: 6c65 732c 2072 656c 6178 6564 203d 2072  les, relaxed = r
+000087c0: 6561 645f 6461 7461 2822 6d69 7363 656c  ead_data("miscel
+000087d0: 6c61 6e65 6f75 7322 2c20 2264 6563 6f72  laneous", "decor
+000087e0: 6174 6f72 7322 290a 2020 2020 2020 2020  ators").        
+000087f0: 2320 736b 6970 2065 7870 6c61 6e61 7469  # skip explanati
+00008800: 6f6e 2063 6f6d 6d65 6e74 7320 6174 2074  on comments at t
+00008810: 6865 2074 6f70 206f 6620 7468 6520 6669  he top of the fi
+00008820: 6c65 0a20 2020 2020 2020 2066 6f72 2073  le.        for s
+00008830: 696d 706c 655f 7465 7374 2069 6e20 7369  imple_test in si
+00008840: 6d70 6c65 732e 7370 6c69 7428 2223 2322  mples.split("##"
+00008850: 295b 313a 5d3a 0a20 2020 2020 2020 2020  )[1:]:.         
+00008860: 2020 206e 6f64 6520 3d20 6365 7263 6973     node = cercis
+00008870: 2e6c 6962 3274 6f33 5f70 6172 7365 2873  .lib2to3_parse(s
+00008880: 696d 706c 655f 7465 7374 290a 2020 2020  imple_test).    
+00008890: 2020 2020 2020 2020 6465 636f 7261 746f          decorato
+000088a0: 7220 3d20 7374 7228 6e6f 6465 2e63 6869  r = str(node.chi
+000088b0: 6c64 7265 6e5b 305d 2e63 6869 6c64 7265  ldren[0].childre
+000088c0: 6e5b 305d 292e 7374 7269 7028 290a 2020  n[0]).strip().  
+000088d0: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+000088e0: 7373 6572 744e 6f74 496e 280a 2020 2020  ssertNotIn(.    
+000088f0: 2020 2020 2020 2020 2020 2020 4665 6174              Feat
+00008900: 7572 652e 5245 4c41 5845 445f 4445 434f  ure.RELAXED_DECO
+00008910: 5241 544f 5253 2c0a 2020 2020 2020 2020  RATORS,.        
+00008920: 2020 2020 2020 2020 6365 7263 6973 2e67          cercis.g
+00008930: 6574 5f66 6561 7475 7265 735f 7573 6564  et_features_used
+00008940: 286e 6f64 6529 2c0a 2020 2020 2020 2020  (node),.        
+00008950: 2020 2020 2020 2020 6d73 673d 280a 2020          msg=(.  
+00008960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008970: 2020 6622 6465 636f 7261 746f 7220 277b    f"decorator '{
+00008980: 6465 636f 7261 746f 727d 2720 666f 6c6c  decorator}' foll
+00008990: 6f77 7320 7079 7468 6f6e 3c3d 332e 3820  ows python<=3.8 
+000089a0: 7379 6e74 6178 220a 2020 2020 2020 2020  syntax".        
+000089b0: 2020 2020 2020 2020 2020 2020 2262 7574              "but
+000089c0: 2069 7320 6465 7465 6374 6564 2061 7320   is detected as 
+000089d0: 332e 392b 220a 2020 2020 2020 2020 2020  3.9+".          
+000089e0: 2020 2020 2020 2020 2020 2320 6622 5468            # f"Th
+000089f0: 6520 6675 6c6c 206e 6f64 6520 6973 5c6e  e full node is\n
+00008a00: 7b6e 6f64 6521 727d 220a 2020 2020 2020  {node!r}".      
+00008a10: 2020 2020 2020 2020 2020 292c 0a20 2020            ),.   
+00008a20: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+00008a30: 2020 2023 2073 6b69 7020 7468 6520 2723     # skip the '#
+00008a40: 206f 7574 7075 7427 2063 6f6d 6d65 6e74   output' comment
+00008a50: 2061 7420 7468 6520 746f 7020 6f66 2074   at the top of t
+00008a60: 6865 206f 7574 7075 7420 7061 7274 0a20  he output part. 
+00008a70: 2020 2020 2020 2066 6f72 2072 656c 6178         for relax
+00008a80: 6564 5f74 6573 7420 696e 2072 656c 6178  ed_test in relax
+00008a90: 6564 2e73 706c 6974 2822 2323 2229 5b31  ed.split("##")[1
+00008aa0: 3a5d 3a0a 2020 2020 2020 2020 2020 2020  :]:.            
+00008ab0: 6e6f 6465 203d 2063 6572 6369 732e 6c69  node = cercis.li
+00008ac0: 6232 746f 335f 7061 7273 6528 7265 6c61  b2to3_parse(rela
+00008ad0: 7865 645f 7465 7374 290a 2020 2020 2020  xed_test).      
+00008ae0: 2020 2020 2020 6465 636f 7261 746f 7220        decorator 
+00008af0: 3d20 7374 7228 6e6f 6465 2e63 6869 6c64  = str(node.child
+00008b00: 7265 6e5b 305d 2e63 6869 6c64 7265 6e5b  ren[0].children[
+00008b10: 305d 292e 7374 7269 7028 290a 2020 2020  0]).strip().    
+00008b20: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00008b30: 6572 7449 6e28 0a20 2020 2020 2020 2020  ertIn(.         
+00008b40: 2020 2020 2020 2046 6561 7475 7265 2e52         Feature.R
+00008b50: 454c 4158 4544 5f44 4543 4f52 4154 4f52  ELAXED_DECORATOR
+00008b60: 532c 0a20 2020 2020 2020 2020 2020 2020  S,.             
+00008b70: 2020 2063 6572 6369 732e 6765 745f 6665     cercis.get_fe
+00008b80: 6174 7572 6573 5f75 7365 6428 6e6f 6465  atures_used(node
+00008b90: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+00008ba0: 2020 206d 7367 3d28 0a20 2020 2020 2020     msg=(.       
+00008bb0: 2020 2020 2020 2020 2020 2020 2066 2264               f"d
+00008bc0: 6563 6f72 6174 6f72 2027 7b64 6563 6f72  ecorator '{decor
+00008bd0: 6174 6f72 7d27 2075 7365 7320 7079 7468  ator}' uses pyth
+00008be0: 6f6e 332e 392b 2073 796e 7461 7822 0a20  on3.9+ syntax". 
+00008bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008c00: 2020 2022 6275 7420 6973 2064 6574 6563     "but is detec
+00008c10: 7465 6420 6173 2070 7974 686f 6e3c 3d33  ted as python<=3
+00008c20: 2e38 220a 2020 2020 2020 2020 2020 2020  .8".            
+00008c30: 2020 2020 2020 2020 2320 6622 5468 6520          # f"The 
+00008c40: 6675 6c6c 206e 6f64 6520 6973 5c6e 7b6e  full node is\n{n
+00008c50: 6f64 6521 727d 220a 2020 2020 2020 2020  ode!r}".        
+00008c60: 2020 2020 2020 2020 292c 0a20 2020 2020          ),.     
+00008c70: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
+00008c80: 6620 7465 7374 5f67 6574 5f66 6561 7475  f test_get_featu
+00008c90: 7265 735f 7573 6564 2873 656c 6629 202d  res_used(self) -
+00008ca0: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+00008cb0: 6e6f 6465 203d 2063 6572 6369 732e 6c69  node = cercis.li
+00008cc0: 6232 746f 335f 7061 7273 6528 2264 6566  b2to3_parse("def
+00008cd0: 2066 282a 2c20 6172 6729 3a20 2e2e 2e5c   f(*, arg): ...\
+00008ce0: 6e22 290a 2020 2020 2020 2020 7365 6c66  n").        self
+00008cf0: 2e61 7373 6572 7445 7175 616c 2863 6572  .assertEqual(cer
+00008d00: 6369 732e 6765 745f 6665 6174 7572 6573  cis.get_features
+00008d10: 5f75 7365 6428 6e6f 6465 292c 2073 6574  _used(node), set
+00008d20: 2829 290a 2020 2020 2020 2020 6e6f 6465  ()).        node
+00008d30: 203d 2063 6572 6369 732e 6c69 6232 746f   = cercis.lib2to
+00008d40: 335f 7061 7273 6528 2264 6566 2066 282a  3_parse("def f(*
+00008d50: 2c20 6172 672c 293a 202e 2e2e 5c6e 2229  , arg,): ...\n")
+00008d60: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+00008d70: 7365 7274 4571 7561 6c28 0a20 2020 2020  sertEqual(.     
+00008d80: 2020 2020 2020 2063 6572 6369 732e 6765         cercis.ge
+00008d90: 745f 6665 6174 7572 6573 5f75 7365 6428  t_features_used(
+00008da0: 6e6f 6465 292c 207b 4665 6174 7572 652e  node), {Feature.
+00008db0: 5452 4149 4c49 4e47 5f43 4f4d 4d41 5f49  TRAILING_COMMA_I
+00008dc0: 4e5f 4445 467d 0a20 2020 2020 2020 2029  N_DEF}.        )
+00008dd0: 0a20 2020 2020 2020 206e 6f64 6520 3d20  .        node = 
+00008de0: 6365 7263 6973 2e6c 6962 3274 6f33 5f70  cercis.lib2to3_p
+00008df0: 6172 7365 2822 6628 2a61 7267 2c29 5c6e  arse("f(*arg,)\n
+00008e00: 2229 0a20 2020 2020 2020 2073 656c 662e  ").        self.
+00008e10: 6173 7365 7274 4571 7561 6c28 0a20 2020  assertEqual(.   
+00008e20: 2020 2020 2020 2020 2063 6572 6369 732e           cercis.
+00008e30: 6765 745f 6665 6174 7572 6573 5f75 7365  get_features_use
+00008e40: 6428 6e6f 6465 292c 207b 4665 6174 7572  d(node), {Featur
+00008e50: 652e 5452 4149 4c49 4e47 5f43 4f4d 4d41  e.TRAILING_COMMA
+00008e60: 5f49 4e5f 4341 4c4c 7d0a 2020 2020 2020  _IN_CALL}.      
+00008e70: 2020 290a 2020 2020 2020 2020 6e6f 6465    ).        node
+00008e80: 203d 2063 6572 6369 732e 6c69 6232 746f   = cercis.lib2to
+00008e90: 335f 7061 7273 6528 2264 6566 2066 282a  3_parse("def f(*
+00008ea0: 2c20 6172 6729 3a20 6627 7374 7269 6e67  , arg): f'string
+00008eb0: 275c 6e22 290a 2020 2020 2020 2020 7365  '\n").        se
+00008ec0: 6c66 2e61 7373 6572 7445 7175 616c 2863  lf.assertEqual(c
+00008ed0: 6572 6369 732e 6765 745f 6665 6174 7572  ercis.get_featur
+00008ee0: 6573 5f75 7365 6428 6e6f 6465 292c 207b  es_used(node), {
+00008ef0: 4665 6174 7572 652e 465f 5354 5249 4e47  Feature.F_STRING
+00008f00: 537d 290a 2020 2020 2020 2020 6e6f 6465  S}).        node
+00008f10: 203d 2063 6572 6369 732e 6c69 6232 746f   = cercis.lib2to
+00008f20: 335f 7061 7273 6528 2231 3233 5f34 3536  3_parse("123_456
+00008f30: 5c6e 2229 0a20 2020 2020 2020 2073 656c  \n").        sel
+00008f40: 662e 6173 7365 7274 4571 7561 6c28 6365  f.assertEqual(ce
+00008f50: 7263 6973 2e67 6574 5f66 6561 7475 7265  rcis.get_feature
+00008f60: 735f 7573 6564 286e 6f64 6529 2c20 7b46  s_used(node), {F
+00008f70: 6561 7475 7265 2e4e 554d 4552 4943 5f55  eature.NUMERIC_U
+00008f80: 4e44 4552 5343 4f52 4553 7d29 0a20 2020  NDERSCORES}).   
+00008f90: 2020 2020 206e 6f64 6520 3d20 6365 7263       node = cerc
+00008fa0: 6973 2e6c 6962 3274 6f33 5f70 6172 7365  is.lib2to3_parse
+00008fb0: 2822 3132 3334 3536 5c6e 2229 0a20 2020  ("123456\n").   
+00008fc0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00008fd0: 4571 7561 6c28 6365 7263 6973 2e67 6574  Equal(cercis.get
+00008fe0: 5f66 6561 7475 7265 735f 7573 6564 286e  _features_used(n
+00008ff0: 6f64 6529 2c20 7365 7428 2929 0a20 2020  ode), set()).   
+00009000: 2020 2020 2073 6f75 7263 652c 2065 7870       source, exp
+00009010: 6563 7465 6420 3d20 7265 6164 5f64 6174  ected = read_dat
+00009020: 6128 2273 696d 706c 655f 6361 7365 7322  a("simple_cases"
+00009030: 2c20 2266 756e 6374 696f 6e22 290a 2020  , "function").  
+00009040: 2020 2020 2020 6e6f 6465 203d 2063 6572        node = cer
+00009050: 6369 732e 6c69 6232 746f 335f 7061 7273  cis.lib2to3_pars
+00009060: 6528 736f 7572 6365 290a 2020 2020 2020  e(source).      
+00009070: 2020 6578 7065 6374 6564 5f66 6561 7475    expected_featu
+00009080: 7265 7320 3d20 7b0a 2020 2020 2020 2020  res = {.        
+00009090: 2020 2020 4665 6174 7572 652e 5452 4149      Feature.TRAI
+000090a0: 4c49 4e47 5f43 4f4d 4d41 5f49 4e5f 4341  LING_COMMA_IN_CA
+000090b0: 4c4c 2c0a 2020 2020 2020 2020 2020 2020  LL,.            
+000090c0: 4665 6174 7572 652e 5452 4149 4c49 4e47  Feature.TRAILING
+000090d0: 5f43 4f4d 4d41 5f49 4e5f 4445 462c 0a20  _COMMA_IN_DEF,. 
+000090e0: 2020 2020 2020 2020 2020 2046 6561 7475             Featu
+000090f0: 7265 2e46 5f53 5452 494e 4753 2c0a 2020  re.F_STRINGS,.  
+00009100: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
+00009110: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+00009120: 2863 6572 6369 732e 6765 745f 6665 6174  (cercis.get_feat
+00009130: 7572 6573 5f75 7365 6428 6e6f 6465 292c  ures_used(node),
+00009140: 2065 7870 6563 7465 645f 6665 6174 7572   expected_featur
+00009150: 6573 290a 2020 2020 2020 2020 6e6f 6465  es).        node
+00009160: 203d 2063 6572 6369 732e 6c69 6232 746f   = cercis.lib2to
+00009170: 335f 7061 7273 6528 6578 7065 6374 6564  3_parse(expected
+00009180: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+00009190: 7373 6572 7445 7175 616c 2863 6572 6369  ssertEqual(cerci
+000091a0: 732e 6765 745f 6665 6174 7572 6573 5f75  s.get_features_u
+000091b0: 7365 6428 6e6f 6465 292c 2065 7870 6563  sed(node), expec
+000091c0: 7465 645f 6665 6174 7572 6573 290a 2020  ted_features).  
+000091d0: 2020 2020 2020 736f 7572 6365 2c20 6578        source, ex
+000091e0: 7065 6374 6564 203d 2072 6561 645f 6461  pected = read_da
+000091f0: 7461 2822 7369 6d70 6c65 5f63 6173 6573  ta("simple_cases
+00009200: 222c 2022 6578 7072 6573 7369 6f6e 2229  ", "expression")
+00009210: 0a20 2020 2020 2020 206e 6f64 6520 3d20  .        node = 
+00009220: 6365 7263 6973 2e6c 6962 3274 6f33 5f70  cercis.lib2to3_p
+00009230: 6172 7365 2873 6f75 7263 6529 0a20 2020  arse(source).   
+00009240: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00009250: 4571 7561 6c28 6365 7263 6973 2e67 6574  Equal(cercis.get
+00009260: 5f66 6561 7475 7265 735f 7573 6564 286e  _features_used(n
+00009270: 6f64 6529 2c20 7365 7428 2929 0a20 2020  ode), set()).   
+00009280: 2020 2020 206e 6f64 6520 3d20 6365 7263       node = cerc
+00009290: 6973 2e6c 6962 3274 6f33 5f70 6172 7365  is.lib2to3_parse
+000092a0: 2865 7870 6563 7465 6429 0a20 2020 2020  (expected).     
+000092b0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+000092c0: 7561 6c28 6365 7263 6973 2e67 6574 5f66  ual(cercis.get_f
+000092d0: 6561 7475 7265 735f 7573 6564 286e 6f64  eatures_used(nod
+000092e0: 6529 2c20 7365 7428 2929 0a20 2020 2020  e), set()).     
+000092f0: 2020 206e 6f64 6520 3d20 6365 7263 6973     node = cercis
+00009300: 2e6c 6962 3274 6f33 5f70 6172 7365 2822  .lib2to3_parse("
+00009310: 6c61 6d62 6461 2061 2c20 2f2c 2062 3a20  lambda a, /, b: 
+00009320: 2e2e 2e22 290a 2020 2020 2020 2020 7365  ...").        se
+00009330: 6c66 2e61 7373 6572 7445 7175 616c 2863  lf.assertEqual(c
+00009340: 6572 6369 732e 6765 745f 6665 6174 7572  ercis.get_featur
+00009350: 6573 5f75 7365 6428 6e6f 6465 292c 207b  es_used(node), {
+00009360: 4665 6174 7572 652e 504f 535f 4f4e 4c59  Feature.POS_ONLY
+00009370: 5f41 5247 554d 454e 5453 7d29 0a20 2020  _ARGUMENTS}).   
+00009380: 2020 2020 206e 6f64 6520 3d20 6365 7263       node = cerc
+00009390: 6973 2e6c 6962 3274 6f33 5f70 6172 7365  is.lib2to3_parse
+000093a0: 2822 6465 6620 666e 2861 2c20 2f2c 2062  ("def fn(a, /, b
+000093b0: 293a 202e 2e2e 2229 0a20 2020 2020 2020  ): ...").       
+000093c0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+000093d0: 6c28 6365 7263 6973 2e67 6574 5f66 6561  l(cercis.get_fea
+000093e0: 7475 7265 735f 7573 6564 286e 6f64 6529  tures_used(node)
+000093f0: 2c20 7b46 6561 7475 7265 2e50 4f53 5f4f  , {Feature.POS_O
+00009400: 4e4c 595f 4152 4755 4d45 4e54 537d 290a  NLY_ARGUMENTS}).
+00009410: 2020 2020 2020 2020 6e6f 6465 203d 2063          node = c
+00009420: 6572 6369 732e 6c69 6232 746f 335f 7061  ercis.lib2to3_pa
+00009430: 7273 6528 2264 6566 2066 6e28 293a 2079  rse("def fn(): y
+00009440: 6965 6c64 2061 2c20 6222 290a 2020 2020  ield a, b").    
+00009450: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+00009460: 7175 616c 2863 6572 6369 732e 6765 745f  qual(cercis.get_
+00009470: 6665 6174 7572 6573 5f75 7365 6428 6e6f  features_used(no
+00009480: 6465 292c 2073 6574 2829 290a 2020 2020  de), set()).    
+00009490: 2020 2020 6e6f 6465 203d 2063 6572 6369      node = cerci
+000094a0: 732e 6c69 6232 746f 335f 7061 7273 6528  s.lib2to3_parse(
+000094b0: 2264 6566 2066 6e28 293a 2072 6574 7572  "def fn(): retur
+000094c0: 6e20 612c 2062 2229 0a20 2020 2020 2020  n a, b").       
+000094d0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+000094e0: 6c28 6365 7263 6973 2e67 6574 5f66 6561  l(cercis.get_fea
+000094f0: 7475 7265 735f 7573 6564 286e 6f64 6529  tures_used(node)
+00009500: 2c20 7365 7428 2929 0a20 2020 2020 2020  , set()).       
+00009510: 206e 6f64 6520 3d20 6365 7263 6973 2e6c   node = cercis.l
+00009520: 6962 3274 6f33 5f70 6172 7365 2822 6465  ib2to3_parse("de
+00009530: 6620 666e 2829 3a20 7969 656c 6420 2a62  f fn(): yield *b
+00009540: 2c20 6322 290a 2020 2020 2020 2020 7365  , c").        se
+00009550: 6c66 2e61 7373 6572 7445 7175 616c 2863  lf.assertEqual(c
+00009560: 6572 6369 732e 6765 745f 6665 6174 7572  ercis.get_featur
+00009570: 6573 5f75 7365 6428 6e6f 6465 292c 207b  es_used(node), {
+00009580: 4665 6174 7572 652e 554e 5041 434b 494e  Feature.UNPACKIN
+00009590: 475f 4f4e 5f46 4c4f 577d 290a 2020 2020  G_ON_FLOW}).    
+000095a0: 2020 2020 6e6f 6465 203d 2063 6572 6369      node = cerci
+000095b0: 732e 6c69 6232 746f 335f 7061 7273 6528  s.lib2to3_parse(
+000095c0: 2264 6566 2066 6e28 293a 2072 6574 7572  "def fn(): retur
+000095d0: 6e20 612c 202a 622c 2063 2229 0a20 2020  n a, *b, c").   
+000095e0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+000095f0: 4571 7561 6c28 6365 7263 6973 2e67 6574  Equal(cercis.get
+00009600: 5f66 6561 7475 7265 735f 7573 6564 286e  _features_used(n
+00009610: 6f64 6529 2c20 7b46 6561 7475 7265 2e55  ode), {Feature.U
+00009620: 4e50 4143 4b49 4e47 5f4f 4e5f 464c 4f57  NPACKING_ON_FLOW
+00009630: 7d29 0a20 2020 2020 2020 206e 6f64 6520  }).        node 
+00009640: 3d20 6365 7263 6973 2e6c 6962 3274 6f33  = cercis.lib2to3
+00009650: 5f70 6172 7365 2822 7820 3d20 612c 202a  _parse("x = a, *
+00009660: 622c 2063 2229 0a20 2020 2020 2020 2073  b, c").        s
+00009670: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+00009680: 6365 7263 6973 2e67 6574 5f66 6561 7475  cercis.get_featu
+00009690: 7265 735f 7573 6564 286e 6f64 6529 2c20  res_used(node), 
+000096a0: 7365 7428 2929 0a20 2020 2020 2020 206e  set()).        n
+000096b0: 6f64 6520 3d20 6365 7263 6973 2e6c 6962  ode = cercis.lib
+000096c0: 3274 6f33 5f70 6172 7365 2822 783a 2041  2to3_parse("x: A
+000096d0: 6e79 203d 2072 6567 756c 6172 2229 0a20  ny = regular"). 
+000096e0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+000096f0: 7274 4571 7561 6c28 6365 7263 6973 2e67  rtEqual(cercis.g
+00009700: 6574 5f66 6561 7475 7265 735f 7573 6564  et_features_used
+00009710: 286e 6f64 6529 2c20 7365 7428 2929 0a20  (node), set()). 
+00009720: 2020 2020 2020 206e 6f64 6520 3d20 6365         node = ce
+00009730: 7263 6973 2e6c 6962 3274 6f33 5f70 6172  rcis.lib2to3_par
+00009740: 7365 2822 783a 2041 6e79 203d 2028 7265  se("x: Any = (re
+00009750: 6775 6c61 722c 2072 6567 756c 6172 2922  gular, regular)"
+00009760: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+00009770: 7373 6572 7445 7175 616c 2863 6572 6369  ssertEqual(cerci
+00009780: 732e 6765 745f 6665 6174 7572 6573 5f75  s.get_features_u
+00009790: 7365 6428 6e6f 6465 292c 2073 6574 2829  sed(node), set()
+000097a0: 290a 2020 2020 2020 2020 6e6f 6465 203d  ).        node =
+000097b0: 2063 6572 6369 732e 6c69 6232 746f 335f   cercis.lib2to3_
+000097c0: 7061 7273 6528 2278 3a20 416e 7920 3d20  parse("x: Any = 
+000097d0: 436f 6d70 6c65 7828 5479 7065 2831 2929  Complex(Type(1))
+000097e0: 5b73 6f6d 6574 6869 6e67 5d22 290a 2020  [something]").  
+000097f0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00009800: 7445 7175 616c 2863 6572 6369 732e 6765  tEqual(cercis.ge
+00009810: 745f 6665 6174 7572 6573 5f75 7365 6428  t_features_used(
+00009820: 6e6f 6465 292c 2073 6574 2829 290a 2020  node), set()).  
+00009830: 2020 2020 2020 6e6f 6465 203d 2063 6572        node = cer
+00009840: 6369 732e 6c69 6232 746f 335f 7061 7273  cis.lib2to3_pars
+00009850: 6528 2278 3a20 5475 706c 655b 696e 742c  e("x: Tuple[int,
+00009860: 202e 2e2e 5d20 3d20 612c 2062 2c20 6322   ...] = a, b, c"
+00009870: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+00009880: 7373 6572 7445 7175 616c 280a 2020 2020  ssertEqual(.    
+00009890: 2020 2020 2020 2020 6365 7263 6973 2e67          cercis.g
+000098a0: 6574 5f66 6561 7475 7265 735f 7573 6564  et_features_used
+000098b0: 286e 6f64 6529 2c20 7b46 6561 7475 7265  (node), {Feature
+000098c0: 2e41 4e4e 5f41 5353 4947 4e5f 4558 5445  .ANN_ASSIGN_EXTE
+000098d0: 4e44 4544 5f52 4853 7d0a 2020 2020 2020  NDED_RHS}.      
+000098e0: 2020 290a 2020 2020 2020 2020 6e6f 6465    ).        node
+000098f0: 203d 2063 6572 6369 732e 6c69 6232 746f   = cercis.lib2to
+00009900: 335f 7061 7273 6528 2274 7279 3a20 7061  3_parse("try: pa
+00009910: 7373 5c6e 6578 6365 7074 2053 6f6d 6574  ss\nexcept Somet
+00009920: 6869 6e67 3a20 7061 7373 2229 0a20 2020  hing: pass").   
+00009930: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00009940: 4571 7561 6c28 6365 7263 6973 2e67 6574  Equal(cercis.get
+00009950: 5f66 6561 7475 7265 735f 7573 6564 286e  _features_used(n
+00009960: 6f64 6529 2c20 7365 7428 2929 0a20 2020  ode), set()).   
+00009970: 2020 2020 206e 6f64 6520 3d20 6365 7263       node = cerc
+00009980: 6973 2e6c 6962 3274 6f33 5f70 6172 7365  is.lib2to3_parse
+00009990: 2822 7472 793a 2070 6173 735c 6e65 7863  ("try: pass\nexc
+000099a0: 6570 7420 282a 536f 6d65 7468 696e 672c  ept (*Something,
+000099b0: 293a 2070 6173 7322 290a 2020 2020 2020  ): pass").      
+000099c0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+000099d0: 616c 2863 6572 6369 732e 6765 745f 6665  al(cercis.get_fe
+000099e0: 6174 7572 6573 5f75 7365 6428 6e6f 6465  atures_used(node
+000099f0: 292c 2073 6574 2829 290a 2020 2020 2020  ), set()).      
+00009a00: 2020 6e6f 6465 203d 2063 6572 6369 732e    node = cercis.
+00009a10: 6c69 6232 746f 335f 7061 7273 6528 2274  lib2to3_parse("t
+00009a20: 7279 3a20 7061 7373 5c6e 6578 6365 7074  ry: pass\nexcept
+00009a30: 202a 4772 6f75 703a 2070 6173 7322 290a   *Group: pass").
+00009a40: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00009a50: 6572 7445 7175 616c 2863 6572 6369 732e  ertEqual(cercis.
+00009a60: 6765 745f 6665 6174 7572 6573 5f75 7365  get_features_use
+00009a70: 6428 6e6f 6465 292c 207b 4665 6174 7572  d(node), {Featur
+00009a80: 652e 4558 4345 5054 5f53 5441 527d 290a  e.EXCEPT_STAR}).
+00009a90: 2020 2020 2020 2020 6e6f 6465 203d 2063          node = c
+00009aa0: 6572 6369 732e 6c69 6232 746f 335f 7061  ercis.lib2to3_pa
+00009ab0: 7273 6528 2261 5b2a 625d 2229 0a20 2020  rse("a[*b]").   
+00009ac0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00009ad0: 4571 7561 6c28 6365 7263 6973 2e67 6574  Equal(cercis.get
+00009ae0: 5f66 6561 7475 7265 735f 7573 6564 286e  _features_used(n
+00009af0: 6f64 6529 2c20 7b46 6561 7475 7265 2e56  ode), {Feature.V
+00009b00: 4152 4941 4449 435f 4745 4e45 5249 4353  ARIADIC_GENERICS
+00009b10: 7d29 0a20 2020 2020 2020 206e 6f64 6520  }).        node 
+00009b20: 3d20 6365 7263 6973 2e6c 6962 3274 6f33  = cercis.lib2to3
+00009b30: 5f70 6172 7365 2822 615b 782c 202a 7928  _parse("a[x, *y(
+00009b40: 292c 207a 5d20 3d20 7422 290a 2020 2020  ), z] = t").    
+00009b50: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+00009b60: 7175 616c 2863 6572 6369 732e 6765 745f  qual(cercis.get_
+00009b70: 6665 6174 7572 6573 5f75 7365 6428 6e6f  features_used(no
+00009b80: 6465 292c 207b 4665 6174 7572 652e 5641  de), {Feature.VA
+00009b90: 5249 4144 4943 5f47 454e 4552 4943 537d  RIADIC_GENERICS}
+00009ba0: 290a 2020 2020 2020 2020 6e6f 6465 203d  ).        node =
+00009bb0: 2063 6572 6369 732e 6c69 6232 746f 335f   cercis.lib2to3_
+00009bc0: 7061 7273 6528 2264 6566 2066 6e28 2a61  parse("def fn(*a
+00009bd0: 7267 733a 202a 5429 3a20 7061 7373 2229  rgs: *T): pass")
+00009be0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+00009bf0: 7365 7274 4571 7561 6c28 6365 7263 6973  sertEqual(cercis
+00009c00: 2e67 6574 5f66 6561 7475 7265 735f 7573  .get_features_us
+00009c10: 6564 286e 6f64 6529 2c20 7b46 6561 7475  ed(node), {Featu
+00009c20: 7265 2e56 4152 4941 4449 435f 4745 4e45  re.VARIADIC_GENE
+00009c30: 5249 4353 7d29 0a0a 2020 2020 6465 6620  RICS})..    def 
+00009c40: 7465 7374 5f67 6574 5f66 6561 7475 7265  test_get_feature
+00009c50: 735f 7573 6564 5f66 6f72 5f66 7574 7572  s_used_for_futur
+00009c60: 655f 666c 6167 7328 7365 6c66 2920 2d3e  e_flags(self) ->
+00009c70: 204e 6f6e 653a 0a20 2020 2020 2020 2066   None:.        f
+00009c80: 6f72 2073 7263 2c20 6665 6174 7572 6573  or src, features
+00009c90: 2069 6e20 5b0a 2020 2020 2020 2020 2020   in [.          
+00009ca0: 2020 2822 6672 6f6d 205f 5f66 7574 7572    ("from __futur
+00009cb0: 655f 5f20 696d 706f 7274 2061 6e6e 6f74  e__ import annot
+00009cc0: 6174 696f 6e73 222c 207b 4665 6174 7572  ations", {Featur
+00009cd0: 652e 4655 5455 5245 5f41 4e4e 4f54 4154  e.FUTURE_ANNOTAT
+00009ce0: 494f 4e53 7d29 2c0a 2020 2020 2020 2020  IONS}),.        
+00009cf0: 2020 2020 280a 2020 2020 2020 2020 2020      (.          
+00009d00: 2020 2020 2020 2266 726f 6d20 5f5f 6675        "from __fu
+00009d10: 7475 7265 5f5f 2069 6d70 6f72 7420 286f  ture__ import (o
+00009d20: 7468 6572 2c20 616e 6e6f 7461 7469 6f6e  ther, annotation
+00009d30: 7329 222c 0a20 2020 2020 2020 2020 2020  s)",.           
+00009d40: 2020 2020 207b 4665 6174 7572 652e 4655       {Feature.FU
+00009d50: 5455 5245 5f41 4e4e 4f54 4154 494f 4e53  TURE_ANNOTATIONS
+00009d60: 7d2c 0a20 2020 2020 2020 2020 2020 2029  },.            )
+00009d70: 2c0a 2020 2020 2020 2020 2020 2020 2822  ,.            ("
+00009d80: 6120 3d20 3120 2b20 325c 6e66 726f 6d20  a = 1 + 2\nfrom 
+00009d90: 736f 6d65 7468 696e 6720 696d 706f 7274  something import
+00009da0: 2061 6e6e 6f74 6174 696f 6e73 222c 2073   annotations", s
+00009db0: 6574 2829 292c 0a20 2020 2020 2020 2020  et()),.         
+00009dc0: 2020 2028 2266 726f 6d20 5f5f 6675 7475     ("from __futu
+00009dd0: 7265 5f5f 2069 6d70 6f72 7420 782c 2079  re__ import x, y
+00009de0: 222c 2073 6574 2829 292c 0a20 2020 2020  ", set()),.     
+00009df0: 2020 205d 3a0a 2020 2020 2020 2020 2020     ]:.          
+00009e00: 2020 7769 7468 2073 656c 662e 7375 6254    with self.subT
+00009e10: 6573 7428 7372 633d 7372 632c 2066 6561  est(src=src, fea
+00009e20: 7475 7265 733d 6665 6174 7572 6573 293a  tures=features):
+00009e30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009e40: 206e 6f64 6520 3d20 6365 7263 6973 2e6c   node = cercis.l
+00009e50: 6962 3274 6f33 5f70 6172 7365 2873 7263  ib2to3_parse(src
+00009e60: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00009e70: 2020 6675 7475 7265 5f69 6d70 6f72 7473    future_imports
+00009e80: 203d 2063 6572 6369 732e 6765 745f 6675   = cercis.get_fu
+00009e90: 7475 7265 5f69 6d70 6f72 7473 286e 6f64  ture_imports(nod
+00009ea0: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
+00009eb0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+00009ec0: 7561 6c28 0a20 2020 2020 2020 2020 2020  ual(.           
+00009ed0: 2020 2020 2020 2020 2063 6572 6369 732e           cercis.
+00009ee0: 6765 745f 6665 6174 7572 6573 5f75 7365  get_features_use
+00009ef0: 6428 6e6f 6465 2c20 6675 7475 7265 5f69  d(node, future_i
+00009f00: 6d70 6f72 7473 3d66 7574 7572 655f 696d  mports=future_im
+00009f10: 706f 7274 7329 2c0a 2020 2020 2020 2020  ports),.        
+00009f20: 2020 2020 2020 2020 2020 2020 6665 6174              feat
+00009f30: 7572 6573 2c0a 2020 2020 2020 2020 2020  ures,.          
+00009f40: 2020 2020 2020 290a 0a20 2020 2064 6566        )..    def
+00009f50: 2074 6573 745f 6765 745f 6675 7475 7265   test_get_future
+00009f60: 5f69 6d70 6f72 7473 2873 656c 6629 202d  _imports(self) -
+00009f70: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+00009f80: 6e6f 6465 203d 2063 6572 6369 732e 6c69  node = cercis.li
+00009f90: 6232 746f 335f 7061 7273 6528 225c 6e22  b2to3_parse("\n"
+00009fa0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+00009fb0: 7373 6572 7445 7175 616c 2873 6574 2829  ssertEqual(set()
+00009fc0: 2c20 6365 7263 6973 2e67 6574 5f66 7574  , cercis.get_fut
+00009fd0: 7572 655f 696d 706f 7274 7328 6e6f 6465  ure_imports(node
+00009fe0: 2929 0a20 2020 2020 2020 206e 6f64 6520  )).        node 
+00009ff0: 3d20 6365 7263 6973 2e6c 6962 3274 6f33  = cercis.lib2to3
+0000a000: 5f70 6172 7365 2822 6672 6f6d 205f 5f66  _parse("from __f
+0000a010: 7574 7572 655f 5f20 696d 706f 7274 2063  uture__ import c
+0000a020: 6572 6369 735c 6e22 290a 2020 2020 2020  ercis\n").      
+0000a030: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+0000a040: 616c 287b 2263 6572 6369 7322 7d2c 2063  al({"cercis"}, c
+0000a050: 6572 6369 732e 6765 745f 6675 7475 7265  ercis.get_future
+0000a060: 5f69 6d70 6f72 7473 286e 6f64 6529 290a  _imports(node)).
+0000a070: 2020 2020 2020 2020 6e6f 6465 203d 2063          node = c
+0000a080: 6572 6369 732e 6c69 6232 746f 335f 7061  ercis.lib2to3_pa
+0000a090: 7273 6528 2266 726f 6d20 5f5f 6675 7475  rse("from __futu
+0000a0a0: 7265 5f5f 2069 6d70 6f72 7420 6d75 6c74  re__ import mult
+0000a0b0: 6970 6c65 2c20 696d 706f 7274 735c 6e22  iple, imports\n"
+0000a0c0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+0000a0d0: 7373 6572 7445 7175 616c 287b 226d 756c  ssertEqual({"mul
+0000a0e0: 7469 706c 6522 2c20 2269 6d70 6f72 7473  tiple", "imports
+0000a0f0: 227d 2c20 6365 7263 6973 2e67 6574 5f66  "}, cercis.get_f
+0000a100: 7574 7572 655f 696d 706f 7274 7328 6e6f  uture_imports(no
+0000a110: 6465 2929 0a20 2020 2020 2020 206e 6f64  de)).        nod
+0000a120: 6520 3d20 6365 7263 6973 2e6c 6962 3274  e = cercis.lib2t
+0000a130: 6f33 5f70 6172 7365 2822 6672 6f6d 205f  o3_parse("from _
+0000a140: 5f66 7574 7572 655f 5f20 696d 706f 7274  _future__ import
+0000a150: 2028 7061 7265 6e74 6865 7369 7a65 642c   (parenthesized,
+0000a160: 2069 6d70 6f72 7473 295c 6e22 290a 2020   imports)\n").  
+0000a170: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+0000a180: 7445 7175 616c 287b 2270 6172 656e 7468  tEqual({"parenth
+0000a190: 6573 697a 6564 222c 2022 696d 706f 7274  esized", "import
+0000a1a0: 7322 7d2c 2063 6572 6369 732e 6765 745f  s"}, cercis.get_
+0000a1b0: 6675 7475 7265 5f69 6d70 6f72 7473 286e  future_imports(n
+0000a1c0: 6f64 6529 290a 2020 2020 2020 2020 6e6f  ode)).        no
+0000a1d0: 6465 203d 2063 6572 6369 732e 6c69 6232  de = cercis.lib2
+0000a1e0: 746f 335f 7061 7273 6528 0a20 2020 2020  to3_parse(.     
+0000a1f0: 2020 2020 2020 2022 6672 6f6d 205f 5f66         "from __f
+0000a200: 7574 7572 655f 5f20 696d 706f 7274 206d  uture__ import m
+0000a210: 756c 7469 706c 655c 6e66 726f 6d20 5f5f  ultiple\nfrom __
+0000a220: 6675 7475 7265 5f5f 2069 6d70 6f72 7420  future__ import 
+0000a230: 696d 706f 7274 735c 6e22 0a20 2020 2020  imports\n".     
+0000a240: 2020 2029 0a20 2020 2020 2020 2073 656c     ).        sel
+0000a250: 662e 6173 7365 7274 4571 7561 6c28 7b22  f.assertEqual({"
+0000a260: 6d75 6c74 6970 6c65 222c 2022 696d 706f  multiple", "impo
+0000a270: 7274 7322 7d2c 2063 6572 6369 732e 6765  rts"}, cercis.ge
+0000a280: 745f 6675 7475 7265 5f69 6d70 6f72 7473  t_future_imports
+0000a290: 286e 6f64 6529 290a 2020 2020 2020 2020  (node)).        
+0000a2a0: 6e6f 6465 203d 2063 6572 6369 732e 6c69  node = cercis.li
+0000a2b0: 6232 746f 335f 7061 7273 6528 2223 2063  b2to3_parse("# c
+0000a2c0: 6f6d 6d65 6e74 5c6e 6672 6f6d 205f 5f66  omment\nfrom __f
+0000a2d0: 7574 7572 655f 5f20 696d 706f 7274 2063  uture__ import c
+0000a2e0: 6572 6369 735c 6e22 290a 2020 2020 2020  ercis\n").      
+0000a2f0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+0000a300: 616c 287b 2263 6572 6369 7322 7d2c 2063  al({"cercis"}, c
+0000a310: 6572 6369 732e 6765 745f 6675 7475 7265  ercis.get_future
+0000a320: 5f69 6d70 6f72 7473 286e 6f64 6529 290a  _imports(node)).
+0000a330: 2020 2020 2020 2020 6e6f 6465 203d 2063          node = c
+0000a340: 6572 6369 732e 6c69 6232 746f 335f 7061  ercis.lib2to3_pa
+0000a350: 7273 6528 2722 2222 646f 6373 7472 696e  rse('"""docstrin
+0000a360: 6722 2222 5c6e 6672 6f6d 205f 5f66 7574  g"""\nfrom __fut
+0000a370: 7572 655f 5f20 696d 706f 7274 2063 6572  ure__ import cer
+0000a380: 6369 735c 6e27 290a 2020 2020 2020 2020  cis\n').        
+0000a390: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+0000a3a0: 287b 2263 6572 6369 7322 7d2c 2063 6572  ({"cercis"}, cer
+0000a3b0: 6369 732e 6765 745f 6675 7475 7265 5f69  cis.get_future_i
+0000a3c0: 6d70 6f72 7473 286e 6f64 6529 290a 2020  mports(node)).  
+0000a3d0: 2020 2020 2020 6e6f 6465 203d 2063 6572        node = cer
+0000a3e0: 6369 732e 6c69 6232 746f 335f 7061 7273  cis.lib2to3_pars
+0000a3f0: 6528 0a20 2020 2020 2020 2020 2020 2022  e(.            "
+0000a400: 736f 6d65 286f 7468 6572 2c20 636f 6465  some(other, code
+0000a410: 295c 6e66 726f 6d20 5f5f 6675 7475 7265  )\nfrom __future
+0000a420: 5f5f 2069 6d70 6f72 7420 6365 7263 6973  __ import cercis
+0000a430: 5c6e 220a 2020 2020 2020 2020 290a 2020  \n".        ).  
+0000a440: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+0000a450: 7445 7175 616c 2873 6574 2829 2c20 6365  tEqual(set(), ce
+0000a460: 7263 6973 2e67 6574 5f66 7574 7572 655f  rcis.get_future_
+0000a470: 696d 706f 7274 7328 6e6f 6465 2929 0a20  imports(node)). 
+0000a480: 2020 2020 2020 206e 6f64 6520 3d20 6365         node = ce
+0000a490: 7263 6973 2e6c 6962 3274 6f33 5f70 6172  rcis.lib2to3_par
+0000a4a0: 7365 2822 6672 6f6d 2073 6f6d 652e 6d6f  se("from some.mo
+0000a4b0: 6475 6c65 2069 6d70 6f72 7420 6365 7263  dule import cerc
+0000a4c0: 6973 5c6e 2229 0a20 2020 2020 2020 2073  is\n").        s
+0000a4d0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+0000a4e0: 7365 7428 292c 2063 6572 6369 732e 6765  set(), cercis.ge
+0000a4f0: 745f 6675 7475 7265 5f69 6d70 6f72 7473  t_future_imports
+0000a500: 286e 6f64 6529 290a 2020 2020 2020 2020  (node)).        
+0000a510: 6e6f 6465 203d 2063 6572 6369 732e 6c69  node = cercis.li
+0000a520: 6232 746f 335f 7061 7273 6528 0a20 2020  b2to3_parse(.   
+0000a530: 2020 2020 2020 2020 2022 6672 6f6d 205f           "from _
+0000a540: 5f66 7574 7572 655f 5f20 696d 706f 7274  _future__ import
+0000a550: 2075 6e69 636f 6465 5f6c 6974 6572 616c   unicode_literal
+0000a560: 7320 6173 205f 756e 6963 6f64 655f 6c69  s as _unicode_li
+0000a570: 7465 7261 6c73 220a 2020 2020 2020 2020  terals".        
+0000a580: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+0000a590: 7373 6572 7445 7175 616c 287b 2275 6e69  ssertEqual({"uni
+0000a5a0: 636f 6465 5f6c 6974 6572 616c 7322 7d2c  code_literals"},
+0000a5b0: 2063 6572 6369 732e 6765 745f 6675 7475   cercis.get_futu
+0000a5c0: 7265 5f69 6d70 6f72 7473 286e 6f64 6529  re_imports(node)
+0000a5d0: 290a 2020 2020 2020 2020 6e6f 6465 203d  ).        node =
+0000a5e0: 2063 6572 6369 732e 6c69 6232 746f 335f   cercis.lib2to3_
+0000a5f0: 7061 7273 6528 0a20 2020 2020 2020 2020  parse(.         
+0000a600: 2020 2022 6672 6f6d 205f 5f66 7574 7572     "from __futur
+0000a610: 655f 5f20 696d 706f 7274 2075 6e69 636f  e__ import unico
+0000a620: 6465 5f6c 6974 6572 616c 7320 6173 205f  de_literals as _
+0000a630: 6c6f 6c2c 2070 7269 6e74 220a 2020 2020  lol, print".    
+0000a640: 2020 2020 290a 2020 2020 2020 2020 7365      ).        se
+0000a650: 6c66 2e61 7373 6572 7445 7175 616c 287b  lf.assertEqual({
+0000a660: 2275 6e69 636f 6465 5f6c 6974 6572 616c  "unicode_literal
+0000a670: 7322 2c20 2270 7269 6e74 227d 2c20 6365  s", "print"}, ce
+0000a680: 7263 6973 2e67 6574 5f66 7574 7572 655f  rcis.get_future_
+0000a690: 696d 706f 7274 7328 6e6f 6465 2929 0a0a  imports(node))..
+0000a6a0: 2020 2020 4070 7974 6573 742e 6d61 726b      @pytest.mark
+0000a6b0: 2e69 6e63 6f6d 7061 7469 626c 655f 7769  .incompatible_wi
+0000a6c0: 7468 5f6d 7970 7963 0a20 2020 2064 6566  th_mypyc.    def
+0000a6d0: 2074 6573 745f 6465 6275 675f 7669 7369   test_debug_visi
+0000a6e0: 746f 7228 7365 6c66 2920 2d3e 204e 6f6e  tor(self) -> Non
+0000a6f0: 653a 0a20 2020 2020 2020 2073 6f75 7263  e:.        sourc
+0000a700: 652c 205f 203d 2072 6561 645f 6461 7461  e, _ = read_data
+0000a710: 2822 6d69 7363 656c 6c61 6e65 6f75 7322  ("miscellaneous"
+0000a720: 2c20 2264 6562 7567 5f76 6973 6974 6f72  , "debug_visitor
+0000a730: 2229 0a20 2020 2020 2020 2065 7870 6563  ").        expec
+0000a740: 7465 642c 205f 203d 2072 6561 645f 6461  ted, _ = read_da
+0000a750: 7461 2822 6d69 7363 656c 6c61 6e65 6f75  ta("miscellaneou
+0000a760: 7322 2c20 2264 6562 7567 5f76 6973 6974  s", "debug_visit
+0000a770: 6f72 2e6f 7574 2229 0a20 2020 2020 2020  or.out").       
+0000a780: 206f 7574 5f6c 696e 6573 203d 205b 5d0a   out_lines = [].
+0000a790: 2020 2020 2020 2020 6572 725f 6c69 6e65          err_line
+0000a7a0: 7320 3d20 5b5d 0a0a 2020 2020 2020 2020  s = []..        
+0000a7b0: 6465 6620 6f75 7428 6d73 673a 2073 7472  def out(msg: str
+0000a7c0: 2c20 2a2a 6b77 6172 6773 3a20 416e 7929  , **kwargs: Any)
+0000a7d0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
+0000a7e0: 2020 2020 2020 6f75 745f 6c69 6e65 732e        out_lines.
+0000a7f0: 6170 7065 6e64 286d 7367 290a 0a20 2020  append(msg)..   
+0000a800: 2020 2020 2064 6566 2065 7272 286d 7367       def err(msg
+0000a810: 3a20 7374 722c 202a 2a6b 7761 7267 733a  : str, **kwargs:
+0000a820: 2041 6e79 2920 2d3e 204e 6f6e 653a 0a20   Any) -> None:. 
+0000a830: 2020 2020 2020 2020 2020 2065 7272 5f6c             err_l
+0000a840: 696e 6573 2e61 7070 656e 6428 6d73 6729  ines.append(msg)
+0000a850: 0a0a 2020 2020 2020 2020 7769 7468 2070  ..        with p
+0000a860: 6174 6368 2822 6365 7263 6973 2e64 6562  atch("cercis.deb
+0000a870: 7567 2e6f 7574 222c 206f 7574 293a 0a20  ug.out", out):. 
+0000a880: 2020 2020 2020 2020 2020 2044 6562 7567             Debug
+0000a890: 5669 7369 746f 722e 7368 6f77 2873 6f75  Visitor.show(sou
+0000a8a0: 7263 6529 0a20 2020 2020 2020 2061 6374  rce).        act
+0000a8b0: 7561 6c20 3d20 225c 6e22 2e6a 6f69 6e28  ual = "\n".join(
+0000a8c0: 6f75 745f 6c69 6e65 7329 202b 2022 5c6e  out_lines) + "\n
+0000a8d0: 220a 2020 2020 2020 2020 6c6f 675f 6e61  ".        log_na
+0000a8e0: 6d65 203d 2022 220a 2020 2020 2020 2020  me = "".        
+0000a8f0: 6966 2065 7870 6563 7465 6420 213d 2061  if expected != a
+0000a900: 6374 7561 6c3a 0a20 2020 2020 2020 2020  ctual:.         
+0000a910: 2020 206c 6f67 5f6e 616d 6520 3d20 6365     log_name = ce
+0000a920: 7263 6973 2e64 756d 705f 746f 5f66 696c  rcis.dump_to_fil
+0000a930: 6528 2a6f 7574 5f6c 696e 6573 290a 2020  e(*out_lines).  
+0000a940: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+0000a950: 7445 7175 616c 280a 2020 2020 2020 2020  tEqual(.        
+0000a960: 2020 2020 6578 7065 6374 6564 2c0a 2020      expected,.  
+0000a970: 2020 2020 2020 2020 2020 6163 7475 616c            actual
+0000a980: 2c0a 2020 2020 2020 2020 2020 2020 6622  ,.            f"
+0000a990: 4153 5420 7072 696e 7420 6f75 7420 6973  AST print out is
+0000a9a0: 2064 6966 6665 7265 6e74 2e20 4163 7475   different. Actu
+0000a9b0: 616c 2076 6572 7369 6f6e 2064 756d 7065  al version dumpe
+0000a9c0: 6420 746f 207b 6c6f 675f 6e61 6d65 7d22  d to {log_name}"
+0000a9d0: 2c0a 2020 2020 2020 2020 290a 0a20 2020  ,.        )..   
+0000a9e0: 2064 6566 2074 6573 745f 666f 726d 6174   def test_format
+0000a9f0: 5f66 696c 655f 636f 6e74 656e 7473 2873  _file_contents(s
+0000aa00: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
+0000aa10: 2020 2020 2020 6d6f 6465 203d 2044 4546        mode = DEF
+0000aa20: 4155 4c54 5f4d 4f44 450a 2020 2020 2020  AULT_MODE.      
+0000aa30: 2020 656d 7074 7920 3d20 2222 0a20 2020    empty = "".   
+0000aa40: 2020 2020 2077 6974 6820 7365 6c66 2e61       with self.a
+0000aa50: 7373 6572 7452 6169 7365 7328 6365 7263  ssertRaises(cerc
+0000aa60: 6973 2e4e 6f74 6869 6e67 4368 616e 6765  is.NothingChange
+0000aa70: 6429 3a0a 2020 2020 2020 2020 2020 2020  d):.            
+0000aa80: 6365 7263 6973 2e66 6f72 6d61 745f 6669  cercis.format_fi
+0000aa90: 6c65 5f63 6f6e 7465 6e74 7328 656d 7074  le_contents(empt
+0000aaa0: 792c 206d 6f64 653d 6d6f 6465 2c20 6661  y, mode=mode, fa
+0000aab0: 7374 3d46 616c 7365 290a 2020 2020 2020  st=False).      
+0000aac0: 2020 6a75 7374 5f6e 6c20 3d20 225c 6e22    just_nl = "\n"
+0000aad0: 0a20 2020 2020 2020 2077 6974 6820 7365  .        with se
+0000aae0: 6c66 2e61 7373 6572 7452 6169 7365 7328  lf.assertRaises(
+0000aaf0: 6365 7263 6973 2e4e 6f74 6869 6e67 4368  cercis.NothingCh
+0000ab00: 616e 6765 6429 3a0a 2020 2020 2020 2020  anged):.        
+0000ab10: 2020 2020 6365 7263 6973 2e66 6f72 6d61      cercis.forma
+0000ab20: 745f 6669 6c65 5f63 6f6e 7465 6e74 7328  t_file_contents(
+0000ab30: 6a75 7374 5f6e 6c2c 206d 6f64 653d 6d6f  just_nl, mode=mo
+0000ab40: 6465 2c20 6661 7374 3d46 616c 7365 290a  de, fast=False).
+0000ab50: 2020 2020 2020 2020 7361 6d65 203d 2022          same = "
+0000ab60: 6a20 3d20 5b31 2c20 322c 2033 5d5c 6e22  j = [1, 2, 3]\n"
+0000ab70: 0a20 2020 2020 2020 2077 6974 6820 7365  .        with se
+0000ab80: 6c66 2e61 7373 6572 7452 6169 7365 7328  lf.assertRaises(
+0000ab90: 6365 7263 6973 2e4e 6f74 6869 6e67 4368  cercis.NothingCh
+0000aba0: 616e 6765 6429 3a0a 2020 2020 2020 2020  anged):.        
+0000abb0: 2020 2020 6365 7263 6973 2e66 6f72 6d61      cercis.forma
+0000abc0: 745f 6669 6c65 5f63 6f6e 7465 6e74 7328  t_file_contents(
+0000abd0: 7361 6d65 2c20 6d6f 6465 3d6d 6f64 652c  same, mode=mode,
+0000abe0: 2066 6173 743d 4661 6c73 6529 0a20 2020   fast=False).   
+0000abf0: 2020 2020 2064 6966 6665 7265 6e74 203d       different =
+0000ac00: 2022 6a20 3d20 5b31 2c32 2c33 5d22 0a20   "j = [1,2,3]". 
+0000ac10: 2020 2020 2020 2065 7870 6563 7465 6420         expected 
+0000ac20: 3d20 7361 6d65 0a20 2020 2020 2020 2061  = same.        a
+0000ac30: 6374 7561 6c20 3d20 6365 7263 6973 2e66  ctual = cercis.f
+0000ac40: 6f72 6d61 745f 6669 6c65 5f63 6f6e 7465  ormat_file_conte
+0000ac50: 6e74 7328 6469 6666 6572 656e 742c 206d  nts(different, m
+0000ac60: 6f64 653d 6d6f 6465 2c20 6661 7374 3d46  ode=mode, fast=F
+0000ac70: 616c 7365 290a 2020 2020 2020 2020 7365  alse).        se
+0000ac80: 6c66 2e61 7373 6572 7445 7175 616c 2865  lf.assertEqual(e
+0000ac90: 7870 6563 7465 642c 2061 6374 7561 6c29  xpected, actual)
+0000aca0: 0a20 2020 2020 2020 2069 6e76 616c 6964  .        invalid
+0000acb0: 203d 2022 7265 7475 726e 2069 6620 796f   = "return if yo
+0000acc0: 7520 6361 6e22 0a20 2020 2020 2020 2077  u can".        w
+0000acd0: 6974 6820 7365 6c66 2e61 7373 6572 7452  ith self.assertR
+0000ace0: 6169 7365 7328 6365 7263 6973 2e49 6e76  aises(cercis.Inv
+0000acf0: 616c 6964 496e 7075 7429 2061 7320 653a  alidInput) as e:
+0000ad00: 0a20 2020 2020 2020 2020 2020 2063 6572  .            cer
+0000ad10: 6369 732e 666f 726d 6174 5f66 696c 655f  cis.format_file_
+0000ad20: 636f 6e74 656e 7473 2869 6e76 616c 6964  contents(invalid
+0000ad30: 2c20 6d6f 6465 3d6d 6f64 652c 2066 6173  , mode=mode, fas
+0000ad40: 743d 4661 6c73 6529 0a20 2020 2020 2020  t=False).       
+0000ad50: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+0000ad60: 6c28 7374 7228 652e 6578 6365 7074 696f  l(str(e.exceptio
+0000ad70: 6e29 2c20 2243 616e 6e6f 7420 7061 7273  n), "Cannot pars
+0000ad80: 653a 2031 3a37 3a20 7265 7475 726e 2069  e: 1:7: return i
+0000ad90: 6620 796f 7520 6361 6e22 290a 0a20 2020  f you can")..   
+0000ada0: 2020 2020 206d 6f64 6520 3d20 6365 7263       mode = cerc
+0000adb0: 6973 2e4d 6f64 6528 7072 6576 6965 773d  is.Mode(preview=
+0000adc0: 5472 7565 290a 2020 2020 2020 2020 6a75  True).        ju
+0000add0: 7374 5f63 726c 6620 3d20 225c 725c 6e22  st_crlf = "\r\n"
+0000ade0: 0a20 2020 2020 2020 2077 6974 6820 7365  .        with se
+0000adf0: 6c66 2e61 7373 6572 7452 6169 7365 7328  lf.assertRaises(
+0000ae00: 6365 7263 6973 2e4e 6f74 6869 6e67 4368  cercis.NothingCh
+0000ae10: 616e 6765 6429 3a0a 2020 2020 2020 2020  anged):.        
+0000ae20: 2020 2020 6365 7263 6973 2e66 6f72 6d61      cercis.forma
+0000ae30: 745f 6669 6c65 5f63 6f6e 7465 6e74 7328  t_file_contents(
+0000ae40: 6a75 7374 5f63 726c 662c 206d 6f64 653d  just_crlf, mode=
+0000ae50: 6d6f 6465 2c20 6661 7374 3d46 616c 7365  mode, fast=False
+0000ae60: 290a 2020 2020 2020 2020 6a75 7374 5f77  ).        just_w
+0000ae70: 6869 7465 7370 6163 655f 6e6c 203d 2022  hitespace_nl = "
+0000ae80: 5c6e 5c74 5c6e 205c 6e5c 7420 5c6e 205c  \n\t\n \n\t \n \
+0000ae90: 745c 6e5c 6e22 0a20 2020 2020 2020 2061  t\n\n".        a
+0000aea0: 6374 7561 6c20 3d20 6365 7263 6973 2e66  ctual = cercis.f
+0000aeb0: 6f72 6d61 745f 6669 6c65 5f63 6f6e 7465  ormat_file_conte
+0000aec0: 6e74 7328 6a75 7374 5f77 6869 7465 7370  nts(just_whitesp
+0000aed0: 6163 655f 6e6c 2c20 6d6f 6465 3d6d 6f64  ace_nl, mode=mod
+0000aee0: 652c 2066 6173 743d 4661 6c73 6529 0a20  e, fast=False). 
+0000aef0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+0000af00: 7274 4571 7561 6c28 225c 6e22 2c20 6163  rtEqual("\n", ac
+0000af10: 7475 616c 290a 2020 2020 2020 2020 6a75  tual).        ju
+0000af20: 7374 5f77 6869 7465 7370 6163 655f 6372  st_whitespace_cr
+0000af30: 6c66 203d 2022 5c72 5c6e 5c74 5c72 5c6e  lf = "\r\n\t\r\n
+0000af40: 205c 725c 6e5c 7420 5c72 5c6e 205c 745c   \r\n\t \r\n \t\
+0000af50: 725c 6e5c 725c 6e22 0a20 2020 2020 2020  r\n\r\n".       
+0000af60: 2061 6374 7561 6c20 3d20 6365 7263 6973   actual = cercis
+0000af70: 2e66 6f72 6d61 745f 6669 6c65 5f63 6f6e  .format_file_con
+0000af80: 7465 6e74 7328 0a20 2020 2020 2020 2020  tents(.         
+0000af90: 2020 206a 7573 745f 7768 6974 6573 7061     just_whitespa
+0000afa0: 6365 5f63 726c 662c 206d 6f64 653d 6d6f  ce_crlf, mode=mo
+0000afb0: 6465 2c20 6661 7374 3d46 616c 7365 0a20  de, fast=False. 
+0000afc0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0000afd0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+0000afe0: 6c28 225c 725c 6e22 2c20 6163 7475 616c  l("\r\n", actual
+0000aff0: 290a 0a20 2020 2064 6566 2074 6573 745f  )..    def test_
+0000b000: 656e 646d 6172 6b65 7228 7365 6c66 2920  endmarker(self) 
+0000b010: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
+0000b020: 206e 203d 2063 6572 6369 732e 6c69 6232   n = cercis.lib2
+0000b030: 746f 335f 7061 7273 6528 225c 6e22 290a  to3_parse("\n").
+0000b040: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+0000b050: 6572 7445 7175 616c 286e 2e74 7970 652c  ertEqual(n.type,
+0000b060: 2063 6572 6369 732e 7379 6d73 2e66 696c   cercis.syms.fil
+0000b070: 655f 696e 7075 7429 0a20 2020 2020 2020  e_input).       
+0000b080: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+0000b090: 6c28 6c65 6e28 6e2e 6368 696c 6472 656e  l(len(n.children
+0000b0a0: 292c 2031 290a 2020 2020 2020 2020 7365  ), 1).        se
+0000b0b0: 6c66 2e61 7373 6572 7445 7175 616c 286e  lf.assertEqual(n
+0000b0c0: 2e63 6869 6c64 7265 6e5b 305d 2e74 7970  .children[0].typ
+0000b0d0: 652c 2063 6572 6369 732e 746f 6b65 6e2e  e, cercis.token.
+0000b0e0: 454e 444d 4152 4b45 5229 0a0a 2020 2020  ENDMARKER)..    
+0000b0f0: 4070 7974 6573 742e 6d61 726b 2e69 6e63  @pytest.mark.inc
+0000b100: 6f6d 7061 7469 626c 655f 7769 7468 5f6d  ompatible_with_m
+0000b110: 7970 7963 0a20 2020 2040 756e 6974 7465  ypyc.    @unitte
+0000b120: 7374 2e73 6b69 7049 6628 6f73 2e65 6e76  st.skipIf(os.env
+0000b130: 6972 6f6e 2e67 6574 2822 534b 4950 5f41  iron.get("SKIP_A
+0000b140: 5354 5f50 5249 4e54 2229 2c20 2275 7365  ST_PRINT"), "use
+0000b150: 7220 7365 7420 534b 4950 5f41 5354 5f50  r set SKIP_AST_P
+0000b160: 5249 4e54 2229 0a20 2020 2064 6566 2074  RINT").    def t
+0000b170: 6573 745f 6173 7365 7274 466f 726d 6174  est_assertFormat
+0000b180: 4571 7561 6c28 7365 6c66 2920 2d3e 204e  Equal(self) -> N
+0000b190: 6f6e 653a 0a20 2020 2020 2020 206f 7574  one:.        out
+0000b1a0: 5f6c 696e 6573 203d 205b 5d0a 2020 2020  _lines = [].    
+0000b1b0: 2020 2020 6572 725f 6c69 6e65 7320 3d20      err_lines = 
+0000b1c0: 5b5d 0a0a 2020 2020 2020 2020 6465 6620  []..        def 
+0000b1d0: 6f75 7428 6d73 673a 2073 7472 2c20 2a2a  out(msg: str, **
+0000b1e0: 6b77 6172 6773 3a20 416e 7929 202d 3e20  kwargs: Any) -> 
+0000b1f0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+0000b200: 2020 6f75 745f 6c69 6e65 732e 6170 7065    out_lines.appe
+0000b210: 6e64 286d 7367 290a 0a20 2020 2020 2020  nd(msg)..       
+0000b220: 2064 6566 2065 7272 286d 7367 3a20 7374   def err(msg: st
+0000b230: 722c 202a 2a6b 7761 7267 733a 2041 6e79  r, **kwargs: Any
+0000b240: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+0000b250: 2020 2020 2020 2065 7272 5f6c 696e 6573         err_lines
+0000b260: 2e61 7070 656e 6428 6d73 6729 0a0a 2020  .append(msg)..  
+0000b270: 2020 2020 2020 7769 7468 2070 6174 6368        with patch
+0000b280: 2822 6365 7263 6973 2e6f 7574 7075 742e  ("cercis.output.
+0000b290: 5f6f 7574 222c 206f 7574 292c 2070 6174  _out", out), pat
+0000b2a0: 6368 2822 6365 7263 6973 2e6f 7574 7075  ch("cercis.outpu
+0000b2b0: 742e 5f65 7272 222c 2065 7272 293a 0a20  t._err", err):. 
+0000b2c0: 2020 2020 2020 2020 2020 2077 6974 6820             with 
+0000b2d0: 7365 6c66 2e61 7373 6572 7452 6169 7365  self.assertRaise
+0000b2e0: 7328 4173 7365 7274 696f 6e45 7272 6f72  s(AssertionError
+0000b2f0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0000b300: 2020 2073 656c 662e 6173 7365 7274 466f     self.assertFo
+0000b310: 726d 6174 4571 7561 6c28 226a 203d 205b  rmatEqual("j = [
+0000b320: 312c 2032 2c20 335d 222c 2022 6a20 3d20  1, 2, 3]", "j = 
+0000b330: 5b31 2c20 322c 2033 2c5d 2229 0a0a 2020  [1, 2, 3,]")..  
+0000b340: 2020 2020 2020 6f75 745f 7374 7220 3d20        out_str = 
+0000b350: 2222 2e6a 6f69 6e28 6f75 745f 6c69 6e65  "".join(out_line
+0000b360: 7329 0a20 2020 2020 2020 2073 656c 662e  s).        self.
+0000b370: 6173 7365 7274 496e 2822 4578 7065 6374  assertIn("Expect
+0000b380: 6564 2074 7265 653a 222c 206f 7574 5f73  ed tree:", out_s
+0000b390: 7472 290a 2020 2020 2020 2020 7365 6c66  tr).        self
+0000b3a0: 2e61 7373 6572 7449 6e28 2241 6374 7561  .assertIn("Actua
+0000b3b0: 6c20 7472 6565 3a22 2c20 6f75 745f 7374  l tree:", out_st
+0000b3c0: 7229 0a20 2020 2020 2020 2073 656c 662e  r).        self.
+0000b3d0: 6173 7365 7274 4571 7561 6c28 2222 2e6a  assertEqual("".j
+0000b3e0: 6f69 6e28 6572 725f 6c69 6e65 7329 2c20  oin(err_lines), 
+0000b3f0: 2222 290a 0a20 2020 2040 6576 656e 745f  "")..    @event_
+0000b400: 6c6f 6f70 2829 0a20 2020 2040 7061 7463  loop().    @patc
+0000b410: 6828 2263 6f6e 6375 7272 656e 742e 6675  h("concurrent.fu
+0000b420: 7475 7265 732e 5072 6f63 6573 7350 6f6f  tures.ProcessPoo
+0000b430: 6c45 7865 6375 746f 7222 2c20 4d61 6769  lExecutor", Magi
+0000b440: 634d 6f63 6b28 7369 6465 5f65 6666 6563  cMock(side_effec
+0000b450: 743d 4f53 4572 726f 7229 290a 2020 2020  t=OSError)).    
+0000b460: 6465 6620 7465 7374 5f77 6f72 6b73 5f69  def test_works_i
+0000b470: 6e5f 6d6f 6e6f 5f70 726f 6365 7373 5f6f  n_mono_process_o
+0000b480: 6e6c 795f 656e 7669 726f 6e6d 656e 7428  nly_environment(
+0000b490: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
+0000b4a0: 2020 2020 2020 2077 6974 6820 6361 6368         with cach
+0000b4b0: 655f 6469 7228 2920 6173 2077 6f72 6b73  e_dir() as works
+0000b4c0: 7061 6365 3a0a 2020 2020 2020 2020 2020  pace:.          
+0000b4d0: 2020 666f 7220 6620 696e 205b 0a20 2020    for f in [.   
+0000b4e0: 2020 2020 2020 2020 2020 2020 2028 776f               (wo
+0000b4f0: 726b 7370 6163 6520 2f20 226f 6e65 2e70  rkspace / "one.p
+0000b500: 7922 292e 7265 736f 6c76 6528 292c 0a20  y").resolve(),. 
+0000b510: 2020 2020 2020 2020 2020 2020 2020 2028                 (
+0000b520: 776f 726b 7370 6163 6520 2f20 2274 776f  workspace / "two
+0000b530: 2e70 7922 292e 7265 736f 6c76 6528 292c  .py").resolve(),
+0000b540: 0a20 2020 2020 2020 2020 2020 205d 3a0a  .            ]:.
+0000b550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b560: 662e 7772 6974 655f 7465 7874 2827 7072  f.write_text('pr
+0000b570: 696e 7428 2268 656c 6c6f 2229 5c6e 2729  int("hello")\n')
+0000b580: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0000b590: 662e 696e 766f 6b65 426c 6163 6b28 5b73  f.invokeBlack([s
+0000b5a0: 7472 2877 6f72 6b73 7061 6365 295d 290a  tr(workspace)]).
+0000b5b0: 0a20 2020 2040 6576 656e 745f 6c6f 6f70  .    @event_loop
+0000b5c0: 2829 0a20 2020 2064 6566 2074 6573 745f  ().    def test_
+0000b5d0: 6368 6563 6b5f 6469 6666 5f75 7365 5f74  check_diff_use_t
+0000b5e0: 6f67 6574 6865 7228 7365 6c66 2920 2d3e  ogether(self) ->
+0000b5f0: 204e 6f6e 653a 0a20 2020 2020 2020 2073   None:.        s
+0000b600: 7120 3d20 222d 2d73 696e 676c 652d 7175  q = "--single-qu
+0000b610: 6f74 653d 4661 6c73 6522 0a20 2020 2020  ote=False".     
+0000b620: 2020 206c 6c20 3d20 222d 2d6c 696e 652d     ll = "--line-
+0000b630: 6c65 6e67 7468 3d38 3822 0a20 2020 2020  length=88".     
+0000b640: 2020 2077 6974 6820 6361 6368 655f 6469     with cache_di
+0000b650: 7228 293a 0a20 2020 2020 2020 2020 2020  r():.           
+0000b660: 2023 2046 696c 6573 2077 6869 6368 2077   # Files which w
+0000b670: 696c 6c20 6265 2072 6566 6f72 6d61 7474  ill be reformatt
+0000b680: 6564 2e0a 2020 2020 2020 2020 2020 2020  ed..            
+0000b690: 7372 6331 203d 2067 6574 5f63 6173 655f  src1 = get_case_
+0000b6a0: 7061 7468 2822 6d69 7363 656c 6c61 6e65  path("miscellane
+0000b6b0: 6f75 7322 2c20 2273 7472 696e 675f 7175  ous", "string_qu
+0000b6c0: 6f74 6573 2229 0a20 2020 2020 2020 2020  otes").         
+0000b6d0: 2020 2073 656c 662e 696e 766f 6b65 426c     self.invokeBl
+0000b6e0: 6163 6b28 5b73 7472 2873 7263 3129 2c20  ack([str(src1), 
+0000b6f0: 222d 2d64 6966 6622 2c20 222d 2d63 6865  "--diff", "--che
+0000b700: 636b 222c 2073 712c 206c 6c5d 2c20 6578  ck", sq, ll], ex
+0000b710: 6974 5f63 6f64 653d 3129 0a20 2020 2020  it_code=1).     
+0000b720: 2020 2020 2020 2023 2046 696c 6573 2077         # Files w
+0000b730: 6869 6368 2077 696c 6c20 6e6f 7420 6265  hich will not be
+0000b740: 2072 6566 6f72 6d61 7474 6564 2e0a 2020   reformatted..  
+0000b750: 2020 2020 2020 2020 2020 7372 6332 203d            src2 =
+0000b760: 2067 6574 5f63 6173 655f 7061 7468 2822   get_case_path("
+0000b770: 7369 6d70 6c65 5f63 6173 6573 222c 2022  simple_cases", "
+0000b780: 636f 6d70 6f73 6974 696f 6e22 290a 2020  composition").  
+0000b790: 2020 2020 2020 2020 2020 7365 6c66 2e69            self.i
+0000b7a0: 6e76 6f6b 6542 6c61 636b 285b 7374 7228  nvokeBlack([str(
+0000b7b0: 7372 6332 292c 2022 2d2d 6469 6666 222c  src2), "--diff",
+0000b7c0: 2022 2d2d 6368 6563 6b22 2c20 7371 2c20   "--check", sq, 
+0000b7d0: 6c6c 5d29 0a20 2020 2020 2020 2020 2020  ll]).           
+0000b7e0: 2023 204d 756c 7469 2066 696c 6520 636f   # Multi file co
+0000b7f0: 6d6d 616e 642e 0a20 2020 2020 2020 2020  mmand..         
+0000b800: 2020 2073 656c 662e 696e 766f 6b65 426c     self.invokeBl
+0000b810: 6163 6b28 0a20 2020 2020 2020 2020 2020  ack(.           
+0000b820: 2020 2020 205b 7374 7228 7372 6331 292c       [str(src1),
+0000b830: 2073 7472 2873 7263 3229 2c20 222d 2d64   str(src2), "--d
+0000b840: 6966 6622 2c20 222d 2d63 6865 636b 222c  iff", "--check",
+0000b850: 2073 712c 206c 6c5d 2c0a 2020 2020 2020   sq, ll],.      
+0000b860: 2020 2020 2020 2020 2020 6578 6974 5f63            exit_c
+0000b870: 6f64 653d 312c 0a20 2020 2020 2020 2020  ode=1,.         
+0000b880: 2020 2029 0a0a 2020 2020 6465 6620 7465     )..    def te
+0000b890: 7374 5f6e 6f5f 7372 635f 6661 696c 7328  st_no_src_fails(
+0000b8a0: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
+0000b8b0: 2020 2020 2020 2077 6974 6820 6361 6368         with cach
+0000b8c0: 655f 6469 7228 293a 0a20 2020 2020 2020  e_dir():.       
+0000b8d0: 2020 2020 2073 656c 662e 696e 766f 6b65       self.invoke
+0000b8e0: 426c 6163 6b28 5b5d 2c20 6578 6974 5f63  Black([], exit_c
+0000b8f0: 6f64 653d 3129 0a0a 2020 2020 6465 6620  ode=1)..    def 
+0000b900: 7465 7374 5f73 7263 5f61 6e64 5f63 6f64  test_src_and_cod
+0000b910: 655f 6661 696c 7328 7365 6c66 2920 2d3e  e_fails(self) ->
+0000b920: 204e 6f6e 653a 0a20 2020 2020 2020 2077   None:.        w
+0000b930: 6974 6820 6361 6368 655f 6469 7228 293a  ith cache_dir():
+0000b940: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0000b950: 662e 696e 766f 6b65 426c 6163 6b28 5b22  f.invokeBlack(["
+0000b960: 2e22 2c20 222d 6322 2c20 2230 225d 2c20  .", "-c", "0"], 
+0000b970: 6578 6974 5f63 6f64 653d 3129 0a0a 2020  exit_code=1)..  
+0000b980: 2020 6465 6620 7465 7374 5f62 726f 6b65    def test_broke
+0000b990: 6e5f 7379 6d6c 696e 6b28 7365 6c66 2920  n_symlink(self) 
+0000b9a0: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
+0000b9b0: 2077 6974 6820 6361 6368 655f 6469 7228   with cache_dir(
+0000b9c0: 2920 6173 2077 6f72 6b73 7061 6365 3a0a  ) as workspace:.
+0000b9d0: 2020 2020 2020 2020 2020 2020 7379 6d6c              syml
+0000b9e0: 696e 6b20 3d20 776f 726b 7370 6163 6520  ink = workspace 
+0000b9f0: 2f20 2262 726f 6b65 6e5f 6c69 6e6b 2e70  / "broken_link.p
+0000ba00: 7922 0a20 2020 2020 2020 2020 2020 2074  y".            t
+0000ba10: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+0000ba20: 2020 2020 7379 6d6c 696e 6b2e 7379 6d6c      symlink.syml
+0000ba30: 696e 6b5f 746f 2822 6e6f 6e65 7869 7374  ink_to("nonexist
+0000ba40: 656e 742e 7079 2229 0a20 2020 2020 2020  ent.py").       
+0000ba50: 2020 2020 2065 7863 6570 7420 284f 5345       except (OSE
+0000ba60: 7272 6f72 2c20 4e6f 7449 6d70 6c65 6d65  rror, NotImpleme
+0000ba70: 6e74 6564 4572 726f 7229 2061 7320 653a  ntedError) as e:
+0000ba80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ba90: 2073 656c 662e 736b 6970 5465 7374 2866   self.skipTest(f
+0000baa0: 2243 616e 2774 2063 7265 6174 6520 7379  "Can't create sy
+0000bab0: 6d6c 696e 6b73 3a20 7b65 7d22 290a 2020  mlinks: {e}").  
+0000bac0: 2020 2020 2020 2020 2020 7365 6c66 2e69            self.i
+0000bad0: 6e76 6f6b 6542 6c61 636b 285b 7374 7228  nvokeBlack([str(
+0000bae0: 776f 726b 7370 6163 652e 7265 736f 6c76  workspace.resolv
+0000baf0: 6528 2929 5d29 0a0a 2020 2020 6465 6620  e())])..    def 
+0000bb00: 7465 7374 5f73 696e 676c 655f 6669 6c65  test_single_file
+0000bb10: 5f66 6f72 6365 5f70 7969 2873 656c 6629  _force_pyi(self)
+0000bb20: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
+0000bb30: 2020 7079 695f 6d6f 6465 203d 2072 6570    pyi_mode = rep
+0000bb40: 6c61 6365 2844 4546 4155 4c54 5f4d 4f44  lace(DEFAULT_MOD
+0000bb50: 452c 2069 735f 7079 693d 5472 7565 290a  E, is_pyi=True).
+0000bb60: 2020 2020 2020 2020 636f 6e74 656e 7473          contents
+0000bb70: 2c20 6578 7065 6374 6564 203d 2072 6561  , expected = rea
+0000bb80: 645f 6461 7461 2822 6d69 7363 656c 6c61  d_data("miscella
+0000bb90: 6e65 6f75 7322 2c20 2266 6f72 6365 5f70  neous", "force_p
+0000bba0: 7969 2229 0a20 2020 2020 2020 2077 6974  yi").        wit
+0000bbb0: 6820 6361 6368 655f 6469 7228 2920 6173  h cache_dir() as
+0000bbc0: 2077 6f72 6b73 7061 6365 3a0a 2020 2020   workspace:.    
+0000bbd0: 2020 2020 2020 2020 7061 7468 203d 2028          path = (
+0000bbe0: 776f 726b 7370 6163 6520 2f20 2266 696c  workspace / "fil
+0000bbf0: 652e 7079 2229 2e72 6573 6f6c 7665 2829  e.py").resolve()
+0000bc00: 0a20 2020 2020 2020 2020 2020 2077 6974  .            wit
+0000bc10: 6820 6f70 656e 2870 6174 682c 2022 7722  h open(path, "w"
+0000bc20: 2920 6173 2066 683a 0a20 2020 2020 2020  ) as fh:.       
+0000bc30: 2020 2020 2020 2020 2066 682e 7772 6974           fh.writ
+0000bc40: 6528 636f 6e74 656e 7473 290a 2020 2020  e(contents).    
+0000bc50: 2020 2020 2020 2020 7365 6c66 2e69 6e76          self.inv
+0000bc60: 6f6b 6542 6c61 636b 285b 7374 7228 7061  okeBlack([str(pa
+0000bc70: 7468 292c 2022 2d2d 7079 6922 5d29 0a20  th), "--pyi"]). 
+0000bc80: 2020 2020 2020 2020 2020 2077 6974 6820             with 
+0000bc90: 6f70 656e 2870 6174 682c 2022 7222 2920  open(path, "r") 
+0000bca0: 6173 2066 683a 0a20 2020 2020 2020 2020  as fh:.         
+0000bcb0: 2020 2020 2020 2061 6374 7561 6c20 3d20         actual = 
+0000bcc0: 6668 2e72 6561 6428 290a 2020 2020 2020  fh.read().      
+0000bcd0: 2020 2020 2020 2320 7665 7269 6679 2063        # verify c
+0000bce0: 6163 6865 2077 6974 6820 2d2d 7079 6920  ache with --pyi 
+0000bcf0: 6973 2073 6570 6172 6174 650a 2020 2020  is separate.    
+0000bd00: 2020 2020 2020 2020 7079 695f 6361 6368          pyi_cach
+0000bd10: 6520 3d20 6365 7263 6973 2e72 6561 645f  e = cercis.read_
+0000bd20: 6361 6368 6528 7079 695f 6d6f 6465 290a  cache(pyi_mode).
+0000bd30: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000bd40: 2e61 7373 6572 7449 6e28 7374 7228 7061  .assertIn(str(pa
+0000bd50: 7468 292c 2070 7969 5f63 6163 6865 290a  th), pyi_cache).
+0000bd60: 2020 2020 2020 2020 2020 2020 6e6f 726d              norm
+0000bd70: 616c 5f63 6163 6865 203d 2063 6572 6369  al_cache = cerci
+0000bd80: 732e 7265 6164 5f63 6163 6865 2844 4546  s.read_cache(DEF
+0000bd90: 4155 4c54 5f4d 4f44 4529 0a20 2020 2020  AULT_MODE).     
+0000bda0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+0000bdb0: 7274 4e6f 7449 6e28 7374 7228 7061 7468  rtNotIn(str(path
+0000bdc0: 292c 206e 6f72 6d61 6c5f 6361 6368 6529  ), normal_cache)
+0000bdd0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+0000bde0: 7365 7274 466f 726d 6174 4571 7561 6c28  sertFormatEqual(
+0000bdf0: 6578 7065 6374 6564 2c20 6163 7475 616c  expected, actual
+0000be00: 290a 2020 2020 2020 2020 6365 7263 6973  ).        cercis
+0000be10: 2e61 7373 6572 745f 6571 7569 7661 6c65  .assert_equivale
+0000be20: 6e74 2863 6f6e 7465 6e74 732c 2061 6374  nt(contents, act
+0000be30: 7561 6c29 0a20 2020 2020 2020 2063 6572  ual).        cer
+0000be40: 6369 732e 6173 7365 7274 5f73 7461 626c  cis.assert_stabl
+0000be50: 6528 636f 6e74 656e 7473 2c20 6163 7475  e(contents, actu
+0000be60: 616c 2c20 7079 695f 6d6f 6465 290a 0a20  al, pyi_mode).. 
+0000be70: 2020 2040 6576 656e 745f 6c6f 6f70 2829     @event_loop()
+0000be80: 0a20 2020 2064 6566 2074 6573 745f 6d75  .    def test_mu
+0000be90: 6c74 695f 6669 6c65 5f66 6f72 6365 5f70  lti_file_force_p
+0000bea0: 7969 2873 656c 6629 202d 3e20 4e6f 6e65  yi(self) -> None
+0000beb0: 3a0a 2020 2020 2020 2020 7265 675f 6d6f  :.        reg_mo
+0000bec0: 6465 203d 2044 4546 4155 4c54 5f4d 4f44  de = DEFAULT_MOD
+0000bed0: 450a 2020 2020 2020 2020 7079 695f 6d6f  E.        pyi_mo
+0000bee0: 6465 203d 2072 6570 6c61 6365 2844 4546  de = replace(DEF
+0000bef0: 4155 4c54 5f4d 4f44 452c 2069 735f 7079  AULT_MODE, is_py
+0000bf00: 693d 5472 7565 290a 2020 2020 2020 2020  i=True).        
+0000bf10: 636f 6e74 656e 7473 2c20 6578 7065 6374  contents, expect
+0000bf20: 6564 203d 2072 6561 645f 6461 7461 2822  ed = read_data("
+0000bf30: 6d69 7363 656c 6c61 6e65 6f75 7322 2c20  miscellaneous", 
+0000bf40: 2266 6f72 6365 5f70 7969 2229 0a20 2020  "force_pyi").   
+0000bf50: 2020 2020 2077 6974 6820 6361 6368 655f       with cache_
+0000bf60: 6469 7228 2920 6173 2077 6f72 6b73 7061  dir() as workspa
+0000bf70: 6365 3a0a 2020 2020 2020 2020 2020 2020  ce:.            
+0000bf80: 7061 7468 7320 3d20 5b0a 2020 2020 2020  paths = [.      
+0000bf90: 2020 2020 2020 2020 2020 2877 6f72 6b73            (works
+0000bfa0: 7061 6365 202f 2022 6669 6c65 312e 7079  pace / "file1.py
+0000bfb0: 2229 2e72 6573 6f6c 7665 2829 2c0a 2020  ").resolve(),.  
+0000bfc0: 2020 2020 2020 2020 2020 2020 2020 2877                (w
+0000bfd0: 6f72 6b73 7061 6365 202f 2022 6669 6c65  orkspace / "file
+0000bfe0: 322e 7079 2229 2e72 6573 6f6c 7665 2829  2.py").resolve()
+0000bff0: 2c0a 2020 2020 2020 2020 2020 2020 5d0a  ,.            ].
+0000c000: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+0000c010: 7061 7468 2069 6e20 7061 7468 733a 0a20  path in paths:. 
+0000c020: 2020 2020 2020 2020 2020 2020 2020 2077                 w
+0000c030: 6974 6820 6f70 656e 2870 6174 682c 2022  ith open(path, "
+0000c040: 7722 2920 6173 2066 683a 0a20 2020 2020  w") as fh:.     
+0000c050: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0000c060: 682e 7772 6974 6528 636f 6e74 656e 7473  h.write(contents
+0000c070: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+0000c080: 6c66 2e69 6e76 6f6b 6542 6c61 636b 285b  lf.invokeBlack([
+0000c090: 7374 7228 7029 2066 6f72 2070 2069 6e20  str(p) for p in 
+0000c0a0: 7061 7468 735d 202b 205b 222d 2d70 7969  paths] + ["--pyi
+0000c0b0: 225d 290a 2020 2020 2020 2020 2020 2020  "]).            
+0000c0c0: 666f 7220 7061 7468 2069 6e20 7061 7468  for path in path
+0000c0d0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+0000c0e0: 2020 2077 6974 6820 6f70 656e 2870 6174     with open(pat
+0000c0f0: 682c 2022 7222 2920 6173 2066 683a 0a20  h, "r") as fh:. 
+0000c100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c110: 2020 2061 6374 7561 6c20 3d20 6668 2e72     actual = fh.r
+0000c120: 6561 6428 290a 2020 2020 2020 2020 2020  ead().          
+0000c130: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+0000c140: 7445 7175 616c 2861 6374 7561 6c2c 2065  tEqual(actual, e
+0000c150: 7870 6563 7465 6429 0a20 2020 2020 2020  xpected).       
+0000c160: 2020 2020 2023 2076 6572 6966 7920 6361       # verify ca
+0000c170: 6368 6520 7769 7468 202d 2d70 7969 2069  che with --pyi i
+0000c180: 7320 7365 7061 7261 7465 0a20 2020 2020  s separate.     
+0000c190: 2020 2020 2020 2070 7969 5f63 6163 6865         pyi_cache
+0000c1a0: 203d 2063 6572 6369 732e 7265 6164 5f63   = cercis.read_c
+0000c1b0: 6163 6865 2870 7969 5f6d 6f64 6529 0a20  ache(pyi_mode). 
+0000c1c0: 2020 2020 2020 2020 2020 206e 6f72 6d61             norma
+0000c1d0: 6c5f 6361 6368 6520 3d20 6365 7263 6973  l_cache = cercis
+0000c1e0: 2e72 6561 645f 6361 6368 6528 7265 675f  .read_cache(reg_
+0000c1f0: 6d6f 6465 290a 2020 2020 2020 2020 2020  mode).          
+0000c200: 2020 666f 7220 7061 7468 2069 6e20 7061    for path in pa
+0000c210: 7468 733a 0a20 2020 2020 2020 2020 2020  ths:.           
+0000c220: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+0000c230: 496e 2873 7472 2870 6174 6829 2c20 7079  In(str(path), py
+0000c240: 695f 6361 6368 6529 0a20 2020 2020 2020  i_cache).       
+0000c250: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
+0000c260: 7365 7274 4e6f 7449 6e28 7374 7228 7061  sertNotIn(str(pa
+0000c270: 7468 292c 206e 6f72 6d61 6c5f 6361 6368  th), normal_cach
+0000c280: 6529 0a0a 2020 2020 6465 6620 7465 7374  e)..    def test
+0000c290: 5f70 6970 655f 666f 7263 655f 7079 6928  _pipe_force_pyi(
+0000c2a0: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
+0000c2b0: 2020 2020 2020 2073 6f75 7263 652c 2065         source, e
+0000c2c0: 7870 6563 7465 6420 3d20 7265 6164 5f64  xpected = read_d
+0000c2d0: 6174 6128 226d 6973 6365 6c6c 616e 656f  ata("miscellaneo
+0000c2e0: 7573 222c 2022 666f 7263 655f 7079 6922  us", "force_pyi"
+0000c2f0: 290a 2020 2020 2020 2020 7265 7375 6c74  ).        result
+0000c300: 203d 2043 6c69 5275 6e6e 6572 2829 2e69   = CliRunner().i
+0000c310: 6e76 6f6b 6528 0a20 2020 2020 2020 2020  nvoke(.         
+0000c320: 2020 2063 6572 6369 732e 6d61 696e 2c20     cercis.main, 
+0000c330: 5b22 2d22 2c20 222d 7122 2c20 222d 2d70  ["-", "-q", "--p
+0000c340: 7969 225d 2c20 696e 7075 743d 4279 7465  yi"], input=Byte
+0000c350: 7349 4f28 736f 7572 6365 2e65 6e63 6f64  sIO(source.encod
+0000c360: 6528 2275 7466 3822 2929 0a20 2020 2020  e("utf8")).     
+0000c370: 2020 2029 0a20 2020 2020 2020 2073 656c     ).        sel
+0000c380: 662e 6173 7365 7274 4571 7561 6c28 7265  f.assertEqual(re
+0000c390: 7375 6c74 2e65 7869 745f 636f 6465 2c20  sult.exit_code, 
+0000c3a0: 3029 0a20 2020 2020 2020 2061 6374 7561  0).        actua
+0000c3b0: 6c20 3d20 7265 7375 6c74 2e6f 7574 7075  l = result.outpu
+0000c3c0: 740a 2020 2020 2020 2020 7365 6c66 2e61  t.        self.a
+0000c3d0: 7373 6572 7446 6f72 6d61 7445 7175 616c  ssertFormatEqual
+0000c3e0: 2861 6374 7561 6c2c 2065 7870 6563 7465  (actual, expecte
+0000c3f0: 6429 0a0a 2020 2020 6465 6620 7465 7374  d)..    def test
+0000c400: 5f73 696e 676c 655f 6669 6c65 5f66 6f72  _single_file_for
+0000c410: 6365 5f70 7933 3628 7365 6c66 2920 2d3e  ce_py36(self) ->
+0000c420: 204e 6f6e 653a 0a20 2020 2020 2020 2072   None:.        r
+0000c430: 6567 5f6d 6f64 6520 3d20 4445 4641 554c  eg_mode = DEFAUL
+0000c440: 545f 4d4f 4445 0a20 2020 2020 2020 2070  T_MODE.        p
+0000c450: 7933 365f 6d6f 6465 203d 2072 6570 6c61  y36_mode = repla
+0000c460: 6365 2844 4546 4155 4c54 5f4d 4f44 452c  ce(DEFAULT_MODE,
+0000c470: 2074 6172 6765 745f 7665 7273 696f 6e73   target_versions
+0000c480: 3d50 5933 365f 5645 5253 494f 4e53 290a  =PY36_VERSIONS).
+0000c490: 2020 2020 2020 2020 736f 7572 6365 2c20          source, 
+0000c4a0: 6578 7065 6374 6564 203d 2072 6561 645f  expected = read_
+0000c4b0: 6461 7461 2822 6d69 7363 656c 6c61 6e65  data("miscellane
+0000c4c0: 6f75 7322 2c20 2266 6f72 6365 5f70 7933  ous", "force_py3
+0000c4d0: 3622 290a 2020 2020 2020 2020 7769 7468  6").        with
+0000c4e0: 2063 6163 6865 5f64 6972 2829 2061 7320   cache_dir() as 
+0000c4f0: 776f 726b 7370 6163 653a 0a20 2020 2020  workspace:.     
+0000c500: 2020 2020 2020 2070 6174 6820 3d20 2877         path = (w
+0000c510: 6f72 6b73 7061 6365 202f 2022 6669 6c65  orkspace / "file
+0000c520: 2e70 7922 292e 7265 736f 6c76 6528 290a  .py").resolve().
+0000c530: 2020 2020 2020 2020 2020 2020 7769 7468              with
+0000c540: 206f 7065 6e28 7061 7468 2c20 2277 2229   open(path, "w")
+0000c550: 2061 7320 6668 3a0a 2020 2020 2020 2020   as fh:.        
+0000c560: 2020 2020 2020 2020 6668 2e77 7269 7465          fh.write
+0000c570: 2873 6f75 7263 6529 0a20 2020 2020 2020  (source).       
+0000c580: 2020 2020 2073 656c 662e 696e 766f 6b65       self.invoke
+0000c590: 426c 6163 6b28 5b73 7472 2870 6174 6829  Black([str(path)
+0000c5a0: 2c20 2a50 5933 365f 4152 4753 5d29 0a20  , *PY36_ARGS]). 
+0000c5b0: 2020 2020 2020 2020 2020 2077 6974 6820             with 
+0000c5c0: 6f70 656e 2870 6174 682c 2022 7222 2920  open(path, "r") 
+0000c5d0: 6173 2066 683a 0a20 2020 2020 2020 2020  as fh:.         
+0000c5e0: 2020 2020 2020 2061 6374 7561 6c20 3d20         actual = 
+0000c5f0: 6668 2e72 6561 6428 290a 2020 2020 2020  fh.read().      
+0000c600: 2020 2020 2020 2320 7665 7269 6679 2063        # verify c
+0000c610: 6163 6865 2077 6974 6820 2d2d 7461 7267  ache with --targ
+0000c620: 6574 2d76 6572 7369 6f6e 2069 7320 7365  et-version is se
+0000c630: 7061 7261 7465 0a20 2020 2020 2020 2020  parate.         
+0000c640: 2020 2070 7933 365f 6361 6368 6520 3d20     py36_cache = 
+0000c650: 6365 7263 6973 2e72 6561 645f 6361 6368  cercis.read_cach
+0000c660: 6528 7079 3336 5f6d 6f64 6529 0a20 2020  e(py36_mode).   
+0000c670: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
+0000c680: 7365 7274 496e 2873 7472 2870 6174 6829  sertIn(str(path)
+0000c690: 2c20 7079 3336 5f63 6163 6865 290a 2020  , py36_cache).  
+0000c6a0: 2020 2020 2020 2020 2020 6e6f 726d 616c            normal
+0000c6b0: 5f63 6163 6865 203d 2063 6572 6369 732e  _cache = cercis.
+0000c6c0: 7265 6164 5f63 6163 6865 2872 6567 5f6d  read_cache(reg_m
+0000c6d0: 6f64 6529 0a20 2020 2020 2020 2020 2020  ode).           
+0000c6e0: 2073 656c 662e 6173 7365 7274 4e6f 7449   self.assertNotI
+0000c6f0: 6e28 7374 7228 7061 7468 292c 206e 6f72  n(str(path), nor
+0000c700: 6d61 6c5f 6361 6368 6529 0a20 2020 2020  mal_cache).     
+0000c710: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+0000c720: 7561 6c28 6163 7475 616c 2c20 6578 7065  ual(actual, expe
+0000c730: 6374 6564 290a 0a20 2020 2040 6576 656e  cted)..    @even
+0000c740: 745f 6c6f 6f70 2829 0a20 2020 2064 6566  t_loop().    def
+0000c750: 2074 6573 745f 6d75 6c74 695f 6669 6c65   test_multi_file
+0000c760: 5f66 6f72 6365 5f70 7933 3628 7365 6c66  _force_py36(self
+0000c770: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+0000c780: 2020 2072 6567 5f6d 6f64 6520 3d20 4445     reg_mode = DE
+0000c790: 4641 554c 545f 4d4f 4445 0a20 2020 2020  FAULT_MODE.     
+0000c7a0: 2020 2070 7933 365f 6d6f 6465 203d 2072     py36_mode = r
+0000c7b0: 6570 6c61 6365 2844 4546 4155 4c54 5f4d  eplace(DEFAULT_M
+0000c7c0: 4f44 452c 2074 6172 6765 745f 7665 7273  ODE, target_vers
+0000c7d0: 696f 6e73 3d50 5933 365f 5645 5253 494f  ions=PY36_VERSIO
+0000c7e0: 4e53 290a 2020 2020 2020 2020 736f 7572  NS).        sour
+0000c7f0: 6365 2c20 6578 7065 6374 6564 203d 2072  ce, expected = r
+0000c800: 6561 645f 6461 7461 2822 6d69 7363 656c  ead_data("miscel
+0000c810: 6c61 6e65 6f75 7322 2c20 2266 6f72 6365  laneous", "force
+0000c820: 5f70 7933 3622 290a 2020 2020 2020 2020  _py36").        
+0000c830: 7769 7468 2063 6163 6865 5f64 6972 2829  with cache_dir()
+0000c840: 2061 7320 776f 726b 7370 6163 653a 0a20   as workspace:. 
+0000c850: 2020 2020 2020 2020 2020 2070 6174 6873             paths
+0000c860: 203d 205b 0a20 2020 2020 2020 2020 2020   = [.           
+0000c870: 2020 2020 2028 776f 726b 7370 6163 6520       (workspace 
+0000c880: 2f20 2266 696c 6531 2e70 7922 292e 7265  / "file1.py").re
+0000c890: 736f 6c76 6528 292c 0a20 2020 2020 2020  solve(),.       
+0000c8a0: 2020 2020 2020 2020 2028 776f 726b 7370           (worksp
+0000c8b0: 6163 6520 2f20 2266 696c 6532 2e70 7922  ace / "file2.py"
+0000c8c0: 292e 7265 736f 6c76 6528 292c 0a20 2020  ).resolve(),.   
+0000c8d0: 2020 2020 2020 2020 205d 0a20 2020 2020           ].     
+0000c8e0: 2020 2020 2020 2066 6f72 2070 6174 6820         for path 
+0000c8f0: 696e 2070 6174 6873 3a0a 2020 2020 2020  in paths:.      
+0000c900: 2020 2020 2020 2020 2020 7769 7468 206f            with o
+0000c910: 7065 6e28 7061 7468 2c20 2277 2229 2061  pen(path, "w") a
+0000c920: 7320 6668 3a0a 2020 2020 2020 2020 2020  s fh:.          
+0000c930: 2020 2020 2020 2020 2020 6668 2e77 7269            fh.wri
+0000c940: 7465 2873 6f75 7263 6529 0a20 2020 2020  te(source).     
+0000c950: 2020 2020 2020 2073 656c 662e 696e 766f         self.invo
+0000c960: 6b65 426c 6163 6b28 5b73 7472 2870 2920  keBlack([str(p) 
+0000c970: 666f 7220 7020 696e 2070 6174 6873 5d20  for p in paths] 
+0000c980: 2b20 5059 3336 5f41 5247 5329 0a20 2020  + PY36_ARGS).   
+0000c990: 2020 2020 2020 2020 2066 6f72 2070 6174           for pat
+0000c9a0: 6820 696e 2070 6174 6873 3a0a 2020 2020  h in paths:.    
+0000c9b0: 2020 2020 2020 2020 2020 2020 7769 7468              with
+0000c9c0: 206f 7065 6e28 7061 7468 2c20 2272 2229   open(path, "r")
+0000c9d0: 2061 7320 6668 3a0a 2020 2020 2020 2020   as fh:.        
+0000c9e0: 2020 2020 2020 2020 2020 2020 6163 7475              actu
+0000c9f0: 616c 203d 2066 682e 7265 6164 2829 0a20  al = fh.read(). 
+0000ca00: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0000ca10: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+0000ca20: 6163 7475 616c 2c20 6578 7065 6374 6564  actual, expected
+0000ca30: 290a 2020 2020 2020 2020 2020 2020 2320  ).            # 
+0000ca40: 7665 7269 6679 2063 6163 6865 2077 6974  verify cache wit
+0000ca50: 6820 2d2d 7461 7267 6574 2d76 6572 7369  h --target-versi
+0000ca60: 6f6e 2069 7320 7365 7061 7261 7465 0a20  on is separate. 
+0000ca70: 2020 2020 2020 2020 2020 2070 7969 5f63             pyi_c
+0000ca80: 6163 6865 203d 2063 6572 6369 732e 7265  ache = cercis.re
+0000ca90: 6164 5f63 6163 6865 2870 7933 365f 6d6f  ad_cache(py36_mo
+0000caa0: 6465 290a 2020 2020 2020 2020 2020 2020  de).            
+0000cab0: 6e6f 726d 616c 5f63 6163 6865 203d 2063  normal_cache = c
+0000cac0: 6572 6369 732e 7265 6164 5f63 6163 6865  ercis.read_cache
+0000cad0: 2872 6567 5f6d 6f64 6529 0a20 2020 2020  (reg_mode).     
+0000cae0: 2020 2020 2020 2066 6f72 2070 6174 6820         for path 
+0000caf0: 696e 2070 6174 6873 3a0a 2020 2020 2020  in paths:.      
+0000cb00: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+0000cb10: 7373 6572 7449 6e28 7374 7228 7061 7468  ssertIn(str(path
+0000cb20: 292c 2070 7969 5f63 6163 6865 290a 2020  ), pyi_cache).  
+0000cb30: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0000cb40: 6c66 2e61 7373 6572 744e 6f74 496e 2873  lf.assertNotIn(s
+0000cb50: 7472 2870 6174 6829 2c20 6e6f 726d 616c  tr(path), normal
+0000cb60: 5f63 6163 6865 290a 0a20 2020 2064 6566  _cache)..    def
+0000cb70: 2074 6573 745f 7069 7065 5f66 6f72 6365   test_pipe_force
+0000cb80: 5f70 7933 3628 7365 6c66 2920 2d3e 204e  _py36(self) -> N
+0000cb90: 6f6e 653a 0a20 2020 2020 2020 2073 6f75  one:.        sou
+0000cba0: 7263 652c 2065 7870 6563 7465 6420 3d20  rce, expected = 
+0000cbb0: 7265 6164 5f64 6174 6128 226d 6973 6365  read_data("misce
+0000cbc0: 6c6c 616e 656f 7573 222c 2022 666f 7263  llaneous", "forc
+0000cbd0: 655f 7079 3336 2229 0a20 2020 2020 2020  e_py36").       
+0000cbe0: 2072 6573 756c 7420 3d20 436c 6952 756e   result = CliRun
+0000cbf0: 6e65 7228 292e 696e 766f 6b65 280a 2020  ner().invoke(.  
+0000cc00: 2020 2020 2020 2020 2020 6365 7263 6973            cercis
+0000cc10: 2e6d 6169 6e2c 0a20 2020 2020 2020 2020  .main,.         
+0000cc20: 2020 205b 222d 222c 2022 2d71 222c 2022     ["-", "-q", "
+0000cc30: 2d2d 7461 7267 6574 2d76 6572 7369 6f6e  --target-version
+0000cc40: 3d70 7933 3622 5d2c 0a20 2020 2020 2020  =py36"],.       
+0000cc50: 2020 2020 2069 6e70 7574 3d42 7974 6573       input=Bytes
+0000cc60: 494f 2873 6f75 7263 652e 656e 636f 6465  IO(source.encode
+0000cc70: 2822 7574 6638 2229 292c 0a20 2020 2020  ("utf8")),.     
+0000cc80: 2020 2029 0a20 2020 2020 2020 2073 656c     ).        sel
+0000cc90: 662e 6173 7365 7274 4571 7561 6c28 7265  f.assertEqual(re
+0000cca0: 7375 6c74 2e65 7869 745f 636f 6465 2c20  sult.exit_code, 
+0000ccb0: 3029 0a20 2020 2020 2020 2061 6374 7561  0).        actua
+0000ccc0: 6c20 3d20 7265 7375 6c74 2e6f 7574 7075  l = result.outpu
+0000ccd0: 740a 2020 2020 2020 2020 7365 6c66 2e61  t.        self.a
+0000cce0: 7373 6572 7446 6f72 6d61 7445 7175 616c  ssertFormatEqual
+0000ccf0: 2861 6374 7561 6c2c 2065 7870 6563 7465  (actual, expecte
+0000cd00: 6429 0a0a 2020 2020 4070 7974 6573 742e  d)..    @pytest.
+0000cd10: 6d61 726b 2e69 6e63 6f6d 7061 7469 626c  mark.incompatibl
+0000cd20: 655f 7769 7468 5f6d 7970 7963 0a20 2020  e_with_mypyc.   
+0000cd30: 2064 6566 2074 6573 745f 7265 666f 726d   def test_reform
+0000cd40: 6174 5f6f 6e65 5f77 6974 685f 7374 6469  at_one_with_stdi
+0000cd50: 6e28 7365 6c66 2920 2d3e 204e 6f6e 653a  n(self) -> None:
+0000cd60: 0a20 2020 2020 2020 2077 6974 6820 7061  .        with pa
+0000cd70: 7463 6828 0a20 2020 2020 2020 2020 2020  tch(.           
+0000cd80: 2022 6365 7263 6973 2e66 6f72 6d61 745f   "cercis.format_
+0000cd90: 7374 6469 6e5f 746f 5f73 7464 6f75 7422  stdin_to_stdout"
+0000cda0: 2c0a 2020 2020 2020 2020 2020 2020 7265  ,.            re
+0000cdb0: 7475 726e 5f76 616c 7565 3d6c 616d 6264  turn_value=lambd
+0000cdc0: 6120 2a61 7267 732c 202a 2a6b 7761 7267  a *args, **kwarg
+0000cdd0: 733a 2063 6572 6369 732e 4368 616e 6765  s: cercis.Change
+0000cde0: 642e 5945 532c 0a20 2020 2020 2020 2029  d.YES,.        )
+0000cdf0: 2061 7320 6673 7473 3a0a 2020 2020 2020   as fsts:.      
+0000ce00: 2020 2020 2020 7265 706f 7274 203d 204d        report = M
+0000ce10: 6167 6963 4d6f 636b 2829 0a20 2020 2020  agicMock().     
+0000ce20: 2020 2020 2020 2070 6174 6820 3d20 5061         path = Pa
+0000ce30: 7468 2822 2d22 290a 2020 2020 2020 2020  th("-").        
+0000ce40: 2020 2020 6365 7263 6973 2e72 6566 6f72      cercis.refor
+0000ce50: 6d61 745f 6f6e 6528 0a20 2020 2020 2020  mat_one(.       
+0000ce60: 2020 2020 2020 2020 2070 6174 682c 0a20           path,. 
+0000ce70: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0000ce80: 6173 743d 5472 7565 2c0a 2020 2020 2020  ast=True,.      
+0000ce90: 2020 2020 2020 2020 2020 7772 6974 655f            write_
+0000cea0: 6261 636b 3d63 6572 6369 732e 5772 6974  back=cercis.Writ
+0000ceb0: 6542 6163 6b2e 5945 532c 0a20 2020 2020  eBack.YES,.     
+0000cec0: 2020 2020 2020 2020 2020 206d 6f64 653d             mode=
+0000ced0: 4445 4641 554c 545f 4d4f 4445 2c0a 2020  DEFAULT_MODE,.  
+0000cee0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0000cef0: 706f 7274 3d72 6570 6f72 742c 0a20 2020  port=report,.   
+0000cf00: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+0000cf10: 2020 2020 2020 2066 7374 732e 6173 7365         fsts.asse
+0000cf20: 7274 5f63 616c 6c65 645f 6f6e 6365 2829  rt_called_once()
+0000cf30: 0a20 2020 2020 2020 2020 2020 2072 6570  .            rep
+0000cf40: 6f72 742e 646f 6e65 2e61 7373 6572 745f  ort.done.assert_
+0000cf50: 6361 6c6c 6564 5f77 6974 6828 7061 7468  called_with(path
+0000cf60: 2c20 6365 7263 6973 2e43 6861 6e67 6564  , cercis.Changed
+0000cf70: 2e59 4553 290a 0a20 2020 2040 7079 7465  .YES)..    @pyte
+0000cf80: 7374 2e6d 6172 6b2e 696e 636f 6d70 6174  st.mark.incompat
+0000cf90: 6962 6c65 5f77 6974 685f 6d79 7079 630a  ible_with_mypyc.
+0000cfa0: 2020 2020 6465 6620 7465 7374 5f72 6566      def test_ref
+0000cfb0: 6f72 6d61 745f 6f6e 655f 7769 7468 5f73  ormat_one_with_s
+0000cfc0: 7464 696e 5f66 696c 656e 616d 6528 7365  tdin_filename(se
+0000cfd0: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
+0000cfe0: 2020 2020 2077 6974 6820 7061 7463 6828       with patch(
+0000cff0: 0a20 2020 2020 2020 2020 2020 2022 6365  .            "ce
+0000d000: 7263 6973 2e66 6f72 6d61 745f 7374 6469  rcis.format_stdi
+0000d010: 6e5f 746f 5f73 7464 6f75 7422 2c0a 2020  n_to_stdout",.  
+0000d020: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0000d030: 5f76 616c 7565 3d6c 616d 6264 6120 2a61  _value=lambda *a
+0000d040: 7267 732c 202a 2a6b 7761 7267 733a 2063  rgs, **kwargs: c
+0000d050: 6572 6369 732e 4368 616e 6765 642e 5945  ercis.Changed.YE
+0000d060: 532c 0a20 2020 2020 2020 2029 2061 7320  S,.        ) as 
+0000d070: 6673 7473 3a0a 2020 2020 2020 2020 2020  fsts:.          
+0000d080: 2020 7265 706f 7274 203d 204d 6167 6963    report = Magic
+0000d090: 4d6f 636b 2829 0a20 2020 2020 2020 2020  Mock().         
+0000d0a0: 2020 2070 203d 2022 666f 6f2e 7079 220a     p = "foo.py".
+0000d0b0: 2020 2020 2020 2020 2020 2020 7061 7468              path
+0000d0c0: 203d 2050 6174 6828 6622 5f5f 424c 4143   = Path(f"__BLAC
+0000d0d0: 4b5f 5354 4449 4e5f 4649 4c45 4e41 4d45  K_STDIN_FILENAME
+0000d0e0: 5f5f 7b70 7d22 290a 2020 2020 2020 2020  __{p}").        
+0000d0f0: 2020 2020 6578 7065 6374 6564 203d 2050      expected = P
+0000d100: 6174 6828 7029 0a20 2020 2020 2020 2020  ath(p).         
+0000d110: 2020 2063 6572 6369 732e 7265 666f 726d     cercis.reform
+0000d120: 6174 5f6f 6e65 280a 2020 2020 2020 2020  at_one(.        
+0000d130: 2020 2020 2020 2020 7061 7468 2c0a 2020          path,.  
+0000d140: 2020 2020 2020 2020 2020 2020 2020 6661                fa
+0000d150: 7374 3d54 7275 652c 0a20 2020 2020 2020  st=True,.       
+0000d160: 2020 2020 2020 2020 2077 7269 7465 5f62           write_b
+0000d170: 6163 6b3d 6365 7263 6973 2e57 7269 7465  ack=cercis.Write
+0000d180: 4261 636b 2e59 4553 2c0a 2020 2020 2020  Back.YES,.      
+0000d190: 2020 2020 2020 2020 2020 6d6f 6465 3d44            mode=D
+0000d1a0: 4546 4155 4c54 5f4d 4f44 452c 0a20 2020  EFAULT_MODE,.   
+0000d1b0: 2020 2020 2020 2020 2020 2020 2072 6570               rep
+0000d1c0: 6f72 743d 7265 706f 7274 2c0a 2020 2020  ort=report,.    
+0000d1d0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+0000d1e0: 2020 2020 2020 6673 7473 2e61 7373 6572        fsts.asser
+0000d1f0: 745f 6361 6c6c 6564 5f6f 6e63 655f 7769  t_called_once_wi
+0000d200: 7468 280a 2020 2020 2020 2020 2020 2020  th(.            
+0000d210: 2020 2020 6661 7374 3d54 7275 652c 2077      fast=True, w
+0000d220: 7269 7465 5f62 6163 6b3d 6365 7263 6973  rite_back=cercis
+0000d230: 2e57 7269 7465 4261 636b 2e59 4553 2c20  .WriteBack.YES, 
+0000d240: 6d6f 6465 3d44 4546 4155 4c54 5f4d 4f44  mode=DEFAULT_MOD
+0000d250: 450a 2020 2020 2020 2020 2020 2020 290a  E.            ).
+0000d260: 2020 2020 2020 2020 2020 2020 2320 5f5f              # __
+0000d270: 424c 4143 4b5f 5354 4449 4e5f 4649 4c45  BLACK_STDIN_FILE
+0000d280: 4e41 4d45 5f5f 2073 686f 756c 6420 6861  NAME__ should ha
+0000d290: 7665 2062 6565 6e20 7374 7269 7070 6564  ve been stripped
+0000d2a0: 0a20 2020 2020 2020 2020 2020 2072 6570  .            rep
+0000d2b0: 6f72 742e 646f 6e65 2e61 7373 6572 745f  ort.done.assert_
+0000d2c0: 6361 6c6c 6564 5f77 6974 6828 6578 7065  called_with(expe
+0000d2d0: 6374 6564 2c20 6365 7263 6973 2e43 6861  cted, cercis.Cha
+0000d2e0: 6e67 6564 2e59 4553 290a 0a20 2020 2040  nged.YES)..    @
+0000d2f0: 7079 7465 7374 2e6d 6172 6b2e 696e 636f  pytest.mark.inco
+0000d300: 6d70 6174 6962 6c65 5f77 6974 685f 6d79  mpatible_with_my
+0000d310: 7079 630a 2020 2020 6465 6620 7465 7374  pyc.    def test
+0000d320: 5f72 6566 6f72 6d61 745f 6f6e 655f 7769  _reformat_one_wi
+0000d330: 7468 5f73 7464 696e 5f66 696c 656e 616d  th_stdin_filenam
+0000d340: 655f 7079 6928 7365 6c66 2920 2d3e 204e  e_pyi(self) -> N
+0000d350: 6f6e 653a 0a20 2020 2020 2020 2077 6974  one:.        wit
+0000d360: 6820 7061 7463 6828 0a20 2020 2020 2020  h patch(.       
+0000d370: 2020 2020 2022 6365 7263 6973 2e66 6f72       "cercis.for
+0000d380: 6d61 745f 7374 6469 6e5f 746f 5f73 7464  mat_stdin_to_std
+0000d390: 6f75 7422 2c0a 2020 2020 2020 2020 2020  out",.          
+0000d3a0: 2020 7265 7475 726e 5f76 616c 7565 3d6c    return_value=l
+0000d3b0: 616d 6264 6120 2a61 7267 732c 202a 2a6b  ambda *args, **k
+0000d3c0: 7761 7267 733a 2063 6572 6369 732e 4368  wargs: cercis.Ch
+0000d3d0: 616e 6765 642e 5945 532c 0a20 2020 2020  anged.YES,.     
+0000d3e0: 2020 2029 2061 7320 6673 7473 3a0a 2020     ) as fsts:.  
+0000d3f0: 2020 2020 2020 2020 2020 7265 706f 7274            report
+0000d400: 203d 204d 6167 6963 4d6f 636b 2829 0a20   = MagicMock(). 
+0000d410: 2020 2020 2020 2020 2020 2070 203d 2022             p = "
+0000d420: 666f 6f2e 7079 6922 0a20 2020 2020 2020  foo.pyi".       
+0000d430: 2020 2020 2070 6174 6820 3d20 5061 7468       path = Path
+0000d440: 2866 225f 5f42 4c41 434b 5f53 5444 494e  (f"__BLACK_STDIN
+0000d450: 5f46 494c 454e 414d 455f 5f7b 707d 2229  _FILENAME__{p}")
+0000d460: 0a20 2020 2020 2020 2020 2020 2065 7870  .            exp
+0000d470: 6563 7465 6420 3d20 5061 7468 2870 290a  ected = Path(p).
+0000d480: 2020 2020 2020 2020 2020 2020 6365 7263              cerc
+0000d490: 6973 2e72 6566 6f72 6d61 745f 6f6e 6528  is.reformat_one(
+0000d4a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d4b0: 2070 6174 682c 0a20 2020 2020 2020 2020   path,.         
+0000d4c0: 2020 2020 2020 2066 6173 743d 5472 7565         fast=True
+0000d4d0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000d4e0: 2020 7772 6974 655f 6261 636b 3d63 6572    write_back=cer
+0000d4f0: 6369 732e 5772 6974 6542 6163 6b2e 5945  cis.WriteBack.YE
+0000d500: 532c 0a20 2020 2020 2020 2020 2020 2020  S,.             
+0000d510: 2020 206d 6f64 653d 4445 4641 554c 545f     mode=DEFAULT_
+0000d520: 4d4f 4445 2c0a 2020 2020 2020 2020 2020  MODE,.          
+0000d530: 2020 2020 2020 7265 706f 7274 3d72 6570        report=rep
+0000d540: 6f72 742c 0a20 2020 2020 2020 2020 2020  ort,.           
+0000d550: 2029 0a20 2020 2020 2020 2020 2020 2066   ).            f
+0000d560: 7374 732e 6173 7365 7274 5f63 616c 6c65  sts.assert_calle
+0000d570: 645f 6f6e 6365 5f77 6974 6828 0a20 2020  d_once_with(.   
+0000d580: 2020 2020 2020 2020 2020 2020 2066 6173               fas
+0000d590: 743d 5472 7565 2c0a 2020 2020 2020 2020  t=True,.        
+0000d5a0: 2020 2020 2020 2020 7772 6974 655f 6261          write_ba
+0000d5b0: 636b 3d63 6572 6369 732e 5772 6974 6542  ck=cercis.WriteB
+0000d5c0: 6163 6b2e 5945 532c 0a20 2020 2020 2020  ack.YES,.       
+0000d5d0: 2020 2020 2020 2020 206d 6f64 653d 7265           mode=re
+0000d5e0: 706c 6163 6528 4445 4641 554c 545f 4d4f  place(DEFAULT_MO
+0000d5f0: 4445 2c20 6973 5f70 7969 3d54 7275 6529  DE, is_pyi=True)
+0000d600: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
+0000d610: 2020 2020 2020 2020 2020 2020 2320 5f5f              # __
+0000d620: 424c 4143 4b5f 5354 4449 4e5f 4649 4c45  BLACK_STDIN_FILE
+0000d630: 4e41 4d45 5f5f 2073 686f 756c 6420 6861  NAME__ should ha
+0000d640: 7665 2062 6565 6e20 7374 7269 7070 6564  ve been stripped
+0000d650: 0a20 2020 2020 2020 2020 2020 2072 6570  .            rep
+0000d660: 6f72 742e 646f 6e65 2e61 7373 6572 745f  ort.done.assert_
+0000d670: 6361 6c6c 6564 5f77 6974 6828 6578 7065  called_with(expe
+0000d680: 6374 6564 2c20 6365 7263 6973 2e43 6861  cted, cercis.Cha
+0000d690: 6e67 6564 2e59 4553 290a 0a20 2020 2040  nged.YES)..    @
+0000d6a0: 7079 7465 7374 2e6d 6172 6b2e 696e 636f  pytest.mark.inco
+0000d6b0: 6d70 6174 6962 6c65 5f77 6974 685f 6d79  mpatible_with_my
+0000d6c0: 7079 630a 2020 2020 6465 6620 7465 7374  pyc.    def test
+0000d6d0: 5f72 6566 6f72 6d61 745f 6f6e 655f 7769  _reformat_one_wi
+0000d6e0: 7468 5f73 7464 696e 5f66 696c 656e 616d  th_stdin_filenam
+0000d6f0: 655f 6970 796e 6228 7365 6c66 2920 2d3e  e_ipynb(self) ->
+0000d700: 204e 6f6e 653a 0a20 2020 2020 2020 2077   None:.        w
+0000d710: 6974 6820 7061 7463 6828 0a20 2020 2020  ith patch(.     
+0000d720: 2020 2020 2020 2022 6365 7263 6973 2e66         "cercis.f
+0000d730: 6f72 6d61 745f 7374 6469 6e5f 746f 5f73  ormat_stdin_to_s
+0000d740: 7464 6f75 7422 2c0a 2020 2020 2020 2020  tdout",.        
+0000d750: 2020 2020 7265 7475 726e 5f76 616c 7565      return_value
+0000d760: 3d6c 616d 6264 6120 2a61 7267 732c 202a  =lambda *args, *
+0000d770: 2a6b 7761 7267 733a 2063 6572 6369 732e  *kwargs: cercis.
+0000d780: 4368 616e 6765 642e 5945 532c 0a20 2020  Changed.YES,.   
+0000d790: 2020 2020 2029 2061 7320 6673 7473 3a0a       ) as fsts:.
+0000d7a0: 2020 2020 2020 2020 2020 2020 7265 706f              repo
+0000d7b0: 7274 203d 204d 6167 6963 4d6f 636b 2829  rt = MagicMock()
+0000d7c0: 0a20 2020 2020 2020 2020 2020 2070 203d  .            p =
+0000d7d0: 2022 666f 6f2e 6970 796e 6222 0a20 2020   "foo.ipynb".   
+0000d7e0: 2020 2020 2020 2020 2070 6174 6820 3d20           path = 
+0000d7f0: 5061 7468 2866 225f 5f42 4c41 434b 5f53  Path(f"__BLACK_S
+0000d800: 5444 494e 5f46 494c 454e 414d 455f 5f7b  TDIN_FILENAME__{
+0000d810: 707d 2229 0a20 2020 2020 2020 2020 2020  p}").           
+0000d820: 2065 7870 6563 7465 6420 3d20 5061 7468   expected = Path
+0000d830: 2870 290a 2020 2020 2020 2020 2020 2020  (p).            
+0000d840: 6365 7263 6973 2e72 6566 6f72 6d61 745f  cercis.reformat_
+0000d850: 6f6e 6528 0a20 2020 2020 2020 2020 2020  one(.           
+0000d860: 2020 2020 2070 6174 682c 0a20 2020 2020       path,.     
+0000d870: 2020 2020 2020 2020 2020 2066 6173 743d             fast=
+0000d880: 5472 7565 2c0a 2020 2020 2020 2020 2020  True,.          
+0000d890: 2020 2020 2020 7772 6974 655f 6261 636b        write_back
+0000d8a0: 3d63 6572 6369 732e 5772 6974 6542 6163  =cercis.WriteBac
+0000d8b0: 6b2e 5945 532c 0a20 2020 2020 2020 2020  k.YES,.         
+0000d8c0: 2020 2020 2020 206d 6f64 653d 4445 4641         mode=DEFA
+0000d8d0: 554c 545f 4d4f 4445 2c0a 2020 2020 2020  ULT_MODE,.      
+0000d8e0: 2020 2020 2020 2020 2020 7265 706f 7274            report
+0000d8f0: 3d72 6570 6f72 742c 0a20 2020 2020 2020  =report,.       
+0000d900: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+0000d910: 2020 2066 7374 732e 6173 7365 7274 5f63     fsts.assert_c
+0000d920: 616c 6c65 645f 6f6e 6365 5f77 6974 6828  alled_once_with(
+0000d930: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d940: 2066 6173 743d 5472 7565 2c0a 2020 2020   fast=True,.    
+0000d950: 2020 2020 2020 2020 2020 2020 7772 6974              writ
+0000d960: 655f 6261 636b 3d63 6572 6369 732e 5772  e_back=cercis.Wr
+0000d970: 6974 6542 6163 6b2e 5945 532c 0a20 2020  iteBack.YES,.   
+0000d980: 2020 2020 2020 2020 2020 2020 206d 6f64               mod
+0000d990: 653d 7265 706c 6163 6528 4445 4641 554c  e=replace(DEFAUL
+0000d9a0: 545f 4d4f 4445 2c20 6973 5f69 7079 6e62  T_MODE, is_ipynb
+0000d9b0: 3d54 7275 6529 2c0a 2020 2020 2020 2020  =True),.        
+0000d9c0: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+0000d9d0: 2020 2320 5f5f 424c 4143 4b5f 5354 4449    # __BLACK_STDI
+0000d9e0: 4e5f 4649 4c45 4e41 4d45 5f5f 2073 686f  N_FILENAME__ sho
+0000d9f0: 756c 6420 6861 7665 2062 6565 6e20 7374  uld have been st
+0000da00: 7269 7070 6564 0a20 2020 2020 2020 2020  ripped.         
+0000da10: 2020 2072 6570 6f72 742e 646f 6e65 2e61     report.done.a
+0000da20: 7373 6572 745f 6361 6c6c 6564 5f77 6974  ssert_called_wit
+0000da30: 6828 6578 7065 6374 6564 2c20 6365 7263  h(expected, cerc
+0000da40: 6973 2e43 6861 6e67 6564 2e59 4553 290a  is.Changed.YES).
+0000da50: 0a20 2020 2040 7079 7465 7374 2e6d 6172  .    @pytest.mar
+0000da60: 6b2e 696e 636f 6d70 6174 6962 6c65 5f77  k.incompatible_w
+0000da70: 6974 685f 6d79 7079 630a 2020 2020 6465  ith_mypyc.    de
+0000da80: 6620 7465 7374 5f72 6566 6f72 6d61 745f  f test_reformat_
+0000da90: 6f6e 655f 7769 7468 5f73 7464 696e 5f61  one_with_stdin_a
+0000daa0: 6e64 5f65 7869 7374 696e 675f 7061 7468  nd_existing_path
+0000dab0: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
+0000dac0: 2020 2020 2020 2020 7769 7468 2070 6174          with pat
+0000dad0: 6368 280a 2020 2020 2020 2020 2020 2020  ch(.            
+0000dae0: 2263 6572 6369 732e 666f 726d 6174 5f73  "cercis.format_s
+0000daf0: 7464 696e 5f74 6f5f 7374 646f 7574 222c  tdin_to_stdout",
+0000db00: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0000db10: 7572 6e5f 7661 6c75 653d 6c61 6d62 6461  urn_value=lambda
+0000db20: 202a 6172 6773 2c20 2a2a 6b77 6172 6773   *args, **kwargs
+0000db30: 3a20 6365 7263 6973 2e43 6861 6e67 6564  : cercis.Changed
+0000db40: 2e59 4553 2c0a 2020 2020 2020 2020 2920  .YES,.        ) 
+0000db50: 6173 2066 7374 733a 0a20 2020 2020 2020  as fsts:.       
+0000db60: 2020 2020 2072 6570 6f72 7420 3d20 4d61       report = Ma
+0000db70: 6769 634d 6f63 6b28 290a 2020 2020 2020  gicMock().      
+0000db80: 2020 2020 2020 2320 4576 656e 2077 6974        # Even wit
+0000db90: 6820 616e 2065 7869 7374 696e 6720 6669  h an existing fi
+0000dba0: 6c65 2c20 7369 6e63 6520 7765 2061 7265  le, since we are
+0000dbb0: 2066 6f72 6369 6e67 2073 7464 696e 2c20   forcing stdin, 
+0000dbc0: 6365 7263 6973 0a20 2020 2020 2020 2020  cercis.         
+0000dbd0: 2020 2023 2073 686f 756c 6420 6f75 7470     # should outp
+0000dbe0: 7574 2074 6f20 7374 646f 7574 2061 6e64  ut to stdout and
+0000dbf0: 206e 6f74 206d 6f64 6966 7920 7468 6520   not modify the 
+0000dc00: 6669 6c65 2069 6e70 6c61 6365 0a20 2020  file inplace.   
+0000dc10: 2020 2020 2020 2020 2070 203d 2054 4849           p = THI
+0000dc20: 535f 4449 5220 2f20 2264 6174 6122 202f  S_DIR / "data" /
+0000dc30: 2022 7369 6d70 6c65 5f63 6173 6573 2220   "simple_cases" 
+0000dc40: 2f20 2263 6f6c 6c65 6374 696f 6e73 2e70  / "collections.p
+0000dc50: 7922 0a20 2020 2020 2020 2020 2020 2023  y".            #
+0000dc60: 204d 616b 6520 7375 7265 2069 735f 6669   Make sure is_fi
+0000dc70: 6c65 2061 6374 7561 6c6c 7920 7265 7475  le actually retu
+0000dc80: 726e 7320 5472 7565 0a20 2020 2020 2020  rns True.       
+0000dc90: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+0000dca0: 5472 7565 2870 2e69 735f 6669 6c65 2829  True(p.is_file()
+0000dcb0: 290a 2020 2020 2020 2020 2020 2020 7061  ).            pa
+0000dcc0: 7468 203d 2050 6174 6828 6622 5f5f 424c  th = Path(f"__BL
+0000dcd0: 4143 4b5f 5354 4449 4e5f 4649 4c45 4e41  ACK_STDIN_FILENA
+0000dce0: 4d45 5f5f 7b70 7d22 290a 2020 2020 2020  ME__{p}").      
+0000dcf0: 2020 2020 2020 6578 7065 6374 6564 203d        expected =
+0000dd00: 2050 6174 6828 7029 0a20 2020 2020 2020   Path(p).       
+0000dd10: 2020 2020 2063 6572 6369 732e 7265 666f       cercis.refo
+0000dd20: 726d 6174 5f6f 6e65 280a 2020 2020 2020  rmat_one(.      
+0000dd30: 2020 2020 2020 2020 2020 7061 7468 2c0a            path,.
+0000dd40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dd50: 6661 7374 3d54 7275 652c 0a20 2020 2020  fast=True,.     
+0000dd60: 2020 2020 2020 2020 2020 2077 7269 7465             write
+0000dd70: 5f62 6163 6b3d 6365 7263 6973 2e57 7269  _back=cercis.Wri
+0000dd80: 7465 4261 636b 2e59 4553 2c0a 2020 2020  teBack.YES,.    
+0000dd90: 2020 2020 2020 2020 2020 2020 6d6f 6465              mode
+0000dda0: 3d44 4546 4155 4c54 5f4d 4f44 452c 0a20  =DEFAULT_MODE,. 
+0000ddb0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0000ddc0: 6570 6f72 743d 7265 706f 7274 2c0a 2020  eport=report,.  
+0000ddd0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+0000dde0: 2020 2020 2020 2020 6673 7473 2e61 7373          fsts.ass
+0000ddf0: 6572 745f 6361 6c6c 6564 5f6f 6e63 6528  ert_called_once(
+0000de00: 290a 2020 2020 2020 2020 2020 2020 2320  ).            # 
+0000de10: 5f5f 424c 4143 4b5f 5354 4449 4e5f 4649  __BLACK_STDIN_FI
+0000de20: 4c45 4e41 4d45 5f5f 2073 686f 756c 6420  LENAME__ should 
+0000de30: 6861 7665 2062 6565 6e20 7374 7269 7070  have been stripp
+0000de40: 6564 0a20 2020 2020 2020 2020 2020 2072  ed.            r
+0000de50: 6570 6f72 742e 646f 6e65 2e61 7373 6572  eport.done.asser
+0000de60: 745f 6361 6c6c 6564 5f77 6974 6828 6578  t_called_with(ex
+0000de70: 7065 6374 6564 2c20 6365 7263 6973 2e43  pected, cercis.C
+0000de80: 6861 6e67 6564 2e59 4553 290a 0a20 2020  hanged.YES)..   
+0000de90: 2064 6566 2074 6573 745f 7265 666f 726d   def test_reform
+0000dea0: 6174 5f6f 6e65 5f77 6974 685f 7374 6469  at_one_with_stdi
+0000deb0: 6e5f 656d 7074 7928 7365 6c66 2920 2d3e  n_empty(self) ->
+0000dec0: 204e 6f6e 653a 0a20 2020 2020 2020 2063   None:.        c
+0000ded0: 6173 6573 203d 205b 0a20 2020 2020 2020  ases = [.       
+0000dee0: 2020 2020 2028 2222 2c20 2222 292c 0a20       ("", ""),. 
+0000def0: 2020 2020 2020 2020 2020 2028 225c 6e22             ("\n"
+0000df00: 2c20 225c 6e22 292c 0a20 2020 2020 2020  , "\n"),.       
+0000df10: 2020 2020 2028 225c 725c 6e22 2c20 225c       ("\r\n", "\
+0000df20: 725c 6e22 292c 0a20 2020 2020 2020 2020  r\n"),.         
+0000df30: 2020 2028 2220 5c74 222c 2022 2229 2c0a     (" \t", ""),.
+0000df40: 2020 2020 2020 2020 2020 2020 2822 205c              (" \
+0000df50: 745c 6e5c 7420 222c 2022 5c6e 2229 2c0a  t\n\t ", "\n"),.
+0000df60: 2020 2020 2020 2020 2020 2020 2822 205c              (" \
+0000df70: 745c 725c 6e5c 7420 222c 2022 5c72 5c6e  t\r\n\t ", "\r\n
+0000df80: 2229 2c0a 2020 2020 2020 2020 5d0a 0a20  "),.        ].. 
+0000df90: 2020 2020 2020 2064 6566 205f 6e65 775f         def _new_
+0000dfa0: 7772 6170 7065 7228 0a20 2020 2020 2020  wrapper(.       
+0000dfb0: 2020 2020 2020 2020 206f 7574 7075 743a           output:
+0000dfc0: 2069 6f2e 5374 7269 6e67 494f 2c20 696f   io.StringIO, io
+0000dfd0: 5f54 6578 7449 4f57 7261 7070 6572 3a20  _TextIOWrapper: 
+0000dfe0: 5479 7065 5b69 6f2e 5465 7874 494f 5772  Type[io.TextIOWr
+0000dff0: 6170 7065 725d 0a20 2020 2020 2020 2029  apper].        )
+0000e000: 202d 3e20 4361 6c6c 6162 6c65 5b5b 416e   -> Callable[[An
+0000e010: 792c 2041 6e79 5d2c 2069 6f2e 5465 7874  y, Any], io.Text
+0000e020: 494f 5772 6170 7065 725d 3a0a 2020 2020  IOWrapper]:.    
+0000e030: 2020 2020 2020 2020 6465 6620 6765 745f          def get_
+0000e040: 6f75 7470 7574 282a 6172 6773 3a20 416e  output(*args: An
+0000e050: 792c 202a 2a6b 7761 7267 733a 2041 6e79  y, **kwargs: Any
+0000e060: 2920 2d3e 2069 6f2e 5465 7874 494f 5772  ) -> io.TextIOWr
+0000e070: 6170 7065 723a 0a20 2020 2020 2020 2020  apper:.         
+0000e080: 2020 2020 2020 2069 6620 6172 6773 203d         if args =
+0000e090: 3d20 2873 7973 2e73 7464 6f75 742e 6275  = (sys.stdout.bu
+0000e0a0: 6666 6572 2c29 3a0a 2020 2020 2020 2020  ffer,):.        
+0000e0b0: 2020 2020 2020 2020 2020 2020 2320 4974              # It
+0000e0c0: 2773 2060 666f 726d 6174 5f73 7464 696e  's `format_stdin
+0000e0d0: 5f74 6f5f 7374 646f 7574 2829 6020 6361  _to_stdout()` ca
+0000e0e0: 6c6c 696e 6720 6069 6f2e 5465 7874 494f  lling `io.TextIO
+0000e0f0: 5772 6170 7065 7228 2960 2c0a 2020 2020  Wrapper()`,.    
+0000e100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e110: 2320 7265 7475 726e 206f 7572 206d 6f63  # return our moc
+0000e120: 6b20 6f62 6a65 6374 2e0a 2020 2020 2020  k object..      
+0000e130: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0000e140: 7475 726e 206f 7574 7075 740a 2020 2020  turn output.    
+0000e150: 2020 2020 2020 2020 2020 2020 2320 4974              # It
+0000e160: 2773 2073 6f6d 6574 6869 6e67 2065 6c73  's something els
+0000e170: 6520 2869 2e65 2e20 6064 6563 6f64 655f  e (i.e. `decode_
+0000e180: 6279 7465 7328 2960 2920 6361 6c6c 696e  bytes()`) callin
+0000e190: 670a 2020 2020 2020 2020 2020 2020 2020  g.              
+0000e1a0: 2020 2320 6069 6f2e 5465 7874 494f 5772    # `io.TextIOWr
+0000e1b0: 6170 7065 7228 2960 2c20 7061 7373 2074  apper()`, pass t
+0000e1c0: 6872 6f75 6768 2074 6f20 7468 6520 6f72  hrough to the or
+0000e1d0: 6967 696e 616c 2069 6d70 6c65 6d65 6e74  iginal implement
+0000e1e0: 6174 696f 6e2e 0a20 2020 2020 2020 2020  ation..         
+0000e1f0: 2020 2020 2020 2023 2053 6565 2064 6973         # See dis
+0000e200: 6375 7373 696f 6e20 696e 2068 7474 7073  cussion in https
+0000e210: 3a2f 2f67 6974 6875 622e 636f 6d2f 7073  ://github.com/ps
+0000e220: 662f 626c 6163 6b2f 7075 6c6c 2f32 3438  f/black/pull/248
+0000e230: 390a 2020 2020 2020 2020 2020 2020 2020  9.              
+0000e240: 2020 7265 7475 726e 2069 6f5f 5465 7874    return io_Text
+0000e250: 494f 5772 6170 7065 7228 2a61 7267 732c  IOWrapper(*args,
+0000e260: 202a 2a6b 7761 7267 7329 0a0a 2020 2020   **kwargs)..    
+0000e270: 2020 2020 2020 2020 7265 7475 726e 2067          return g
+0000e280: 6574 5f6f 7574 7075 740a 0a20 2020 2020  et_output..     
+0000e290: 2020 206d 6f64 6520 3d20 6365 7263 6973     mode = cercis
+0000e2a0: 2e4d 6f64 6528 7072 6576 6965 773d 5472  .Mode(preview=Tr
+0000e2b0: 7565 290a 2020 2020 2020 2020 666f 7220  ue).        for 
+0000e2c0: 636f 6e74 656e 742c 2065 7870 6563 7465  content, expecte
+0000e2d0: 6420 696e 2063 6173 6573 3a0a 2020 2020  d in cases:.    
+0000e2e0: 2020 2020 2020 2020 6f75 7470 7574 203d          output =
+0000e2f0: 2069 6f2e 5374 7269 6e67 494f 2829 0a20   io.StringIO(). 
+0000e300: 2020 2020 2020 2020 2020 2069 6f5f 5465             io_Te
+0000e310: 7874 494f 5772 6170 7065 7220 3d20 696f  xtIOWrapper = io
+0000e320: 2e54 6578 7449 4f57 7261 7070 6572 0a0a  .TextIOWrapper..
+0000e330: 2020 2020 2020 2020 2020 2020 7769 7468              with
+0000e340: 2070 6174 6368 2822 696f 2e54 6578 7449   patch("io.TextI
+0000e350: 4f57 7261 7070 6572 222c 205f 6e65 775f  OWrapper", _new_
+0000e360: 7772 6170 7065 7228 6f75 7470 7574 2c20  wrapper(output, 
+0000e370: 696f 5f54 6578 7449 4f57 7261 7070 6572  io_TextIOWrapper
+0000e380: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
+0000e390: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+0000e3a0: 2020 2020 2020 2020 2020 2020 2063 6572               cer
+0000e3b0: 6369 732e 666f 726d 6174 5f73 7464 696e  cis.format_stdin
+0000e3c0: 5f74 6f5f 7374 646f 7574 280a 2020 2020  _to_stdout(.    
+0000e3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e3e0: 2020 2020 6661 7374 3d54 7275 652c 0a20      fast=True,. 
+0000e3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e400: 2020 2020 2020 2063 6f6e 7465 6e74 3d63         content=c
+0000e410: 6f6e 7465 6e74 2c0a 2020 2020 2020 2020  ontent,.        
+0000e420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e430: 7772 6974 655f 6261 636b 3d63 6572 6369  write_back=cerci
+0000e440: 732e 5772 6974 6542 6163 6b2e 5945 532c  s.WriteBack.YES,
+0000e450: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000e460: 2020 2020 2020 2020 206d 6f64 653d 6d6f           mode=mo
+0000e470: 6465 2c0a 2020 2020 2020 2020 2020 2020  de,.            
+0000e480: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+0000e490: 2020 2020 2020 2020 2020 6578 6365 7074            except
+0000e4a0: 2069 6f2e 556e 7375 7070 6f72 7465 644f   io.UnsupportedO
+0000e4b0: 7065 7261 7469 6f6e 3a0a 2020 2020 2020  peration:.      
+0000e4c0: 2020 2020 2020 2020 2020 2020 2020 7061                pa
+0000e4d0: 7373 2020 2320 5374 7269 6e67 494f 2064  ss  # StringIO d
+0000e4e0: 6f65 7320 6e6f 7420 7375 7070 6f72 7420  oes not support 
+0000e4f0: 6465 7461 6368 0a20 2020 2020 2020 2020  detach.         
+0000e500: 2020 2020 2020 2061 7373 6572 7420 6f75         assert ou
+0000e510: 7470 7574 2e67 6574 7661 6c75 6528 2920  tput.getvalue() 
+0000e520: 3d3d 2065 7870 6563 7465 640a 0a20 2020  == expected..   
+0000e530: 2020 2020 2023 2041 6e20 656d 7074 7920       # An empty 
+0000e540: 7374 7269 6e67 2069 7320 7468 6520 6f6e  string is the on
+0000e550: 6c79 2074 6573 7420 6361 7365 2066 6f72  ly test case for
+0000e560: 2060 7072 6576 6965 773d 4661 6c73 6560   `preview=False`
+0000e570: 0a20 2020 2020 2020 206f 7574 7075 7420  .        output 
+0000e580: 3d20 696f 2e53 7472 696e 6749 4f28 290a  = io.StringIO().
+0000e590: 2020 2020 2020 2020 696f 5f54 6578 7449          io_TextI
+0000e5a0: 4f57 7261 7070 6572 203d 2069 6f2e 5465  OWrapper = io.Te
+0000e5b0: 7874 494f 5772 6170 7065 720a 2020 2020  xtIOWrapper.    
+0000e5c0: 2020 2020 7769 7468 2070 6174 6368 2822      with patch("
+0000e5d0: 696f 2e54 6578 7449 4f57 7261 7070 6572  io.TextIOWrapper
+0000e5e0: 222c 205f 6e65 775f 7772 6170 7065 7228  ", _new_wrapper(
+0000e5f0: 6f75 7470 7574 2c20 696f 5f54 6578 7449  output, io_TextI
+0000e600: 4f57 7261 7070 6572 2929 3a0a 2020 2020  OWrapper)):.    
+0000e610: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+0000e620: 2020 2020 2020 2020 2020 2020 2063 6572               cer
+0000e630: 6369 732e 666f 726d 6174 5f73 7464 696e  cis.format_stdin
+0000e640: 5f74 6f5f 7374 646f 7574 280a 2020 2020  _to_stdout(.    
+0000e650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e660: 6661 7374 3d54 7275 652c 0a20 2020 2020  fast=True,.     
+0000e670: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0000e680: 6f6e 7465 6e74 3d22 222c 0a20 2020 2020  ontent="",.     
+0000e690: 2020 2020 2020 2020 2020 2020 2020 2077                 w
+0000e6a0: 7269 7465 5f62 6163 6b3d 6365 7263 6973  rite_back=cercis
+0000e6b0: 2e57 7269 7465 4261 636b 2e59 4553 2c0a  .WriteBack.YES,.
+0000e6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e6d0: 2020 2020 6d6f 6465 3d44 4546 4155 4c54      mode=DEFAULT
+0000e6e0: 5f4d 4f44 452c 0a20 2020 2020 2020 2020  _MODE,.         
+0000e6f0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0000e700: 2020 2020 2065 7863 6570 7420 696f 2e55       except io.U
+0000e710: 6e73 7570 706f 7274 6564 4f70 6572 6174  nsupportedOperat
+0000e720: 696f 6e3a 0a20 2020 2020 2020 2020 2020  ion:.           
+0000e730: 2020 2020 2070 6173 7320 2023 2053 7472       pass  # Str
+0000e740: 696e 6749 4f20 646f 6573 206e 6f74 2073  ingIO does not s
+0000e750: 7570 706f 7274 2064 6574 6163 680a 2020  upport detach.  
+0000e760: 2020 2020 2020 2020 2020 6173 7365 7274            assert
+0000e770: 206f 7574 7075 742e 6765 7476 616c 7565   output.getvalue
+0000e780: 2829 203d 3d20 2222 0a0a 2020 2020 6465  () == ""..    de
+0000e790: 6620 7465 7374 5f69 6e76 616c 6964 5f63  f test_invalid_c
+0000e7a0: 6c69 5f72 6567 6578 2873 656c 6629 202d  li_regex(self) -
+0000e7b0: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+0000e7c0: 666f 7220 6f70 7469 6f6e 2069 6e20 5b22  for option in ["
+0000e7d0: 2d2d 696e 636c 7564 6522 2c20 222d 2d65  --include", "--e
+0000e7e0: 7863 6c75 6465 222c 2022 2d2d 6578 7465  xclude", "--exte
+0000e7f0: 6e64 2d65 7863 6c75 6465 222c 2022 2d2d  nd-exclude", "--
+0000e800: 666f 7263 652d 6578 636c 7564 6522 5d3a  force-exclude"]:
+0000e810: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0000e820: 662e 696e 766f 6b65 426c 6163 6b28 5b22  f.invokeBlack(["
+0000e830: 2d22 2c20 6f70 7469 6f6e 2c20 222a 2a28  -", option, "**(
+0000e840: 2928 2121 2a29 225d 2c20 6578 6974 5f63  )(!!*)"], exit_c
+0000e850: 6f64 653d 3229 0a0a 2020 2020 6465 6620  ode=2)..    def 
 0000e860: 7465 7374 5f72 6571 7569 7265 645f 7665  test_required_ve
-0000e870: 7273 696f 6e5f 646f 6573 5f6e 6f74 5f6d  rsion_does_not_m
-0000e880: 6174 6368 5f6f 6e5f 6d69 6e6f 725f 7665  atch_on_minor_ve
-0000e890: 7273 696f 6e28 7365 6c66 2920 2d3e 204e  rsion(self) -> N
-0000e8a0: 6f6e 653a 0a20 2020 2020 2020 2073 656c  one:.        sel
-0000e8b0: 662e 696e 766f 6b65 426c 6163 6b28 0a20  f.invokeBlack(. 
-0000e8c0: 2020 2020 2020 2020 2020 205b 0a20 2020             [.   
-0000e8d0: 2020 2020 2020 2020 2020 2020 2022 2d2d               "--
-0000e8e0: 7265 7175 6972 6564 2d76 6572 7369 6f6e  required-version
-0000e8f0: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
-0000e900: 2020 2063 6572 6369 732e 5f5f 7665 7273     cercis.__vers
-0000e910: 696f 6e5f 5f2e 7370 6c69 7428 222e 2229  ion__.split(".")
-0000e920: 5b30 5d20 2b20 222e 3939 3922 2c0a 2020  [0] + ".999",.  
-0000e930: 2020 2020 2020 2020 2020 2020 2020 222d                "-
-0000e940: 6322 2c0a 2020 2020 2020 2020 2020 2020  c",.            
-0000e950: 2020 2020 2230 222c 0a20 2020 2020 2020      "0",.       
-0000e960: 2020 2020 205d 2c0a 2020 2020 2020 2020       ],.        
-0000e970: 2020 2020 6578 6974 5f63 6f64 653d 312c      exit_code=1,
-0000e980: 0a20 2020 2020 2020 2020 2020 2069 676e  .            ign
-0000e990: 6f72 655f 636f 6e66 6967 3d54 7275 652c  ore_config=True,
-0000e9a0: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-0000e9b0: 6465 6620 7465 7374 5f72 6571 7569 7265  def test_require
-0000e9c0: 645f 7665 7273 696f 6e5f 646f 6573 5f6e  d_version_does_n
-0000e9d0: 6f74 5f6d 6174 6368 5f76 6572 7369 6f6e  ot_match_version
-0000e9e0: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
-0000e9f0: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
-0000ea00: 2042 6c61 636b 5275 6e6e 6572 2829 2e69   BlackRunner().i
-0000ea10: 6e76 6f6b 6528 0a20 2020 2020 2020 2020  nvoke(.         
-0000ea20: 2020 2063 6572 6369 732e 6d61 696e 2c0a     cercis.main,.
-0000ea30: 2020 2020 2020 2020 2020 2020 5b22 2d2d              ["--
-0000ea40: 7265 7175 6972 6564 2d76 6572 7369 6f6e  required-version
-0000ea50: 222c 2022 3230 2e39 3962 222c 2022 2d63  ", "20.99b", "-c
-0000ea60: 222c 2022 3022 5d2c 0a20 2020 2020 2020  ", "0"],.       
-0000ea70: 2029 0a20 2020 2020 2020 2073 656c 662e   ).        self.
-0000ea80: 6173 7365 7274 4571 7561 6c28 7265 7375  assertEqual(resu
-0000ea90: 6c74 2e65 7869 745f 636f 6465 2c20 3129  lt.exit_code, 1)
-0000eaa0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-0000eab0: 7365 7274 496e 2822 7265 7175 6972 6564  sertIn("required
-0000eac0: 2076 6572 7369 6f6e 222c 2072 6573 756c   version", resul
-0000ead0: 742e 7374 6465 7272 290a 0a20 2020 2064  t.stderr)..    d
-0000eae0: 6566 2074 6573 745f 7072 6573 6572 7665  ef test_preserve
-0000eaf0: 735f 6c69 6e65 5f65 6e64 696e 6773 2873  s_line_endings(s
-0000eb00: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
-0000eb10: 2020 2020 2020 7769 7468 2054 656d 706f        with Tempo
-0000eb20: 7261 7279 4469 7265 6374 6f72 7928 2920  raryDirectory() 
-0000eb30: 6173 2077 6f72 6b73 7061 6365 3a0a 2020  as workspace:.  
-0000eb40: 2020 2020 2020 2020 2020 7465 7374 5f66            test_f
-0000eb50: 696c 6520 3d20 5061 7468 2877 6f72 6b73  ile = Path(works
-0000eb60: 7061 6365 2920 2f20 2274 6573 742e 7079  pace) / "test.py
-0000eb70: 220a 2020 2020 2020 2020 2020 2020 666f  ".            fo
-0000eb80: 7220 6e6c 2069 6e20 5b22 5c6e 222c 2022  r nl in ["\n", "
-0000eb90: 5c72 5c6e 225d 3a0a 2020 2020 2020 2020  \r\n"]:.        
-0000eba0: 2020 2020 2020 2020 636f 6e74 656e 7473          contents
-0000ebb0: 203d 206e 6c2e 6a6f 696e 285b 2264 6566   = nl.join(["def
-0000ebc0: 2066 2820 2029 3a22 2c20 2220 2020 2070   f(  ):", "    p
-0000ebd0: 6173 7322 5d29 0a20 2020 2020 2020 2020  ass"]).         
-0000ebe0: 2020 2020 2020 2074 6573 745f 6669 6c65         test_file
-0000ebf0: 2e77 7269 7465 5f62 7974 6573 2863 6f6e  .write_bytes(con
-0000ec00: 7465 6e74 732e 656e 636f 6465 2829 290a  tents.encode()).
-0000ec10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ec20: 6666 2874 6573 745f 6669 6c65 2c20 7772  ff(test_file, wr
-0000ec30: 6974 655f 6261 636b 3d63 6572 6369 732e  ite_back=cercis.
-0000ec40: 5772 6974 6542 6163 6b2e 5945 5329 0a20  WriteBack.YES). 
-0000ec50: 2020 2020 2020 2020 2020 2020 2020 2075                 u
-0000ec60: 7064 6174 6564 5f63 6f6e 7465 6e74 733a  pdated_contents:
-0000ec70: 2062 7974 6573 203d 2074 6573 745f 6669   bytes = test_fi
-0000ec80: 6c65 2e72 6561 645f 6279 7465 7328 290a  le.read_bytes().
-0000ec90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000eca0: 7365 6c66 2e61 7373 6572 7449 6e28 6e6c  self.assertIn(nl
-0000ecb0: 2e65 6e63 6f64 6528 292c 2075 7064 6174  .encode(), updat
-0000ecc0: 6564 5f63 6f6e 7465 6e74 7329 0a20 2020  ed_contents).   
-0000ecd0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0000ece0: 6e6c 203d 3d20 225c 6e22 3a0a 2020 2020  nl == "\n":.    
-0000ecf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ed00: 7365 6c66 2e61 7373 6572 744e 6f74 496e  self.assertNotIn
-0000ed10: 2862 225c 725c 6e22 2c20 7570 6461 7465  (b"\r\n", update
-0000ed20: 645f 636f 6e74 656e 7473 290a 0a20 2020  d_contents)..   
-0000ed30: 2064 6566 2074 6573 745f 7072 6573 6572   def test_preser
-0000ed40: 7665 735f 6c69 6e65 5f65 6e64 696e 6773  ves_line_endings
-0000ed50: 5f76 6961 5f73 7464 696e 2873 656c 6629  _via_stdin(self)
-0000ed60: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-0000ed70: 2020 666f 7220 6e6c 2069 6e20 5b22 5c6e    for nl in ["\n
-0000ed80: 222c 2022 5c72 5c6e 225d 3a0a 2020 2020  ", "\r\n"]:.    
-0000ed90: 2020 2020 2020 2020 636f 6e74 656e 7473          contents
-0000eda0: 203d 206e 6c2e 6a6f 696e 285b 2264 6566   = nl.join(["def
-0000edb0: 2066 2820 2029 3a22 2c20 2220 2020 2070   f(  ):", "    p
-0000edc0: 6173 7322 5d29 0a20 2020 2020 2020 2020  ass"]).         
-0000edd0: 2020 2072 756e 6e65 7220 3d20 426c 6163     runner = Blac
-0000ede0: 6b52 756e 6e65 7228 290a 2020 2020 2020  kRunner().      
-0000edf0: 2020 2020 2020 7265 7375 6c74 203d 2072        result = r
-0000ee00: 756e 6e65 722e 696e 766f 6b65 280a 2020  unner.invoke(.  
-0000ee10: 2020 2020 2020 2020 2020 2020 2020 6365                ce
-0000ee20: 7263 6973 2e6d 6169 6e2c 205b 222d 222c  rcis.main, ["-",
-0000ee30: 2022 2d2d 6661 7374 225d 2c20 696e 7075   "--fast"], inpu
-0000ee40: 743d 4279 7465 7349 4f28 636f 6e74 656e  t=BytesIO(conten
-0000ee50: 7473 2e65 6e63 6f64 6528 2275 7466 3822  ts.encode("utf8"
-0000ee60: 2929 0a20 2020 2020 2020 2020 2020 2029  )).            )
-0000ee70: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0000ee80: 662e 6173 7365 7274 4571 7561 6c28 7265  f.assertEqual(re
-0000ee90: 7375 6c74 2e65 7869 745f 636f 6465 2c20  sult.exit_code, 
-0000eea0: 3029 0a20 2020 2020 2020 2020 2020 206f  0).            o
-0000eeb0: 7574 7075 7420 3d20 7265 7375 6c74 2e73  utput = result.s
-0000eec0: 7464 6f75 745f 6279 7465 730a 2020 2020  tdout_bytes.    
-0000eed0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-0000eee0: 6572 7449 6e28 6e6c 2e65 6e63 6f64 6528  ertIn(nl.encode(
-0000eef0: 2275 7466 3822 292c 206f 7574 7075 7429  "utf8"), output)
-0000ef00: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000ef10: 6e6c 203d 3d20 225c 6e22 3a0a 2020 2020  nl == "\n":.    
-0000ef20: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000ef30: 2e61 7373 6572 744e 6f74 496e 2862 225c  .assertNotIn(b"\
-0000ef40: 725c 6e22 2c20 6f75 7470 7574 290a 0a20  r\n", output).. 
-0000ef50: 2020 2064 6566 2074 6573 745f 6e6f 726d     def test_norm
-0000ef60: 616c 697a 655f 6c69 6e65 5f65 6e64 696e  alize_line_endin
-0000ef70: 6773 2873 656c 6629 202d 3e20 4e6f 6e65  gs(self) -> None
-0000ef80: 3a0a 2020 2020 2020 2020 7769 7468 2054  :.        with T
-0000ef90: 656d 706f 7261 7279 4469 7265 6374 6f72  emporaryDirector
-0000efa0: 7928 2920 6173 2077 6f72 6b73 7061 6365  y() as workspace
-0000efb0: 3a0a 2020 2020 2020 2020 2020 2020 7465  :.            te
-0000efc0: 7374 5f66 696c 6520 3d20 5061 7468 2877  st_file = Path(w
-0000efd0: 6f72 6b73 7061 6365 2920 2f20 2274 6573  orkspace) / "tes
-0000efe0: 742e 7079 220a 2020 2020 2020 2020 2020  t.py".          
-0000eff0: 2020 666f 7220 6461 7461 2c20 6578 7065    for data, expe
-0000f000: 6374 6564 2069 6e20 280a 2020 2020 2020  cted in (.      
-0000f010: 2020 2020 2020 2020 2020 2862 2263 5c72            (b"c\r
-0000f020: 5c6e 635c 6e20 222c 2062 2263 5c72 5c6e  \nc\n ", b"c\r\n
-0000f030: 635c 725c 6e22 292c 0a20 2020 2020 2020  c\r\n"),.       
-0000f040: 2020 2020 2020 2020 2028 6222 6c5c 6e6c           (b"l\nl
-0000f050: 5c72 5c6e 2022 2c20 6222 6c5c 6e6c 5c6e  \r\n ", b"l\nl\n
-0000f060: 2229 2c0a 2020 2020 2020 2020 2020 2020  "),.            
-0000f070: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0000f080: 2020 2074 6573 745f 6669 6c65 2e77 7269     test_file.wri
-0000f090: 7465 5f62 7974 6573 2864 6174 6129 0a20  te_bytes(data). 
-0000f0a0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0000f0b0: 6628 7465 7374 5f66 696c 652c 2077 7269  f(test_file, wri
-0000f0c0: 7465 5f62 6163 6b3d 6365 7263 6973 2e57  te_back=cercis.W
-0000f0d0: 7269 7465 4261 636b 2e59 4553 290a 2020  riteBack.YES).  
-0000f0e0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0000f0f0: 6c66 2e61 7373 6572 7445 7175 616c 2874  lf.assertEqual(t
-0000f100: 6573 745f 6669 6c65 2e72 6561 645f 6279  est_file.read_by
-0000f110: 7465 7328 292c 2065 7870 6563 7465 6429  tes(), expected)
-0000f120: 0a0a 2020 2020 6465 6620 7465 7374 5f61  ..    def test_a
-0000f130: 7373 6572 745f 6571 7569 7661 6c65 6e74  ssert_equivalent
-0000f140: 5f64 6966 6665 7265 6e74 5f61 7374 7328  _different_asts(
-0000f150: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
-0000f160: 2020 2020 2020 2077 6974 6820 7365 6c66         with self
-0000f170: 2e61 7373 6572 7452 6169 7365 7328 4173  .assertRaises(As
-0000f180: 7365 7274 696f 6e45 7272 6f72 293a 0a20  sertionError):. 
-0000f190: 2020 2020 2020 2020 2020 2063 6572 6369             cerci
-0000f1a0: 732e 6173 7365 7274 5f65 7175 6976 616c  s.assert_equival
-0000f1b0: 656e 7428 227b 7d22 2c20 224e 6f6e 6522  ent("{}", "None"
-0000f1c0: 290a 0a20 2020 2064 6566 2074 6573 745f  )..    def test_
-0000f1d0: 7368 6868 5f63 6c69 636b 2873 656c 6629  shhh_click(self)
-0000f1e0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-0000f1f0: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
-0000f200: 2020 2066 726f 6d20 636c 6963 6b20 696d     from click im
-0000f210: 706f 7274 205f 756e 6963 6f64 6566 756e  port _unicodefun
-0000f220: 2020 2320 7479 7065 3a20 6967 6e6f 7265    # type: ignore
-0000f230: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
-0000f240: 496d 706f 7274 4572 726f 723a 0a20 2020  ImportError:.   
-0000f250: 2020 2020 2020 2020 2073 656c 662e 736b           self.sk
-0000f260: 6970 5465 7374 2822 496e 636f 6d70 6174  ipTest("Incompat
-0000f270: 6962 6c65 2043 6c69 636b 2076 6572 7369  ible Click versi
-0000f280: 6f6e 2229 0a0a 2020 2020 2020 2020 6966  on")..        if
-0000f290: 206e 6f74 2068 6173 6174 7472 285f 756e   not hasattr(_un
-0000f2a0: 6963 6f64 6566 756e 2c20 225f 7665 7269  icodefun, "_veri
-0000f2b0: 6679 5f70 7974 686f 6e5f 656e 7622 293a  fy_python_env"):
-0000f2c0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0000f2d0: 662e 736b 6970 5465 7374 2822 496e 636f  f.skipTest("Inco
-0000f2e0: 6d70 6174 6962 6c65 2043 6c69 636b 2076  mpatible Click v
-0000f2f0: 6572 7369 6f6e 2229 0a0a 2020 2020 2020  ersion")..      
-0000f300: 2020 2320 4669 7273 742c 206c 6574 2773    # First, let's
-0000f310: 2073 6565 2069 6620 436c 6963 6b20 6973   see if Click is
-0000f320: 2063 7261 7368 696e 6720 7769 7468 2061   crashing with a
-0000f330: 2070 7265 6665 7272 6564 2041 5343 4949   preferred ASCII
-0000f340: 2063 6861 7273 6574 2e0a 2020 2020 2020   charset..      
-0000f350: 2020 7769 7468 2070 6174 6368 2822 6c6f    with patch("lo
-0000f360: 6361 6c65 2e67 6574 7072 6566 6572 7265  cale.getpreferre
-0000f370: 6465 6e63 6f64 696e 6722 2920 6173 2067  dencoding") as g
-0000f380: 7065 3a0a 2020 2020 2020 2020 2020 2020  pe:.            
-0000f390: 6770 652e 7265 7475 726e 5f76 616c 7565  gpe.return_value
-0000f3a0: 203d 2022 4153 4349 4922 0a20 2020 2020   = "ASCII".     
-0000f3b0: 2020 2020 2020 2077 6974 6820 7365 6c66         with self
-0000f3c0: 2e61 7373 6572 7452 6169 7365 7328 5275  .assertRaises(Ru
-0000f3d0: 6e74 696d 6545 7272 6f72 293a 0a20 2020  ntimeError):.   
-0000f3e0: 2020 2020 2020 2020 2020 2020 205f 756e               _un
-0000f3f0: 6963 6f64 6566 756e 2e5f 7665 7269 6679  icodefun._verify
-0000f400: 5f70 7974 686f 6e5f 656e 7628 290a 2020  _python_env().  
-0000f410: 2020 2020 2020 2320 4e6f 772c 206c 6574        # Now, let
-0000f420: 2773 2073 696c 656e 6365 2043 6c69 636b  's silence Click
-0000f430: 2e2e 2e0a 2020 2020 2020 2020 6365 7263  ....        cerc
-0000f440: 6973 2e70 6174 6368 5f63 6c69 636b 2829  is.patch_click()
-0000f450: 0a20 2020 2020 2020 2023 202e 2e2e 616e  .        # ...an
-0000f460: 6420 636f 6e66 6972 6d20 6974 2773 2073  d confirm it's s
-0000f470: 696c 656e 742e 0a20 2020 2020 2020 2077  ilent..        w
-0000f480: 6974 6820 7061 7463 6828 226c 6f63 616c  ith patch("local
-0000f490: 652e 6765 7470 7265 6665 7272 6564 656e  e.getpreferreden
-0000f4a0: 636f 6469 6e67 2229 2061 7320 6770 653a  coding") as gpe:
-0000f4b0: 0a20 2020 2020 2020 2020 2020 2067 7065  .            gpe
-0000f4c0: 2e72 6574 7572 6e5f 7661 6c75 6520 3d20  .return_value = 
-0000f4d0: 2241 5343 4949 220a 2020 2020 2020 2020  "ASCII".        
-0000f4e0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-0000f4f0: 2020 2020 2020 2020 205f 756e 6963 6f64           _unicod
-0000f500: 6566 756e 2e5f 7665 7269 6679 5f70 7974  efun._verify_pyt
-0000f510: 686f 6e5f 656e 7628 290a 2020 2020 2020  hon_env().      
-0000f520: 2020 2020 2020 6578 6365 7074 2052 756e        except Run
-0000f530: 7469 6d65 4572 726f 7220 6173 2072 653a  timeError as re:
-0000f540: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000f550: 2073 656c 662e 6661 696c 2866 2260 7061   self.fail(f"`pa
-0000f560: 7463 685f 636c 6963 6b28 2960 2066 6169  tch_click()` fai
-0000f570: 6c65 642c 2065 7863 6570 7469 6f6e 2073  led, exception s
-0000f580: 7469 6c6c 2072 6169 7365 643a 207b 7265  till raised: {re
-0000f590: 7d22 290a 0a20 2020 2064 6566 2074 6573  }")..    def tes
-0000f5a0: 745f 726f 6f74 5f6c 6f67 6765 725f 6e6f  t_root_logger_no
-0000f5b0: 745f 7573 6564 5f64 6972 6563 746c 7928  t_used_directly(
-0000f5c0: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
-0000f5d0: 2020 2020 2020 2064 6566 2066 6169 6c28         def fail(
-0000f5e0: 2a61 7267 733a 2041 6e79 2c20 2a2a 6b77  *args: Any, **kw
-0000f5f0: 6172 6773 3a20 416e 7929 202d 3e20 4e6f  args: Any) -> No
-0000f600: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-0000f610: 7365 6c66 2e66 6169 6c28 2252 6563 6f72  self.fail("Recor
-0000f620: 6420 6372 6561 7465 6420 7769 7468 2072  d created with r
-0000f630: 6f6f 7420 6c6f 6767 6572 2229 0a0a 2020  oot logger")..  
-0000f640: 2020 2020 2020 7769 7468 2070 6174 6368        with patch
-0000f650: 2e6d 756c 7469 706c 6528 0a20 2020 2020  .multiple(.     
-0000f660: 2020 2020 2020 206c 6f67 6769 6e67 2e72         logging.r
-0000f670: 6f6f 742c 0a20 2020 2020 2020 2020 2020  oot,.           
-0000f680: 2064 6562 7567 3d66 6169 6c2c 0a20 2020   debug=fail,.   
-0000f690: 2020 2020 2020 2020 2069 6e66 6f3d 6661           info=fa
-0000f6a0: 696c 2c0a 2020 2020 2020 2020 2020 2020  il,.            
-0000f6b0: 7761 726e 696e 673d 6661 696c 2c0a 2020  warning=fail,.  
-0000f6c0: 2020 2020 2020 2020 2020 6572 726f 723d            error=
-0000f6d0: 6661 696c 2c0a 2020 2020 2020 2020 2020  fail,.          
-0000f6e0: 2020 6372 6974 6963 616c 3d66 6169 6c2c    critical=fail,
-0000f6f0: 0a20 2020 2020 2020 2020 2020 206c 6f67  .            log
-0000f700: 3d66 6169 6c2c 0a20 2020 2020 2020 2029  =fail,.        )
-0000f710: 3a0a 2020 2020 2020 2020 2020 2020 6666  :.            ff
-0000f720: 2854 4849 535f 4449 5220 2f20 2275 7469  (THIS_DIR / "uti
-0000f730: 6c2e 7079 2229 0a0a 2020 2020 6465 6620  l.py")..    def 
-0000f740: 7465 7374 5f69 6e76 616c 6964 5f63 6f6e  test_invalid_con
-0000f750: 6669 675f 7265 7475 726e 5f63 6f64 6528  fig_return_code(
-0000f760: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
-0000f770: 2020 2020 2020 2074 6d70 5f66 696c 6520         tmp_file 
-0000f780: 3d20 5061 7468 2863 6572 6369 732e 6475  = Path(cercis.du
-0000f790: 6d70 5f74 6f5f 6669 6c65 2829 290a 2020  mp_to_file()).  
-0000f7a0: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-0000f7b0: 2020 2020 2020 2074 6d70 5f63 6f6e 6669         tmp_confi
-0000f7c0: 6720 3d20 5061 7468 2863 6572 6369 732e  g = Path(cercis.
-0000f7d0: 6475 6d70 5f74 6f5f 6669 6c65 2829 290a  dump_to_file()).
-0000f7e0: 2020 2020 2020 2020 2020 2020 746d 705f              tmp_
-0000f7f0: 636f 6e66 6967 2e75 6e6c 696e 6b28 290a  config.unlink().
-0000f800: 2020 2020 2020 2020 2020 2020 6172 6773              args
-0000f810: 203d 205b 222d 2d63 6f6e 6669 6722 2c20   = ["--config", 
-0000f820: 7374 7228 746d 705f 636f 6e66 6967 292c  str(tmp_config),
-0000f830: 2073 7472 2874 6d70 5f66 696c 6529 5d0a   str(tmp_file)].
-0000f840: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000f850: 2e69 6e76 6f6b 6542 6c61 636b 2861 7267  .invokeBlack(arg
-0000f860: 732c 2065 7869 745f 636f 6465 3d32 2c20  s, exit_code=2, 
-0000f870: 6967 6e6f 7265 5f63 6f6e 6669 673d 4661  ignore_config=Fa
-0000f880: 6c73 6529 0a20 2020 2020 2020 2066 696e  lse).        fin
-0000f890: 616c 6c79 3a0a 2020 2020 2020 2020 2020  ally:.          
-0000f8a0: 2020 746d 705f 6669 6c65 2e75 6e6c 696e    tmp_file.unlin
-0000f8b0: 6b28 290a 0a20 2020 2064 6566 2074 6573  k()..    def tes
-0000f8c0: 745f 7061 7273 655f 7079 7072 6f6a 6563  t_parse_pyprojec
-0000f8d0: 745f 746f 6d6c 2873 656c 6629 202d 3e20  t_toml(self) -> 
-0000f8e0: 4e6f 6e65 3a0a 2020 2020 2020 2020 7465  None:.        te
-0000f8f0: 7374 5f74 6f6d 6c5f 6669 6c65 203d 2054  st_toml_file = T
-0000f900: 4849 535f 4449 5220 2f20 2274 6573 742e  HIS_DIR / "test.
-0000f910: 746f 6d6c 220a 2020 2020 2020 2020 636f  toml".        co
-0000f920: 6e66 6967 203d 2063 6572 6369 732e 7061  nfig = cercis.pa
-0000f930: 7273 655f 7079 7072 6f6a 6563 745f 746f  rse_pyproject_to
-0000f940: 6d6c 2873 7472 2874 6573 745f 746f 6d6c  ml(str(test_toml
-0000f950: 5f66 696c 6529 290a 2020 2020 2020 2020  _file)).        
-0000f960: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-0000f970: 2863 6f6e 6669 675b 2276 6572 626f 7365  (config["verbose
-0000f980: 225d 2c20 3129 0a20 2020 2020 2020 2073  "], 1).        s
-0000f990: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-0000f9a0: 636f 6e66 6967 5b22 6368 6563 6b22 5d2c  config["check"],
-0000f9b0: 2022 6e6f 2229 0a20 2020 2020 2020 2073   "no").        s
-0000f9c0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-0000f9d0: 636f 6e66 6967 5b22 6469 6666 225d 2c20  config["diff"], 
-0000f9e0: 2279 2229 0a20 2020 2020 2020 2073 656c  "y").        sel
-0000f9f0: 662e 6173 7365 7274 4571 7561 6c28 636f  f.assertEqual(co
-0000fa00: 6e66 6967 5b22 636f 6c6f 7222 5d2c 2054  nfig["color"], T
-0000fa10: 7275 6529 0a20 2020 2020 2020 2073 656c  rue).        sel
-0000fa20: 662e 6173 7365 7274 4571 7561 6c28 636f  f.assertEqual(co
-0000fa30: 6e66 6967 5b22 6c69 6e65 5f6c 656e 6774  nfig["line_lengt
-0000fa40: 6822 5d2c 2037 3929 0a20 2020 2020 2020  h"], 79).       
-0000fa50: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-0000fa60: 6c28 636f 6e66 6967 5b22 7461 7267 6574  l(config["target
-0000fa70: 5f76 6572 7369 6f6e 225d 2c20 5b22 7079  _version"], ["py
-0000fa80: 3336 222c 2022 7079 3337 222c 2022 7079  36", "py37", "py
-0000fa90: 3338 225d 290a 2020 2020 2020 2020 7365  38"]).        se
-0000faa0: 6c66 2e61 7373 6572 7445 7175 616c 2863  lf.assertEqual(c
-0000fab0: 6f6e 6669 675b 2270 7974 686f 6e5f 6365  onfig["python_ce
-0000fac0: 6c6c 5f6d 6167 6963 7322 5d2c 205b 2263  ll_magics"], ["c
-0000fad0: 7573 746f 6d31 222c 2022 6375 7374 6f6d  ustom1", "custom
-0000fae0: 3222 5d29 0a20 2020 2020 2020 2073 656c  2"]).        sel
-0000faf0: 662e 6173 7365 7274 4571 7561 6c28 636f  f.assertEqual(co
-0000fb00: 6e66 6967 5b22 6578 636c 7564 6522 5d2c  nfig["exclude"],
-0000fb10: 2072 225c 2e70 7969 3f24 2229 0a20 2020   r"\.pyi?$").   
-0000fb20: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-0000fb30: 4571 7561 6c28 636f 6e66 6967 5b22 696e  Equal(config["in
-0000fb40: 636c 7564 6522 5d2c 2072 225c 2e70 793f  clude"], r"\.py?
-0000fb50: 2422 290a 0a20 2020 2064 6566 2074 6573  $")..    def tes
-0000fb60: 745f 7061 7273 655f 7079 7072 6f6a 6563  t_parse_pyprojec
-0000fb70: 745f 746f 6d6c 5f70 726f 6a65 6374 5f6d  t_toml_project_m
-0000fb80: 6574 6164 6174 6128 7365 6c66 2920 2d3e  etadata(self) ->
-0000fb90: 204e 6f6e 653a 0a20 2020 2020 2020 2066   None:.        f
-0000fba0: 6f72 2074 6573 745f 746f 6d6c 2c20 6578  or test_toml, ex
-0000fbb0: 7065 6374 6564 2069 6e20 5b0a 2020 2020  pected in [.    
-0000fbc0: 2020 2020 2020 2020 2822 6f6e 6c79 5f62          ("only_b
-0000fbd0: 6c61 636b 5f70 7970 726f 6a65 6374 2e74  lack_pyproject.t
-0000fbe0: 6f6d 6c22 2c20 5b22 7079 3331 3022 5d29  oml", ["py310"])
-0000fbf0: 2c0a 2020 2020 2020 2020 2020 2020 2822  ,.            ("
-0000fc00: 6f6e 6c79 5f6d 6574 6164 6174 615f 7079  only_metadata_py
-0000fc10: 7072 6f6a 6563 742e 746f 6d6c 222c 205b  project.toml", [
-0000fc20: 2270 7933 3722 2c20 2270 7933 3822 2c20  "py37", "py38", 
-0000fc30: 2270 7933 3922 2c20 2270 7933 3130 225d  "py39", "py310"]
-0000fc40: 292c 0a20 2020 2020 2020 2020 2020 2028  ),.            (
-0000fc50: 226e 6569 7468 6572 5f70 7970 726f 6a65  "neither_pyproje
-0000fc60: 6374 2e74 6f6d 6c22 2c20 4e6f 6e65 292c  ct.toml", None),
-0000fc70: 0a20 2020 2020 2020 2020 2020 2028 2262  .            ("b
-0000fc80: 6f74 685f 7079 7072 6f6a 6563 742e 746f  oth_pyproject.to
-0000fc90: 6d6c 222c 205b 2270 7933 3130 225d 292c  ml", ["py310"]),
-0000fca0: 0a20 2020 2020 2020 205d 3a0a 2020 2020  .        ]:.    
-0000fcb0: 2020 2020 2020 2020 7465 7374 5f74 6f6d          test_tom
-0000fcc0: 6c5f 6669 6c65 203d 2054 4849 535f 4449  l_file = THIS_DI
-0000fcd0: 5220 2f20 2264 6174 6122 202f 2022 7072  R / "data" / "pr
-0000fce0: 6f6a 6563 745f 6d65 7461 6461 7461 2220  oject_metadata" 
-0000fcf0: 2f20 7465 7374 5f74 6f6d 6c0a 2020 2020  / test_toml.    
-0000fd00: 2020 2020 2020 2020 636f 6e66 6967 203d          config =
-0000fd10: 2063 6572 6369 732e 7061 7273 655f 7079   cercis.parse_py
-0000fd20: 7072 6f6a 6563 745f 746f 6d6c 2873 7472  project_toml(str
-0000fd30: 2874 6573 745f 746f 6d6c 5f66 696c 6529  (test_toml_file)
-0000fd40: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-0000fd50: 6c66 2e61 7373 6572 7445 7175 616c 2863  lf.assertEqual(c
-0000fd60: 6f6e 6669 672e 6765 7428 2274 6172 6765  onfig.get("targe
-0000fd70: 745f 7665 7273 696f 6e22 292c 2065 7870  t_version"), exp
-0000fd80: 6563 7465 6429 0a0a 2020 2020 6465 6620  ected)..    def 
-0000fd90: 7465 7374 5f69 6e66 6572 5f74 6172 6765  test_infer_targe
-0000fda0: 745f 7665 7273 696f 6e28 7365 6c66 2920  t_version(self) 
-0000fdb0: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
-0000fdc0: 2066 6f72 2076 6572 7369 6f6e 2c20 6578   for version, ex
-0000fdd0: 7065 6374 6564 2069 6e20 5b0a 2020 2020  pected in [.    
-0000fde0: 2020 2020 2020 2020 2822 332e 3622 2c20          ("3.6", 
-0000fdf0: 5b54 6172 6765 7456 6572 7369 6f6e 2e50  [TargetVersion.P
-0000fe00: 5933 365d 292c 0a20 2020 2020 2020 2020  Y36]),.         
-0000fe10: 2020 2028 2233 2e31 312e 3072 6331 222c     ("3.11.0rc1",
-0000fe20: 205b 5461 7267 6574 5665 7273 696f 6e2e   [TargetVersion.
-0000fe30: 5059 3331 315d 292c 0a20 2020 2020 2020  PY311]),.       
-0000fe40: 2020 2020 2028 223e 3d33 2e31 3022 2c20       (">=3.10", 
-0000fe50: 5b54 6172 6765 7456 6572 7369 6f6e 2e50  [TargetVersion.P
-0000fe60: 5933 3130 2c20 5461 7267 6574 5665 7273  Y310, TargetVers
-0000fe70: 696f 6e2e 5059 3331 315d 292c 0a20 2020  ion.PY311]),.   
-0000fe80: 2020 2020 2020 2020 2028 223e 3d33 2e31           (">=3.1
-0000fe90: 302e 3622 2c20 5b54 6172 6765 7456 6572  0.6", [TargetVer
-0000fea0: 7369 6f6e 2e50 5933 3130 2c20 5461 7267  sion.PY310, Targ
-0000feb0: 6574 5665 7273 696f 6e2e 5059 3331 315d  etVersion.PY311]
-0000fec0: 292c 0a20 2020 2020 2020 2020 2020 2028  ),.            (
-0000fed0: 223c 332e 3622 2c20 5b54 6172 6765 7456  "<3.6", [TargetV
-0000fee0: 6572 7369 6f6e 2e50 5933 332c 2054 6172  ersion.PY33, Tar
-0000fef0: 6765 7456 6572 7369 6f6e 2e50 5933 342c  getVersion.PY34,
-0000ff00: 2054 6172 6765 7456 6572 7369 6f6e 2e50   TargetVersion.P
-0000ff10: 5933 355d 292c 0a20 2020 2020 2020 2020  Y35]),.         
-0000ff20: 2020 2028 223e 332e 372c 3c33 2e31 3022     (">3.7,<3.10"
-0000ff30: 2c20 5b54 6172 6765 7456 6572 7369 6f6e  , [TargetVersion
-0000ff40: 2e50 5933 382c 2054 6172 6765 7456 6572  .PY38, TargetVer
-0000ff50: 7369 6f6e 2e50 5933 395d 292c 0a20 2020  sion.PY39]),.   
-0000ff60: 2020 2020 2020 2020 2028 223e 332e 372c           (">3.7,
-0000ff70: 213d 332e 382c 213d 332e 3922 2c20 5b54  !=3.8,!=3.9", [T
-0000ff80: 6172 6765 7456 6572 7369 6f6e 2e50 5933  argetVersion.PY3
-0000ff90: 3130 2c20 5461 7267 6574 5665 7273 696f  10, TargetVersio
-0000ffa0: 6e2e 5059 3331 315d 292c 0a20 2020 2020  n.PY311]),.     
-0000ffb0: 2020 2020 2020 2028 0a20 2020 2020 2020         (.       
-0000ffc0: 2020 2020 2020 2020 2022 3e20 332e 392e           "> 3.9.
-0000ffd0: 342c 2021 3d20 332e 3130 2e33 222c 0a20  4, != 3.10.3",. 
-0000ffe0: 2020 2020 2020 2020 2020 2020 2020 205b                 [
-0000fff0: 5461 7267 6574 5665 7273 696f 6e2e 5059  TargetVersion.PY
-00010000: 3339 2c20 5461 7267 6574 5665 7273 696f  39, TargetVersio
-00010010: 6e2e 5059 3331 302c 2054 6172 6765 7456  n.PY310, TargetV
-00010020: 6572 7369 6f6e 2e50 5933 3131 5d2c 0a20  ersion.PY311],. 
-00010030: 2020 2020 2020 2020 2020 2029 2c0a 2020             ),.  
-00010040: 2020 2020 2020 2020 2020 280a 2020 2020            (.    
-00010050: 2020 2020 2020 2020 2020 2020 2221 3d33              "!=3
-00010060: 2e33 2c21 3d33 2e34 222c 0a20 2020 2020  .3,!=3.4",.     
-00010070: 2020 2020 2020 2020 2020 205b 0a20 2020             [.   
-00010080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010090: 2054 6172 6765 7456 6572 7369 6f6e 2e50   TargetVersion.P
-000100a0: 5933 352c 0a20 2020 2020 2020 2020 2020  Y35,.           
-000100b0: 2020 2020 2020 2020 2054 6172 6765 7456           TargetV
-000100c0: 6572 7369 6f6e 2e50 5933 362c 0a20 2020  ersion.PY36,.   
-000100d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000100e0: 2054 6172 6765 7456 6572 7369 6f6e 2e50   TargetVersion.P
-000100f0: 5933 372c 0a20 2020 2020 2020 2020 2020  Y37,.           
-00010100: 2020 2020 2020 2020 2054 6172 6765 7456           TargetV
-00010110: 6572 7369 6f6e 2e50 5933 382c 0a20 2020  ersion.PY38,.   
-00010120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010130: 2054 6172 6765 7456 6572 7369 6f6e 2e50   TargetVersion.P
-00010140: 5933 392c 0a20 2020 2020 2020 2020 2020  Y39,.           
-00010150: 2020 2020 2020 2020 2054 6172 6765 7456           TargetV
-00010160: 6572 7369 6f6e 2e50 5933 3130 2c0a 2020  ersion.PY310,.  
-00010170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010180: 2020 5461 7267 6574 5665 7273 696f 6e2e    TargetVersion.
-00010190: 5059 3331 312c 0a20 2020 2020 2020 2020  PY311,.         
-000101a0: 2020 2020 2020 205d 2c0a 2020 2020 2020         ],.      
-000101b0: 2020 2020 2020 292c 0a20 2020 2020 2020        ),.       
-000101c0: 2020 2020 2028 0a20 2020 2020 2020 2020       (.         
-000101d0: 2020 2020 2020 2022 3d3d 332e 2a22 2c0a         "==3.*",.
-000101e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000101f0: 5b0a 2020 2020 2020 2020 2020 2020 2020  [.              
-00010200: 2020 2020 2020 5461 7267 6574 5665 7273        TargetVers
-00010210: 696f 6e2e 5059 3333 2c0a 2020 2020 2020  ion.PY33,.      
-00010220: 2020 2020 2020 2020 2020 2020 2020 5461                Ta
-00010230: 7267 6574 5665 7273 696f 6e2e 5059 3334  rgetVersion.PY34
-00010240: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00010250: 2020 2020 2020 5461 7267 6574 5665 7273        TargetVers
-00010260: 696f 6e2e 5059 3335 2c0a 2020 2020 2020  ion.PY35,.      
-00010270: 2020 2020 2020 2020 2020 2020 2020 5461                Ta
-00010280: 7267 6574 5665 7273 696f 6e2e 5059 3336  rgetVersion.PY36
-00010290: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000102a0: 2020 2020 2020 5461 7267 6574 5665 7273        TargetVers
-000102b0: 696f 6e2e 5059 3337 2c0a 2020 2020 2020  ion.PY37,.      
-000102c0: 2020 2020 2020 2020 2020 2020 2020 5461                Ta
-000102d0: 7267 6574 5665 7273 696f 6e2e 5059 3338  rgetVersion.PY38
-000102e0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000102f0: 2020 2020 2020 5461 7267 6574 5665 7273        TargetVers
-00010300: 696f 6e2e 5059 3339 2c0a 2020 2020 2020  ion.PY39,.      
-00010310: 2020 2020 2020 2020 2020 2020 2020 5461                Ta
-00010320: 7267 6574 5665 7273 696f 6e2e 5059 3331  rgetVersion.PY31
-00010330: 302c 0a20 2020 2020 2020 2020 2020 2020  0,.             
-00010340: 2020 2020 2020 2054 6172 6765 7456 6572         TargetVer
-00010350: 7369 6f6e 2e50 5933 3131 2c0a 2020 2020  sion.PY311,.    
-00010360: 2020 2020 2020 2020 2020 2020 5d2c 0a20              ],. 
-00010370: 2020 2020 2020 2020 2020 2029 2c0a 2020             ),.  
-00010380: 2020 2020 2020 2020 2020 2822 3d3d 332e            ("==3.
-00010390: 382e 2a22 2c20 5b54 6172 6765 7456 6572  8.*", [TargetVer
-000103a0: 7369 6f6e 2e50 5933 385d 292c 0a20 2020  sion.PY38]),.   
-000103b0: 2020 2020 2020 2020 2028 4e6f 6e65 2c20           (None, 
-000103c0: 4e6f 6e65 292c 0a20 2020 2020 2020 2020  None),.         
-000103d0: 2020 2028 2222 2c20 4e6f 6e65 292c 0a20     ("", None),. 
-000103e0: 2020 2020 2020 2020 2020 2028 2269 6e76             ("inv
-000103f0: 616c 6964 222c 204e 6f6e 6529 2c0a 2020  alid", None),.  
-00010400: 2020 2020 2020 2020 2020 2822 3d3d 696e            ("==in
-00010410: 7661 6c69 6422 2c20 4e6f 6e65 292c 0a20  valid", None),. 
-00010420: 2020 2020 2020 2020 2020 2028 223e 332e             (">3.
-00010430: 392c 213d 696e 7661 6c69 6422 2c20 4e6f  9,!=invalid", No
-00010440: 6e65 292c 0a20 2020 2020 2020 2020 2020  ne),.           
-00010450: 2028 2233 222c 204e 6f6e 6529 2c0a 2020   ("3", None),.  
-00010460: 2020 2020 2020 2020 2020 2822 332e 3222            ("3.2"
-00010470: 2c20 4e6f 6e65 292c 0a20 2020 2020 2020  , None),.       
-00010480: 2020 2020 2028 2232 2e37 2e31 3822 2c20       ("2.7.18", 
-00010490: 4e6f 6e65 292c 0a20 2020 2020 2020 2020  None),.         
-000104a0: 2020 2028 223d 3d32 2e37 222c 204e 6f6e     ("==2.7", Non
-000104b0: 6529 2c0a 2020 2020 2020 2020 2020 2020  e),.            
-000104c0: 2822 3e33 2e31 302c 3c33 2e31 3122 2c20  (">3.10,<3.11", 
-000104d0: 4e6f 6e65 292c 0a20 2020 2020 2020 205d  None),.        ]
-000104e0: 3a0a 2020 2020 2020 2020 2020 2020 7465  :.            te
-000104f0: 7374 5f74 6f6d 6c20 3d20 7b22 7072 6f6a  st_toml = {"proj
-00010500: 6563 7422 3a20 7b22 7265 7175 6972 6573  ect": {"requires
-00010510: 2d70 7974 686f 6e22 3a20 7665 7273 696f  -python": versio
-00010520: 6e7d 7d0a 2020 2020 2020 2020 2020 2020  n}}.            
-00010530: 7265 7375 6c74 203d 2063 6572 6369 732e  result = cercis.
-00010540: 6669 6c65 732e 696e 6665 725f 7461 7267  files.infer_targ
-00010550: 6574 5f76 6572 7369 6f6e 2874 6573 745f  et_version(test_
-00010560: 746f 6d6c 290a 2020 2020 2020 2020 2020  toml).          
-00010570: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00010580: 616c 2872 6573 756c 742c 2065 7870 6563  al(result, expec
-00010590: 7465 6429 0a0a 2020 2020 6465 6620 7465  ted)..    def te
-000105a0: 7374 5f72 6561 645f 7079 7072 6f6a 6563  st_read_pyprojec
-000105b0: 745f 746f 6d6c 2873 656c 6629 202d 3e20  t_toml(self) -> 
-000105c0: 4e6f 6e65 3a0a 2020 2020 2020 2020 7465  None:.        te
-000105d0: 7374 5f74 6f6d 6c5f 6669 6c65 203d 2054  st_toml_file = T
-000105e0: 4849 535f 4449 5220 2f20 2274 6573 742e  HIS_DIR / "test.
-000105f0: 746f 6d6c 220a 2020 2020 2020 2020 6661  toml".        fa
-00010600: 6b65 5f63 7478 203d 2046 616b 6543 6f6e  ke_ctx = FakeCon
-00010610: 7465 7874 2829 0a20 2020 2020 2020 2063  text().        c
-00010620: 6572 6369 732e 7265 6164 5f70 7970 726f  ercis.read_pypro
-00010630: 6a65 6374 5f74 6f6d 6c28 6661 6b65 5f63  ject_toml(fake_c
-00010640: 7478 2c20 4661 6b65 5061 7261 6d65 7465  tx, FakeParamete
-00010650: 7228 292c 2073 7472 2874 6573 745f 746f  r(), str(test_to
-00010660: 6d6c 5f66 696c 6529 290a 2020 2020 2020  ml_file)).      
-00010670: 2020 636f 6e66 6967 203d 2066 616b 655f    config = fake_
-00010680: 6374 782e 6465 6661 756c 745f 6d61 700a  ctx.default_map.
-00010690: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-000106a0: 6572 7445 7175 616c 2863 6f6e 6669 675b  ertEqual(config[
-000106b0: 2276 6572 626f 7365 225d 2c20 2231 2229  "verbose"], "1")
-000106c0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-000106d0: 7365 7274 4571 7561 6c28 636f 6e66 6967  sertEqual(config
-000106e0: 5b22 6368 6563 6b22 5d2c 2022 6e6f 2229  ["check"], "no")
-000106f0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-00010700: 7365 7274 4571 7561 6c28 636f 6e66 6967  sertEqual(config
-00010710: 5b22 6469 6666 225d 2c20 2279 2229 0a20  ["diff"], "y"). 
-00010720: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00010730: 7274 4571 7561 6c28 636f 6e66 6967 5b22  rtEqual(config["
-00010740: 636f 6c6f 7222 5d2c 2022 5472 7565 2229  color"], "True")
-00010750: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-00010760: 7365 7274 4571 7561 6c28 636f 6e66 6967  sertEqual(config
-00010770: 5b22 6c69 6e65 5f6c 656e 6774 6822 5d2c  ["line_length"],
-00010780: 2022 3739 2229 0a20 2020 2020 2020 2073   "79").        s
-00010790: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-000107a0: 636f 6e66 6967 5b22 7461 7267 6574 5f76  config["target_v
-000107b0: 6572 7369 6f6e 225d 2c20 5b22 7079 3336  ersion"], ["py36
-000107c0: 222c 2022 7079 3337 222c 2022 7079 3338  ", "py37", "py38
-000107d0: 225d 290a 2020 2020 2020 2020 7365 6c66  "]).        self
-000107e0: 2e61 7373 6572 7445 7175 616c 2863 6f6e  .assertEqual(con
-000107f0: 6669 675b 2265 7863 6c75 6465 225d 2c20  fig["exclude"], 
-00010800: 7222 5c2e 7079 693f 2422 290a 2020 2020  r"\.pyi?$").    
-00010810: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00010820: 7175 616c 2863 6f6e 6669 675b 2269 6e63  qual(config["inc
-00010830: 6c75 6465 225d 2c20 7222 5c2e 7079 3f24  lude"], r"\.py?$
-00010840: 2229 0a0a 2020 2020 4070 7974 6573 742e  ")..    @pytest.
-00010850: 6d61 726b 2e69 6e63 6f6d 7061 7469 626c  mark.incompatibl
-00010860: 655f 7769 7468 5f6d 7970 7963 0a20 2020  e_with_mypyc.   
-00010870: 2064 6566 2074 6573 745f 6669 6e64 5f70   def test_find_p
-00010880: 726f 6a65 6374 5f72 6f6f 7428 7365 6c66  roject_root(self
-00010890: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-000108a0: 2020 2077 6974 6820 5465 6d70 6f72 6172     with Temporar
-000108b0: 7944 6972 6563 746f 7279 2829 2061 7320  yDirectory() as 
-000108c0: 776f 726b 7370 6163 653a 0a20 2020 2020  workspace:.     
-000108d0: 2020 2020 2020 2072 6f6f 7420 3d20 5061         root = Pa
-000108e0: 7468 2877 6f72 6b73 7061 6365 290a 2020  th(workspace).  
-000108f0: 2020 2020 2020 2020 2020 7465 7374 5f64            test_d
-00010900: 6972 203d 2072 6f6f 7420 2f20 2274 6573  ir = root / "tes
-00010910: 7422 0a20 2020 2020 2020 2020 2020 2074  t".            t
-00010920: 6573 745f 6469 722e 6d6b 6469 7228 290a  est_dir.mkdir().
-00010930: 0a20 2020 2020 2020 2020 2020 2073 7263  .            src
-00010940: 5f64 6972 203d 2072 6f6f 7420 2f20 2273  _dir = root / "s
-00010950: 7263 220a 2020 2020 2020 2020 2020 2020  rc".            
-00010960: 7372 635f 6469 722e 6d6b 6469 7228 290a  src_dir.mkdir().
-00010970: 0a20 2020 2020 2020 2020 2020 2072 6f6f  .            roo
-00010980: 745f 7079 7072 6f6a 6563 7420 3d20 726f  t_pyproject = ro
-00010990: 6f74 202f 2022 7079 7072 6f6a 6563 742e  ot / "pyproject.
-000109a0: 746f 6d6c 220a 2020 2020 2020 2020 2020  toml".          
-000109b0: 2020 726f 6f74 5f70 7970 726f 6a65 6374    root_pyproject
-000109c0: 2e74 6f75 6368 2829 0a20 2020 2020 2020  .touch().       
-000109d0: 2020 2020 2073 7263 5f70 7970 726f 6a65       src_pyproje
-000109e0: 6374 203d 2073 7263 5f64 6972 202f 2022  ct = src_dir / "
-000109f0: 7079 7072 6f6a 6563 742e 746f 6d6c 220a  pyproject.toml".
-00010a00: 2020 2020 2020 2020 2020 2020 7372 635f              src_
-00010a10: 7079 7072 6f6a 6563 742e 746f 7563 6828  pyproject.touch(
-00010a20: 290a 2020 2020 2020 2020 2020 2020 7372  ).            sr
-00010a30: 635f 7079 7468 6f6e 203d 2073 7263 5f64  c_python = src_d
-00010a40: 6972 202f 2022 666f 6f2e 7079 220a 2020  ir / "foo.py".  
-00010a50: 2020 2020 2020 2020 2020 7372 635f 7079            src_py
-00010a60: 7468 6f6e 2e74 6f75 6368 2829 0a0a 2020  thon.touch()..  
-00010a70: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-00010a80: 7373 6572 7445 7175 616c 280a 2020 2020  ssertEqual(.    
-00010a90: 2020 2020 2020 2020 2020 2020 6365 7263              cerc
-00010aa0: 6973 2e66 696e 645f 7072 6f6a 6563 745f  is.find_project_
-00010ab0: 726f 6f74 2828 7372 635f 6469 722c 2074  root((src_dir, t
-00010ac0: 6573 745f 6469 7229 292c 0a20 2020 2020  est_dir)),.     
-00010ad0: 2020 2020 2020 2020 2020 2028 726f 6f74             (root
-00010ae0: 2e72 6573 6f6c 7665 2829 2c20 2270 7970  .resolve(), "pyp
-00010af0: 726f 6a65 6374 2e74 6f6d 6c22 292c 0a20  roject.toml"),. 
-00010b00: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-00010b10: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
-00010b20: 7365 7274 4571 7561 6c28 0a20 2020 2020  sertEqual(.     
-00010b30: 2020 2020 2020 2020 2020 2063 6572 6369             cerci
-00010b40: 732e 6669 6e64 5f70 726f 6a65 6374 5f72  s.find_project_r
-00010b50: 6f6f 7428 2873 7263 5f64 6972 2c29 292c  oot((src_dir,)),
-00010b60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010b70: 2028 7372 635f 6469 722e 7265 736f 6c76   (src_dir.resolv
-00010b80: 6528 292c 2022 7079 7072 6f6a 6563 742e  e(), "pyproject.
-00010b90: 746f 6d6c 2229 2c0a 2020 2020 2020 2020  toml"),.        
-00010ba0: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-00010bb0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00010bc0: 616c 280a 2020 2020 2020 2020 2020 2020  al(.            
-00010bd0: 2020 2020 6365 7263 6973 2e66 696e 645f      cercis.find_
-00010be0: 7072 6f6a 6563 745f 726f 6f74 2828 7372  project_root((sr
-00010bf0: 635f 7079 7468 6f6e 2c29 292c 0a20 2020  c_python,)),.   
-00010c00: 2020 2020 2020 2020 2020 2020 2028 7372               (sr
-00010c10: 635f 6469 722e 7265 736f 6c76 6528 292c  c_dir.resolve(),
-00010c20: 2022 7079 7072 6f6a 6563 742e 746f 6d6c   "pyproject.toml
-00010c30: 2229 2c0a 2020 2020 2020 2020 2020 2020  "),.            
-00010c40: 290a 0a20 2020 2020 2020 2020 2020 2077  )..            w
-00010c50: 6974 6820 6368 616e 6765 5f64 6972 6563  ith change_direc
-00010c60: 746f 7279 2874 6573 745f 6469 7229 3a0a  tory(test_dir):.
-00010c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010c80: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-00010c90: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00010ca0: 2020 2020 2020 6365 7263 6973 2e66 696e        cercis.fin
-00010cb0: 645f 7072 6f6a 6563 745f 726f 6f74 2828  d_project_root((
-00010cc0: 222d 222c 292c 2073 7464 696e 5f66 696c  "-",), stdin_fil
-00010cd0: 656e 616d 653d 222e 2e2f 7372 632f 612e  ename="../src/a.
-00010ce0: 7079 2229 2c0a 2020 2020 2020 2020 2020  py"),.          
-00010cf0: 2020 2020 2020 2020 2020 2873 7263 5f64            (src_d
-00010d00: 6972 2e72 6573 6f6c 7665 2829 2c20 2270  ir.resolve(), "p
-00010d10: 7970 726f 6a65 6374 2e74 6f6d 6c22 292c  yproject.toml"),
-00010d20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010d30: 2029 0a0a 2020 2020 4070 6174 6368 280a   )..    @patch(.
-00010d40: 2020 2020 2020 2020 2263 6572 6369 732e          "cercis.
-00010d50: 6669 6c65 732e 6669 6e64 5f75 7365 725f  files.find_user_
-00010d60: 7079 7072 6f6a 6563 745f 746f 6d6c 222c  pyproject_toml",
-00010d70: 0a20 2020 2029 0a20 2020 2064 6566 2074  .    ).    def t
-00010d80: 6573 745f 6669 6e64 5f70 7970 726f 6a65  est_find_pyproje
-00010d90: 6374 5f74 6f6d 6c28 7365 6c66 2c20 6669  ct_toml(self, fi
-00010da0: 6e64 5f75 7365 725f 7079 7072 6f6a 6563  nd_user_pyprojec
-00010db0: 745f 746f 6d6c 3a20 4d61 6769 634d 6f63  t_toml: MagicMoc
-00010dc0: 6b29 202d 3e20 4e6f 6e65 3a0a 2020 2020  k) -> None:.    
-00010dd0: 2020 2020 6669 6e64 5f75 7365 725f 7079      find_user_py
-00010de0: 7072 6f6a 6563 745f 746f 6d6c 2e73 6964  project_toml.sid
-00010df0: 655f 6566 6665 6374 203d 2052 756e 7469  e_effect = Runti
-00010e00: 6d65 4572 726f 7228 290a 0a20 2020 2020  meError()..     
-00010e10: 2020 2077 6974 6820 7265 6469 7265 6374     with redirect
-00010e20: 5f73 7464 6572 7228 696f 2e53 7472 696e  _stderr(io.Strin
-00010e30: 6749 4f28 2929 2061 7320 7374 6465 7272  gIO()) as stderr
-00010e40: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00010e50: 7375 6c74 203d 2063 6572 6369 732e 6669  sult = cercis.fi
-00010e60: 6c65 732e 6669 6e64 5f70 7970 726f 6a65  les.find_pyproje
-00010e70: 6374 5f74 6f6d 6c28 0a20 2020 2020 2020  ct_toml(.       
-00010e80: 2020 2020 2020 2020 2070 6174 685f 7365           path_se
-00010e90: 6172 6368 5f73 7461 7274 3d28 7374 7228  arch_start=(str(
-00010ea0: 5061 7468 2e63 7764 2829 2e72 6f6f 7429  Path.cwd().root)
-00010eb0: 2c29 0a20 2020 2020 2020 2020 2020 2029  ,).            )
-00010ec0: 0a0a 2020 2020 2020 2020 6173 7365 7274  ..        assert
-00010ed0: 2072 6573 756c 7420 6973 204e 6f6e 650a   result is None.
-00010ee0: 2020 2020 2020 2020 6572 7220 3d20 7374          err = st
-00010ef0: 6465 7272 2e67 6574 7661 6c75 6528 290a  derr.getvalue().
-00010f00: 2020 2020 2020 2020 6173 7365 7274 2022          assert "
-00010f10: 4967 6e6f 7269 6e67 2075 7365 7220 636f  Ignoring user co
-00010f20: 6e66 6967 7572 6174 696f 6e22 2069 6e20  nfiguration" in 
-00010f30: 6572 720a 0a20 2020 2040 7061 7463 6828  err..    @patch(
-00010f40: 0a20 2020 2020 2020 2022 6365 7263 6973  .        "cercis
-00010f50: 2e66 696c 6573 2e66 696e 645f 7573 6572  .files.find_user
-00010f60: 5f70 7970 726f 6a65 6374 5f74 6f6d 6c22  _pyproject_toml"
-00010f70: 2c0a 2020 2020 2020 2020 6365 7263 6973  ,.        cercis
-00010f80: 2e66 696c 6573 2e66 696e 645f 7573 6572  .files.find_user
-00010f90: 5f70 7970 726f 6a65 6374 5f74 6f6d 6c2e  _pyproject_toml.
-00010fa0: 5f5f 7772 6170 7065 645f 5f2c 0a20 2020  __wrapped__,.   
-00010fb0: 2029 0a20 2020 2064 6566 2074 6573 745f   ).    def test_
-00010fc0: 6669 6e64 5f75 7365 725f 7079 7072 6f6a  find_user_pyproj
-00010fd0: 6563 745f 746f 6d6c 5f6c 696e 7578 2873  ect_toml_linux(s
-00010fe0: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
-00010ff0: 2020 2020 2020 6966 2073 7973 7465 6d28        if system(
-00011000: 2920 3d3d 2022 5769 6e64 6f77 7322 3a0a  ) == "Windows":.
-00011010: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00011020: 726e 0a0a 2020 2020 2020 2020 2320 5465  rn..        # Te
-00011030: 7374 2069 6620 5844 475f 434f 4e46 4947  st if XDG_CONFIG
-00011040: 5f48 4f4d 4520 6973 2063 6865 636b 6564  _HOME is checked
-00011050: 0a20 2020 2020 2020 2077 6974 6820 5465  .        with Te
-00011060: 6d70 6f72 6172 7944 6972 6563 746f 7279  mporaryDirectory
-00011070: 2829 2061 7320 776f 726b 7370 6163 653a  () as workspace:
-00011080: 0a20 2020 2020 2020 2020 2020 2074 6d70  .            tmp
-00011090: 5f75 7365 725f 636f 6e66 6967 203d 2050  _user_config = P
-000110a0: 6174 6828 776f 726b 7370 6163 6529 202f  ath(workspace) /
-000110b0: 2022 6365 7263 6973 220a 2020 2020 2020   "cercis".      
-000110c0: 2020 2020 2020 7769 7468 2070 6174 6368        with patch
-000110d0: 2e64 6963 7428 226f 732e 656e 7669 726f  .dict("os.enviro
-000110e0: 6e22 2c20 7b22 5844 475f 434f 4e46 4947  n", {"XDG_CONFIG
-000110f0: 5f48 4f4d 4522 3a20 776f 726b 7370 6163  _HOME": workspac
-00011100: 657d 293a 0a20 2020 2020 2020 2020 2020  e}):.           
-00011110: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00011120: 4571 7561 6c28 0a20 2020 2020 2020 2020  Equal(.         
-00011130: 2020 2020 2020 2020 2020 2063 6572 6369             cerci
-00011140: 732e 6669 6c65 732e 6669 6e64 5f75 7365  s.files.find_use
-00011150: 725f 7079 7072 6f6a 6563 745f 746f 6d6c  r_pyproject_toml
-00011160: 2829 2c20 746d 705f 7573 6572 5f63 6f6e  (), tmp_user_con
-00011170: 6669 672e 7265 736f 6c76 6528 290a 2020  fig.resolve().  
-00011180: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-00011190: 0a20 2020 2020 2020 2023 2054 6573 7420  .        # Test 
-000111a0: 6661 6c6c 6261 636b 2066 6f72 2058 4447  fallback for XDG
-000111b0: 5f43 4f4e 4649 475f 484f 4d45 0a20 2020  _CONFIG_HOME.   
-000111c0: 2020 2020 2077 6974 6820 7061 7463 682e       with patch.
-000111d0: 6469 6374 2822 6f73 2e65 6e76 6972 6f6e  dict("os.environ
-000111e0: 2229 3a0a 2020 2020 2020 2020 2020 2020  "):.            
-000111f0: 6f73 2e65 6e76 6972 6f6e 2e70 6f70 2822  os.environ.pop("
-00011200: 5844 475f 434f 4e46 4947 5f48 4f4d 4522  XDG_CONFIG_HOME"
-00011210: 2c20 4e6f 6e65 290a 2020 2020 2020 2020  , None).        
-00011220: 2020 2020 6661 6c6c 6261 636b 5f75 7365      fallback_use
-00011230: 725f 636f 6e66 6967 203d 2050 6174 6828  r_config = Path(
-00011240: 227e 2f2e 636f 6e66 6967 2229 2e65 7870  "~/.config").exp
-00011250: 616e 6475 7365 7228 2920 2f20 2263 6572  anduser() / "cer
-00011260: 6369 7322 0a20 2020 2020 2020 2020 2020  cis".           
-00011270: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00011280: 6c28 0a20 2020 2020 2020 2020 2020 2020  l(.             
-00011290: 2020 2063 6572 6369 732e 6669 6c65 732e     cercis.files.
-000112a0: 6669 6e64 5f75 7365 725f 7079 7072 6f6a  find_user_pyproj
-000112b0: 6563 745f 746f 6d6c 2829 2c20 6661 6c6c  ect_toml(), fall
-000112c0: 6261 636b 5f75 7365 725f 636f 6e66 6967  back_user_config
-000112d0: 2e72 6573 6f6c 7665 2829 0a20 2020 2020  .resolve().     
-000112e0: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
-000112f0: 6620 7465 7374 5f66 696e 645f 7573 6572  f test_find_user
-00011300: 5f70 7970 726f 6a65 6374 5f74 6f6d 6c5f  _pyproject_toml_
-00011310: 7769 6e64 6f77 7328 7365 6c66 2920 2d3e  windows(self) ->
-00011320: 204e 6f6e 653a 0a20 2020 2020 2020 2069   None:.        i
-00011330: 6620 7379 7374 656d 2829 2021 3d20 2257  f system() != "W
-00011340: 696e 646f 7773 223a 0a20 2020 2020 2020  indows":.       
-00011350: 2020 2020 2072 6574 7572 6e0a 0a20 2020       return..   
-00011360: 2020 2020 2075 7365 725f 636f 6e66 6967       user_config
-00011370: 5f70 6174 6820 3d20 5061 7468 2e68 6f6d  _path = Path.hom
-00011380: 6528 2920 2f20 222e 6365 7263 6973 220a  e() / ".cercis".
-00011390: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-000113a0: 6572 7445 7175 616c 280a 2020 2020 2020  ertEqual(.      
-000113b0: 2020 2020 2020 6365 7263 6973 2e66 696c        cercis.fil
-000113c0: 6573 2e66 696e 645f 7573 6572 5f70 7970  es.find_user_pyp
-000113d0: 726f 6a65 6374 5f74 6f6d 6c28 292c 2075  roject_toml(), u
-000113e0: 7365 725f 636f 6e66 6967 5f70 6174 682e  ser_config_path.
-000113f0: 7265 736f 6c76 6528 290a 2020 2020 2020  resolve().      
-00011400: 2020 290a 0a20 2020 2064 6566 2074 6573    )..    def tes
-00011410: 745f 6270 6f5f 3333 3636 305f 776f 726b  t_bpo_33660_work
-00011420: 6172 6f75 6e64 2873 656c 6629 202d 3e20  around(self) -> 
-00011430: 4e6f 6e65 3a0a 2020 2020 2020 2020 6966  None:.        if
-00011440: 2073 7973 7465 6d28 2920 3d3d 2022 5769   system() == "Wi
-00011450: 6e64 6f77 7322 3a0a 2020 2020 2020 2020  ndows":.        
-00011460: 2020 2020 7265 7475 726e 0a0a 2020 2020      return..    
-00011470: 2020 2020 2320 6874 7470 733a 2f2f 6275      # https://bu
-00011480: 6773 2e70 7974 686f 6e2e 6f72 672f 6973  gs.python.org/is
-00011490: 7375 6533 3336 3630 0a20 2020 2020 2020  sue33660.       
-000114a0: 2072 6f6f 7420 3d20 5061 7468 2822 2f22   root = Path("/"
-000114b0: 290a 2020 2020 2020 2020 7769 7468 2063  ).        with c
-000114c0: 6861 6e67 655f 6469 7265 6374 6f72 7928  hange_directory(
-000114d0: 726f 6f74 293a 0a20 2020 2020 2020 2020  root):.         
-000114e0: 2020 2070 6174 6820 3d20 5061 7468 2822     path = Path("
-000114f0: 776f 726b 7370 6163 6522 2920 2f20 2270  workspace") / "p
-00011500: 726f 6a65 6374 220a 2020 2020 2020 2020  roject".        
-00011510: 2020 2020 7265 706f 7274 203d 2063 6572      report = cer
-00011520: 6369 732e 5265 706f 7274 2876 6572 626f  cis.Report(verbo
-00011530: 7365 3d54 7275 6529 0a20 2020 2020 2020  se=True).       
-00011540: 2020 2020 206e 6f72 6d61 6c69 7a65 645f       normalized_
-00011550: 7061 7468 203d 2063 6572 6369 732e 6e6f  path = cercis.no
-00011560: 726d 616c 697a 655f 7061 7468 5f6d 6179  rmalize_path_may
-00011570: 6265 5f69 676e 6f72 6528 7061 7468 2c20  be_ignore(path, 
-00011580: 726f 6f74 2c20 7265 706f 7274 290a 2020  root, report).  
-00011590: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-000115a0: 7373 6572 7445 7175 616c 286e 6f72 6d61  ssertEqual(norma
-000115b0: 6c69 7a65 645f 7061 7468 2c20 2277 6f72  lized_path, "wor
-000115c0: 6b73 7061 6365 2f70 726f 6a65 6374 2229  kspace/project")
-000115d0: 0a0a 2020 2020 6465 6620 7465 7374 5f6e  ..    def test_n
-000115e0: 6f72 6d61 6c69 7a65 5f70 6174 685f 6967  ormalize_path_ig
-000115f0: 6e6f 7265 5f77 696e 646f 7773 5f6a 756e  nore_windows_jun
-00011600: 6374 696f 6e73 5f6f 7574 7369 6465 5f6f  ctions_outside_o
-00011610: 665f 726f 6f74 2873 656c 6629 202d 3e20  f_root(self) -> 
-00011620: 4e6f 6e65 3a0a 2020 2020 2020 2020 6966  None:.        if
-00011630: 2073 7973 7465 6d28 2920 213d 2022 5769   system() != "Wi
-00011640: 6e64 6f77 7322 3a0a 2020 2020 2020 2020  ndows":.        
-00011650: 2020 2020 7265 7475 726e 0a0a 2020 2020      return..    
-00011660: 2020 2020 7769 7468 2054 656d 706f 7261      with Tempora
-00011670: 7279 4469 7265 6374 6f72 7928 2920 6173  ryDirectory() as
-00011680: 2077 6f72 6b73 7061 6365 3a0a 2020 2020   workspace:.    
-00011690: 2020 2020 2020 2020 726f 6f74 203d 2050          root = P
-000116a0: 6174 6828 776f 726b 7370 6163 6529 0a20  ath(workspace). 
-000116b0: 2020 2020 2020 2020 2020 206a 756e 6374             junct
-000116c0: 696f 6e5f 6469 7220 3d20 726f 6f74 202f  ion_dir = root /
-000116d0: 2022 6a75 6e63 7469 6f6e 220a 2020 2020   "junction".    
-000116e0: 2020 2020 2020 2020 6a75 6e63 7469 6f6e          junction
-000116f0: 5f74 6172 6765 745f 6f75 7473 6964 655f  _target_outside_
-00011700: 6f66 5f72 6f6f 7420 3d20 726f 6f74 202f  of_root = root /
-00011710: 2022 2e2e 220a 2020 2020 2020 2020 2020   "..".          
-00011720: 2020 6f73 2e73 7973 7465 6d28 6622 6d6b    os.system(f"mk
-00011730: 6c69 6e6b 202f 4a20 7b6a 756e 6374 696f  link /J {junctio
-00011740: 6e5f 6469 727d 207b 6a75 6e63 7469 6f6e  n_dir} {junction
-00011750: 5f74 6172 6765 745f 6f75 7473 6964 655f  _target_outside_
-00011760: 6f66 5f72 6f6f 747d 2229 0a0a 2020 2020  of_root}")..    
-00011770: 2020 2020 2020 2020 7265 706f 7274 203d          report =
-00011780: 2063 6572 6369 732e 5265 706f 7274 2876   cercis.Report(v
-00011790: 6572 626f 7365 3d54 7275 6529 0a20 2020  erbose=True).   
-000117a0: 2020 2020 2020 2020 206e 6f72 6d61 6c69           normali
-000117b0: 7a65 645f 7061 7468 203d 2063 6572 6369  zed_path = cerci
-000117c0: 732e 6e6f 726d 616c 697a 655f 7061 7468  s.normalize_path
-000117d0: 5f6d 6179 6265 5f69 676e 6f72 6528 0a20  _maybe_ignore(. 
-000117e0: 2020 2020 2020 2020 2020 2020 2020 206a                 j
-000117f0: 756e 6374 696f 6e5f 6469 722c 2072 6f6f  unction_dir, roo
-00011800: 742c 2072 6570 6f72 740a 2020 2020 2020  t, report.      
-00011810: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00011820: 2020 2020 2320 4d61 6e75 616c 6c79 2064      # Manually d
-00011830: 656c 6574 6520 666f 7220 5079 7468 6f6e  elete for Python
-00011840: 203c 2033 2e38 0a20 2020 2020 2020 2020   < 3.8.         
-00011850: 2020 206f 732e 7379 7374 656d 2866 2272     os.system(f"r
-00011860: 6d64 6972 207b 6a75 6e63 7469 6f6e 5f64  mdir {junction_d
-00011870: 6972 7d22 290a 0a20 2020 2020 2020 2020  ir}")..         
-00011880: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-00011890: 7561 6c28 6e6f 726d 616c 697a 6564 5f70  ual(normalized_p
-000118a0: 6174 682c 204e 6f6e 6529 0a0a 2020 2020  ath, None)..    
-000118b0: 6465 6620 7465 7374 5f6e 6577 6c69 6e65  def test_newline
-000118c0: 5f63 6f6d 6d65 6e74 5f69 6e74 6572 6163  _comment_interac
-000118d0: 7469 6f6e 2873 656c 6629 202d 3e20 4e6f  tion(self) -> No
-000118e0: 6e65 3a0a 2020 2020 2020 2020 736f 7572  ne:.        sour
-000118f0: 6365 203d 2022 636c 6173 7320 413a 5c5c  ce = "class A:\\
-00011900: 5c72 5c6e 2320 7479 7065 3a20 6967 6e6f  \r\n# type: igno
-00011910: 7265 5c6e 2070 6173 735c 6e22 0a20 2020  re\n pass\n".   
-00011920: 2020 2020 206f 7574 7075 7420 3d20 6365       output = ce
-00011930: 7263 6973 2e66 6f72 6d61 745f 7374 7228  rcis.format_str(
-00011940: 736f 7572 6365 2c20 6d6f 6465 3d44 4546  source, mode=DEF
-00011950: 4155 4c54 5f4d 4f44 4529 0a20 2020 2020  AULT_MODE).     
-00011960: 2020 2063 6572 6369 732e 6173 7365 7274     cercis.assert
-00011970: 5f73 7461 626c 6528 736f 7572 6365 2c20  _stable(source, 
-00011980: 6f75 7470 7574 2c20 6d6f 6465 3d44 4546  output, mode=DEF
-00011990: 4155 4c54 5f4d 4f44 4529 0a0a 2020 2020  AULT_MODE)..    
-000119a0: 6465 6620 7465 7374 5f62 706f 5f32 3134  def test_bpo_214
-000119b0: 325f 776f 726b 6172 6f75 6e64 2873 656c  2_workaround(sel
-000119c0: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
-000119d0: 2020 2020 2320 6874 7470 733a 2f2f 6275      # https://bu
-000119e0: 6773 2e70 7974 686f 6e2e 6f72 672f 6973  gs.python.org/is
-000119f0: 7375 6532 3134 320a 0a20 2020 2020 2020  sue2142..       
-00011a00: 2073 6f75 7263 652c 205f 203d 2072 6561   source, _ = rea
-00011a10: 645f 6461 7461 2822 6d69 7363 656c 6c61  d_data("miscella
-00011a20: 6e65 6f75 7322 2c20 226d 6973 7369 6e67  neous", "missing
-00011a30: 5f66 696e 616c 5f6e 6577 6c69 6e65 2229  _final_newline")
-00011a40: 0a20 2020 2020 2020 2023 2072 6561 645f  .        # read_
-00011a50: 6461 7461 2061 6464 7320 6120 7472 6169  data adds a trai
-00011a60: 6c69 6e67 206e 6577 6c69 6e65 0a20 2020  ling newline.   
-00011a70: 2020 2020 2073 6f75 7263 6520 3d20 736f       source = so
-00011a80: 7572 6365 2e72 7374 7269 7028 290a 2020  urce.rstrip().  
-00011a90: 2020 2020 2020 6578 7065 6374 6564 2c20        expected, 
-00011aa0: 5f20 3d20 7265 6164 5f64 6174 6128 226d  _ = read_data("m
-00011ab0: 6973 6365 6c6c 616e 656f 7573 222c 2022  iscellaneous", "
-00011ac0: 6d69 7373 696e 675f 6669 6e61 6c5f 6e65  missing_final_ne
-00011ad0: 776c 696e 652e 6469 6666 2229 0a20 2020  wline.diff").   
-00011ae0: 2020 2020 2074 6d70 5f66 696c 6520 3d20       tmp_file = 
-00011af0: 5061 7468 2863 6572 6369 732e 6475 6d70  Path(cercis.dump
-00011b00: 5f74 6f5f 6669 6c65 2873 6f75 7263 652c  _to_file(source,
-00011b10: 2065 6e73 7572 655f 6669 6e61 6c5f 6e65   ensure_final_ne
-00011b20: 776c 696e 653d 4661 6c73 6529 290a 2020  wline=False)).  
-00011b30: 2020 2020 2020 6469 6666 5f68 6561 6465        diff_heade
-00011b40: 7220 3d20 7265 2e63 6f6d 7069 6c65 280a  r = re.compile(.
-00011b50: 2020 2020 2020 2020 2020 2020 7266 227b              rf"{
-00011b60: 7265 2e65 7363 6170 6528 7374 7228 746d  re.escape(str(tm
-00011b70: 705f 6669 6c65 2929 7d5c 745c 645c 645c  p_file))}\t\d\d\
-00011b80: 645c 642d 5c64 5c64 2d5c 645c 6420 220a  d\d-\d\d-\d\d ".
-00011b90: 2020 2020 2020 2020 2020 2020 7222 5c64              r"\d
-00011ba0: 5c64 3a5c 645c 643a 5c64 5c64 5c2e 5c64  \d:\d\d:\d\d\.\d
-00011bb0: 5c64 5c64 5c64 5c64 5c64 205c 2b5c 645c  \d\d\d\d\d \+\d\
-00011bc0: 645c 645c 6422 0a20 2020 2020 2020 2029  d\d\d".        )
-00011bd0: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
-00011be0: 2020 2020 2020 2020 2020 7265 7375 6c74            result
-00011bf0: 203d 2042 6c61 636b 5275 6e6e 6572 2829   = BlackRunner()
-00011c00: 2e69 6e76 6f6b 6528 6365 7263 6973 2e6d  .invoke(cercis.m
-00011c10: 6169 6e2c 205b 222d 2d64 6966 6622 2c20  ain, ["--diff", 
-00011c20: 7374 7228 746d 705f 6669 6c65 295d 290a  str(tmp_file)]).
-00011c30: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00011c40: 2e61 7373 6572 7445 7175 616c 2872 6573  .assertEqual(res
-00011c50: 756c 742e 6578 6974 5f63 6f64 652c 2030  ult.exit_code, 0
-00011c60: 290a 2020 2020 2020 2020 6669 6e61 6c6c  ).        finall
-00011c70: 793a 0a20 2020 2020 2020 2020 2020 206f  y:.            o
-00011c80: 732e 756e 6c69 6e6b 2874 6d70 5f66 696c  s.unlink(tmp_fil
-00011c90: 6529 0a20 2020 2020 2020 2061 6374 7561  e).        actua
-00011ca0: 6c20 3d20 7265 7375 6c74 2e6f 7574 7075  l = result.outpu
-00011cb0: 740a 2020 2020 2020 2020 6163 7475 616c  t.        actual
-00011cc0: 203d 2064 6966 665f 6865 6164 6572 2e73   = diff_header.s
-00011cd0: 7562 2844 4554 4552 4d49 4e49 5354 4943  ub(DETERMINISTIC
-00011ce0: 5f48 4541 4445 522c 2061 6374 7561 6c29  _HEADER, actual)
-00011cf0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-00011d00: 7365 7274 4571 7561 6c28 6163 7475 616c  sertEqual(actual
-00011d10: 2c20 6578 7065 6374 6564 290a 0a20 2020  , expected)..   
-00011d20: 2040 7374 6174 6963 6d65 7468 6f64 0a20   @staticmethod. 
-00011d30: 2020 2064 6566 2063 6f6d 7061 7265 5f72     def compare_r
-00011d40: 6573 756c 7473 280a 2020 2020 2020 2020  esults(.        
-00011d50: 2020 2020 7265 7375 6c74 3a20 636c 6963      result: clic
-00011d60: 6b2e 7465 7374 696e 672e 5265 7375 6c74  k.testing.Result
-00011d70: 2c20 6578 7065 6374 6564 5f76 616c 7565  , expected_value
-00011d80: 3a20 7374 722c 2065 7870 6563 7465 645f  : str, expected_
-00011d90: 6578 6974 5f63 6f64 653a 2069 6e74 0a20  exit_code: int. 
-00011da0: 2020 2029 202d 3e20 4e6f 6e65 3a0a 2020     ) -> None:.  
-00011db0: 2020 2020 2020 2222 2248 656c 7065 7220        """Helper 
-00011dc0: 6d65 7468 6f64 2074 6f20 7465 7374 2074  method to test t
-00011dd0: 6865 2076 616c 7565 2061 6e64 2065 7869  he value and exi
-00011de0: 7420 636f 6465 206f 6620 6120 636c 6963  t code of a clic
-00011df0: 6b20 5265 7375 6c74 2e22 2222 0a20 2020  k Result.""".   
-00011e00: 2020 2020 2061 7373 6572 7420 280a 2020       assert (.  
-00011e10: 2020 2020 2020 2020 2020 7265 7375 6c74            result
-00011e20: 2e6f 7574 7075 7420 3d3d 2065 7870 6563  .output == expec
-00011e30: 7465 645f 7661 6c75 650a 2020 2020 2020  ted_value.      
-00011e40: 2020 292c 2022 5468 6520 6f75 7470 7574    ), "The output
-00011e50: 2064 6964 206e 6f74 206d 6174 6368 2074   did not match t
-00011e60: 6865 2065 7870 6563 7465 6420 7661 6c75  he expected valu
-00011e70: 652e 220a 2020 2020 2020 2020 6173 7365  e.".        asse
-00011e80: 7274 2072 6573 756c 742e 6578 6974 5f63  rt result.exit_c
-00011e90: 6f64 6520 3d3d 2065 7870 6563 7465 645f  ode == expected_
-00011ea0: 6578 6974 5f63 6f64 652c 2022 5468 6520  exit_code, "The 
-00011eb0: 6578 6974 2063 6f64 6520 6973 2069 6e63  exit code is inc
-00011ec0: 6f72 7265 6374 2e22 0a0a 2020 2020 6465  orrect."..    de
-00011ed0: 6620 7465 7374 5f63 6f64 655f 6f70 7469  f test_code_opti
-00011ee0: 6f6e 2873 656c 6629 202d 3e20 4e6f 6e65  on(self) -> None
-00011ef0: 3a0a 2020 2020 2020 2020 2222 2254 6573  :.        """Tes
-00011f00: 7420 7468 6520 636f 6465 206f 7074 696f  t the code optio
-00011f10: 6e20 7769 7468 206e 6f20 6368 616e 6765  n with no change
-00011f20: 732e 2222 220a 2020 2020 2020 2020 636f  s.""".        co
-00011f30: 6465 203d 2027 7072 696e 7428 2248 656c  de = 'print("Hel
-00011f40: 6c6f 2077 6f72 6c64 2229 5c6e 270a 2020  lo world")\n'.  
-00011f50: 2020 2020 2020 6172 6773 203d 205b 222d        args = ["-
-00011f60: 2d63 6f64 6522 2c20 636f 6465 5d0a 2020  -code", code].  
-00011f70: 2020 2020 2020 7265 7375 6c74 203d 2043        result = C
-00011f80: 6c69 5275 6e6e 6572 2829 2e69 6e76 6f6b  liRunner().invok
-00011f90: 6528 6365 7263 6973 2e6d 6169 6e2c 2061  e(cercis.main, a
-00011fa0: 7267 7329 0a0a 2020 2020 2020 2020 7365  rgs)..        se
-00011fb0: 6c66 2e63 6f6d 7061 7265 5f72 6573 756c  lf.compare_resul
-00011fc0: 7473 2872 6573 756c 742c 2063 6f64 652c  ts(result, code,
-00011fd0: 2030 290a 0a20 2020 2064 6566 2074 6573   0)..    def tes
-00011fe0: 745f 636f 6465 5f6f 7074 696f 6e5f 6368  t_code_option_ch
-00011ff0: 616e 6765 6428 7365 6c66 2920 2d3e 204e  anged(self) -> N
-00012000: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
-00012010: 5465 7374 2074 6865 2063 6f64 6520 6f70  Test the code op
-00012020: 7469 6f6e 2077 6865 6e20 6368 616e 6765  tion when change
-00012030: 7320 6172 6520 7265 7175 6972 6564 2e22  s are required."
-00012040: 2222 0a20 2020 2020 2020 2063 6f64 6520  "".        code 
-00012050: 3d20 2270 7269 6e74 2827 6865 6c6c 6f20  = "print('hello 
-00012060: 776f 726c 6427 2922 0a20 2020 2020 2020  world')".       
-00012070: 2066 6f72 6d61 7474 6564 203d 2063 6572   formatted = cer
-00012080: 6369 732e 666f 726d 6174 5f73 7472 2863  cis.format_str(c
-00012090: 6f64 652c 206d 6f64 653d 4445 4641 554c  ode, mode=DEFAUL
-000120a0: 545f 4d4f 4445 290a 0a20 2020 2020 2020  T_MODE)..       
-000120b0: 2061 7267 7320 3d20 5b22 2d2d 636f 6465   args = ["--code
-000120c0: 222c 2063 6f64 655d 0a20 2020 2020 2020  ", code].       
-000120d0: 2072 6573 756c 7420 3d20 436c 6952 756e   result = CliRun
-000120e0: 6e65 7228 292e 696e 766f 6b65 2863 6572  ner().invoke(cer
-000120f0: 6369 732e 6d61 696e 2c20 6172 6773 290a  cis.main, args).
-00012100: 0a20 2020 2020 2020 2073 656c 662e 636f  .        self.co
-00012110: 6d70 6172 655f 7265 7375 6c74 7328 7265  mpare_results(re
-00012120: 7375 6c74 2c20 666f 726d 6174 7465 642c  sult, formatted,
-00012130: 2030 290a 0a20 2020 2064 6566 2074 6573   0)..    def tes
-00012140: 745f 636f 6465 5f6f 7074 696f 6e5f 6368  t_code_option_ch
-00012150: 6563 6b28 7365 6c66 2920 2d3e 204e 6f6e  eck(self) -> Non
-00012160: 653a 0a20 2020 2020 2020 2022 2222 5465  e:.        """Te
-00012170: 7374 2074 6865 2063 6f64 6520 6f70 7469  st the code opti
-00012180: 6f6e 2077 6865 6e20 6368 6563 6b20 6973  on when check is
-00012190: 2070 6173 7365 642e 2222 220a 2020 2020   passed.""".    
-000121a0: 2020 2020 6172 6773 203d 205b 222d 2d63      args = ["--c
-000121b0: 6865 636b 222c 2022 2d2d 636f 6465 222c  heck", "--code",
-000121c0: 2027 7072 696e 7428 2248 656c 6c6f 2077   'print("Hello w
-000121d0: 6f72 6c64 2229 5c6e 275d 0a20 2020 2020  orld")\n'].     
-000121e0: 2020 2072 6573 756c 7420 3d20 436c 6952     result = CliR
-000121f0: 756e 6e65 7228 292e 696e 766f 6b65 2863  unner().invoke(c
-00012200: 6572 6369 732e 6d61 696e 2c20 6172 6773  ercis.main, args
-00012210: 290a 2020 2020 2020 2020 7365 6c66 2e63  ).        self.c
-00012220: 6f6d 7061 7265 5f72 6573 756c 7473 2872  ompare_results(r
-00012230: 6573 756c 742c 2022 222c 2030 290a 0a20  esult, "", 0).. 
-00012240: 2020 2064 6566 2074 6573 745f 636f 6465     def test_code
-00012250: 5f6f 7074 696f 6e5f 6368 6563 6b5f 6368  _option_check_ch
-00012260: 616e 6765 6428 7365 6c66 2920 2d3e 204e  anged(self) -> N
-00012270: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
-00012280: 5465 7374 2074 6865 2063 6f64 6520 6f70  Test the code op
-00012290: 7469 6f6e 2077 6865 6e20 6368 616e 6765  tion when change
-000122a0: 7320 6172 6520 7265 7175 6972 6564 2c20  s are required, 
-000122b0: 616e 6420 6368 6563 6b20 6973 2070 6173  and check is pas
-000122c0: 7365 642e 2222 220a 2020 2020 2020 2020  sed.""".        
-000122d0: 6172 6773 203d 205b 222d 2d63 6865 636b  args = ["--check
-000122e0: 222c 2022 2d2d 636f 6465 222c 2022 7072  ", "--code", "pr
-000122f0: 696e 7428 2768 656c 6c6f 2077 6f72 6c64  int('hello world
-00012300: 2729 225d 0a20 2020 2020 2020 2072 6573  ')"].        res
-00012310: 756c 7420 3d20 436c 6952 756e 6e65 7228  ult = CliRunner(
-00012320: 292e 696e 766f 6b65 2863 6572 6369 732e  ).invoke(cercis.
-00012330: 6d61 696e 2c20 6172 6773 290a 2020 2020  main, args).    
-00012340: 2020 2020 7365 6c66 2e63 6f6d 7061 7265      self.compare
-00012350: 5f72 6573 756c 7473 2872 6573 756c 742c  _results(result,
-00012360: 2022 222c 2031 290a 0a20 2020 2064 6566   "", 1)..    def
-00012370: 2074 6573 745f 636f 6465 5f6f 7074 696f   test_code_optio
-00012380: 6e5f 6469 6666 2873 656c 6629 202d 3e20  n_diff(self) -> 
-00012390: 4e6f 6e65 3a0a 2020 2020 2020 2020 2222  None:.        ""
-000123a0: 2254 6573 7420 7468 6520 636f 6465 206f  "Test the code o
-000123b0: 7074 696f 6e20 7768 656e 2064 6966 6620  ption when diff 
-000123c0: 6973 2070 6173 7365 642e 2222 220a 2020  is passed.""".  
-000123d0: 2020 2020 2020 636f 6465 203d 2022 7072        code = "pr
-000123e0: 696e 7428 2768 656c 6c6f 2077 6f72 6c64  int('hello world
-000123f0: 2729 220a 2020 2020 2020 2020 666f 726d  ')".        form
-00012400: 6174 7465 6420 3d20 6365 7263 6973 2e66  atted = cercis.f
-00012410: 6f72 6d61 745f 7374 7228 636f 6465 2c20  ormat_str(code, 
-00012420: 6d6f 6465 3d44 4546 4155 4c54 5f4d 4f44  mode=DEFAULT_MOD
-00012430: 4529 0a20 2020 2020 2020 2072 6573 756c  E).        resul
-00012440: 745f 6469 6666 203d 2064 6966 6628 636f  t_diff = diff(co
-00012450: 6465 2c20 666f 726d 6174 7465 642c 2022  de, formatted, "
-00012460: 5354 4449 4e22 2c20 2253 5444 4f55 5422  STDIN", "STDOUT"
-00012470: 290a 0a20 2020 2020 2020 2061 7267 7320  )..        args 
-00012480: 3d20 5b22 2d2d 6469 6666 222c 2022 2d2d  = ["--diff", "--
-00012490: 636f 6465 222c 2063 6f64 655d 0a20 2020  code", code].   
-000124a0: 2020 2020 2072 6573 756c 7420 3d20 436c       result = Cl
-000124b0: 6952 756e 6e65 7228 292e 696e 766f 6b65  iRunner().invoke
-000124c0: 2863 6572 6369 732e 6d61 696e 2c20 6172  (cercis.main, ar
-000124d0: 6773 290a 0a20 2020 2020 2020 2023 2052  gs)..        # R
-000124e0: 656d 6f76 6520 7469 6d65 2066 726f 6d20  emove time from 
-000124f0: 6469 6666 0a20 2020 2020 2020 206f 7574  diff.        out
-00012500: 7075 7420 3d20 4449 4646 5f54 494d 452e  put = DIFF_TIME.
-00012510: 7375 6228 2222 2c20 7265 7375 6c74 2e6f  sub("", result.o
-00012520: 7574 7075 7429 0a0a 2020 2020 2020 2020  utput)..        
-00012530: 6173 7365 7274 206f 7574 7075 7420 3d3d  assert output ==
-00012540: 2072 6573 756c 745f 6469 6666 2c20 2254   result_diff, "T
-00012550: 6865 206f 7574 7075 7420 6469 6420 6e6f  he output did no
-00012560: 7420 6d61 7463 6820 7468 6520 6578 7065  t match the expe
-00012570: 6374 6564 2076 616c 7565 2e22 0a20 2020  cted value.".   
-00012580: 2020 2020 2061 7373 6572 7420 7265 7375       assert resu
-00012590: 6c74 2e65 7869 745f 636f 6465 203d 3d20  lt.exit_code == 
-000125a0: 302c 2022 5468 6520 6578 6974 2063 6f64  0, "The exit cod
-000125b0: 6520 6973 2069 6e63 6f72 7265 6374 2e22  e is incorrect."
-000125c0: 0a0a 2020 2020 6465 6620 7465 7374 5f63  ..    def test_c
-000125d0: 6f64 655f 6f70 7469 6f6e 5f63 6f6c 6f72  ode_option_color
-000125e0: 5f64 6966 6628 7365 6c66 2920 2d3e 204e  _diff(self) -> N
-000125f0: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
-00012600: 5465 7374 2074 6865 2063 6f64 6520 6f70  Test the code op
-00012610: 7469 6f6e 2077 6865 6e20 636f 6c6f 7220  tion when color 
-00012620: 616e 6420 6469 6666 2061 7265 2070 6173  and diff are pas
-00012630: 7365 642e 2222 220a 2020 2020 2020 2020  sed.""".        
-00012640: 636f 6465 203d 2022 7072 696e 7428 2768  code = "print('h
-00012650: 656c 6c6f 2077 6f72 6c64 2729 220a 2020  ello world')".  
-00012660: 2020 2020 2020 666f 726d 6174 7465 6420        formatted 
-00012670: 3d20 6365 7263 6973 2e66 6f72 6d61 745f  = cercis.format_
-00012680: 7374 7228 636f 6465 2c20 6d6f 6465 3d44  str(code, mode=D
-00012690: 4546 4155 4c54 5f4d 4f44 4529 0a0a 2020  EFAULT_MODE)..  
-000126a0: 2020 2020 2020 7265 7375 6c74 5f64 6966        result_dif
-000126b0: 6620 3d20 6469 6666 2863 6f64 652c 2066  f = diff(code, f
-000126c0: 6f72 6d61 7474 6564 2c20 2253 5444 494e  ormatted, "STDIN
-000126d0: 222c 2022 5354 444f 5554 2229 0a20 2020  ", "STDOUT").   
-000126e0: 2020 2020 2072 6573 756c 745f 6469 6666       result_diff
-000126f0: 203d 2063 6f6c 6f72 5f64 6966 6628 7265   = color_diff(re
-00012700: 7375 6c74 5f64 6966 6629 0a0a 2020 2020  sult_diff)..    
-00012710: 2020 2020 6172 6773 203d 205b 222d 2d64      args = ["--d
-00012720: 6966 6622 2c20 222d 2d63 6f6c 6f72 222c  iff", "--color",
-00012730: 2022 2d2d 636f 6465 222c 2063 6f64 655d   "--code", code]
-00012740: 0a20 2020 2020 2020 2072 6573 756c 7420  .        result 
-00012750: 3d20 436c 6952 756e 6e65 7228 292e 696e  = CliRunner().in
-00012760: 766f 6b65 2863 6572 6369 732e 6d61 696e  voke(cercis.main
-00012770: 2c20 6172 6773 290a 0a20 2020 2020 2020  , args)..       
-00012780: 2023 2052 656d 6f76 6520 7469 6d65 2066   # Remove time f
-00012790: 726f 6d20 6469 6666 0a20 2020 2020 2020  rom diff.       
-000127a0: 206f 7574 7075 7420 3d20 4449 4646 5f54   output = DIFF_T
-000127b0: 494d 452e 7375 6228 2222 2c20 7265 7375  IME.sub("", resu
-000127c0: 6c74 2e6f 7574 7075 7429 0a0a 2020 2020  lt.output)..    
-000127d0: 2020 2020 6173 7365 7274 206f 7574 7075      assert outpu
-000127e0: 7420 3d3d 2072 6573 756c 745f 6469 6666  t == result_diff
-000127f0: 2c20 2254 6865 206f 7574 7075 7420 6469  , "The output di
-00012800: 6420 6e6f 7420 6d61 7463 6820 7468 6520  d not match the 
-00012810: 6578 7065 6374 6564 2076 616c 7565 2e22  expected value."
-00012820: 0a20 2020 2020 2020 2061 7373 6572 7420  .        assert 
-00012830: 7265 7375 6c74 2e65 7869 745f 636f 6465  result.exit_code
-00012840: 203d 3d20 302c 2022 5468 6520 6578 6974   == 0, "The exit
-00012850: 2063 6f64 6520 6973 2069 6e63 6f72 7265   code is incorre
-00012860: 6374 2e22 0a0a 2020 2020 4070 7974 6573  ct."..    @pytes
-00012870: 742e 6d61 726b 2e69 6e63 6f6d 7061 7469  t.mark.incompati
-00012880: 626c 655f 7769 7468 5f6d 7970 7963 0a20  ble_with_mypyc. 
-00012890: 2020 2064 6566 2074 6573 745f 636f 6465     def test_code
-000128a0: 5f6f 7074 696f 6e5f 7361 6665 2873 656c  _option_safe(sel
-000128b0: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
-000128c0: 2020 2020 2222 2254 6573 7420 7468 6174      """Test that
-000128d0: 2074 6865 2063 6f64 6520 6f70 7469 6f6e   the code option
-000128e0: 2074 6872 6f77 7320 616e 2065 7272 6f72   throws an error
-000128f0: 2077 6865 6e20 7468 6520 7361 6e69 7479   when the sanity
-00012900: 2063 6865 636b 7320 6661 696c 2e22 2222   checks fail."""
-00012910: 0a20 2020 2020 2020 2023 2050 6174 6368  .        # Patch
-00012920: 2063 6572 6369 732e 6173 7365 7274 5f65   cercis.assert_e
-00012930: 7175 6976 616c 656e 7420 746f 2065 6e73  quivalent to ens
-00012940: 7572 6520 7468 6520 7361 6e69 7479 2063  ure the sanity c
-00012950: 6865 636b 7320 6661 696c 0a20 2020 2020  hecks fail.     
-00012960: 2020 2077 6974 6820 7061 7463 682e 6f62     with patch.ob
-00012970: 6a65 6374 2863 6572 6369 732c 2022 6173  ject(cercis, "as
-00012980: 7365 7274 5f65 7175 6976 616c 656e 7422  sert_equivalent"
-00012990: 2c20 7369 6465 5f65 6666 6563 743d 4173  , side_effect=As
-000129a0: 7365 7274 696f 6e45 7272 6f72 293a 0a20  sertionError):. 
-000129b0: 2020 2020 2020 2020 2020 2063 6f64 6520             code 
-000129c0: 3d20 2770 7269 6e74 2822 4865 6c6c 6f20  = 'print("Hello 
-000129d0: 776f 726c 6422 2927 0a20 2020 2020 2020  world")'.       
-000129e0: 2020 2020 2065 7272 6f72 5f6d 7367 203d       error_msg =
-000129f0: 2066 227b 636f 6465 7d5c 6e65 7272 6f72   f"{code}\nerror
-00012a00: 3a20 6361 6e6e 6f74 2066 6f72 6d61 7420  : cannot format 
-00012a10: 3c73 7472 696e 673e 3a20 5c6e 220a 0a20  <string>: \n".. 
-00012a20: 2020 2020 2020 2020 2020 2061 7267 7320             args 
-00012a30: 3d20 5b22 2d2d 7361 6665 222c 2022 2d2d  = ["--safe", "--
-00012a40: 636f 6465 222c 2063 6f64 655d 0a20 2020  code", code].   
-00012a50: 2020 2020 2020 2020 2072 6573 756c 7420           result 
-00012a60: 3d20 436c 6952 756e 6e65 7228 292e 696e  = CliRunner().in
-00012a70: 766f 6b65 2863 6572 6369 732e 6d61 696e  voke(cercis.main
-00012a80: 2c20 6172 6773 290a 0a20 2020 2020 2020  , args)..       
-00012a90: 2020 2020 2073 656c 662e 636f 6d70 6172       self.compar
-00012aa0: 655f 7265 7375 6c74 7328 7265 7375 6c74  e_results(result
-00012ab0: 2c20 6572 726f 725f 6d73 672c 2031 3233  , error_msg, 123
-00012ac0: 290a 0a20 2020 2064 6566 2074 6573 745f  )..    def test_
-00012ad0: 636f 6465 5f6f 7074 696f 6e5f 6661 7374  code_option_fast
-00012ae0: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
-00012af0: 2020 2020 2020 2020 2222 2254 6573 7420          """Test 
-00012b00: 7468 6174 2074 6865 2063 6f64 6520 6f70  that the code op
-00012b10: 7469 6f6e 2069 676e 6f72 6573 2065 7272  tion ignores err
-00012b20: 6f72 7320 7768 656e 2074 6865 2073 616e  ors when the san
-00012b30: 6974 7920 6368 6563 6b73 2066 6169 6c2e  ity checks fail.
-00012b40: 2222 220a 2020 2020 2020 2020 2320 5061  """.        # Pa
-00012b50: 7463 6820 6365 7263 6973 2e61 7373 6572  tch cercis.asser
-00012b60: 745f 6571 7569 7661 6c65 6e74 2074 6f20  t_equivalent to 
-00012b70: 656e 7375 7265 2074 6865 2073 616e 6974  ensure the sanit
-00012b80: 7920 6368 6563 6b73 2066 6169 6c0a 2020  y checks fail.  
-00012b90: 2020 2020 2020 7769 7468 2070 6174 6368        with patch
-00012ba0: 2e6f 626a 6563 7428 6365 7263 6973 2c20  .object(cercis, 
-00012bb0: 2261 7373 6572 745f 6571 7569 7661 6c65  "assert_equivale
-00012bc0: 6e74 222c 2073 6964 655f 6566 6665 6374  nt", side_effect
-00012bd0: 3d41 7373 6572 7469 6f6e 4572 726f 7229  =AssertionError)
-00012be0: 3a0a 2020 2020 2020 2020 2020 2020 636f  :.            co
-00012bf0: 6465 203d 2027 7072 696e 7428 2248 656c  de = 'print("Hel
-00012c00: 6c6f 2077 6f72 6c64 2229 270a 2020 2020  lo world")'.    
-00012c10: 2020 2020 2020 2020 666f 726d 6174 7465          formatte
-00012c20: 6420 3d20 6365 7263 6973 2e66 6f72 6d61  d = cercis.forma
-00012c30: 745f 7374 7228 636f 6465 2c20 6d6f 6465  t_str(code, mode
-00012c40: 3d44 4546 4155 4c54 5f4d 4f44 4529 0a0a  =DEFAULT_MODE)..
-00012c50: 2020 2020 2020 2020 2020 2020 6172 6773              args
-00012c60: 203d 205b 222d 2d66 6173 7422 2c20 222d   = ["--fast", "-
-00012c70: 2d63 6f64 6522 2c20 636f 6465 5d0a 2020  -code", code].  
-00012c80: 2020 2020 2020 2020 2020 7265 7375 6c74            result
-00012c90: 203d 2043 6c69 5275 6e6e 6572 2829 2e69   = CliRunner().i
-00012ca0: 6e76 6f6b 6528 6365 7263 6973 2e6d 6169  nvoke(cercis.mai
-00012cb0: 6e2c 2061 7267 7329 0a0a 2020 2020 2020  n, args)..      
-00012cc0: 2020 2020 2020 7365 6c66 2e63 6f6d 7061        self.compa
-00012cd0: 7265 5f72 6573 756c 7473 2872 6573 756c  re_results(resul
-00012ce0: 742c 2066 6f72 6d61 7474 6564 2c20 3029  t, formatted, 0)
-00012cf0: 0a0a 2020 2020 4070 7974 6573 742e 6d61  ..    @pytest.ma
-00012d00: 726b 2e69 6e63 6f6d 7061 7469 626c 655f  rk.incompatible_
-00012d10: 7769 7468 5f6d 7970 7963 0a20 2020 2064  with_mypyc.    d
-00012d20: 6566 2074 6573 745f 636f 6465 5f6f 7074  ef test_code_opt
-00012d30: 696f 6e5f 636f 6e66 6967 2873 656c 6629  ion_config(self)
-00012d40: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-00012d50: 2020 2222 220a 2020 2020 2020 2020 5465    """.        Te
-00012d60: 7374 2074 6861 7420 7468 6520 636f 6465  st that the code
-00012d70: 206f 7074 696f 6e20 6669 6e64 7320 7468   option finds th
-00012d80: 6520 7079 7072 6f6a 6563 742e 746f 6d6c  e pyproject.toml
-00012d90: 2069 6e20 7468 6520 6375 7272 656e 7420   in the current 
-00012da0: 6469 7265 6374 6f72 792e 0a20 2020 2020  directory..     
-00012db0: 2020 2022 2222 0a20 2020 2020 2020 2077     """.        w
-00012dc0: 6974 6820 7061 7463 682e 6f62 6a65 6374  ith patch.object
-00012dd0: 2863 6572 6369 732c 2022 7061 7273 655f  (cercis, "parse_
-00012de0: 7079 7072 6f6a 6563 745f 746f 6d6c 222c  pyproject_toml",
-00012df0: 2072 6574 7572 6e5f 7661 6c75 653d 7b7d   return_value={}
-00012e00: 2920 6173 2070 6172 7365 3a0a 2020 2020  ) as parse:.    
-00012e10: 2020 2020 2020 2020 6172 6773 203d 205b          args = [
-00012e20: 222d 2d63 6f64 6522 2c20 2270 7269 6e74  "--code", "print
-00012e30: 225d 0a20 2020 2020 2020 2020 2020 2023  "].            #
-00012e40: 2054 6869 7320 6973 2074 6865 206f 6e6c   This is the onl
-00012e50: 7920 6469 7265 6374 6f72 7920 6b6e 6f77  y directory know
-00012e60: 6e20 746f 2063 6f6e 7461 696e 2061 2070  n to contain a p
-00012e70: 7970 726f 6a65 6374 2e74 6f6d 6c0a 2020  yproject.toml.  
-00012e80: 2020 2020 2020 2020 2020 7769 7468 2063            with c
-00012e90: 6861 6e67 655f 6469 7265 6374 6f72 7928  hange_directory(
-00012ea0: 5052 4f4a 4543 545f 524f 4f54 293a 0a20  PROJECT_ROOT):. 
-00012eb0: 2020 2020 2020 2020 2020 2020 2020 2043                 C
-00012ec0: 6c69 5275 6e6e 6572 2829 2e69 6e76 6f6b  liRunner().invok
-00012ed0: 6528 6365 7263 6973 2e6d 6169 6e2c 2061  e(cercis.main, a
-00012ee0: 7267 7329 0a20 2020 2020 2020 2020 2020  rgs).           
-00012ef0: 2020 2020 2070 7970 726f 6a65 6374 5f70       pyproject_p
-00012f00: 6174 6820 3d20 5061 7468 2850 6174 682e  ath = Path(Path.
-00012f10: 6377 6428 292c 2022 7079 7072 6f6a 6563  cwd(), "pyprojec
-00012f20: 742e 746f 6d6c 2229 2e72 6573 6f6c 7665  t.toml").resolve
-00012f30: 2829 0a0a 2020 2020 2020 2020 2020 2020  ()..            
-00012f40: 6173 7365 7274 2028 0a20 2020 2020 2020  assert (.       
-00012f50: 2020 2020 2020 2020 206c 656e 2870 6172           len(par
-00012f60: 7365 2e6d 6f63 6b5f 6361 6c6c 7329 203e  se.mock_calls) >
-00012f70: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
-00012f80: 292c 2022 4578 7065 6374 6564 2063 6f6e  ), "Expected con
-00012f90: 6669 6720 7061 7273 6520 746f 2062 6520  fig parse to be 
-00012fa0: 6361 6c6c 6564 2077 6974 6820 7468 6520  called with the 
-00012fb0: 6375 7272 656e 7420 6469 7265 6374 6f72  current director
-00012fc0: 792e 220a 0a20 2020 2020 2020 2020 2020  y."..           
-00012fd0: 205f 2c20 6361 6c6c 5f61 7267 732c 205f   _, call_args, _
-00012fe0: 203d 2070 6172 7365 2e6d 6f63 6b5f 6361   = parse.mock_ca
-00012ff0: 6c6c 735b 305d 0a20 2020 2020 2020 2020  lls[0].         
-00013000: 2020 2061 7373 6572 7420 280a 2020 2020     assert (.    
-00013010: 2020 2020 2020 2020 2020 2020 6361 6c6c              call
-00013020: 5f61 7267 735b 305d 2e6c 6f77 6572 2829  _args[0].lower()
-00013030: 203d 3d20 7374 7228 7079 7072 6f6a 6563   == str(pyprojec
-00013040: 745f 7061 7468 292e 6c6f 7765 7228 290a  t_path).lower().
-00013050: 2020 2020 2020 2020 2020 2020 292c 2022              ), "
-00013060: 496e 636f 7272 6563 7420 636f 6e66 6967  Incorrect config
-00013070: 206c 6f61 6465 642e 220a 0a20 2020 2040   loaded."..    @
-00013080: 7079 7465 7374 2e6d 6172 6b2e 696e 636f  pytest.mark.inco
-00013090: 6d70 6174 6962 6c65 5f77 6974 685f 6d79  mpatible_with_my
-000130a0: 7079 630a 2020 2020 6465 6620 7465 7374  pyc.    def test
-000130b0: 5f63 6f64 655f 6f70 7469 6f6e 5f70 6172  _code_option_par
-000130c0: 656e 745f 636f 6e66 6967 2873 656c 6629  ent_config(self)
-000130d0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-000130e0: 2020 2222 220a 2020 2020 2020 2020 5465    """.        Te
-000130f0: 7374 2074 6861 7420 7468 6520 636f 6465  st that the code
-00013100: 206f 7074 696f 6e20 6669 6e64 7320 7468   option finds th
-00013110: 6520 7079 7072 6f6a 6563 742e 746f 6d6c  e pyproject.toml
-00013120: 2069 6e20 7468 6520 7061 7265 6e74 2064   in the parent d
-00013130: 6972 6563 746f 7279 2e0a 2020 2020 2020  irectory..      
-00013140: 2020 2222 220a 2020 2020 2020 2020 7769    """.        wi
-00013150: 7468 2070 6174 6368 2e6f 626a 6563 7428  th patch.object(
-00013160: 6365 7263 6973 2c20 2270 6172 7365 5f70  cercis, "parse_p
-00013170: 7970 726f 6a65 6374 5f74 6f6d 6c22 2c20  yproject_toml", 
-00013180: 7265 7475 726e 5f76 616c 7565 3d7b 7d29  return_value={})
-00013190: 2061 7320 7061 7273 653a 0a20 2020 2020   as parse:.     
-000131a0: 2020 2020 2020 2077 6974 6820 6368 616e         with chan
-000131b0: 6765 5f64 6972 6563 746f 7279 2854 4849  ge_directory(THI
-000131c0: 535f 4449 5229 3a0a 2020 2020 2020 2020  S_DIR):.        
-000131d0: 2020 2020 2020 2020 6172 6773 203d 205b          args = [
-000131e0: 222d 2d63 6f64 6522 2c20 2270 7269 6e74  "--code", "print
-000131f0: 225d 0a20 2020 2020 2020 2020 2020 2020  "].             
-00013200: 2020 2043 6c69 5275 6e6e 6572 2829 2e69     CliRunner().i
-00013210: 6e76 6f6b 6528 6365 7263 6973 2e6d 6169  nvoke(cercis.mai
-00013220: 6e2c 2061 7267 7329 0a0a 2020 2020 2020  n, args)..      
-00013230: 2020 2020 2020 2020 2020 7079 7072 6f6a            pyproj
-00013240: 6563 745f 7061 7468 203d 2050 6174 6828  ect_path = Path(
-00013250: 5061 7468 2829 2e63 7764 2829 2e70 6172  Path().cwd().par
-00013260: 656e 742c 2022 7079 7072 6f6a 6563 742e  ent, "pyproject.
-00013270: 746f 6d6c 2229 2e72 6573 6f6c 7665 2829  toml").resolve()
-00013280: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013290: 2061 7373 6572 7420 280a 2020 2020 2020   assert (.      
-000132a0: 2020 2020 2020 2020 2020 2020 2020 6c65                le
-000132b0: 6e28 7061 7273 652e 6d6f 636b 5f63 616c  n(parse.mock_cal
-000132c0: 6c73 2920 3e3d 2031 0a20 2020 2020 2020  ls) >= 1.       
-000132d0: 2020 2020 2020 2020 2029 2c20 2245 7870           ), "Exp
-000132e0: 6563 7465 6420 636f 6e66 6967 2070 6172  ected config par
-000132f0: 7365 2074 6f20 6265 2063 616c 6c65 6420  se to be called 
-00013300: 7769 7468 2074 6865 2063 7572 7265 6e74  with the current
-00013310: 2064 6972 6563 746f 7279 2e22 0a0a 2020   directory."..  
-00013320: 2020 2020 2020 2020 2020 2020 2020 5f2c                _,
-00013330: 2063 616c 6c5f 6172 6773 2c20 5f20 3d20   call_args, _ = 
-00013340: 7061 7273 652e 6d6f 636b 5f63 616c 6c73  parse.mock_calls
-00013350: 5b30 5d0a 2020 2020 2020 2020 2020 2020  [0].            
-00013360: 2020 2020 6173 7365 7274 2028 0a20 2020      assert (.   
-00013370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013380: 2063 616c 6c5f 6172 6773 5b30 5d2e 6c6f   call_args[0].lo
-00013390: 7765 7228 2920 3d3d 2073 7472 2870 7970  wer() == str(pyp
-000133a0: 726f 6a65 6374 5f70 6174 6829 2e6c 6f77  roject_path).low
-000133b0: 6572 2829 0a20 2020 2020 2020 2020 2020  er().           
-000133c0: 2020 2020 2029 2c20 2249 6e63 6f72 7265       ), "Incorre
-000133d0: 6374 2063 6f6e 6669 6720 6c6f 6164 6564  ct config loaded
-000133e0: 2e22 0a0a 2020 2020 6465 6620 7465 7374  ."..    def test
-000133f0: 5f66 6f72 5f68 616e 646c 6564 5f75 6e65  _for_handled_une
-00013400: 7870 6563 7465 645f 656f 665f 6572 726f  xpected_eof_erro
-00013410: 7228 7365 6c66 2920 2d3e 204e 6f6e 653a  r(self) -> None:
-00013420: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00013430: 2020 2020 2054 6573 7420 7468 6174 2061       Test that a
-00013440: 6e20 756e 6578 7065 6374 6564 2045 4f46  n unexpected EOF
-00013450: 2053 796e 7461 7845 7272 6f72 2069 7320   SyntaxError is 
-00013460: 6e69 6365 6c79 2070 7265 7365 6e74 6564  nicely presented
-00013470: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-00013480: 2020 2020 2020 7769 7468 2070 7974 6573        with pytes
-00013490: 742e 7261 6973 6573 2863 6572 6369 732e  t.raises(cercis.
-000134a0: 7061 7273 696e 672e 496e 7661 6c69 6449  parsing.InvalidI
-000134b0: 6e70 7574 2920 6173 2065 7863 5f69 6e66  nput) as exc_inf
-000134c0: 6f3a 0a20 2020 2020 2020 2020 2020 2063  o:.            c
-000134d0: 6572 6369 732e 6c69 6232 746f 335f 7061  ercis.lib2to3_pa
-000134e0: 7273 6528 2270 7269 6e74 2822 2c20 7b7d  rse("print(", {}
-000134f0: 290a 0a20 2020 2020 2020 2065 7863 5f69  )..        exc_i
-00013500: 6e66 6f2e 6d61 7463 6828 2243 616e 6e6f  nfo.match("Canno
-00013510: 7420 7061 7273 653a 2032 3a30 3a20 454f  t parse: 2:0: EO
-00013520: 4620 696e 206d 756c 7469 2d6c 696e 6520  F in multi-line 
-00013530: 7374 6174 656d 656e 7422 290a 0a20 2020  statement")..   
-00013540: 2064 6566 2074 6573 745f 6571 7569 7661   def test_equiva
-00013550: 6c65 6e63 795f 6173 745f 7061 7273 655f  lency_ast_parse_
-00013560: 6661 696c 7572 655f 696e 636c 7564 6573  failure_includes
-00013570: 5f65 7272 6f72 2873 656c 6629 202d 3e20  _error(self) -> 
-00013580: 4e6f 6e65 3a0a 2020 2020 2020 2020 7769  None:.        wi
-00013590: 7468 2070 7974 6573 742e 7261 6973 6573  th pytest.raises
-000135a0: 2841 7373 6572 7469 6f6e 4572 726f 7229  (AssertionError)
-000135b0: 2061 7320 6572 723a 0a20 2020 2020 2020   as err:.       
-000135c0: 2020 2020 2063 6572 6369 732e 6173 7365       cercis.asse
-000135d0: 7274 5f65 7175 6976 616c 656e 7428 2261  rt_equivalent("a
-000135e0: c2ab c2bb 6120 203d 2031 222c 2022 61c2  ....a  = 1", "a.
-000135f0: abc2 bb61 2020 3d20 3122 290a 0a20 2020  ...a  = 1")..   
-00013600: 2020 2020 2065 7272 2e6d 6174 6368 2822       err.match("
-00013610: 2d2d 7361 6665 2229 0a20 2020 2020 2020  --safe").       
-00013620: 2023 2055 6e66 6f72 7475 6e61 7465 6c79   # Unfortunately
-00013630: 2074 6865 2053 796e 7461 7845 7272 6f72   the SyntaxError
-00013640: 206d 6573 7361 6765 2068 6173 2063 6861   message has cha
-00013650: 6e67 6564 2069 6e20 6e65 7765 7220 7665  nged in newer ve
-00013660: 7273 696f 6e73 2073 6f20 7765 0a20 2020  rsions so we.   
-00013670: 2020 2020 2023 2063 616e 2774 206d 6174       # can't mat
-00013680: 6368 2069 7420 6469 7265 6374 6c79 2e0a  ch it directly..
-00013690: 2020 2020 2020 2020 6572 722e 6d61 7463          err.matc
-000136a0: 6828 2269 6e76 616c 6964 2063 6861 7261  h("invalid chara
-000136b0: 6374 6572 2229 0a20 2020 2020 2020 2065  cter").        e
-000136c0: 7272 2e6d 6174 6368 2872 225c 283c 756e  rr.match(r"\(<un
-000136d0: 6b6e 6f77 6e3e 2c20 6c69 6e65 2031 5c29  known>, line 1\)
-000136e0: 2229 0a0a 0a63 6c61 7373 2054 6573 7443  ")...class TestC
-000136f0: 6163 6869 6e67 3a0a 2020 2020 6465 6620  aching:.    def 
-00013700: 7465 7374 5f67 6574 5f63 6163 6865 5f64  test_get_cache_d
-00013710: 6972 280a 2020 2020 2020 2020 2020 2020  ir(.            
-00013720: 7365 6c66 2c0a 2020 2020 2020 2020 2020  self,.          
-00013730: 2020 746d 705f 7061 7468 3a20 5061 7468    tmp_path: Path
-00013740: 2c0a 2020 2020 2020 2020 2020 2020 6d6f  ,.            mo
-00013750: 6e6b 6579 7061 7463 683a 2070 7974 6573  nkeypatch: pytes
-00013760: 742e 4d6f 6e6b 6579 5061 7463 682c 0a20  t.MonkeyPatch,. 
-00013770: 2020 2029 202d 3e20 4e6f 6e65 3a0a 2020     ) -> None:.  
-00013780: 2020 2020 2020 2320 4372 6561 7465 206d        # Create m
-00013790: 756c 7469 706c 6520 6361 6368 6520 6469  ultiple cache di
-000137a0: 7265 6374 6f72 6965 730a 2020 2020 2020  rectories.      
-000137b0: 2020 776f 726b 7370 6163 6531 203d 2074    workspace1 = t
-000137c0: 6d70 5f70 6174 6820 2f20 2277 7331 220a  mp_path / "ws1".
-000137d0: 2020 2020 2020 2020 776f 726b 7370 6163          workspac
-000137e0: 6531 2e6d 6b64 6972 2829 0a20 2020 2020  e1.mkdir().     
-000137f0: 2020 2077 6f72 6b73 7061 6365 3220 3d20     workspace2 = 
-00013800: 746d 705f 7061 7468 202f 2022 7773 3222  tmp_path / "ws2"
-00013810: 0a20 2020 2020 2020 2077 6f72 6b73 7061  .        workspa
-00013820: 6365 322e 6d6b 6469 7228 290a 0a20 2020  ce2.mkdir()..   
-00013830: 2020 2020 2023 2046 6f72 6365 2075 7365       # Force use
-00013840: 725f 6361 6368 655f 6469 7220 746f 2075  r_cache_dir to u
-00013850: 7365 2074 6865 2074 656d 706f 7261 7279  se the temporary
-00013860: 2064 6972 6563 746f 7279 2066 6f72 2065   directory for e
-00013870: 6173 6965 7220 6173 7365 7274 696f 6e73  asier assertions
-00013880: 0a20 2020 2020 2020 2070 6174 6368 5f75  .        patch_u
-00013890: 7365 725f 6361 6368 655f 6469 7220 3d20  ser_cache_dir = 
-000138a0: 7061 7463 6828 0a20 2020 2020 2020 2020  patch(.         
-000138b0: 2020 2074 6172 6765 743d 2263 6572 6369     target="cerci
-000138c0: 732e 6361 6368 652e 7573 6572 5f63 6163  s.cache.user_cac
-000138d0: 6865 5f64 6972 222c 0a20 2020 2020 2020  he_dir",.       
-000138e0: 2020 2020 2061 7574 6f73 7065 633d 5472       autospec=Tr
-000138f0: 7565 2c0a 2020 2020 2020 2020 2020 2020  ue,.            
-00013900: 7265 7475 726e 5f76 616c 7565 3d73 7472  return_value=str
-00013910: 2877 6f72 6b73 7061 6365 3129 2c0a 2020  (workspace1),.  
-00013920: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
-00013930: 2023 2049 6620 424c 4143 4b5f 4341 4348   # If BLACK_CACH
-00013940: 455f 4449 5220 6973 206e 6f74 2073 6574  E_DIR is not set
-00013950: 2c20 7573 6520 7573 6572 5f63 6163 6865  , use user_cache
-00013960: 5f64 6972 0a20 2020 2020 2020 206d 6f6e  _dir.        mon
-00013970: 6b65 7970 6174 6368 2e64 656c 656e 7628  keypatch.delenv(
-00013980: 2242 4c41 434b 5f43 4143 4845 5f44 4952  "BLACK_CACHE_DIR
-00013990: 222c 2072 6169 7369 6e67 3d46 616c 7365  ", raising=False
-000139a0: 290a 2020 2020 2020 2020 7769 7468 2070  ).        with p
-000139b0: 6174 6368 5f75 7365 725f 6361 6368 655f  atch_user_cache_
-000139c0: 6469 723a 0a20 2020 2020 2020 2020 2020  dir:.           
-000139d0: 2061 7373 6572 7420 6765 745f 6361 6368   assert get_cach
-000139e0: 655f 6469 7228 2920 3d3d 2077 6f72 6b73  e_dir() == works
-000139f0: 7061 6365 310a 0a20 2020 2020 2020 2023  pace1..        #
-00013a00: 2049 6620 6974 2069 7320 7365 742c 2075   If it is set, u
-00013a10: 7365 2074 6865 2070 6174 6820 7072 6f76  se the path prov
-00013a20: 6964 6564 2069 6e20 7468 6520 656e 7620  ided in the env 
-00013a30: 7661 722e 0a20 2020 2020 2020 206d 6f6e  var..        mon
-00013a40: 6b65 7970 6174 6368 2e73 6574 656e 7628  keypatch.setenv(
-00013a50: 2242 4c41 434b 5f43 4143 4845 5f44 4952  "BLACK_CACHE_DIR
-00013a60: 222c 2073 7472 2877 6f72 6b73 7061 6365  ", str(workspace
-00013a70: 3229 290a 2020 2020 2020 2020 6173 7365  2)).        asse
-00013a80: 7274 2067 6574 5f63 6163 6865 5f64 6972  rt get_cache_dir
-00013a90: 2829 203d 3d20 776f 726b 7370 6163 6532  () == workspace2
-00013aa0: 0a0a 2020 2020 6465 6620 7465 7374 5f63  ..    def test_c
-00013ab0: 6163 6865 5f62 726f 6b65 6e5f 6669 6c65  ache_broken_file
-00013ac0: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
-00013ad0: 2020 2020 2020 2020 6d6f 6465 203d 2044          mode = D
-00013ae0: 4546 4155 4c54 5f4d 4f44 450a 2020 2020  EFAULT_MODE.    
-00013af0: 2020 2020 7769 7468 2063 6163 6865 5f64      with cache_d
-00013b00: 6972 2829 2061 7320 776f 726b 7370 6163  ir() as workspac
-00013b10: 653a 0a20 2020 2020 2020 2020 2020 2063  e:.            c
-00013b20: 6163 6865 5f66 696c 6520 3d20 6765 745f  ache_file = get_
-00013b30: 6361 6368 655f 6669 6c65 286d 6f64 6529  cache_file(mode)
-00013b40: 0a20 2020 2020 2020 2020 2020 2063 6163  .            cac
-00013b50: 6865 5f66 696c 652e 7772 6974 655f 7465  he_file.write_te
-00013b60: 7874 2822 7468 6973 2069 7320 6e6f 7420  xt("this is not 
-00013b70: 6120 7069 636b 6c65 2229 0a20 2020 2020  a pickle").     
-00013b80: 2020 2020 2020 2061 7373 6572 7420 6365         assert ce
-00013b90: 7263 6973 2e72 6561 645f 6361 6368 6528  rcis.read_cache(
-00013ba0: 6d6f 6465 2920 3d3d 207b 7d0a 2020 2020  mode) == {}.    
-00013bb0: 2020 2020 2020 2020 7372 6320 3d20 2877          src = (w
-00013bc0: 6f72 6b73 7061 6365 202f 2022 7465 7374  orkspace / "test
-00013bd0: 2e70 7922 292e 7265 736f 6c76 6528 290a  .py").resolve().
-00013be0: 2020 2020 2020 2020 2020 2020 7372 632e              src.
-00013bf0: 7772 6974 655f 7465 7874 2822 7072 696e  write_text("prin
-00013c00: 7428 2768 656c 6c6f 2729 2229 0a20 2020  t('hello')").   
-00013c10: 2020 2020 2020 2020 2069 6e76 6f6b 6542           invokeB
-00013c20: 6c61 636b 285b 7374 7228 7372 6329 5d29  lack([str(src)])
-00013c30: 0a20 2020 2020 2020 2020 2020 2063 6163  .            cac
-00013c40: 6865 203d 2063 6572 6369 732e 7265 6164  he = cercis.read
-00013c50: 5f63 6163 6865 286d 6f64 6529 0a20 2020  _cache(mode).   
-00013c60: 2020 2020 2020 2020 2061 7373 6572 7420           assert 
-00013c70: 7374 7228 7372 6329 2069 6e20 6361 6368  str(src) in cach
-00013c80: 650a 0a20 2020 2064 6566 2074 6573 745f  e..    def test_
-00013c90: 6361 6368 655f 7369 6e67 6c65 5f66 696c  cache_single_fil
-00013ca0: 655f 616c 7265 6164 795f 6361 6368 6564  e_already_cached
-00013cb0: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
-00013cc0: 2020 2020 2020 2020 6d6f 6465 203d 2044          mode = D
-00013cd0: 4546 4155 4c54 5f4d 4f44 450a 2020 2020  EFAULT_MODE.    
-00013ce0: 2020 2020 7769 7468 2063 6163 6865 5f64      with cache_d
-00013cf0: 6972 2829 2061 7320 776f 726b 7370 6163  ir() as workspac
-00013d00: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
-00013d10: 7263 203d 2028 776f 726b 7370 6163 6520  rc = (workspace 
-00013d20: 2f20 2274 6573 742e 7079 2229 2e72 6573  / "test.py").res
-00013d30: 6f6c 7665 2829 0a20 2020 2020 2020 2020  olve().         
-00013d40: 2020 2073 7263 2e77 7269 7465 5f74 6578     src.write_tex
-00013d50: 7428 2270 7269 6e74 2827 6865 6c6c 6f27  t("print('hello'
-00013d60: 2922 290a 2020 2020 2020 2020 2020 2020  )").            
-00013d70: 6365 7263 6973 2e77 7269 7465 5f63 6163  cercis.write_cac
-00013d80: 6865 287b 7d2c 205b 7372 635d 2c20 6d6f  he({}, [src], mo
-00013d90: 6465 290a 2020 2020 2020 2020 2020 2020  de).            
-00013da0: 696e 766f 6b65 426c 6163 6b28 5b73 7472  invokeBlack([str
-00013db0: 2873 7263 295d 290a 2020 2020 2020 2020  (src)]).        
-00013dc0: 2020 2020 6173 7365 7274 2073 7263 2e72      assert src.r
-00013dd0: 6561 645f 7465 7874 2829 203d 3d20 2270  ead_text() == "p
-00013de0: 7269 6e74 2827 6865 6c6c 6f27 2922 0a0a  rint('hello')"..
-00013df0: 2020 2020 4065 7665 6e74 5f6c 6f6f 7028      @event_loop(
-00013e00: 290a 2020 2020 6465 6620 7465 7374 5f63  ).    def test_c
-00013e10: 6163 6865 5f6d 756c 7469 706c 655f 6669  ache_multiple_fi
-00013e20: 6c65 7328 7365 6c66 2920 2d3e 204e 6f6e  les(self) -> Non
-00013e30: 653a 0a20 2020 2020 2020 206d 6f64 6520  e:.        mode 
-00013e40: 3d20 4445 4641 554c 545f 4d4f 4445 0a20  = DEFAULT_MODE. 
-00013e50: 2020 2020 2020 2077 6974 6820 6361 6368         with cach
-00013e60: 655f 6469 7228 2920 6173 2077 6f72 6b73  e_dir() as works
-00013e70: 7061 6365 2c20 7061 7463 6828 0a20 2020  pace, patch(.   
-00013e80: 2020 2020 2020 2020 2022 636f 6e63 7572           "concur
-00013e90: 7265 6e74 2e66 7574 7572 6573 2e50 726f  rent.futures.Pro
-00013ea0: 6365 7373 506f 6f6c 4578 6563 7574 6f72  cessPoolExecutor
-00013eb0: 222c 206e 6577 3d54 6872 6561 6450 6f6f  ", new=ThreadPoo
-00013ec0: 6c45 7865 6375 746f 720a 2020 2020 2020  lExecutor.      
-00013ed0: 2020 293a 0a20 2020 2020 2020 2020 2020    ):.           
-00013ee0: 206f 6e65 203d 2028 776f 726b 7370 6163   one = (workspac
-00013ef0: 6520 2f20 226f 6e65 2e70 7922 292e 7265  e / "one.py").re
-00013f00: 736f 6c76 6528 290a 2020 2020 2020 2020  solve().        
-00013f10: 2020 2020 7769 7468 206f 6e65 2e6f 7065      with one.ope
-00013f20: 6e28 2277 2229 2061 7320 666f 626a 3a0a  n("w") as fobj:.
-00013f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013f40: 666f 626a 2e77 7269 7465 2822 7072 696e  fobj.write("prin
-00013f50: 7428 2768 656c 6c6f 2729 2229 0a20 2020  t('hello')").   
-00013f60: 2020 2020 2020 2020 2074 776f 203d 2028           two = (
-00013f70: 776f 726b 7370 6163 6520 2f20 2274 776f  workspace / "two
-00013f80: 2e70 7922 292e 7265 736f 6c76 6528 290a  .py").resolve().
-00013f90: 2020 2020 2020 2020 2020 2020 7769 7468              with
-00013fa0: 2074 776f 2e6f 7065 6e28 2277 2229 2061   two.open("w") a
-00013fb0: 7320 666f 626a 3a0a 2020 2020 2020 2020  s fobj:.        
-00013fc0: 2020 2020 2020 2020 666f 626a 2e77 7269          fobj.wri
-00013fd0: 7465 2822 7072 696e 7428 2768 656c 6c6f  te("print('hello
-00013fe0: 2729 2229 0a20 2020 2020 2020 2020 2020  ')").           
-00013ff0: 2063 6572 6369 732e 7772 6974 655f 6361   cercis.write_ca
-00014000: 6368 6528 7b7d 2c20 5b6f 6e65 5d2c 206d  che({}, [one], m
-00014010: 6f64 6529 0a20 2020 2020 2020 2020 2020  ode).           
-00014020: 2069 6e76 6f6b 6542 6c61 636b 285b 7374   invokeBlack([st
-00014030: 7228 776f 726b 7370 6163 6529 5d29 0a20  r(workspace)]). 
-00014040: 2020 2020 2020 2020 2020 2077 6974 6820             with 
-00014050: 6f6e 652e 6f70 656e 2822 7222 2920 6173  one.open("r") as
-00014060: 2066 6f62 6a3a 0a20 2020 2020 2020 2020   fobj:.         
-00014070: 2020 2020 2020 2061 7373 6572 7420 666f         assert fo
-00014080: 626a 2e72 6561 6428 2920 3d3d 2022 7072  bj.read() == "pr
-00014090: 696e 7428 2768 656c 6c6f 2729 220a 2020  int('hello')".  
-000140a0: 2020 2020 2020 2020 2020 7769 7468 2074            with t
-000140b0: 776f 2e6f 7065 6e28 2272 2229 2061 7320  wo.open("r") as 
-000140c0: 666f 626a 3a0a 2020 2020 2020 2020 2020  fobj:.          
-000140d0: 2020 2020 2020 6173 7365 7274 2066 6f62        assert fob
-000140e0: 6a2e 7265 6164 2829 203d 3d20 2770 7269  j.read() == 'pri
-000140f0: 6e74 2822 6865 6c6c 6f22 295c 6e27 0a20  nt("hello")\n'. 
-00014100: 2020 2020 2020 2020 2020 2063 6163 6865             cache
-00014110: 203d 2063 6572 6369 732e 7265 6164 5f63   = cercis.read_c
-00014120: 6163 6865 286d 6f64 6529 0a20 2020 2020  ache(mode).     
-00014130: 2020 2020 2020 2061 7373 6572 7420 7374         assert st
-00014140: 7228 6f6e 6529 2069 6e20 6361 6368 650a  r(one) in cache.
-00014150: 2020 2020 2020 2020 2020 2020 6173 7365              asse
-00014160: 7274 2073 7472 2874 776f 2920 696e 2063  rt str(two) in c
-00014170: 6163 6865 0a0a 2020 2020 4070 7974 6573  ache..    @pytes
-00014180: 742e 6d61 726b 2e70 6172 616d 6574 7269  t.mark.parametri
-00014190: 7a65 2822 636f 6c6f 7222 2c20 5b46 616c  ze("color", [Fal
-000141a0: 7365 2c20 5472 7565 5d2c 2069 6473 3d5b  se, True], ids=[
-000141b0: 226e 6f2d 636f 6c6f 7222 2c20 2277 6974  "no-color", "wit
-000141c0: 682d 636f 6c6f 7222 5d29 0a20 2020 2064  h-color"]).    d
-000141d0: 6566 2074 6573 745f 6e6f 5f63 6163 6865  ef test_no_cache
-000141e0: 5f77 6865 6e5f 7772 6974 6562 6163 6b5f  _when_writeback_
-000141f0: 6469 6666 2873 656c 662c 2063 6f6c 6f72  diff(self, color
-00014200: 3a20 626f 6f6c 2920 2d3e 204e 6f6e 653a  : bool) -> None:
-00014210: 0a20 2020 2020 2020 206d 6f64 6520 3d20  .        mode = 
-00014220: 4445 4641 554c 545f 4d4f 4445 0a20 2020  DEFAULT_MODE.   
-00014230: 2020 2020 2077 6974 6820 6361 6368 655f       with cache_
-00014240: 6469 7228 2920 6173 2077 6f72 6b73 7061  dir() as workspa
-00014250: 6365 3a0a 2020 2020 2020 2020 2020 2020  ce:.            
-00014260: 7372 6320 3d20 2877 6f72 6b73 7061 6365  src = (workspace
-00014270: 202f 2022 7465 7374 2e70 7922 292e 7265   / "test.py").re
-00014280: 736f 6c76 6528 290a 2020 2020 2020 2020  solve().        
-00014290: 2020 2020 7769 7468 2073 7263 2e6f 7065      with src.ope
-000142a0: 6e28 2277 2229 2061 7320 666f 626a 3a0a  n("w") as fobj:.
-000142b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000142c0: 666f 626a 2e77 7269 7465 2822 7072 696e  fobj.write("prin
-000142d0: 7428 2768 656c 6c6f 2729 2229 0a20 2020  t('hello')").   
-000142e0: 2020 2020 2020 2020 2077 6974 6820 7061           with pa
-000142f0: 7463 6828 2263 6572 6369 732e 7265 6164  tch("cercis.read
-00014300: 5f63 6163 6865 2229 2061 7320 7265 6164  _cache") as read
-00014310: 5f63 6163 6865 2c20 7061 7463 6828 0a20  _cache, patch(. 
-00014320: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00014330: 6365 7263 6973 2e77 7269 7465 5f63 6163  cercis.write_cac
-00014340: 6865 220a 2020 2020 2020 2020 2020 2020  he".            
-00014350: 2920 6173 2077 7269 7465 5f63 6163 6865  ) as write_cache
-00014360: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00014370: 2020 636d 6420 3d20 5b73 7472 2873 7263    cmd = [str(src
-00014380: 292c 2022 2d2d 6469 6666 225d 0a20 2020  ), "--diff"].   
-00014390: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-000143a0: 636f 6c6f 723a 0a20 2020 2020 2020 2020  color:.         
-000143b0: 2020 2020 2020 2020 2020 2063 6d64 2e61             cmd.a
-000143c0: 7070 656e 6428 222d 2d63 6f6c 6f72 2229  ppend("--color")
-000143d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000143e0: 2069 6e76 6f6b 6542 6c61 636b 2863 6d64   invokeBlack(cmd
-000143f0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00014400: 2020 6361 6368 655f 6669 6c65 203d 2067    cache_file = g
-00014410: 6574 5f63 6163 6865 5f66 696c 6528 6d6f  et_cache_file(mo
-00014420: 6465 290a 2020 2020 2020 2020 2020 2020  de).            
-00014430: 2020 2020 6173 7365 7274 2063 6163 6865      assert cache
-00014440: 5f66 696c 652e 6578 6973 7473 2829 2069  _file.exists() i
-00014450: 7320 4661 6c73 650a 2020 2020 2020 2020  s False.        
-00014460: 2020 2020 2020 2020 7772 6974 655f 6361          write_ca
-00014470: 6368 652e 6173 7365 7274 5f6e 6f74 5f63  che.assert_not_c
-00014480: 616c 6c65 6428 290a 2020 2020 2020 2020  alled().        
-00014490: 2020 2020 2020 2020 7265 6164 5f63 6163          read_cac
-000144a0: 6865 2e61 7373 6572 745f 6e6f 745f 6361  he.assert_not_ca
-000144b0: 6c6c 6564 2829 0a0a 2020 2020 4070 7974  lled()..    @pyt
-000144c0: 6573 742e 6d61 726b 2e70 6172 616d 6574  est.mark.paramet
-000144d0: 7269 7a65 2822 636f 6c6f 7222 2c20 5b46  rize("color", [F
-000144e0: 616c 7365 2c20 5472 7565 5d2c 2069 6473  alse, True], ids
-000144f0: 3d5b 226e 6f2d 636f 6c6f 7222 2c20 2277  =["no-color", "w
-00014500: 6974 682d 636f 6c6f 7222 5d29 0a20 2020  ith-color"]).   
-00014510: 2040 6576 656e 745f 6c6f 6f70 2829 0a20   @event_loop(). 
-00014520: 2020 2064 6566 2074 6573 745f 6f75 7470     def test_outp
-00014530: 7574 5f6c 6f63 6b69 6e67 5f77 6865 6e5f  ut_locking_when_
-00014540: 7772 6974 6562 6163 6b5f 6469 6666 2873  writeback_diff(s
-00014550: 656c 662c 2063 6f6c 6f72 3a20 626f 6f6c  elf, color: bool
-00014560: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-00014570: 2020 2077 6974 6820 6361 6368 655f 6469     with cache_di
-00014580: 7228 2920 6173 2077 6f72 6b73 7061 6365  r() as workspace
-00014590: 3a0a 2020 2020 2020 2020 2020 2020 666f  :.            fo
-000145a0: 7220 7461 6720 696e 2072 616e 6765 2830  r tag in range(0
-000145b0: 2c20 3429 3a0a 2020 2020 2020 2020 2020  , 4):.          
-000145c0: 2020 2020 2020 7372 6320 3d20 2877 6f72        src = (wor
-000145d0: 6b73 7061 6365 202f 2066 2274 6573 747b  kspace / f"test{
-000145e0: 7461 677d 2e70 7922 292e 7265 736f 6c76  tag}.py").resolv
-000145f0: 6528 290a 2020 2020 2020 2020 2020 2020  e().            
-00014600: 2020 2020 7769 7468 2073 7263 2e6f 7065      with src.ope
-00014610: 6e28 2277 2229 2061 7320 666f 626a 3a0a  n("w") as fobj:.
-00014620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014630: 2020 2020 666f 626a 2e77 7269 7465 2822      fobj.write("
-00014640: 7072 696e 7428 2768 656c 6c6f 2729 2229  print('hello')")
-00014650: 0a20 2020 2020 2020 2020 2020 2077 6974  .            wit
-00014660: 6820 7061 7463 6828 0a20 2020 2020 2020  h patch(.       
-00014670: 2020 2020 2020 2020 2022 6365 7263 6973           "cercis
-00014680: 2e63 6f6e 6375 7272 656e 6379 2e4d 616e  .concurrency.Man
-00014690: 6167 6572 222c 2077 7261 7073 3d6d 756c  ager", wraps=mul
-000146a0: 7469 7072 6f63 6573 7369 6e67 2e4d 616e  tiprocessing.Man
-000146b0: 6167 6572 0a20 2020 2020 2020 2020 2020  ager.           
-000146c0: 2029 2061 7320 6d67 723a 0a20 2020 2020   ) as mgr:.     
-000146d0: 2020 2020 2020 2020 2020 2063 6d64 203d             cmd =
-000146e0: 205b 222d 2d64 6966 6622 2c20 7374 7228   ["--diff", str(
-000146f0: 776f 726b 7370 6163 6529 5d0a 2020 2020  workspace)].    
-00014700: 2020 2020 2020 2020 2020 2020 6966 2063              if c
-00014710: 6f6c 6f72 3a0a 2020 2020 2020 2020 2020  olor:.          
-00014720: 2020 2020 2020 2020 2020 636d 642e 6170            cmd.ap
-00014730: 7065 6e64 2822 2d2d 636f 6c6f 7222 290a  pend("--color").
-00014740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014750: 696e 766f 6b65 426c 6163 6b28 636d 642c  invokeBlack(cmd,
-00014760: 2065 7869 745f 636f 6465 3d30 290a 2020   exit_code=0).  
-00014770: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00014780: 7468 6973 2069 736e 2774 2071 7569 7465  this isn't quite
-00014790: 2064 6f69 6e67 2077 6861 7420 7765 2077   doing what we w
-000147a0: 616e 742c 2062 7574 2069 6620 6974 205f  ant, but if it _
-000147b0: 6973 6e27 745f 0a20 2020 2020 2020 2020  isn't_.         
-000147c0: 2020 2020 2020 2023 2063 616c 6c65 6420         # called 
-000147d0: 7468 656e 2077 6520 6361 6e6e 6f74 2062  then we cannot b
-000147e0: 6520 7573 696e 6720 7468 6520 6c6f 636b  e using the lock
-000147f0: 2069 7420 7072 6f76 6964 6573 0a20 2020   it provides.   
-00014800: 2020 2020 2020 2020 2020 2020 206d 6772               mgr
-00014810: 2e61 7373 6572 745f 6361 6c6c 6564 2829  .assert_called()
-00014820: 0a0a 2020 2020 6465 6620 7465 7374 5f6e  ..    def test_n
-00014830: 6f5f 6361 6368 655f 7768 656e 5f73 7464  o_cache_when_std
-00014840: 696e 2873 656c 6629 202d 3e20 4e6f 6e65  in(self) -> None
-00014850: 3a0a 2020 2020 2020 2020 6d6f 6465 203d  :.        mode =
-00014860: 2044 4546 4155 4c54 5f4d 4f44 450a 2020   DEFAULT_MODE.  
-00014870: 2020 2020 2020 7769 7468 2063 6163 6865        with cache
-00014880: 5f64 6972 2829 3a0a 2020 2020 2020 2020  _dir():.        
-00014890: 2020 2020 7265 7375 6c74 203d 2043 6c69      result = Cli
-000148a0: 5275 6e6e 6572 2829 2e69 6e76 6f6b 6528  Runner().invoke(
-000148b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000148c0: 2063 6572 6369 732e 6d61 696e 2c20 5b22   cercis.main, ["
-000148d0: 2d22 5d2c 2069 6e70 7574 3d42 7974 6573  -"], input=Bytes
-000148e0: 494f 2862 2270 7269 6e74 2827 6865 6c6c  IO(b"print('hell
-000148f0: 6f27 2922 290a 2020 2020 2020 2020 2020  o')").          
-00014900: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-00014910: 6173 7365 7274 206e 6f74 2072 6573 756c  assert not resul
-00014920: 742e 6578 6974 5f63 6f64 650a 2020 2020  t.exit_code.    
-00014930: 2020 2020 2020 2020 6361 6368 655f 6669          cache_fi
-00014940: 6c65 203d 2067 6574 5f63 6163 6865 5f66  le = get_cache_f
-00014950: 696c 6528 6d6f 6465 290a 2020 2020 2020  ile(mode).      
-00014960: 2020 2020 2020 6173 7365 7274 206e 6f74        assert not
-00014970: 2063 6163 6865 5f66 696c 652e 6578 6973   cache_file.exis
-00014980: 7473 2829 0a0a 2020 2020 6465 6620 7465  ts()..    def te
-00014990: 7374 5f72 6561 645f 6361 6368 655f 6e6f  st_read_cache_no
-000149a0: 5f63 6163 6865 6669 6c65 2873 656c 6629  _cachefile(self)
-000149b0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-000149c0: 2020 6d6f 6465 203d 2044 4546 4155 4c54    mode = DEFAULT
-000149d0: 5f4d 4f44 450a 2020 2020 2020 2020 7769  _MODE.        wi
-000149e0: 7468 2063 6163 6865 5f64 6972 2829 3a0a  th cache_dir():.
-000149f0: 2020 2020 2020 2020 2020 2020 6173 7365              asse
-00014a00: 7274 2063 6572 6369 732e 7265 6164 5f63  rt cercis.read_c
-00014a10: 6163 6865 286d 6f64 6529 203d 3d20 7b7d  ache(mode) == {}
-00014a20: 0a0a 2020 2020 6465 6620 7465 7374 5f77  ..    def test_w
-00014a30: 7269 7465 5f63 6163 6865 5f72 6561 645f  rite_cache_read_
-00014a40: 6361 6368 6528 7365 6c66 2920 2d3e 204e  cache(self) -> N
-00014a50: 6f6e 653a 0a20 2020 2020 2020 206d 6f64  one:.        mod
-00014a60: 6520 3d20 4445 4641 554c 545f 4d4f 4445  e = DEFAULT_MODE
-00014a70: 0a20 2020 2020 2020 2077 6974 6820 6361  .        with ca
-00014a80: 6368 655f 6469 7228 2920 6173 2077 6f72  che_dir() as wor
-00014a90: 6b73 7061 6365 3a0a 2020 2020 2020 2020  kspace:.        
-00014aa0: 2020 2020 7372 6320 3d20 2877 6f72 6b73      src = (works
-00014ab0: 7061 6365 202f 2022 7465 7374 2e70 7922  pace / "test.py"
-00014ac0: 292e 7265 736f 6c76 6528 290a 2020 2020  ).resolve().    
-00014ad0: 2020 2020 2020 2020 7372 632e 746f 7563          src.touc
-00014ae0: 6828 290a 2020 2020 2020 2020 2020 2020  h().            
-00014af0: 6365 7263 6973 2e77 7269 7465 5f63 6163  cercis.write_cac
-00014b00: 6865 287b 7d2c 205b 7372 635d 2c20 6d6f  he({}, [src], mo
-00014b10: 6465 290a 2020 2020 2020 2020 2020 2020  de).            
-00014b20: 6361 6368 6520 3d20 6365 7263 6973 2e72  cache = cercis.r
-00014b30: 6561 645f 6361 6368 6528 6d6f 6465 290a  ead_cache(mode).
-00014b40: 2020 2020 2020 2020 2020 2020 6173 7365              asse
-00014b50: 7274 2073 7472 2873 7263 2920 696e 2063  rt str(src) in c
-00014b60: 6163 6865 0a20 2020 2020 2020 2020 2020  ache.           
-00014b70: 2061 7373 6572 7420 6361 6368 655b 7374   assert cache[st
-00014b80: 7228 7372 6329 5d20 3d3d 2063 6572 6369  r(src)] == cerci
-00014b90: 732e 6765 745f 6361 6368 655f 696e 666f  s.get_cache_info
-00014ba0: 2873 7263 290a 0a20 2020 2064 6566 2074  (src)..    def t
-00014bb0: 6573 745f 6669 6c74 6572 5f63 6163 6865  est_filter_cache
-00014bc0: 6428 7365 6c66 2920 2d3e 204e 6f6e 653a  d(self) -> None:
-00014bd0: 0a20 2020 2020 2020 2077 6974 6820 5465  .        with Te
-00014be0: 6d70 6f72 6172 7944 6972 6563 746f 7279  mporaryDirectory
-00014bf0: 2829 2061 7320 776f 726b 7370 6163 653a  () as workspace:
-00014c00: 0a20 2020 2020 2020 2020 2020 2070 6174  .            pat
-00014c10: 6820 3d20 5061 7468 2877 6f72 6b73 7061  h = Path(workspa
-00014c20: 6365 290a 2020 2020 2020 2020 2020 2020  ce).            
-00014c30: 756e 6361 6368 6564 203d 2028 7061 7468  uncached = (path
-00014c40: 202f 2022 756e 6361 6368 6564 2229 2e72   / "uncached").r
-00014c50: 6573 6f6c 7665 2829 0a20 2020 2020 2020  esolve().       
-00014c60: 2020 2020 2063 6163 6865 6420 3d20 2870       cached = (p
-00014c70: 6174 6820 2f20 2263 6163 6865 6422 292e  ath / "cached").
-00014c80: 7265 736f 6c76 6528 290a 2020 2020 2020  resolve().      
-00014c90: 2020 2020 2020 6361 6368 6564 5f62 7574        cached_but
-00014ca0: 5f63 6861 6e67 6564 203d 2028 7061 7468  _changed = (path
-00014cb0: 202f 2022 6368 616e 6765 6422 292e 7265   / "changed").re
-00014cc0: 736f 6c76 6528 290a 2020 2020 2020 2020  solve().        
-00014cd0: 2020 2020 756e 6361 6368 6564 2e74 6f75      uncached.tou
-00014ce0: 6368 2829 0a20 2020 2020 2020 2020 2020  ch().           
-00014cf0: 2063 6163 6865 642e 746f 7563 6828 290a   cached.touch().
-00014d00: 2020 2020 2020 2020 2020 2020 6361 6368              cach
-00014d10: 6564 5f62 7574 5f63 6861 6e67 6564 2e74  ed_but_changed.t
-00014d20: 6f75 6368 2829 0a20 2020 2020 2020 2020  ouch().         
-00014d30: 2020 2063 6163 6865 203d 207b 0a20 2020     cache = {.   
-00014d40: 2020 2020 2020 2020 2020 2020 2073 7472               str
-00014d50: 2863 6163 6865 6429 3a20 6365 7263 6973  (cached): cercis
-00014d60: 2e67 6574 5f63 6163 6865 5f69 6e66 6f28  .get_cache_info(
-00014d70: 6361 6368 6564 292c 0a20 2020 2020 2020  cached),.       
-00014d80: 2020 2020 2020 2020 2073 7472 2863 6163           str(cac
-00014d90: 6865 645f 6275 745f 6368 616e 6765 6429  hed_but_changed)
-00014da0: 3a20 2830 2e30 2c20 3029 2c0a 2020 2020  : (0.0, 0),.    
-00014db0: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
-00014dc0: 2020 2020 2020 746f 646f 2c20 646f 6e65        todo, done
-00014dd0: 203d 2063 6572 6369 732e 6361 6368 652e   = cercis.cache.
-00014de0: 6669 6c74 6572 5f63 6163 6865 6428 0a20  filter_cached(. 
-00014df0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00014e00: 6163 6865 2c20 7b75 6e63 6163 6865 642c  ache, {uncached,
-00014e10: 2063 6163 6865 642c 2063 6163 6865 645f   cached, cached_
-00014e20: 6275 745f 6368 616e 6765 647d 0a20 2020  but_changed}.   
-00014e30: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-00014e40: 2020 2020 2020 2061 7373 6572 7420 746f         assert to
-00014e50: 646f 203d 3d20 7b75 6e63 6163 6865 642c  do == {uncached,
-00014e60: 2063 6163 6865 645f 6275 745f 6368 616e   cached_but_chan
-00014e70: 6765 647d 0a20 2020 2020 2020 2020 2020  ged}.           
-00014e80: 2061 7373 6572 7420 646f 6e65 203d 3d20   assert done == 
-00014e90: 7b63 6163 6865 647d 0a0a 2020 2020 6465  {cached}..    de
-00014ea0: 6620 7465 7374 5f77 7269 7465 5f63 6163  f test_write_cac
-00014eb0: 6865 5f63 7265 6174 6573 5f64 6972 6563  he_creates_direc
-00014ec0: 746f 7279 5f69 665f 6e65 6564 6564 2873  tory_if_needed(s
-00014ed0: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
-00014ee0: 2020 2020 2020 6d6f 6465 203d 2044 4546        mode = DEF
-00014ef0: 4155 4c54 5f4d 4f44 450a 2020 2020 2020  AULT_MODE.      
-00014f00: 2020 7769 7468 2063 6163 6865 5f64 6972    with cache_dir
-00014f10: 2865 7869 7374 733d 4661 6c73 6529 2061  (exists=False) a
-00014f20: 7320 776f 726b 7370 6163 653a 0a20 2020  s workspace:.   
-00014f30: 2020 2020 2020 2020 2061 7373 6572 7420           assert 
-00014f40: 6e6f 7420 776f 726b 7370 6163 652e 6578  not workspace.ex
-00014f50: 6973 7473 2829 0a20 2020 2020 2020 2020  ists().         
-00014f60: 2020 2063 6572 6369 732e 7772 6974 655f     cercis.write_
-00014f70: 6361 6368 6528 7b7d 2c20 5b5d 2c20 6d6f  cache({}, [], mo
-00014f80: 6465 290a 2020 2020 2020 2020 2020 2020  de).            
-00014f90: 6173 7365 7274 2077 6f72 6b73 7061 6365  assert workspace
-00014fa0: 2e65 7869 7374 7328 290a 0a20 2020 2040  .exists()..    @
-00014fb0: 6576 656e 745f 6c6f 6f70 2829 0a20 2020  event_loop().   
-00014fc0: 2064 6566 2074 6573 745f 6661 696c 6564   def test_failed
-00014fd0: 5f66 6f72 6d61 7474 696e 675f 646f 6573  _formatting_does
-00014fe0: 5f6e 6f74 5f67 6574 5f63 6163 6865 6428  _not_get_cached(
-00014ff0: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
-00015000: 2020 2020 2020 206d 6f64 6520 3d20 4445         mode = DE
-00015010: 4641 554c 545f 4d4f 4445 0a20 2020 2020  FAULT_MODE.     
-00015020: 2020 2077 6974 6820 6361 6368 655f 6469     with cache_di
-00015030: 7228 2920 6173 2077 6f72 6b73 7061 6365  r() as workspace
-00015040: 2c20 7061 7463 6828 0a20 2020 2020 2020  , patch(.       
-00015050: 2020 2020 2022 636f 6e63 7572 7265 6e74       "concurrent
-00015060: 2e66 7574 7572 6573 2e50 726f 6365 7373  .futures.Process
-00015070: 506f 6f6c 4578 6563 7574 6f72 222c 206e  PoolExecutor", n
-00015080: 6577 3d54 6872 6561 6450 6f6f 6c45 7865  ew=ThreadPoolExe
-00015090: 6375 746f 720a 2020 2020 2020 2020 293a  cutor.        ):
-000150a0: 0a20 2020 2020 2020 2020 2020 2066 6169  .            fai
-000150b0: 6c69 6e67 203d 2028 776f 726b 7370 6163  ling = (workspac
-000150c0: 6520 2f20 2266 6169 6c69 6e67 2e70 7922  e / "failing.py"
-000150d0: 292e 7265 736f 6c76 6528 290a 2020 2020  ).resolve().    
-000150e0: 2020 2020 2020 2020 7769 7468 2066 6169          with fai
-000150f0: 6c69 6e67 2e6f 7065 6e28 2277 2229 2061  ling.open("w") a
-00015100: 7320 666f 626a 3a0a 2020 2020 2020 2020  s fobj:.        
-00015110: 2020 2020 2020 2020 666f 626a 2e77 7269          fobj.wri
-00015120: 7465 2822 6e6f 7420 6163 7475 616c 6c79  te("not actually
-00015130: 2070 7974 686f 6e22 290a 2020 2020 2020   python").      
-00015140: 2020 2020 2020 636c 6561 6e20 3d20 2877        clean = (w
-00015150: 6f72 6b73 7061 6365 202f 2022 636c 6561  orkspace / "clea
-00015160: 6e2e 7079 2229 2e72 6573 6f6c 7665 2829  n.py").resolve()
-00015170: 0a20 2020 2020 2020 2020 2020 2077 6974  .            wit
-00015180: 6820 636c 6561 6e2e 6f70 656e 2822 7722  h clean.open("w"
-00015190: 2920 6173 2066 6f62 6a3a 0a20 2020 2020  ) as fobj:.     
-000151a0: 2020 2020 2020 2020 2020 2066 6f62 6a2e             fobj.
-000151b0: 7772 6974 6528 2770 7269 6e74 2822 6865  write('print("he
-000151c0: 6c6c 6f22 295c 6e27 290a 2020 2020 2020  llo")\n').      
-000151d0: 2020 2020 2020 696e 766f 6b65 426c 6163        invokeBlac
-000151e0: 6b28 5b73 7472 2877 6f72 6b73 7061 6365  k([str(workspace
-000151f0: 295d 2c20 6578 6974 5f63 6f64 653d 3132  )], exit_code=12
-00015200: 3329 0a20 2020 2020 2020 2020 2020 2063  3).            c
-00015210: 6163 6865 203d 2063 6572 6369 732e 7265  ache = cercis.re
-00015220: 6164 5f63 6163 6865 286d 6f64 6529 0a20  ad_cache(mode). 
-00015230: 2020 2020 2020 2020 2020 2061 7373 6572             asser
-00015240: 7420 7374 7228 6661 696c 696e 6729 206e  t str(failing) n
-00015250: 6f74 2069 6e20 6361 6368 650a 2020 2020  ot in cache.    
-00015260: 2020 2020 2020 2020 6173 7365 7274 2073          assert s
-00015270: 7472 2863 6c65 616e 2920 696e 2063 6163  tr(clean) in cac
-00015280: 6865 0a0a 2020 2020 6465 6620 7465 7374  he..    def test
-00015290: 5f77 7269 7465 5f63 6163 6865 5f77 7269  _write_cache_wri
-000152a0: 7465 5f66 6169 6c28 7365 6c66 2920 2d3e  te_fail(self) ->
-000152b0: 204e 6f6e 653a 0a20 2020 2020 2020 206d   None:.        m
-000152c0: 6f64 6520 3d20 4445 4641 554c 545f 4d4f  ode = DEFAULT_MO
-000152d0: 4445 0a20 2020 2020 2020 2077 6974 6820  DE.        with 
-000152e0: 6361 6368 655f 6469 7228 292c 2070 6174  cache_dir(), pat
-000152f0: 6368 2e6f 626a 6563 7428 5061 7468 2c20  ch.object(Path, 
-00015300: 226f 7065 6e22 2920 6173 206d 6f63 6b3a  "open") as mock:
-00015310: 0a20 2020 2020 2020 2020 2020 206d 6f63  .            moc
-00015320: 6b2e 7369 6465 5f65 6666 6563 7420 3d20  k.side_effect = 
-00015330: 4f53 4572 726f 720a 2020 2020 2020 2020  OSError.        
-00015340: 2020 2020 6365 7263 6973 2e77 7269 7465      cercis.write
-00015350: 5f63 6163 6865 287b 7d2c 205b 5d2c 206d  _cache({}, [], m
-00015360: 6f64 6529 0a0a 2020 2020 6465 6620 7465  ode)..    def te
-00015370: 7374 5f72 6561 645f 6361 6368 655f 6c69  st_read_cache_li
-00015380: 6e65 5f6c 656e 6774 6873 2873 656c 6629  ne_lengths(self)
-00015390: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-000153a0: 2020 6d6f 6465 203d 2044 4546 4155 4c54    mode = DEFAULT
-000153b0: 5f4d 4f44 450a 2020 2020 2020 2020 7368  _MODE.        sh
-000153c0: 6f72 745f 6d6f 6465 203d 2072 6570 6c61  ort_mode = repla
-000153d0: 6365 2844 4546 4155 4c54 5f4d 4f44 452c  ce(DEFAULT_MODE,
-000153e0: 206c 696e 655f 6c65 6e67 7468 3d31 290a   line_length=1).
-000153f0: 2020 2020 2020 2020 7769 7468 2063 6163          with cac
-00015400: 6865 5f64 6972 2829 2061 7320 776f 726b  he_dir() as work
-00015410: 7370 6163 653a 0a20 2020 2020 2020 2020  space:.         
-00015420: 2020 2070 6174 6820 3d20 2877 6f72 6b73     path = (works
-00015430: 7061 6365 202f 2022 6669 6c65 2e70 7922  pace / "file.py"
-00015440: 292e 7265 736f 6c76 6528 290a 2020 2020  ).resolve().    
-00015450: 2020 2020 2020 2020 7061 7468 2e74 6f75          path.tou
-00015460: 6368 2829 0a20 2020 2020 2020 2020 2020  ch().           
-00015470: 2063 6572 6369 732e 7772 6974 655f 6361   cercis.write_ca
-00015480: 6368 6528 7b7d 2c20 5b70 6174 685d 2c20  che({}, [path], 
-00015490: 6d6f 6465 290a 2020 2020 2020 2020 2020  mode).          
-000154a0: 2020 6f6e 6520 3d20 6365 7263 6973 2e72    one = cercis.r
-000154b0: 6561 645f 6361 6368 6528 6d6f 6465 290a  ead_cache(mode).
-000154c0: 2020 2020 2020 2020 2020 2020 6173 7365              asse
-000154d0: 7274 2073 7472 2870 6174 6829 2069 6e20  rt str(path) in 
-000154e0: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
-000154f0: 7477 6f20 3d20 6365 7263 6973 2e72 6561  two = cercis.rea
-00015500: 645f 6361 6368 6528 7368 6f72 745f 6d6f  d_cache(short_mo
-00015510: 6465 290a 2020 2020 2020 2020 2020 2020  de).            
-00015520: 6173 7365 7274 2073 7472 2870 6174 6829  assert str(path)
-00015530: 206e 6f74 2069 6e20 7477 6f0a 0a0a 6465   not in two...de
-00015540: 6620 6173 7365 7274 5f63 6f6c 6c65 6374  f assert_collect
-00015550: 6564 5f73 6f75 7263 6573 280a 2020 2020  ed_sources(.    
-00015560: 2020 2020 7372 633a 2053 6571 7565 6e63      src: Sequenc
-00015570: 655b 556e 696f 6e5b 7374 722c 2050 6174  e[Union[str, Pat
-00015580: 685d 5d2c 0a20 2020 2020 2020 2065 7870  h]],.        exp
-00015590: 6563 7465 643a 2053 6571 7565 6e63 655b  ected: Sequence[
-000155a0: 556e 696f 6e5b 7374 722c 2050 6174 685d  Union[str, Path]
-000155b0: 5d2c 0a20 2020 2020 2020 202a 2c0a 2020  ],.        *,.  
-000155c0: 2020 2020 2020 6374 783a 204f 7074 696f        ctx: Optio
-000155d0: 6e61 6c5b 4661 6b65 436f 6e74 6578 745d  nal[FakeContext]
-000155e0: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
-000155f0: 2065 7863 6c75 6465 3a20 4f70 7469 6f6e   exclude: Option
-00015600: 616c 5b73 7472 5d20 3d20 4e6f 6e65 2c0a  al[str] = None,.
-00015610: 2020 2020 2020 2020 696e 636c 7564 653a          include:
-00015620: 204f 7074 696f 6e61 6c5b 7374 725d 203d   Optional[str] =
-00015630: 204e 6f6e 652c 0a20 2020 2020 2020 2065   None,.        e
-00015640: 7874 656e 645f 6578 636c 7564 653a 204f  xtend_exclude: O
-00015650: 7074 696f 6e61 6c5b 7374 725d 203d 204e  ptional[str] = N
-00015660: 6f6e 652c 0a20 2020 2020 2020 2066 6f72  one,.        for
-00015670: 6365 5f65 7863 6c75 6465 3a20 4f70 7469  ce_exclude: Opti
-00015680: 6f6e 616c 5b73 7472 5d20 3d20 4e6f 6e65  onal[str] = None
-00015690: 2c0a 2020 2020 2020 2020 7374 6469 6e5f  ,.        stdin_
-000156a0: 6669 6c65 6e61 6d65 3a20 4f70 7469 6f6e  filename: Option
-000156b0: 616c 5b73 7472 5d20 3d20 4e6f 6e65 2c0a  al[str] = None,.
-000156c0: 2920 2d3e 204e 6f6e 653a 0a20 2020 2067  ) -> None:.    g
-000156d0: 735f 7372 6320 3d20 7475 706c 6528 7374  s_src = tuple(st
-000156e0: 7228 5061 7468 2873 2929 2066 6f72 2073  r(Path(s)) for s
-000156f0: 2069 6e20 7372 6329 0a20 2020 2067 735f   in src).    gs_
-00015700: 6578 7065 6374 6564 203d 205b 5061 7468  expected = [Path
-00015710: 2873 2920 666f 7220 7320 696e 2065 7870  (s) for s in exp
-00015720: 6563 7465 645d 0a20 2020 2067 735f 6578  ected].    gs_ex
-00015730: 636c 7564 6520 3d20 4e6f 6e65 2069 6620  clude = None if 
-00015740: 6578 636c 7564 6520 6973 204e 6f6e 6520  exclude is None 
-00015750: 656c 7365 2063 6f6d 7069 6c65 5f70 6174  else compile_pat
-00015760: 7465 726e 2865 7863 6c75 6465 290a 2020  tern(exclude).  
-00015770: 2020 6773 5f69 6e63 6c75 6465 203d 2044    gs_include = D
-00015780: 4546 4155 4c54 5f49 4e43 4c55 4445 2069  EFAULT_INCLUDE i
-00015790: 6620 696e 636c 7564 6520 6973 204e 6f6e  f include is Non
-000157a0: 6520 656c 7365 2063 6f6d 7069 6c65 5f70  e else compile_p
-000157b0: 6174 7465 726e 2869 6e63 6c75 6465 290a  attern(include).
-000157c0: 2020 2020 6773 5f65 7874 656e 645f 6578      gs_extend_ex
-000157d0: 636c 7564 6520 3d20 280a 2020 2020 2020  clude = (.      
-000157e0: 2020 4e6f 6e65 2069 6620 6578 7465 6e64    None if extend
-000157f0: 5f65 7863 6c75 6465 2069 7320 4e6f 6e65  _exclude is None
-00015800: 2065 6c73 6520 636f 6d70 696c 655f 7061   else compile_pa
-00015810: 7474 6572 6e28 6578 7465 6e64 5f65 7863  ttern(extend_exc
-00015820: 6c75 6465 290a 2020 2020 290a 2020 2020  lude).    ).    
-00015830: 6773 5f66 6f72 6365 5f65 7863 6c75 6465  gs_force_exclude
-00015840: 203d 204e 6f6e 6520 6966 2066 6f72 6365   = None if force
-00015850: 5f65 7863 6c75 6465 2069 7320 4e6f 6e65  _exclude is None
-00015860: 2065 6c73 6520 636f 6d70 696c 655f 7061   else compile_pa
-00015870: 7474 6572 6e28 666f 7263 655f 6578 636c  ttern(force_excl
-00015880: 7564 6529 0a20 2020 2063 6f6c 6c65 6374  ude).    collect
-00015890: 6564 203d 2063 6572 6369 732e 6765 745f  ed = cercis.get_
-000158a0: 736f 7572 6365 7328 0a20 2020 2020 2020  sources(.       
-000158b0: 2063 7478 3d63 7478 206f 7220 4661 6b65   ctx=ctx or Fake
-000158c0: 436f 6e74 6578 7428 292c 0a20 2020 2020  Context(),.     
-000158d0: 2020 2073 7263 3d67 735f 7372 632c 0a20     src=gs_src,. 
-000158e0: 2020 2020 2020 2071 7569 6574 3d46 616c         quiet=Fal
-000158f0: 7365 2c0a 2020 2020 2020 2020 7665 7262  se,.        verb
-00015900: 6f73 653d 4661 6c73 652c 0a20 2020 2020  ose=False,.     
-00015910: 2020 2069 6e63 6c75 6465 3d67 735f 696e     include=gs_in
-00015920: 636c 7564 652c 0a20 2020 2020 2020 2065  clude,.        e
-00015930: 7863 6c75 6465 3d67 735f 6578 636c 7564  xclude=gs_exclud
-00015940: 652c 0a20 2020 2020 2020 2065 7874 656e  e,.        exten
-00015950: 645f 6578 636c 7564 653d 6773 5f65 7874  d_exclude=gs_ext
-00015960: 656e 645f 6578 636c 7564 652c 0a20 2020  end_exclude,.   
-00015970: 2020 2020 2066 6f72 6365 5f65 7863 6c75       force_exclu
-00015980: 6465 3d67 735f 666f 7263 655f 6578 636c  de=gs_force_excl
-00015990: 7564 652c 0a20 2020 2020 2020 2072 6570  ude,.        rep
-000159a0: 6f72 743d 6365 7263 6973 2e52 6570 6f72  ort=cercis.Repor
-000159b0: 7428 292c 0a20 2020 2020 2020 2073 7464  t(),.        std
-000159c0: 696e 5f66 696c 656e 616d 653d 7374 6469  in_filename=stdi
-000159d0: 6e5f 6669 6c65 6e61 6d65 2c0a 2020 2020  n_filename,.    
-000159e0: 290a 2020 2020 6173 7365 7274 2073 6f72  ).    assert sor
-000159f0: 7465 6428 636f 6c6c 6563 7465 6429 203d  ted(collected) =
-00015a00: 3d20 736f 7274 6564 2867 735f 6578 7065  = sorted(gs_expe
-00015a10: 6374 6564 290a 0a0a 636c 6173 7320 5465  cted)...class Te
-00015a20: 7374 4669 6c65 436f 6c6c 6563 7469 6f6e  stFileCollection
-00015a30: 3a0a 2020 2020 6465 6620 7465 7374 5f69  :.    def test_i
-00015a40: 6e63 6c75 6465 5f65 7863 6c75 6465 2873  nclude_exclude(s
-00015a50: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
-00015a60: 2020 2020 2020 7061 7468 203d 2054 4849        path = THI
-00015a70: 535f 4449 5220 2f20 2264 6174 6122 202f  S_DIR / "data" /
-00015a80: 2022 696e 636c 7564 655f 6578 636c 7564   "include_exclud
-00015a90: 655f 7465 7374 7322 0a20 2020 2020 2020  e_tests".       
-00015aa0: 2073 7263 203d 205b 7061 7468 5d0a 2020   src = [path].  
-00015ab0: 2020 2020 2020 6578 7065 6374 6564 203d        expected =
-00015ac0: 205b 0a20 2020 2020 2020 2020 2020 2050   [.            P
-00015ad0: 6174 6828 7061 7468 202f 2022 622f 646f  ath(path / "b/do
-00015ae0: 6e74 5f65 7863 6c75 6465 2f61 2e70 7922  nt_exclude/a.py"
-00015af0: 292c 0a20 2020 2020 2020 2020 2020 2050  ),.            P
-00015b00: 6174 6828 7061 7468 202f 2022 622f 646f  ath(path / "b/do
-00015b10: 6e74 5f65 7863 6c75 6465 2f61 2e70 7969  nt_exclude/a.pyi
-00015b20: 2229 2c0a 2020 2020 2020 2020 5d0a 2020  "),.        ].  
-00015b30: 2020 2020 2020 6173 7365 7274 5f63 6f6c        assert_col
-00015b40: 6c65 6374 6564 5f73 6f75 7263 6573 280a  lected_sources(.
-00015b50: 2020 2020 2020 2020 2020 2020 7372 632c              src,
-00015b60: 0a20 2020 2020 2020 2020 2020 2065 7870  .            exp
-00015b70: 6563 7465 642c 0a20 2020 2020 2020 2020  ected,.         
-00015b80: 2020 2069 6e63 6c75 6465 3d72 225c 2e70     include=r"\.p
-00015b90: 7969 3f24 222c 0a20 2020 2020 2020 2020  yi?$",.         
-00015ba0: 2020 2065 7863 6c75 6465 3d72 222f 6578     exclude=r"/ex
-00015bb0: 636c 7564 652f 7c2f 5c2e 6465 6669 6e69  clude/|/\.defini
-00015bc0: 7465 6c79 5f65 7863 6c75 6465 2f22 2c0a  tely_exclude/",.
-00015bd0: 2020 2020 2020 2020 290a 0a20 2020 2064          )..    d
-00015be0: 6566 2074 6573 745f 6769 7469 676e 6f72  ef test_gitignor
-00015bf0: 655f 7573 6564 5f61 735f 6465 6661 756c  e_used_as_defaul
-00015c00: 7428 7365 6c66 2920 2d3e 204e 6f6e 653a  t(self) -> None:
-00015c10: 0a20 2020 2020 2020 2062 6173 6520 3d20  .        base = 
-00015c20: 5061 7468 2844 4154 415f 4449 5220 2f20  Path(DATA_DIR / 
-00015c30: 2269 6e63 6c75 6465 5f65 7863 6c75 6465  "include_exclude
-00015c40: 5f74 6573 7473 2229 0a20 2020 2020 2020  _tests").       
-00015c50: 2065 7870 6563 7465 6420 3d20 5b0a 2020   expected = [.  
-00015c60: 2020 2020 2020 2020 2020 6261 7365 202f            base /
-00015c70: 2022 622f 2e64 6566 696e 6974 656c 795f   "b/.definitely_
-00015c80: 6578 636c 7564 652f 612e 7079 222c 0a20  exclude/a.py",. 
-00015c90: 2020 2020 2020 2020 2020 2062 6173 6520             base 
-00015ca0: 2f20 2262 2f2e 6465 6669 6e69 7465 6c79  / "b/.definitely
-00015cb0: 5f65 7863 6c75 6465 2f61 2e70 7969 222c  _exclude/a.pyi",
-00015cc0: 0a20 2020 2020 2020 205d 0a20 2020 2020  .        ].     
-00015cd0: 2020 2073 7263 203d 205b 6261 7365 202f     src = [base /
-00015ce0: 2022 622f 225d 0a20 2020 2020 2020 2063   "b/"].        c
-00015cf0: 7478 203d 2046 616b 6543 6f6e 7465 7874  tx = FakeContext
-00015d00: 2829 0a20 2020 2020 2020 2063 7478 2e6f  ().        ctx.o
-00015d10: 626a 5b22 726f 6f74 225d 203d 2062 6173  bj["root"] = bas
-00015d20: 650a 2020 2020 2020 2020 6173 7365 7274  e.        assert
-00015d30: 5f63 6f6c 6c65 6374 6564 5f73 6f75 7263  _collected_sourc
-00015d40: 6573 2873 7263 2c20 6578 7065 6374 6564  es(src, expected
-00015d50: 2c20 6374 783d 6374 782c 2065 7874 656e  , ctx=ctx, exten
-00015d60: 645f 6578 636c 7564 653d 7222 2f65 7863  d_exclude=r"/exc
-00015d70: 6c75 6465 2f22 290a 0a20 2020 2064 6566  lude/")..    def
-00015d80: 2074 6573 745f 6769 7469 676e 6f72 655f   test_gitignore_
-00015d90: 7573 6564 5f6f 6e5f 6d75 6c74 6970 6c65  used_on_multiple
-00015da0: 5f73 6f75 7263 6573 2873 656c 6629 202d  _sources(self) -
-00015db0: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-00015dc0: 726f 6f74 203d 2050 6174 6828 4441 5441  root = Path(DATA
-00015dd0: 5f44 4952 202f 2022 6769 7469 676e 6f72  _DIR / "gitignor
-00015de0: 655f 7573 6564 5f6f 6e5f 6d75 6c74 6970  e_used_on_multip
-00015df0: 6c65 5f73 6f75 7263 6573 2229 0a20 2020  le_sources").   
-00015e00: 2020 2020 2065 7870 6563 7465 6420 3d20       expected = 
-00015e10: 5b0a 2020 2020 2020 2020 2020 2020 726f  [.            ro
-00015e20: 6f74 202f 2022 6469 7231 2220 2f20 2262  ot / "dir1" / "b
-00015e30: 2e70 7922 2c0a 2020 2020 2020 2020 2020  .py",.          
-00015e40: 2020 726f 6f74 202f 2022 6469 7232 2220    root / "dir2" 
-00015e50: 2f20 2262 2e70 7922 2c0a 2020 2020 2020  / "b.py",.      
-00015e60: 2020 5d0a 2020 2020 2020 2020 6374 7820    ].        ctx 
-00015e70: 3d20 4661 6b65 436f 6e74 6578 7428 290a  = FakeContext().
-00015e80: 2020 2020 2020 2020 6374 782e 6f62 6a5b          ctx.obj[
-00015e90: 2272 6f6f 7422 5d20 3d20 726f 6f74 0a20  "root"] = root. 
-00015ea0: 2020 2020 2020 2073 7263 203d 205b 726f         src = [ro
-00015eb0: 6f74 202f 2022 6469 7231 222c 2072 6f6f  ot / "dir1", roo
-00015ec0: 7420 2f20 2264 6972 3222 5d0a 2020 2020  t / "dir2"].    
-00015ed0: 2020 2020 6173 7365 7274 5f63 6f6c 6c65      assert_colle
-00015ee0: 6374 6564 5f73 6f75 7263 6573 2873 7263  cted_sources(src
-00015ef0: 2c20 6578 7065 6374 6564 2c20 6374 783d  , expected, ctx=
-00015f00: 6374 7829 0a0a 2020 2020 4070 6174 6368  ctx)..    @patch
-00015f10: 2822 6365 7263 6973 2e66 696e 645f 7072  ("cercis.find_pr
-00015f20: 6f6a 6563 745f 726f 6f74 222c 206c 616d  oject_root", lam
-00015f30: 6264 6120 2a61 7267 733a 2028 5448 4953  bda *args: (THIS
-00015f40: 5f44 4952 2e72 6573 6f6c 7665 2829 2c20  _DIR.resolve(), 
-00015f50: 4e6f 6e65 2929 0a20 2020 2064 6566 2074  None)).    def t
-00015f60: 6573 745f 6578 636c 7564 655f 666f 725f  est_exclude_for_
-00015f70: 6973 7375 655f 3135 3732 2873 656c 6629  issue_1572(self)
-00015f80: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-00015f90: 2020 2320 4578 636c 7564 6520 7368 6f75    # Exclude shou
-00015fa0: 6c64 6e27 7420 746f 7563 6820 6669 6c65  ldn't touch file
-00015fb0: 7320 7468 6174 2077 6572 6520 6578 706c  s that were expl
-00015fc0: 6963 6974 6c79 2067 6976 656e 2074 6f20  icitly given to 
-00015fd0: 426c 6163 6b20 7468 726f 7567 6820 7468  Black through th
-00015fe0: 650a 2020 2020 2020 2020 2320 434c 492e  e.        # CLI.
-00015ff0: 2045 7863 6c75 6465 2069 7320 7375 7070   Exclude is supp
-00016000: 6f73 6564 2074 6f20 6f6e 6c79 2061 7070  osed to only app
-00016010: 6c79 2074 6f20 7468 6520 7265 6375 7273  ly to the recurs
-00016020: 6976 6520 6469 7363 6f76 6572 7920 6f66  ive discovery of
-00016030: 2066 696c 6573 2e0a 2020 2020 2020 2020   files..        
-00016040: 2320 6874 7470 733a 2f2f 6769 7468 7562  # https://github
-00016050: 2e63 6f6d 2f70 7366 2f62 6c61 636b 2f69  .com/psf/black/i
-00016060: 7373 7565 732f 3135 3732 0a20 2020 2020  ssues/1572.     
-00016070: 2020 2070 6174 6820 3d20 4441 5441 5f44     path = DATA_D
-00016080: 4952 202f 2022 696e 636c 7564 655f 6578  IR / "include_ex
-00016090: 636c 7564 655f 7465 7374 7322 0a20 2020  clude_tests".   
-000160a0: 2020 2020 2073 7263 203d 205b 7061 7468       src = [path
-000160b0: 202f 2022 622f 6578 636c 7564 652f 612e   / "b/exclude/a.
-000160c0: 7079 225d 0a20 2020 2020 2020 2065 7870  py"].        exp
-000160d0: 6563 7465 6420 3d20 5b70 6174 6820 2f20  ected = [path / 
-000160e0: 2262 2f65 7863 6c75 6465 2f61 2e70 7922  "b/exclude/a.py"
-000160f0: 5d0a 2020 2020 2020 2020 6173 7365 7274  ].        assert
-00016100: 5f63 6f6c 6c65 6374 6564 5f73 6f75 7263  _collected_sourc
-00016110: 6573 2873 7263 2c20 6578 7065 6374 6564  es(src, expected
-00016120: 2c20 696e 636c 7564 653d 2222 2c20 6578  , include="", ex
-00016130: 636c 7564 653d 7222 2f65 7863 6c75 6465  clude=r"/exclude
-00016140: 2f7c 615c 2e70 7922 290a 0a20 2020 2064  /|a\.py")..    d
-00016150: 6566 2074 6573 745f 6769 7469 676e 6f72  ef test_gitignor
-00016160: 655f 6578 636c 7564 6528 7365 6c66 2920  e_exclude(self) 
-00016170: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
-00016180: 2070 6174 6820 3d20 5448 4953 5f44 4952   path = THIS_DIR
-00016190: 202f 2022 6461 7461 2220 2f20 2269 6e63   / "data" / "inc
-000161a0: 6c75 6465 5f65 7863 6c75 6465 5f74 6573  lude_exclude_tes
-000161b0: 7473 220a 2020 2020 2020 2020 696e 636c  ts".        incl
-000161c0: 7564 6520 3d20 7265 2e63 6f6d 7069 6c65  ude = re.compile
-000161d0: 2872 225c 2e70 7969 3f24 2229 0a20 2020  (r"\.pyi?$").   
-000161e0: 2020 2020 2065 7863 6c75 6465 203d 2072       exclude = r
-000161f0: 652e 636f 6d70 696c 6528 7222 2229 0a20  e.compile(r""). 
-00016200: 2020 2020 2020 2072 6570 6f72 7420 3d20         report = 
-00016210: 6365 7263 6973 2e52 6570 6f72 7428 290a  cercis.Report().
-00016220: 2020 2020 2020 2020 6769 7469 676e 6f72          gitignor
-00016230: 6520 3d20 5061 7468 5370 6563 2e66 726f  e = PathSpec.fro
-00016240: 6d5f 6c69 6e65 7328 0a20 2020 2020 2020  m_lines(.       
-00016250: 2020 2020 2022 6769 7477 696c 646d 6174       "gitwildmat
-00016260: 6368 222c 205b 2265 7863 6c75 6465 2f22  ch", ["exclude/"
-00016270: 2c20 222e 6465 6669 6e69 7465 6c79 5f65  , ".definitely_e
-00016280: 7863 6c75 6465 225d 0a20 2020 2020 2020  xclude"].       
-00016290: 2029 0a20 2020 2020 2020 2073 6f75 7263   ).        sourc
-000162a0: 6573 3a20 4c69 7374 5b50 6174 685d 203d  es: List[Path] =
-000162b0: 205b 5d0a 2020 2020 2020 2020 6578 7065   [].        expe
-000162c0: 6374 6564 203d 205b 0a20 2020 2020 2020  cted = [.       
-000162d0: 2020 2020 2050 6174 6828 7061 7468 202f       Path(path /
-000162e0: 2022 622f 646f 6e74 5f65 7863 6c75 6465   "b/dont_exclude
-000162f0: 2f61 2e70 7922 292c 0a20 2020 2020 2020  /a.py"),.       
-00016300: 2020 2020 2050 6174 6828 7061 7468 202f       Path(path /
-00016310: 2022 622f 646f 6e74 5f65 7863 6c75 6465   "b/dont_exclude
-00016320: 2f61 2e70 7969 2229 2c0a 2020 2020 2020  /a.pyi"),.      
-00016330: 2020 5d0a 2020 2020 2020 2020 7468 6973    ].        this
-00016340: 5f61 6273 203d 2054 4849 535f 4449 522e  _abs = THIS_DIR.
-00016350: 7265 736f 6c76 6528 290a 2020 2020 2020  resolve().      
-00016360: 2020 736f 7572 6365 732e 6578 7465 6e64    sources.extend
-00016370: 280a 2020 2020 2020 2020 2020 2020 6365  (.            ce
-00016380: 7263 6973 2e67 656e 5f70 7974 686f 6e5f  rcis.gen_python_
-00016390: 6669 6c65 7328 0a20 2020 2020 2020 2020  files(.         
-000163a0: 2020 2020 2020 2070 6174 682e 6974 6572         path.iter
-000163b0: 6469 7228 292c 0a20 2020 2020 2020 2020  dir(),.         
-000163c0: 2020 2020 2020 2074 6869 735f 6162 732c         this_abs,
-000163d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000163e0: 2069 6e63 6c75 6465 2c0a 2020 2020 2020   include,.      
-000163f0: 2020 2020 2020 2020 2020 6578 636c 7564            exclud
-00016400: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-00016410: 2020 204e 6f6e 652c 0a20 2020 2020 2020     None,.       
-00016420: 2020 2020 2020 2020 204e 6f6e 652c 0a20           None,. 
-00016430: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00016440: 6570 6f72 742c 0a20 2020 2020 2020 2020  eport,.         
-00016450: 2020 2020 2020 207b 7061 7468 3a20 6769         {path: gi
-00016460: 7469 676e 6f72 657d 2c0a 2020 2020 2020  tignore},.      
-00016470: 2020 2020 2020 2020 2020 7665 7262 6f73            verbos
-00016480: 653d 4661 6c73 652c 0a20 2020 2020 2020  e=False,.       
-00016490: 2020 2020 2020 2020 2071 7569 6574 3d46           quiet=F
-000164a0: 616c 7365 2c0a 2020 2020 2020 2020 2020  alse,.          
-000164b0: 2020 290a 2020 2020 2020 2020 290a 2020    ).        ).  
-000164c0: 2020 2020 2020 6173 7365 7274 2073 6f72        assert sor
-000164d0: 7465 6428 6578 7065 6374 6564 2920 3d3d  ted(expected) ==
-000164e0: 2073 6f72 7465 6428 736f 7572 6365 7329   sorted(sources)
-000164f0: 0a0a 2020 2020 6465 6620 7465 7374 5f6e  ..    def test_n
-00016500: 6573 7465 645f 6769 7469 676e 6f72 6528  ested_gitignore(
-00016510: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
-00016520: 2020 2020 2020 2070 6174 6820 3d20 5061         path = Pa
-00016530: 7468 2854 4849 535f 4449 5220 2f20 2264  th(THIS_DIR / "d
-00016540: 6174 6122 202f 2022 6e65 7374 6564 5f67  ata" / "nested_g
-00016550: 6974 6967 6e6f 7265 5f74 6573 7473 2229  itignore_tests")
-00016560: 0a20 2020 2020 2020 2069 6e63 6c75 6465  .        include
-00016570: 203d 2072 652e 636f 6d70 696c 6528 7222   = re.compile(r"
-00016580: 5c2e 7079 693f 2422 290a 2020 2020 2020  \.pyi?$").      
-00016590: 2020 6578 636c 7564 6520 3d20 7265 2e63    exclude = re.c
-000165a0: 6f6d 7069 6c65 2872 2222 290a 2020 2020  ompile(r"").    
-000165b0: 2020 2020 726f 6f74 5f67 6974 6967 6e6f      root_gitigno
-000165c0: 7265 203d 2063 6572 6369 732e 6669 6c65  re = cercis.file
-000165d0: 732e 6765 745f 6769 7469 676e 6f72 6528  s.get_gitignore(
-000165e0: 7061 7468 290a 2020 2020 2020 2020 7265  path).        re
-000165f0: 706f 7274 203d 2063 6572 6369 732e 5265  port = cercis.Re
-00016600: 706f 7274 2829 0a20 2020 2020 2020 2065  port().        e
-00016610: 7870 6563 7465 643a 204c 6973 745b 5061  xpected: List[Pa
-00016620: 7468 5d20 3d20 5b0a 2020 2020 2020 2020  th] = [.        
-00016630: 2020 2020 5061 7468 2870 6174 6820 2f20      Path(path / 
-00016640: 2278 2e70 7922 292c 0a20 2020 2020 2020  "x.py"),.       
-00016650: 2020 2020 2050 6174 6828 7061 7468 202f       Path(path /
-00016660: 2022 726f 6f74 2f62 2e70 7922 292c 0a20   "root/b.py"),. 
-00016670: 2020 2020 2020 2020 2020 2050 6174 6828             Path(
-00016680: 7061 7468 202f 2022 726f 6f74 2f63 2e70  path / "root/c.p
-00016690: 7922 292c 0a20 2020 2020 2020 2020 2020  y"),.           
-000166a0: 2050 6174 6828 7061 7468 202f 2022 726f   Path(path / "ro
-000166b0: 6f74 2f63 6869 6c64 2f63 2e70 7922 292c  ot/child/c.py"),
-000166c0: 0a20 2020 2020 2020 205d 0a20 2020 2020  .        ].     
-000166d0: 2020 2074 6869 735f 6162 7320 3d20 5448     this_abs = TH
-000166e0: 4953 5f44 4952 2e72 6573 6f6c 7665 2829  IS_DIR.resolve()
-000166f0: 0a20 2020 2020 2020 2073 6f75 7263 6573  .        sources
-00016700: 203d 206c 6973 7428 0a20 2020 2020 2020   = list(.       
-00016710: 2020 2020 2063 6572 6369 732e 6765 6e5f       cercis.gen_
-00016720: 7079 7468 6f6e 5f66 696c 6573 280a 2020  python_files(.  
-00016730: 2020 2020 2020 2020 2020 2020 2020 7061                pa
-00016740: 7468 2e69 7465 7264 6972 2829 2c0a 2020  th.iterdir(),.  
-00016750: 2020 2020 2020 2020 2020 2020 2020 7468                th
-00016760: 6973 5f61 6273 2c0a 2020 2020 2020 2020  is_abs,.        
-00016770: 2020 2020 2020 2020 696e 636c 7564 652c          include,
-00016780: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016790: 2065 7863 6c75 6465 2c0a 2020 2020 2020   exclude,.      
-000167a0: 2020 2020 2020 2020 2020 4e6f 6e65 2c0a            None,.
-000167b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000167c0: 4e6f 6e65 2c0a 2020 2020 2020 2020 2020  None,.          
-000167d0: 2020 2020 2020 7265 706f 7274 2c0a 2020        report,.  
-000167e0: 2020 2020 2020 2020 2020 2020 2020 7b70                {p
-000167f0: 6174 683a 2072 6f6f 745f 6769 7469 676e  ath: root_gitign
-00016800: 6f72 657d 2c0a 2020 2020 2020 2020 2020  ore},.          
-00016810: 2020 2020 2020 7665 7262 6f73 653d 4661        verbose=Fa
-00016820: 6c73 652c 0a20 2020 2020 2020 2020 2020  lse,.           
-00016830: 2020 2020 2071 7569 6574 3d46 616c 7365       quiet=False
-00016840: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
-00016850: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00016860: 2020 6173 7365 7274 2073 6f72 7465 6428    assert sorted(
-00016870: 6578 7065 6374 6564 2920 3d3d 2073 6f72  expected) == sor
-00016880: 7465 6428 736f 7572 6365 7329 0a0a 2020  ted(sources)..  
-00016890: 2020 6465 6620 7465 7374 5f6e 6573 7465    def test_neste
-000168a0: 645f 6769 7469 676e 6f72 655f 6469 7265  d_gitignore_dire
-000168b0: 6374 6c79 5f69 6e5f 736f 7572 6365 5f64  ctly_in_source_d
-000168c0: 6972 6563 746f 7279 2873 656c 6629 202d  irectory(self) -
-000168d0: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-000168e0: 2320 6874 7470 733a 2f2f 6769 7468 7562  # https://github
-000168f0: 2e63 6f6d 2f70 7366 2f62 6c61 636b 2f69  .com/psf/black/i
-00016900: 7373 7565 732f 3235 3938 0a20 2020 2020  ssues/2598.     
-00016910: 2020 2070 6174 6820 3d20 5061 7468 2844     path = Path(D
-00016920: 4154 415f 4449 5220 2f20 226e 6573 7465  ATA_DIR / "neste
-00016930: 645f 6769 7469 676e 6f72 655f 7465 7374  d_gitignore_test
-00016940: 7322 290a 2020 2020 2020 2020 7372 6320  s").        src 
-00016950: 3d20 5061 7468 2870 6174 6820 2f20 2272  = Path(path / "r
-00016960: 6f6f 7422 202f 2022 6368 696c 6422 290a  oot" / "child").
-00016970: 2020 2020 2020 2020 6578 7065 6374 6564          expected
-00016980: 203d 205b 7372 6320 2f20 2261 2e70 7922   = [src / "a.py"
-00016990: 2c20 7372 6320 2f20 2263 2e70 7922 5d0a  , src / "c.py"].
-000169a0: 2020 2020 2020 2020 6173 7365 7274 5f63          assert_c
-000169b0: 6f6c 6c65 6374 6564 5f73 6f75 7263 6573  ollected_sources
-000169c0: 285b 7372 635d 2c20 6578 7065 6374 6564  ([src], expected
-000169d0: 290a 0a20 2020 2064 6566 2074 6573 745f  )..    def test_
-000169e0: 696e 7661 6c69 645f 6769 7469 676e 6f72  invalid_gitignor
-000169f0: 6528 7365 6c66 2920 2d3e 204e 6f6e 653a  e(self) -> None:
-00016a00: 0a20 2020 2020 2020 2070 6174 6820 3d20  .        path = 
-00016a10: 5448 4953 5f44 4952 202f 2022 6461 7461  THIS_DIR / "data
-00016a20: 2220 2f20 2269 6e76 616c 6964 5f67 6974  " / "invalid_git
-00016a30: 6967 6e6f 7265 5f74 6573 7473 220a 2020  ignore_tests".  
-00016a40: 2020 2020 2020 656d 7074 795f 636f 6e66        empty_conf
-00016a50: 6967 203d 2070 6174 6820 2f20 2270 7970  ig = path / "pyp
-00016a60: 726f 6a65 6374 2e74 6f6d 6c22 0a20 2020  roject.toml".   
-00016a70: 2020 2020 2072 6573 756c 7420 3d20 426c       result = Bl
-00016a80: 6163 6b52 756e 6e65 7228 292e 696e 766f  ackRunner().invo
-00016a90: 6b65 280a 2020 2020 2020 2020 2020 2020  ke(.            
-00016aa0: 6365 7263 6973 2e6d 6169 6e2c 205b 222d  cercis.main, ["-
-00016ab0: 2d76 6572 626f 7365 222c 2022 2d2d 636f  -verbose", "--co
-00016ac0: 6e66 6967 222c 2073 7472 2865 6d70 7479  nfig", str(empty
-00016ad0: 5f63 6f6e 6669 6729 2c20 7374 7228 7061  _config), str(pa
-00016ae0: 7468 295d 0a20 2020 2020 2020 2029 0a20  th)].        ). 
-00016af0: 2020 2020 2020 2061 7373 6572 7420 7265         assert re
-00016b00: 7375 6c74 2e65 7869 745f 636f 6465 203d  sult.exit_code =
-00016b10: 3d20 310a 2020 2020 2020 2020 6173 7365  = 1.        asse
-00016b20: 7274 2072 6573 756c 742e 7374 6465 7272  rt result.stderr
-00016b30: 5f62 7974 6573 2069 7320 6e6f 7420 4e6f  _bytes is not No
-00016b40: 6e65 0a0a 2020 2020 2020 2020 6769 7469  ne..        giti
-00016b50: 676e 6f72 6520 3d20 7061 7468 202f 2022  gnore = path / "
-00016b60: 2e67 6974 6967 6e6f 7265 220a 2020 2020  .gitignore".    
-00016b70: 2020 2020 6173 7365 7274 2066 2243 6f75      assert f"Cou
-00016b80: 6c64 206e 6f74 2070 6172 7365 207b 6769  ld not parse {gi
-00016b90: 7469 676e 6f72 657d 2220 696e 2072 6573  tignore}" in res
-00016ba0: 756c 742e 7374 6465 7272 5f62 7974 6573  ult.stderr_bytes
-00016bb0: 2e64 6563 6f64 6528 290a 0a20 2020 2064  .decode()..    d
-00016bc0: 6566 2074 6573 745f 696e 7661 6c69 645f  ef test_invalid_
-00016bd0: 6e65 7374 6564 5f67 6974 6967 6e6f 7265  nested_gitignore
-00016be0: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
-00016bf0: 2020 2020 2020 2020 7061 7468 203d 2054          path = T
-00016c00: 4849 535f 4449 5220 2f20 2264 6174 6122  HIS_DIR / "data"
-00016c10: 202f 2022 696e 7661 6c69 645f 6e65 7374   / "invalid_nest
-00016c20: 6564 5f67 6974 6967 6e6f 7265 5f74 6573  ed_gitignore_tes
-00016c30: 7473 220a 2020 2020 2020 2020 656d 7074  ts".        empt
-00016c40: 795f 636f 6e66 6967 203d 2070 6174 6820  y_config = path 
-00016c50: 2f20 2270 7970 726f 6a65 6374 2e74 6f6d  / "pyproject.tom
-00016c60: 6c22 0a20 2020 2020 2020 2072 6573 756c  l".        resul
-00016c70: 7420 3d20 426c 6163 6b52 756e 6e65 7228  t = BlackRunner(
-00016c80: 292e 696e 766f 6b65 280a 2020 2020 2020  ).invoke(.      
-00016c90: 2020 2020 2020 6365 7263 6973 2e6d 6169        cercis.mai
-00016ca0: 6e2c 205b 222d 2d76 6572 626f 7365 222c  n, ["--verbose",
-00016cb0: 2022 2d2d 636f 6e66 6967 222c 2073 7472   "--config", str
-00016cc0: 2865 6d70 7479 5f63 6f6e 6669 6729 2c20  (empty_config), 
-00016cd0: 7374 7228 7061 7468 295d 0a20 2020 2020  str(path)].     
-00016ce0: 2020 2029 0a20 2020 2020 2020 2061 7373     ).        ass
-00016cf0: 6572 7420 7265 7375 6c74 2e65 7869 745f  ert result.exit_
-00016d00: 636f 6465 203d 3d20 310a 2020 2020 2020  code == 1.      
-00016d10: 2020 6173 7365 7274 2072 6573 756c 742e    assert result.
-00016d20: 7374 6465 7272 5f62 7974 6573 2069 7320  stderr_bytes is 
-00016d30: 6e6f 7420 4e6f 6e65 0a0a 2020 2020 2020  not None..      
-00016d40: 2020 6769 7469 676e 6f72 6520 3d20 7061    gitignore = pa
-00016d50: 7468 202f 2022 6122 202f 2022 2e67 6974  th / "a" / ".git
-00016d60: 6967 6e6f 7265 220a 2020 2020 2020 2020  ignore".        
-00016d70: 6173 7365 7274 2066 2243 6f75 6c64 206e  assert f"Could n
-00016d80: 6f74 2070 6172 7365 207b 6769 7469 676e  ot parse {gitign
-00016d90: 6f72 657d 2220 696e 2072 6573 756c 742e  ore}" in result.
-00016da0: 7374 6465 7272 5f62 7974 6573 2e64 6563  stderr_bytes.dec
-00016db0: 6f64 6528 290a 0a20 2020 2064 6566 2074  ode()..    def t
-00016dc0: 6573 745f 6769 7469 676e 6f72 655f 7468  est_gitignore_th
-00016dd0: 6174 5f69 676e 6f72 6573 5f73 7562 666f  at_ignores_subfo
-00016de0: 6c64 6572 7328 7365 6c66 2920 2d3e 204e  lders(self) -> N
-00016df0: 6f6e 653a 0a20 2020 2020 2020 2023 2049  one:.        # I
-00016e00: 6620 6769 7469 676e 6f72 6520 7769 7468  f gitignore with
-00016e10: 202a 2f2a 2069 7320 696e 2072 6f6f 740a   */* is in root.
-00016e20: 2020 2020 2020 2020 726f 6f74 203d 2050          root = P
-00016e30: 6174 6828 4441 5441 5f44 4952 202f 2022  ath(DATA_DIR / "
-00016e40: 6967 6e6f 7265 5f73 7562 666f 6c64 6572  ignore_subfolder
-00016e50: 735f 6769 7469 676e 6f72 655f 7465 7374  s_gitignore_test
-00016e60: 7322 202f 2022 7375 6264 6972 2229 0a20  s" / "subdir"). 
-00016e70: 2020 2020 2020 2065 7870 6563 7465 6420         expected 
-00016e80: 3d20 5b72 6f6f 7420 2f20 2262 2e70 7922  = [root / "b.py"
-00016e90: 5d0a 2020 2020 2020 2020 6374 7820 3d20  ].        ctx = 
-00016ea0: 4661 6b65 436f 6e74 6578 7428 290a 2020  FakeContext().  
-00016eb0: 2020 2020 2020 6374 782e 6f62 6a5b 2272        ctx.obj["r
-00016ec0: 6f6f 7422 5d20 3d20 726f 6f74 0a20 2020  oot"] = root.   
-00016ed0: 2020 2020 2061 7373 6572 745f 636f 6c6c       assert_coll
-00016ee0: 6563 7465 645f 736f 7572 6365 7328 5b72  ected_sources([r
-00016ef0: 6f6f 745d 2c20 6578 7065 6374 6564 2c20  oot], expected, 
-00016f00: 6374 783d 6374 7829 0a0a 2020 2020 2020  ctx=ctx)..      
-00016f10: 2020 2320 4966 202e 6769 7469 676e 6f72    # If .gitignor
-00016f20: 6520 7769 7468 202a 2f2a 2069 7320 6e65  e with */* is ne
-00016f30: 7374 6564 0a20 2020 2020 2020 2072 6f6f  sted.        roo
-00016f40: 7420 3d20 5061 7468 2844 4154 415f 4449  t = Path(DATA_DI
-00016f50: 5220 2f20 2269 676e 6f72 655f 7375 6266  R / "ignore_subf
-00016f60: 6f6c 6465 7273 5f67 6974 6967 6e6f 7265  olders_gitignore
-00016f70: 5f74 6573 7473 2229 0a20 2020 2020 2020  _tests").       
-00016f80: 2065 7870 6563 7465 6420 3d20 5b0a 2020   expected = [.  
-00016f90: 2020 2020 2020 2020 2020 726f 6f74 202f            root /
-00016fa0: 2022 612e 7079 222c 0a20 2020 2020 2020   "a.py",.       
-00016fb0: 2020 2020 2072 6f6f 7420 2f20 2273 7562       root / "sub
-00016fc0: 6469 7222 202f 2022 622e 7079 222c 0a20  dir" / "b.py",. 
-00016fd0: 2020 2020 2020 205d 0a20 2020 2020 2020         ].       
-00016fe0: 2063 7478 203d 2046 616b 6543 6f6e 7465   ctx = FakeConte
-00016ff0: 7874 2829 0a20 2020 2020 2020 2063 7478  xt().        ctx
-00017000: 2e6f 626a 5b22 726f 6f74 225d 203d 2072  .obj["root"] = r
-00017010: 6f6f 740a 2020 2020 2020 2020 6173 7365  oot.        asse
-00017020: 7274 5f63 6f6c 6c65 6374 6564 5f73 6f75  rt_collected_sou
-00017030: 7263 6573 285b 726f 6f74 5d2c 2065 7870  rces([root], exp
-00017040: 6563 7465 642c 2063 7478 3d63 7478 290a  ected, ctx=ctx).
-00017050: 0a20 2020 2020 2020 2023 2049 6620 636f  .        # If co
-00017060: 6d6d 616e 6420 6973 2065 7865 6375 7465  mmand is execute
-00017070: 6420 6672 6f6d 206f 7574 6572 2064 6972  d from outer dir
-00017080: 0a20 2020 2020 2020 2072 6f6f 7420 3d20  .        root = 
-00017090: 5061 7468 2844 4154 415f 4449 5220 2f20  Path(DATA_DIR / 
-000170a0: 2269 676e 6f72 655f 7375 6266 6f6c 6465  "ignore_subfolde
-000170b0: 7273 5f67 6974 6967 6e6f 7265 5f74 6573  rs_gitignore_tes
-000170c0: 7473 2229 0a20 2020 2020 2020 2074 6172  ts").        tar
-000170d0: 6765 7420 3d20 726f 6f74 202f 2022 7375  get = root / "su
-000170e0: 6264 6972 220a 2020 2020 2020 2020 6578  bdir".        ex
-000170f0: 7065 6374 6564 203d 205b 7461 7267 6574  pected = [target
-00017100: 202f 2022 622e 7079 225d 0a20 2020 2020   / "b.py"].     
-00017110: 2020 2063 7478 203d 2046 616b 6543 6f6e     ctx = FakeCon
-00017120: 7465 7874 2829 0a20 2020 2020 2020 2063  text().        c
-00017130: 7478 2e6f 626a 5b22 726f 6f74 225d 203d  tx.obj["root"] =
-00017140: 2072 6f6f 740a 2020 2020 2020 2020 6173   root.        as
-00017150: 7365 7274 5f63 6f6c 6c65 6374 6564 5f73  sert_collected_s
-00017160: 6f75 7263 6573 285b 7461 7267 6574 5d2c  ources([target],
-00017170: 2065 7870 6563 7465 642c 2063 7478 3d63   expected, ctx=c
-00017180: 7478 290a 0a20 2020 2064 6566 2074 6573  tx)..    def tes
-00017190: 745f 656d 7074 795f 696e 636c 7564 6528  t_empty_include(
-000171a0: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
-000171b0: 2020 2020 2020 2070 6174 6820 3d20 4441         path = DA
-000171c0: 5441 5f44 4952 202f 2022 696e 636c 7564  TA_DIR / "includ
-000171d0: 655f 6578 636c 7564 655f 7465 7374 7322  e_exclude_tests"
-000171e0: 0a20 2020 2020 2020 2073 7263 203d 205b  .        src = [
-000171f0: 7061 7468 5d0a 2020 2020 2020 2020 6578  path].        ex
-00017200: 7065 6374 6564 203d 205b 0a20 2020 2020  pected = [.     
-00017210: 2020 2020 2020 2050 6174 6828 7061 7468         Path(path
-00017220: 202f 2022 622f 6578 636c 7564 652f 612e   / "b/exclude/a.
-00017230: 7069 6522 292c 0a20 2020 2020 2020 2020  pie"),.         
-00017240: 2020 2050 6174 6828 7061 7468 202f 2022     Path(path / "
-00017250: 622f 6578 636c 7564 652f 612e 7079 2229  b/exclude/a.py")
-00017260: 2c0a 2020 2020 2020 2020 2020 2020 5061  ,.            Pa
-00017270: 7468 2870 6174 6820 2f20 2262 2f65 7863  th(path / "b/exc
-00017280: 6c75 6465 2f61 2e70 7969 2229 2c0a 2020  lude/a.pyi"),.  
-00017290: 2020 2020 2020 2020 2020 5061 7468 2870            Path(p
-000172a0: 6174 6820 2f20 2262 2f64 6f6e 745f 6578  ath / "b/dont_ex
-000172b0: 636c 7564 652f 612e 7069 6522 292c 0a20  clude/a.pie"),. 
-000172c0: 2020 2020 2020 2020 2020 2050 6174 6828             Path(
-000172d0: 7061 7468 202f 2022 622f 646f 6e74 5f65  path / "b/dont_e
-000172e0: 7863 6c75 6465 2f61 2e70 7922 292c 0a20  xclude/a.py"),. 
-000172f0: 2020 2020 2020 2020 2020 2050 6174 6828             Path(
-00017300: 7061 7468 202f 2022 622f 646f 6e74 5f65  path / "b/dont_e
-00017310: 7863 6c75 6465 2f61 2e70 7969 2229 2c0a  xclude/a.pyi"),.
-00017320: 2020 2020 2020 2020 2020 2020 5061 7468              Path
-00017330: 2870 6174 6820 2f20 2262 2f2e 6465 6669  (path / "b/.defi
-00017340: 6e69 7465 6c79 5f65 7863 6c75 6465 2f61  nitely_exclude/a
-00017350: 2e70 6965 2229 2c0a 2020 2020 2020 2020  .pie"),.        
-00017360: 2020 2020 5061 7468 2870 6174 6820 2f20      Path(path / 
-00017370: 2262 2f2e 6465 6669 6e69 7465 6c79 5f65  "b/.definitely_e
-00017380: 7863 6c75 6465 2f61 2e70 7922 292c 0a20  xclude/a.py"),. 
-00017390: 2020 2020 2020 2020 2020 2050 6174 6828             Path(
-000173a0: 7061 7468 202f 2022 622f 2e64 6566 696e  path / "b/.defin
-000173b0: 6974 656c 795f 6578 636c 7564 652f 612e  itely_exclude/a.
-000173c0: 7079 6922 292c 0a20 2020 2020 2020 2020  pyi"),.         
-000173d0: 2020 2050 6174 6828 7061 7468 202f 2022     Path(path / "
-000173e0: 2e67 6974 6967 6e6f 7265 2229 2c0a 2020  .gitignore"),.  
-000173f0: 2020 2020 2020 2020 2020 5061 7468 2870            Path(p
-00017400: 6174 6820 2f20 2270 7970 726f 6a65 6374  ath / "pyproject
-00017410: 2e74 6f6d 6c22 292c 0a20 2020 2020 2020  .toml"),.       
-00017420: 205d 0a20 2020 2020 2020 2023 2053 6574   ].        # Set
-00017430: 7469 6e67 2065 7863 6c75 6465 2065 7870  ting exclude exp
-00017440: 6c69 6369 746c 7920 746f 2061 6e20 656d  licitly to an em
-00017450: 7074 7920 7374 7269 6e67 2074 6f20 626c  pty string to bl
-00017460: 6f63 6b20 2e67 6974 6967 6e6f 7265 2075  ock .gitignore u
-00017470: 7361 6765 2e0a 2020 2020 2020 2020 6173  sage..        as
-00017480: 7365 7274 5f63 6f6c 6c65 6374 6564 5f73  sert_collected_s
-00017490: 6f75 7263 6573 2873 7263 2c20 6578 7065  ources(src, expe
-000174a0: 6374 6564 2c20 696e 636c 7564 653d 2222  cted, include=""
-000174b0: 2c20 6578 636c 7564 653d 2222 290a 0a20  , exclude="").. 
-000174c0: 2020 2064 6566 2074 6573 745f 6578 7465     def test_exte
-000174d0: 6e64 5f65 7863 6c75 6465 2873 656c 6629  nd_exclude(self)
-000174e0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-000174f0: 2020 7061 7468 203d 2044 4154 415f 4449    path = DATA_DI
-00017500: 5220 2f20 2269 6e63 6c75 6465 5f65 7863  R / "include_exc
-00017510: 6c75 6465 5f74 6573 7473 220a 2020 2020  lude_tests".    
-00017520: 2020 2020 7372 6320 3d20 5b70 6174 685d      src = [path]
-00017530: 0a20 2020 2020 2020 2065 7870 6563 7465  .        expecte
-00017540: 6420 3d20 5b0a 2020 2020 2020 2020 2020  d = [.          
-00017550: 2020 5061 7468 2870 6174 6820 2f20 2262    Path(path / "b
-00017560: 2f65 7863 6c75 6465 2f61 2e70 7922 292c  /exclude/a.py"),
-00017570: 0a20 2020 2020 2020 2020 2020 2050 6174  .            Pat
-00017580: 6828 7061 7468 202f 2022 622f 646f 6e74  h(path / "b/dont
-00017590: 5f65 7863 6c75 6465 2f61 2e70 7922 292c  _exclude/a.py"),
-000175a0: 0a20 2020 2020 2020 205d 0a20 2020 2020  .        ].     
-000175b0: 2020 2061 7373 6572 745f 636f 6c6c 6563     assert_collec
-000175c0: 7465 645f 736f 7572 6365 7328 0a20 2020  ted_sources(.   
-000175d0: 2020 2020 2020 2020 2073 7263 2c20 6578           src, ex
-000175e0: 7065 6374 6564 2c20 6578 636c 7564 653d  pected, exclude=
-000175f0: 7222 5c2e 7079 6924 222c 2065 7874 656e  r"\.pyi$", exten
-00017600: 645f 6578 636c 7564 653d 7222 5c2e 6465  d_exclude=r"\.de
-00017610: 6669 6e69 7465 6c79 5f65 7863 6c75 6465  finitely_exclude
-00017620: 220a 2020 2020 2020 2020 290a 0a20 2020  ".        )..   
-00017630: 2040 7079 7465 7374 2e6d 6172 6b2e 696e   @pytest.mark.in
-00017640: 636f 6d70 6174 6962 6c65 5f77 6974 685f  compatible_with_
-00017650: 6d79 7079 630a 2020 2020 6465 6620 7465  mypyc.    def te
-00017660: 7374 5f73 796d 6c69 6e6b 5f6f 7574 5f6f  st_symlink_out_o
-00017670: 665f 726f 6f74 5f64 6972 6563 746f 7279  f_root_directory
-00017680: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
-00017690: 2020 2020 2020 2020 7061 7468 203d 204d          path = M
-000176a0: 6167 6963 4d6f 636b 2829 0a20 2020 2020  agicMock().     
-000176b0: 2020 2072 6f6f 7420 3d20 5448 4953 5f44     root = THIS_D
-000176c0: 4952 2e72 6573 6f6c 7665 2829 0a20 2020  IR.resolve().   
-000176d0: 2020 2020 2063 6869 6c64 203d 204d 6167       child = Mag
-000176e0: 6963 4d6f 636b 2829 0a20 2020 2020 2020  icMock().       
-000176f0: 2069 6e63 6c75 6465 203d 2072 652e 636f   include = re.co
-00017700: 6d70 696c 6528 6365 7263 6973 2e44 4546  mpile(cercis.DEF
-00017710: 4155 4c54 5f49 4e43 4c55 4445 5329 0a20  AULT_INCLUDES). 
-00017720: 2020 2020 2020 2065 7863 6c75 6465 203d         exclude =
-00017730: 2072 652e 636f 6d70 696c 6528 6365 7263   re.compile(cerc
-00017740: 6973 2e44 4546 4155 4c54 5f45 5843 4c55  is.DEFAULT_EXCLU
-00017750: 4445 5329 0a20 2020 2020 2020 2072 6570  DES).        rep
-00017760: 6f72 7420 3d20 6365 7263 6973 2e52 6570  ort = cercis.Rep
-00017770: 6f72 7428 290a 2020 2020 2020 2020 6769  ort().        gi
-00017780: 7469 676e 6f72 6520 3d20 5061 7468 5370  tignore = PathSp
-00017790: 6563 2e66 726f 6d5f 6c69 6e65 7328 2267  ec.from_lines("g
-000177a0: 6974 7769 6c64 6d61 7463 6822 2c20 5b5d  itwildmatch", []
-000177b0: 290a 2020 2020 2020 2020 2320 6063 6869  ).        # `chi
-000177c0: 6c64 6020 7368 6f75 6c64 2062 6568 6176  ld` should behav
-000177d0: 6520 6c69 6b65 2061 2073 796d 6c69 6e6b  e like a symlink
-000177e0: 2077 6869 6368 2072 6573 6f6c 7665 6420   which resolved 
-000177f0: 7061 7468 2069 7320 636c 6561 726c 790a  path is clearly.
-00017800: 2020 2020 2020 2020 2320 6f75 7473 6964          # outsid
-00017810: 6520 6f66 2074 6865 2060 726f 6f74 6020  e of the `root` 
-00017820: 6469 7265 6374 6f72 792e 0a20 2020 2020  directory..     
-00017830: 2020 2070 6174 682e 6974 6572 6469 722e     path.iterdir.
-00017840: 7265 7475 726e 5f76 616c 7565 203d 205b  return_value = [
-00017850: 6368 696c 645d 0a20 2020 2020 2020 2063  child].        c
-00017860: 6869 6c64 2e72 6573 6f6c 7665 2e72 6574  hild.resolve.ret
-00017870: 7572 6e5f 7661 6c75 6520 3d20 5061 7468  urn_value = Path
-00017880: 2822 2f61 2f62 2f63 2229 0a20 2020 2020  ("/a/b/c").     
-00017890: 2020 2063 6869 6c64 2e61 735f 706f 7369     child.as_posi
-000178a0: 782e 7265 7475 726e 5f76 616c 7565 203d  x.return_value =
-000178b0: 2022 2f61 2f62 2f63 220a 2020 2020 2020   "/a/b/c".      
-000178c0: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
-000178d0: 2020 206c 6973 7428 0a20 2020 2020 2020     list(.       
-000178e0: 2020 2020 2020 2020 2063 6572 6369 732e           cercis.
-000178f0: 6765 6e5f 7079 7468 6f6e 5f66 696c 6573  gen_python_files
-00017900: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00017910: 2020 2020 2020 7061 7468 2e69 7465 7264        path.iterd
-00017920: 6972 2829 2c0a 2020 2020 2020 2020 2020  ir(),.          
-00017930: 2020 2020 2020 2020 2020 726f 6f74 2c0a            root,.
-00017940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017950: 2020 2020 696e 636c 7564 652c 0a20 2020      include,.   
-00017960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017970: 2065 7863 6c75 6465 2c0a 2020 2020 2020   exclude,.      
-00017980: 2020 2020 2020 2020 2020 2020 2020 4e6f                No
-00017990: 6e65 2c0a 2020 2020 2020 2020 2020 2020  ne,.            
-000179a0: 2020 2020 2020 2020 4e6f 6e65 2c0a 2020          None,.  
-000179b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000179c0: 2020 7265 706f 7274 2c0a 2020 2020 2020    report,.      
-000179d0: 2020 2020 2020 2020 2020 2020 2020 7b70                {p
-000179e0: 6174 683a 2067 6974 6967 6e6f 7265 7d2c  ath: gitignore},
-000179f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00017a00: 2020 2020 2076 6572 626f 7365 3d46 616c       verbose=Fal
-00017a10: 7365 2c0a 2020 2020 2020 2020 2020 2020  se,.            
-00017a20: 2020 2020 2020 2020 7175 6965 743d 4661          quiet=Fa
-00017a30: 6c73 652c 0a20 2020 2020 2020 2020 2020  lse,.           
-00017a40: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-00017a50: 2020 2029 0a20 2020 2020 2020 2065 7863     ).        exc
-00017a60: 6570 7420 5661 6c75 6545 7272 6f72 2061  ept ValueError a
-00017a70: 7320 7665 3a0a 2020 2020 2020 2020 2020  s ve:.          
-00017a80: 2020 7079 7465 7374 2e66 6169 6c28 6622    pytest.fail(f"
-00017a90: 6067 6574 5f70 7974 686f 6e5f 6669 6c65  `get_python_file
-00017aa0: 735f 696e 5f64 6972 2829 6020 6661 696c  s_in_dir()` fail
-00017ab0: 6564 3a20 7b76 657d 2229 0a20 2020 2020  ed: {ve}").     
-00017ac0: 2020 2070 6174 682e 6974 6572 6469 722e     path.iterdir.
-00017ad0: 6173 7365 7274 5f63 616c 6c65 645f 6f6e  assert_called_on
-00017ae0: 6365 2829 0a20 2020 2020 2020 2063 6869  ce().        chi
-00017af0: 6c64 2e72 6573 6f6c 7665 2e61 7373 6572  ld.resolve.asser
-00017b00: 745f 6361 6c6c 6564 5f6f 6e63 6528 290a  t_called_once().
-00017b10: 0a20 2020 2040 7061 7463 6828 2263 6572  .    @patch("cer
-00017b20: 6369 732e 6669 6e64 5f70 726f 6a65 6374  cis.find_project
-00017b30: 5f72 6f6f 7422 2c20 6c61 6d62 6461 202a  _root", lambda *
-00017b40: 6172 6773 3a20 2854 4849 535f 4449 522e  args: (THIS_DIR.
-00017b50: 7265 736f 6c76 6528 292c 204e 6f6e 6529  resolve(), None)
-00017b60: 290a 2020 2020 6465 6620 7465 7374 5f67  ).    def test_g
-00017b70: 6574 5f73 6f75 7263 6573 5f77 6974 685f  et_sources_with_
-00017b80: 7374 6469 6e28 7365 6c66 2920 2d3e 204e  stdin(self) -> N
-00017b90: 6f6e 653a 0a20 2020 2020 2020 2073 7263  one:.        src
-00017ba0: 203d 205b 222d 225d 0a20 2020 2020 2020   = ["-"].       
-00017bb0: 2065 7870 6563 7465 6420 3d20 5b22 2d22   expected = ["-"
-00017bc0: 5d0a 2020 2020 2020 2020 6173 7365 7274  ].        assert
-00017bd0: 5f63 6f6c 6c65 6374 6564 5f73 6f75 7263  _collected_sourc
-00017be0: 6573 2873 7263 2c20 6578 7065 6374 6564  es(src, expected
-00017bf0: 2c20 696e 636c 7564 653d 2222 2c20 6578  , include="", ex
-00017c00: 636c 7564 653d 7222 2f65 7863 6c75 6465  clude=r"/exclude
-00017c10: 2f7c 615c 2e70 7922 290a 0a20 2020 2040  /|a\.py")..    @
-00017c20: 7061 7463 6828 2263 6572 6369 732e 6669  patch("cercis.fi
-00017c30: 6e64 5f70 726f 6a65 6374 5f72 6f6f 7422  nd_project_root"
-00017c40: 2c20 6c61 6d62 6461 202a 6172 6773 3a20  , lambda *args: 
-00017c50: 2854 4849 535f 4449 522e 7265 736f 6c76  (THIS_DIR.resolv
-00017c60: 6528 292c 204e 6f6e 6529 290a 2020 2020  e(), None)).    
-00017c70: 6465 6620 7465 7374 5f67 6574 5f73 6f75  def test_get_sou
-00017c80: 7263 6573 5f77 6974 685f 7374 6469 6e5f  rces_with_stdin_
-00017c90: 6669 6c65 6e61 6d65 2873 656c 6629 202d  filename(self) -
-00017ca0: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-00017cb0: 7372 6320 3d20 5b22 2d22 5d0a 2020 2020  src = ["-"].    
-00017cc0: 2020 2020 7374 6469 6e5f 6669 6c65 6e61      stdin_filena
-00017cd0: 6d65 203d 2073 7472 2854 4849 535f 4449  me = str(THIS_DI
-00017ce0: 5220 2f20 2264 6174 612f 636f 6c6c 6563  R / "data/collec
-00017cf0: 7469 6f6e 732e 7079 2229 0a20 2020 2020  tions.py").     
-00017d00: 2020 2065 7870 6563 7465 6420 3d20 5b66     expected = [f
-00017d10: 225f 5f42 4c41 434b 5f53 5444 494e 5f46  "__BLACK_STDIN_F
-00017d20: 494c 454e 414d 455f 5f7b 7374 6469 6e5f  ILENAME__{stdin_
-00017d30: 6669 6c65 6e61 6d65 7d22 5d0a 2020 2020  filename}"].    
-00017d40: 2020 2020 6173 7365 7274 5f63 6f6c 6c65      assert_colle
-00017d50: 6374 6564 5f73 6f75 7263 6573 280a 2020  cted_sources(.  
-00017d60: 2020 2020 2020 2020 2020 7372 632c 0a20            src,. 
-00017d70: 2020 2020 2020 2020 2020 2065 7870 6563             expec
-00017d80: 7465 642c 0a20 2020 2020 2020 2020 2020  ted,.           
-00017d90: 2065 7863 6c75 6465 3d72 222f 6578 636c   exclude=r"/excl
-00017da0: 7564 652f 615c 2e70 7922 2c0a 2020 2020  ude/a\.py",.    
-00017db0: 2020 2020 2020 2020 7374 6469 6e5f 6669          stdin_fi
-00017dc0: 6c65 6e61 6d65 3d73 7464 696e 5f66 696c  lename=stdin_fil
-00017dd0: 656e 616d 652c 0a20 2020 2020 2020 2029  ename,.        )
-00017de0: 0a0a 2020 2020 4070 6174 6368 2822 6365  ..    @patch("ce
-00017df0: 7263 6973 2e66 696e 645f 7072 6f6a 6563  rcis.find_projec
-00017e00: 745f 726f 6f74 222c 206c 616d 6264 6120  t_root", lambda 
-00017e10: 2a61 7267 733a 2028 5448 4953 5f44 4952  *args: (THIS_DIR
-00017e20: 2e72 6573 6f6c 7665 2829 2c20 4e6f 6e65  .resolve(), None
-00017e30: 2929 0a20 2020 2064 6566 2074 6573 745f  )).    def test_
-00017e40: 6765 745f 736f 7572 6365 735f 7769 7468  get_sources_with
-00017e50: 5f73 7464 696e 5f66 696c 656e 616d 655f  _stdin_filename_
-00017e60: 616e 645f 6578 636c 7564 6528 7365 6c66  and_exclude(self
-00017e70: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-00017e80: 2020 2023 2045 7863 6c75 6465 2073 686f     # Exclude sho
-00017e90: 756c 646e 2774 2065 7863 6c75 6465 2073  uldn't exclude s
-00017ea0: 7464 696e 5f66 696c 656e 616d 6520 7369  tdin_filename si
-00017eb0: 6e63 6520 6974 2069 7320 6d69 6d69 636b  nce it is mimick
-00017ec0: 696e 6720 7468 650a 2020 2020 2020 2020  ing the.        
-00017ed0: 2320 6669 6c65 2062 6569 6e67 2070 6173  # file being pas
-00017ee0: 7365 6420 6469 7265 6374 6c79 2e20 5468  sed directly. Th
-00017ef0: 6973 2069 7320 7468 6520 7361 6d65 2061  is is the same a
-00017f00: 730a 2020 2020 2020 2020 2320 7465 7374  s.        # test
-00017f10: 5f65 7863 6c75 6465 5f66 6f72 5f69 7373  _exclude_for_iss
-00017f20: 7565 5f31 3537 320a 2020 2020 2020 2020  ue_1572.        
-00017f30: 7061 7468 203d 2044 4154 415f 4449 5220  path = DATA_DIR 
-00017f40: 2f20 2269 6e63 6c75 6465 5f65 7863 6c75  / "include_exclu
-00017f50: 6465 5f74 6573 7473 220a 2020 2020 2020  de_tests".      
-00017f60: 2020 7372 6320 3d20 5b22 2d22 5d0a 2020    src = ["-"].  
-00017f70: 2020 2020 2020 7374 6469 6e5f 6669 6c65        stdin_file
-00017f80: 6e61 6d65 203d 2073 7472 2870 6174 6820  name = str(path 
-00017f90: 2f20 2262 2f65 7863 6c75 6465 2f61 2e70  / "b/exclude/a.p
-00017fa0: 7922 290a 2020 2020 2020 2020 6578 7065  y").        expe
-00017fb0: 6374 6564 203d 205b 6622 5f5f 424c 4143  cted = [f"__BLAC
-00017fc0: 4b5f 5354 4449 4e5f 4649 4c45 4e41 4d45  K_STDIN_FILENAME
-00017fd0: 5f5f 7b73 7464 696e 5f66 696c 656e 616d  __{stdin_filenam
-00017fe0: 657d 225d 0a20 2020 2020 2020 2061 7373  e}"].        ass
-00017ff0: 6572 745f 636f 6c6c 6563 7465 645f 736f  ert_collected_so
-00018000: 7572 6365 7328 0a20 2020 2020 2020 2020  urces(.         
-00018010: 2020 2073 7263 2c0a 2020 2020 2020 2020     src,.        
-00018020: 2020 2020 6578 7065 6374 6564 2c0a 2020      expected,.  
-00018030: 2020 2020 2020 2020 2020 6578 636c 7564            exclud
-00018040: 653d 7222 2f65 7863 6c75 6465 2f7c 615c  e=r"/exclude/|a\
-00018050: 2e70 7922 2c0a 2020 2020 2020 2020 2020  .py",.          
-00018060: 2020 7374 6469 6e5f 6669 6c65 6e61 6d65    stdin_filename
-00018070: 3d73 7464 696e 5f66 696c 656e 616d 652c  =stdin_filename,
-00018080: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-00018090: 4070 6174 6368 2822 6365 7263 6973 2e66  @patch("cercis.f
-000180a0: 696e 645f 7072 6f6a 6563 745f 726f 6f74  ind_project_root
-000180b0: 222c 206c 616d 6264 6120 2a61 7267 733a  ", lambda *args:
-000180c0: 2028 5448 4953 5f44 4952 2e72 6573 6f6c   (THIS_DIR.resol
-000180d0: 7665 2829 2c20 4e6f 6e65 2929 0a20 2020  ve(), None)).   
-000180e0: 2064 6566 2074 6573 745f 6765 745f 736f   def test_get_so
-000180f0: 7572 6365 735f 7769 7468 5f73 7464 696e  urces_with_stdin
-00018100: 5f66 696c 656e 616d 655f 616e 645f 6578  _filename_and_ex
-00018110: 7465 6e64 5f65 7863 6c75 6465 2873 656c  tend_exclude(sel
-00018120: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
-00018130: 2020 2020 2320 4578 7465 6e64 2065 7863      # Extend exc
-00018140: 6c75 6465 2073 686f 756c 646e 2774 2065  lude shouldn't e
-00018150: 7863 6c75 6465 2073 7464 696e 5f66 696c  xclude stdin_fil
-00018160: 656e 616d 6520 7369 6e63 6520 6974 2069  ename since it i
-00018170: 7320 6d69 6d69 636b 696e 6720 7468 650a  s mimicking the.
-00018180: 2020 2020 2020 2020 2320 6669 6c65 2062          # file b
-00018190: 6569 6e67 2070 6173 7365 6420 6469 7265  eing passed dire
-000181a0: 6374 6c79 2e20 5468 6973 2069 7320 7468  ctly. This is th
-000181b0: 6520 7361 6d65 2061 730a 2020 2020 2020  e same as.      
-000181c0: 2020 2320 7465 7374 5f65 7863 6c75 6465    # test_exclude
-000181d0: 5f66 6f72 5f69 7373 7565 5f31 3537 320a  _for_issue_1572.
-000181e0: 2020 2020 2020 2020 7372 6320 3d20 5b22          src = ["
-000181f0: 2d22 5d0a 2020 2020 2020 2020 7061 7468  -"].        path
-00018200: 203d 2054 4849 535f 4449 5220 2f20 2264   = THIS_DIR / "d
-00018210: 6174 6122 202f 2022 696e 636c 7564 655f  ata" / "include_
-00018220: 6578 636c 7564 655f 7465 7374 7322 0a20  exclude_tests". 
-00018230: 2020 2020 2020 2073 7464 696e 5f66 696c         stdin_fil
-00018240: 656e 616d 6520 3d20 7374 7228 7061 7468  ename = str(path
-00018250: 202f 2022 622f 6578 636c 7564 652f 612e   / "b/exclude/a.
-00018260: 7079 2229 0a20 2020 2020 2020 2065 7870  py").        exp
-00018270: 6563 7465 6420 3d20 5b66 225f 5f42 4c41  ected = [f"__BLA
-00018280: 434b 5f53 5444 494e 5f46 494c 454e 414d  CK_STDIN_FILENAM
-00018290: 455f 5f7b 7374 6469 6e5f 6669 6c65 6e61  E__{stdin_filena
-000182a0: 6d65 7d22 5d0a 2020 2020 2020 2020 6173  me}"].        as
-000182b0: 7365 7274 5f63 6f6c 6c65 6374 6564 5f73  sert_collected_s
-000182c0: 6f75 7263 6573 280a 2020 2020 2020 2020  ources(.        
-000182d0: 2020 2020 7372 632c 0a20 2020 2020 2020      src,.       
-000182e0: 2020 2020 2065 7870 6563 7465 642c 0a20       expected,. 
-000182f0: 2020 2020 2020 2020 2020 2065 7874 656e             exten
-00018300: 645f 6578 636c 7564 653d 7222 2f65 7863  d_exclude=r"/exc
-00018310: 6c75 6465 2f7c 615c 2e70 7922 2c0a 2020  lude/|a\.py",.  
-00018320: 2020 2020 2020 2020 2020 7374 6469 6e5f            stdin_
-00018330: 6669 6c65 6e61 6d65 3d73 7464 696e 5f66  filename=stdin_f
-00018340: 696c 656e 616d 652c 0a20 2020 2020 2020  ilename,.       
-00018350: 2029 0a0a 2020 2020 4070 6174 6368 2822   )..    @patch("
-00018360: 6365 7263 6973 2e66 696e 645f 7072 6f6a  cercis.find_proj
-00018370: 6563 745f 726f 6f74 222c 206c 616d 6264  ect_root", lambd
-00018380: 6120 2a61 7267 733a 2028 5448 4953 5f44  a *args: (THIS_D
-00018390: 4952 2e72 6573 6f6c 7665 2829 2c20 4e6f  IR.resolve(), No
-000183a0: 6e65 2929 0a20 2020 2064 6566 2074 6573  ne)).    def tes
-000183b0: 745f 6765 745f 736f 7572 6365 735f 7769  t_get_sources_wi
-000183c0: 7468 5f73 7464 696e 5f66 696c 656e 616d  th_stdin_filenam
-000183d0: 655f 616e 645f 666f 7263 655f 6578 636c  e_and_force_excl
-000183e0: 7564 6528 7365 6c66 2920 2d3e 204e 6f6e  ude(self) -> Non
-000183f0: 653a 0a20 2020 2020 2020 2023 2046 6f72  e:.        # For
-00018400: 6365 2065 7863 6c75 6465 2073 686f 756c  ce exclude shoul
-00018410: 6420 6578 636c 7564 6520 7468 6520 6669  d exclude the fi
-00018420: 6c65 2077 6865 6e20 7061 7373 696e 6720  le when passing 
-00018430: 6974 2074 6872 6f75 6768 0a20 2020 2020  it through.     
-00018440: 2020 2023 2073 7464 696e 5f66 696c 656e     # stdin_filen
-00018450: 616d 650a 2020 2020 2020 2020 7061 7468  ame.        path
-00018460: 203d 2054 4849 535f 4449 5220 2f20 2264   = THIS_DIR / "d
-00018470: 6174 6122 202f 2022 696e 636c 7564 655f  ata" / "include_
-00018480: 6578 636c 7564 655f 7465 7374 7322 0a20  exclude_tests". 
-00018490: 2020 2020 2020 2073 7464 696e 5f66 696c         stdin_fil
-000184a0: 656e 616d 6520 3d20 7374 7228 7061 7468  ename = str(path
-000184b0: 202f 2022 622f 6578 636c 7564 652f 612e   / "b/exclude/a.
-000184c0: 7079 2229 0a20 2020 2020 2020 2061 7373  py").        ass
-000184d0: 6572 745f 636f 6c6c 6563 7465 645f 736f  ert_collected_so
-000184e0: 7572 6365 7328 0a20 2020 2020 2020 2020  urces(.         
-000184f0: 2020 2073 7263 3d5b 222d 225d 2c0a 2020     src=["-"],.  
-00018500: 2020 2020 2020 2020 2020 6578 7065 6374            expect
-00018510: 6564 3d5b 5d2c 0a20 2020 2020 2020 2020  ed=[],.         
-00018520: 2020 2066 6f72 6365 5f65 7863 6c75 6465     force_exclude
-00018530: 3d72 222f 6578 636c 7564 652f 7c61 5c2e  =r"/exclude/|a\.
-00018540: 7079 222c 0a20 2020 2020 2020 2020 2020  py",.           
-00018550: 2073 7464 696e 5f66 696c 656e 616d 653d   stdin_filename=
-00018560: 7374 6469 6e5f 6669 6c65 6e61 6d65 2c0a  stdin_filename,.
-00018570: 2020 2020 2020 2020 290a 0a0a 7472 793a          )...try:
-00018580: 0a20 2020 2077 6974 6820 6f70 656e 2863  .    with open(c
-00018590: 6572 6369 732e 5f5f 6669 6c65 5f5f 2c20  ercis.__file__, 
-000185a0: 2272 222c 2065 6e63 6f64 696e 673d 2275  "r", encoding="u
-000185b0: 7466 2d38 2229 2061 7320 5f62 663a 0a20  tf-8") as _bf:. 
-000185c0: 2020 2020 2020 2062 6c61 636b 5f73 6f75         black_sou
-000185d0: 7263 655f 6c69 6e65 7320 3d20 5f62 662e  rce_lines = _bf.
-000185e0: 7265 6164 6c69 6e65 7328 290a 6578 6365  readlines().exce
-000185f0: 7074 2055 6e69 636f 6465 4465 636f 6465  pt UnicodeDecode
-00018600: 4572 726f 723a 0a20 2020 2069 6620 6e6f  Error:.    if no
-00018610: 7420 6365 7263 6973 2e43 4f4d 5049 4c45  t cercis.COMPILE
-00018620: 443a 0a20 2020 2020 2020 2072 6169 7365  D:.        raise
-00018630: 0a0a 0a64 6566 2074 7261 6365 6675 6e63  ...def tracefunc
-00018640: 280a 2020 2020 2020 2020 6672 616d 653a  (.        frame:
-00018650: 2074 7970 6573 2e46 7261 6d65 5479 7065   types.FrameType
-00018660: 2c20 6576 656e 743a 2073 7472 2c20 6172  , event: str, ar
-00018670: 673a 2041 6e79 0a29 202d 3e20 4361 6c6c  g: Any.) -> Call
-00018680: 6162 6c65 5b5b 7479 7065 732e 4672 616d  able[[types.Fram
-00018690: 6554 7970 652c 2073 7472 2c20 416e 795d  eType, str, Any]
-000186a0: 2c20 416e 795d 3a0a 2020 2020 2222 2253  , Any]:.    """S
-000186b0: 686f 7720 6675 6e63 7469 6f6e 2063 616c  how function cal
-000186c0: 6c73 2060 6672 6f6d 2063 6572 6369 732f  ls `from cercis/
-000186d0: 5f5f 696e 6974 5f5f 2e70 7960 2061 7320  __init__.py` as 
-000186e0: 7468 6579 2068 6170 7065 6e2e 0a0a 2020  they happen...  
-000186f0: 2020 5265 6769 7374 6572 2074 6869 7320    Register this 
-00018700: 7769 7468 2060 7379 732e 7365 7474 7261  with `sys.settra
-00018710: 6365 2829 6020 696e 2061 2074 6573 7420  ce()` in a test 
-00018720: 796f 7527 7265 2064 6562 7567 6769 6e67  you're debugging
-00018730: 2e0a 2020 2020 2222 220a 2020 2020 6966  ..    """.    if
-00018740: 2065 7665 6e74 2021 3d20 2263 616c 6c22   event != "call"
-00018750: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-00018760: 2074 7261 6365 6675 6e63 0a0a 2020 2020   tracefunc..    
-00018770: 7374 6163 6b20 3d20 6c65 6e28 696e 7370  stack = len(insp
-00018780: 6563 742e 7374 6163 6b28 2929 202d 2031  ect.stack()) - 1
-00018790: 390a 2020 2020 7374 6163 6b20 2a3d 2032  9.    stack *= 2
-000187a0: 0a20 2020 2066 696c 656e 616d 6520 3d20  .    filename = 
-000187b0: 6672 616d 652e 665f 636f 6465 2e63 6f5f  frame.f_code.co_
-000187c0: 6669 6c65 6e61 6d65 0a20 2020 206c 696e  filename.    lin
-000187d0: 656e 6f20 3d20 6672 616d 652e 665f 6c69  eno = frame.f_li
-000187e0: 6e65 6e6f 0a20 2020 2066 756e 635f 7369  neno.    func_si
-000187f0: 675f 6c69 6e65 6e6f 203d 206c 696e 656e  g_lineno = linen
-00018800: 6f20 2d20 310a 2020 2020 6675 6e63 6e61  o - 1.    funcna
-00018810: 6d65 203d 2062 6c61 636b 5f73 6f75 7263  me = black_sourc
-00018820: 655f 6c69 6e65 735b 6675 6e63 5f73 6967  e_lines[func_sig
-00018830: 5f6c 696e 656e 6f5d 2e73 7472 6970 2829  _lineno].strip()
-00018840: 0a20 2020 2077 6869 6c65 2066 756e 636e  .    while funcn
-00018850: 616d 652e 7374 6172 7473 7769 7468 2822  ame.startswith("
-00018860: 4022 293a 0a20 2020 2020 2020 2066 756e  @"):.        fun
-00018870: 635f 7369 675f 6c69 6e65 6e6f 202b 3d20  c_sig_lineno += 
-00018880: 310a 2020 2020 2020 2020 6675 6e63 6e61  1.        funcna
-00018890: 6d65 203d 2062 6c61 636b 5f73 6f75 7263  me = black_sourc
-000188a0: 655f 6c69 6e65 735b 6675 6e63 5f73 6967  e_lines[func_sig
-000188b0: 5f6c 696e 656e 6f5d 2e73 7472 6970 2829  _lineno].strip()
-000188c0: 0a20 2020 2069 6620 2263 6572 6369 732f  .    if "cercis/
-000188d0: 5f5f 696e 6974 5f5f 2e70 7922 2069 6e20  __init__.py" in 
-000188e0: 6669 6c65 6e61 6d65 3a0a 2020 2020 2020  filename:.      
-000188f0: 2020 7072 696e 7428 6622 7b27 2027 202a    print(f"{' ' *
-00018900: 2073 7461 636b 7d7b 6c69 6e65 6e6f 7d3a   stack}{lineno}:
-00018910: 7b66 756e 636e 616d 657d 2229 0a20 2020  {funcname}").   
-00018920: 2072 6574 7572 6e20 7472 6163 6566 756e   return tracefun
-00018930: 630a                                     c.
+0000e870: 7273 696f 6e5f 6d61 7463 6865 735f 7665  rsion_matches_ve
+0000e880: 7273 696f 6e28 7365 6c66 2920 2d3e 204e  rsion(self) -> N
+0000e890: 6f6e 653a 0a20 2020 2020 2020 2073 656c  one:.        sel
+0000e8a0: 662e 696e 766f 6b65 426c 6163 6b28 0a20  f.invokeBlack(. 
+0000e8b0: 2020 2020 2020 2020 2020 205b 222d 2d72             ["--r
+0000e8c0: 6571 7569 7265 642d 7665 7273 696f 6e22  equired-version"
+0000e8d0: 2c20 6365 7263 6973 2e5f 5f76 6572 7369  , cercis.__versi
+0000e8e0: 6f6e 5f5f 2c20 222d 6322 2c20 2230 225d  on__, "-c", "0"]
+0000e8f0: 2c0a 2020 2020 2020 2020 2020 2020 6578  ,.            ex
+0000e900: 6974 5f63 6f64 653d 302c 0a20 2020 2020  it_code=0,.     
+0000e910: 2020 2020 2020 2069 676e 6f72 655f 636f         ignore_co
+0000e920: 6e66 6967 3d54 7275 652c 0a20 2020 2020  nfig=True,.     
+0000e930: 2020 2029 0a0a 2020 2020 6465 6620 7465     )..    def te
+0000e940: 7374 5f72 6571 7569 7265 645f 7665 7273  st_required_vers
+0000e950: 696f 6e5f 6d61 7463 6865 735f 7061 7274  ion_matches_part
+0000e960: 6961 6c5f 7665 7273 696f 6e28 7365 6c66  ial_version(self
+0000e970: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+0000e980: 2020 2073 656c 662e 696e 766f 6b65 426c     self.invokeBl
+0000e990: 6163 6b28 0a20 2020 2020 2020 2020 2020  ack(.           
+0000e9a0: 205b 222d 2d72 6571 7569 7265 642d 7665   ["--required-ve
+0000e9b0: 7273 696f 6e22 2c20 6365 7263 6973 2e5f  rsion", cercis._
+0000e9c0: 5f76 6572 7369 6f6e 5f5f 2e73 706c 6974  _version__.split
+0000e9d0: 2822 2e22 295b 305d 2c20 222d 6322 2c20  (".")[0], "-c", 
+0000e9e0: 2230 225d 2c0a 2020 2020 2020 2020 2020  "0"],.          
+0000e9f0: 2020 6578 6974 5f63 6f64 653d 302c 0a20    exit_code=0,. 
+0000ea00: 2020 2020 2020 2020 2020 2069 676e 6f72             ignor
+0000ea10: 655f 636f 6e66 6967 3d54 7275 652c 0a20  e_config=True,. 
+0000ea20: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
+0000ea30: 6620 7465 7374 5f72 6571 7569 7265 645f  f test_required_
+0000ea40: 7665 7273 696f 6e5f 646f 6573 5f6e 6f74  version_does_not
+0000ea50: 5f6d 6174 6368 5f6f 6e5f 6d69 6e6f 725f  _match_on_minor_
+0000ea60: 7665 7273 696f 6e28 7365 6c66 2920 2d3e  version(self) ->
+0000ea70: 204e 6f6e 653a 0a20 2020 2020 2020 2073   None:.        s
+0000ea80: 656c 662e 696e 766f 6b65 426c 6163 6b28  elf.invokeBlack(
+0000ea90: 0a20 2020 2020 2020 2020 2020 205b 0a20  .            [. 
+0000eaa0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+0000eab0: 2d2d 7265 7175 6972 6564 2d76 6572 7369  --required-versi
+0000eac0: 6f6e 222c 0a20 2020 2020 2020 2020 2020  on",.           
+0000ead0: 2020 2020 2063 6572 6369 732e 5f5f 7665       cercis.__ve
+0000eae0: 7273 696f 6e5f 5f2e 7370 6c69 7428 222e  rsion__.split(".
+0000eaf0: 2229 5b30 5d20 2b20 222e 3939 3922 2c0a  ")[0] + ".999",.
+0000eb00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000eb10: 222d 6322 2c0a 2020 2020 2020 2020 2020  "-c",.          
+0000eb20: 2020 2020 2020 2230 222c 0a20 2020 2020        "0",.     
+0000eb30: 2020 2020 2020 205d 2c0a 2020 2020 2020         ],.      
+0000eb40: 2020 2020 2020 6578 6974 5f63 6f64 653d        exit_code=
+0000eb50: 312c 0a20 2020 2020 2020 2020 2020 2069  1,.            i
+0000eb60: 676e 6f72 655f 636f 6e66 6967 3d54 7275  gnore_config=Tru
+0000eb70: 652c 0a20 2020 2020 2020 2029 0a0a 2020  e,.        )..  
+0000eb80: 2020 6465 6620 7465 7374 5f72 6571 7569    def test_requi
+0000eb90: 7265 645f 7665 7273 696f 6e5f 646f 6573  red_version_does
+0000eba0: 5f6e 6f74 5f6d 6174 6368 5f76 6572 7369  _not_match_versi
+0000ebb0: 6f6e 2873 656c 6629 202d 3e20 4e6f 6e65  on(self) -> None
+0000ebc0: 3a0a 2020 2020 2020 2020 7265 7375 6c74  :.        result
+0000ebd0: 203d 2042 6c61 636b 5275 6e6e 6572 2829   = BlackRunner()
+0000ebe0: 2e69 6e76 6f6b 6528 0a20 2020 2020 2020  .invoke(.       
+0000ebf0: 2020 2020 2063 6572 6369 732e 6d61 696e       cercis.main
+0000ec00: 2c0a 2020 2020 2020 2020 2020 2020 5b22  ,.            ["
+0000ec10: 2d2d 7265 7175 6972 6564 2d76 6572 7369  --required-versi
+0000ec20: 6f6e 222c 2022 3230 2e39 3962 222c 2022  on", "20.99b", "
+0000ec30: 2d63 222c 2022 3022 5d2c 0a20 2020 2020  -c", "0"],.     
+0000ec40: 2020 2029 0a20 2020 2020 2020 2073 656c     ).        sel
+0000ec50: 662e 6173 7365 7274 4571 7561 6c28 7265  f.assertEqual(re
+0000ec60: 7375 6c74 2e65 7869 745f 636f 6465 2c20  sult.exit_code, 
+0000ec70: 3129 0a20 2020 2020 2020 2073 656c 662e  1).        self.
+0000ec80: 6173 7365 7274 496e 2822 7265 7175 6972  assertIn("requir
+0000ec90: 6564 2076 6572 7369 6f6e 222c 2072 6573  ed version", res
+0000eca0: 756c 742e 7374 6465 7272 290a 0a20 2020  ult.stderr)..   
+0000ecb0: 2064 6566 2074 6573 745f 7072 6573 6572   def test_preser
+0000ecc0: 7665 735f 6c69 6e65 5f65 6e64 696e 6773  ves_line_endings
+0000ecd0: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
+0000ece0: 2020 2020 2020 2020 7769 7468 2054 656d          with Tem
+0000ecf0: 706f 7261 7279 4469 7265 6374 6f72 7928  poraryDirectory(
+0000ed00: 2920 6173 2077 6f72 6b73 7061 6365 3a0a  ) as workspace:.
+0000ed10: 2020 2020 2020 2020 2020 2020 7465 7374              test
+0000ed20: 5f66 696c 6520 3d20 5061 7468 2877 6f72  _file = Path(wor
+0000ed30: 6b73 7061 6365 2920 2f20 2274 6573 742e  kspace) / "test.
+0000ed40: 7079 220a 2020 2020 2020 2020 2020 2020  py".            
+0000ed50: 666f 7220 6e6c 2069 6e20 5b22 5c6e 222c  for nl in ["\n",
+0000ed60: 2022 5c72 5c6e 225d 3a0a 2020 2020 2020   "\r\n"]:.      
+0000ed70: 2020 2020 2020 2020 2020 636f 6e74 656e            conten
+0000ed80: 7473 203d 206e 6c2e 6a6f 696e 285b 2264  ts = nl.join(["d
+0000ed90: 6566 2066 2820 2029 3a22 2c20 2220 2020  ef f(  ):", "   
+0000eda0: 2070 6173 7322 5d29 0a20 2020 2020 2020   pass"]).       
+0000edb0: 2020 2020 2020 2020 2074 6573 745f 6669           test_fi
+0000edc0: 6c65 2e77 7269 7465 5f62 7974 6573 2863  le.write_bytes(c
+0000edd0: 6f6e 7465 6e74 732e 656e 636f 6465 2829  ontents.encode()
+0000ede0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000edf0: 2020 6666 2874 6573 745f 6669 6c65 2c20    ff(test_file, 
+0000ee00: 7772 6974 655f 6261 636b 3d63 6572 6369  write_back=cerci
+0000ee10: 732e 5772 6974 6542 6163 6b2e 5945 5329  s.WriteBack.YES)
+0000ee20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ee30: 2075 7064 6174 6564 5f63 6f6e 7465 6e74   updated_content
+0000ee40: 733a 2062 7974 6573 203d 2074 6573 745f  s: bytes = test_
+0000ee50: 6669 6c65 2e72 6561 645f 6279 7465 7328  file.read_bytes(
+0000ee60: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000ee70: 2020 7365 6c66 2e61 7373 6572 7449 6e28    self.assertIn(
+0000ee80: 6e6c 2e65 6e63 6f64 6528 292c 2075 7064  nl.encode(), upd
+0000ee90: 6174 6564 5f63 6f6e 7465 6e74 7329 0a20  ated_contents). 
+0000eea0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000eeb0: 6620 6e6c 203d 3d20 225c 6e22 3a0a 2020  f nl == "\n":.  
+0000eec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000eed0: 2020 7365 6c66 2e61 7373 6572 744e 6f74    self.assertNot
+0000eee0: 496e 2862 225c 725c 6e22 2c20 7570 6461  In(b"\r\n", upda
+0000eef0: 7465 645f 636f 6e74 656e 7473 290a 0a20  ted_contents).. 
+0000ef00: 2020 2064 6566 2074 6573 745f 7072 6573     def test_pres
+0000ef10: 6572 7665 735f 6c69 6e65 5f65 6e64 696e  erves_line_endin
+0000ef20: 6773 5f76 6961 5f73 7464 696e 2873 656c  gs_via_stdin(sel
+0000ef30: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
+0000ef40: 2020 2020 666f 7220 6e6c 2069 6e20 5b22      for nl in ["
+0000ef50: 5c6e 222c 2022 5c72 5c6e 225d 3a0a 2020  \n", "\r\n"]:.  
+0000ef60: 2020 2020 2020 2020 2020 636f 6e74 656e            conten
+0000ef70: 7473 203d 206e 6c2e 6a6f 696e 285b 2264  ts = nl.join(["d
+0000ef80: 6566 2066 2820 2029 3a22 2c20 2220 2020  ef f(  ):", "   
+0000ef90: 2070 6173 7322 5d29 0a20 2020 2020 2020   pass"]).       
+0000efa0: 2020 2020 2072 756e 6e65 7220 3d20 426c       runner = Bl
+0000efb0: 6163 6b52 756e 6e65 7228 290a 2020 2020  ackRunner().    
+0000efc0: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
+0000efd0: 2072 756e 6e65 722e 696e 766f 6b65 280a   runner.invoke(.
+0000efe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000eff0: 6365 7263 6973 2e6d 6169 6e2c 205b 222d  cercis.main, ["-
+0000f000: 222c 2022 2d2d 6661 7374 225d 2c20 696e  ", "--fast"], in
+0000f010: 7075 743d 4279 7465 7349 4f28 636f 6e74  put=BytesIO(cont
+0000f020: 656e 7473 2e65 6e63 6f64 6528 2275 7466  ents.encode("utf
+0000f030: 3822 2929 0a20 2020 2020 2020 2020 2020  8")).           
+0000f040: 2029 0a20 2020 2020 2020 2020 2020 2073   ).            s
+0000f050: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+0000f060: 7265 7375 6c74 2e65 7869 745f 636f 6465  result.exit_code
+0000f070: 2c20 3029 0a20 2020 2020 2020 2020 2020  , 0).           
+0000f080: 206f 7574 7075 7420 3d20 7265 7375 6c74   output = result
+0000f090: 2e73 7464 6f75 745f 6279 7465 730a 2020  .stdout_bytes.  
+0000f0a0: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+0000f0b0: 7373 6572 7449 6e28 6e6c 2e65 6e63 6f64  ssertIn(nl.encod
+0000f0c0: 6528 2275 7466 3822 292c 206f 7574 7075  e("utf8"), outpu
+0000f0d0: 7429 0a20 2020 2020 2020 2020 2020 2069  t).            i
+0000f0e0: 6620 6e6c 203d 3d20 225c 6e22 3a0a 2020  f nl == "\n":.  
+0000f0f0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0000f100: 6c66 2e61 7373 6572 744e 6f74 496e 2862  lf.assertNotIn(b
+0000f110: 225c 725c 6e22 2c20 6f75 7470 7574 290a  "\r\n", output).
+0000f120: 0a20 2020 2064 6566 2074 6573 745f 6e6f  .    def test_no
+0000f130: 726d 616c 697a 655f 6c69 6e65 5f65 6e64  rmalize_line_end
+0000f140: 696e 6773 2873 656c 6629 202d 3e20 4e6f  ings(self) -> No
+0000f150: 6e65 3a0a 2020 2020 2020 2020 7769 7468  ne:.        with
+0000f160: 2054 656d 706f 7261 7279 4469 7265 6374   TemporaryDirect
+0000f170: 6f72 7928 2920 6173 2077 6f72 6b73 7061  ory() as workspa
+0000f180: 6365 3a0a 2020 2020 2020 2020 2020 2020  ce:.            
+0000f190: 7465 7374 5f66 696c 6520 3d20 5061 7468  test_file = Path
+0000f1a0: 2877 6f72 6b73 7061 6365 2920 2f20 2274  (workspace) / "t
+0000f1b0: 6573 742e 7079 220a 2020 2020 2020 2020  est.py".        
+0000f1c0: 2020 2020 666f 7220 6461 7461 2c20 6578      for data, ex
+0000f1d0: 7065 6374 6564 2069 6e20 280a 2020 2020  pected in (.    
+0000f1e0: 2020 2020 2020 2020 2020 2020 2862 2263              (b"c
+0000f1f0: 5c72 5c6e 635c 6e20 222c 2062 2263 5c72  \r\nc\n ", b"c\r
+0000f200: 5c6e 635c 725c 6e22 292c 0a20 2020 2020  \nc\r\n"),.     
+0000f210: 2020 2020 2020 2020 2020 2028 6222 6c5c             (b"l\
+0000f220: 6e6c 5c72 5c6e 2022 2c20 6222 6c5c 6e6c  nl\r\n ", b"l\nl
+0000f230: 5c6e 2229 2c0a 2020 2020 2020 2020 2020  \n"),.          
+0000f240: 2020 293a 0a20 2020 2020 2020 2020 2020    ):.           
+0000f250: 2020 2020 2074 6573 745f 6669 6c65 2e77       test_file.w
+0000f260: 7269 7465 5f62 7974 6573 2864 6174 6129  rite_bytes(data)
+0000f270: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000f280: 2066 6628 7465 7374 5f66 696c 652c 2077   ff(test_file, w
+0000f290: 7269 7465 5f62 6163 6b3d 6365 7263 6973  rite_back=cercis
+0000f2a0: 2e57 7269 7465 4261 636b 2e59 4553 290a  .WriteBack.YES).
+0000f2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f2c0: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+0000f2d0: 2874 6573 745f 6669 6c65 2e72 6561 645f  (test_file.read_
+0000f2e0: 6279 7465 7328 292c 2065 7870 6563 7465  bytes(), expecte
+0000f2f0: 6429 0a0a 2020 2020 6465 6620 7465 7374  d)..    def test
+0000f300: 5f61 7373 6572 745f 6571 7569 7661 6c65  _assert_equivale
+0000f310: 6e74 5f64 6966 6665 7265 6e74 5f61 7374  nt_different_ast
+0000f320: 7328 7365 6c66 2920 2d3e 204e 6f6e 653a  s(self) -> None:
+0000f330: 0a20 2020 2020 2020 2077 6974 6820 7365  .        with se
+0000f340: 6c66 2e61 7373 6572 7452 6169 7365 7328  lf.assertRaises(
+0000f350: 4173 7365 7274 696f 6e45 7272 6f72 293a  AssertionError):
+0000f360: 0a20 2020 2020 2020 2020 2020 2063 6572  .            cer
+0000f370: 6369 732e 6173 7365 7274 5f65 7175 6976  cis.assert_equiv
+0000f380: 616c 656e 7428 227b 7d22 2c20 224e 6f6e  alent("{}", "Non
+0000f390: 6522 290a 0a20 2020 2064 6566 2074 6573  e")..    def tes
+0000f3a0: 745f 7368 6868 5f63 6c69 636b 2873 656c  t_shhh_click(sel
+0000f3b0: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
+0000f3c0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+0000f3d0: 2020 2020 2066 726f 6d20 636c 6963 6b20       from click 
+0000f3e0: 696d 706f 7274 205f 756e 6963 6f64 6566  import _unicodef
+0000f3f0: 756e 2020 2320 7479 7065 3a20 6967 6e6f  un  # type: igno
+0000f400: 7265 0a20 2020 2020 2020 2065 7863 6570  re.        excep
+0000f410: 7420 496d 706f 7274 4572 726f 723a 0a20  t ImportError:. 
+0000f420: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000f430: 736b 6970 5465 7374 2822 496e 636f 6d70  skipTest("Incomp
+0000f440: 6174 6962 6c65 2043 6c69 636b 2076 6572  atible Click ver
+0000f450: 7369 6f6e 2229 0a0a 2020 2020 2020 2020  sion")..        
+0000f460: 6966 206e 6f74 2068 6173 6174 7472 285f  if not hasattr(_
+0000f470: 756e 6963 6f64 6566 756e 2c20 225f 7665  unicodefun, "_ve
+0000f480: 7269 6679 5f70 7974 686f 6e5f 656e 7622  rify_python_env"
+0000f490: 293a 0a20 2020 2020 2020 2020 2020 2073  ):.            s
+0000f4a0: 656c 662e 736b 6970 5465 7374 2822 496e  elf.skipTest("In
+0000f4b0: 636f 6d70 6174 6962 6c65 2043 6c69 636b  compatible Click
+0000f4c0: 2076 6572 7369 6f6e 2229 0a0a 2020 2020   version")..    
+0000f4d0: 2020 2020 2320 4669 7273 742c 206c 6574      # First, let
+0000f4e0: 2773 2073 6565 2069 6620 436c 6963 6b20  's see if Click 
+0000f4f0: 6973 2063 7261 7368 696e 6720 7769 7468  is crashing with
+0000f500: 2061 2070 7265 6665 7272 6564 2041 5343   a preferred ASC
+0000f510: 4949 2063 6861 7273 6574 2e0a 2020 2020  II charset..    
+0000f520: 2020 2020 7769 7468 2070 6174 6368 2822      with patch("
+0000f530: 6c6f 6361 6c65 2e67 6574 7072 6566 6572  locale.getprefer
+0000f540: 7265 6465 6e63 6f64 696e 6722 2920 6173  redencoding") as
+0000f550: 2067 7065 3a0a 2020 2020 2020 2020 2020   gpe:.          
+0000f560: 2020 6770 652e 7265 7475 726e 5f76 616c    gpe.return_val
+0000f570: 7565 203d 2022 4153 4349 4922 0a20 2020  ue = "ASCII".   
+0000f580: 2020 2020 2020 2020 2077 6974 6820 7365           with se
+0000f590: 6c66 2e61 7373 6572 7452 6169 7365 7328  lf.assertRaises(
+0000f5a0: 5275 6e74 696d 6545 7272 6f72 293a 0a20  RuntimeError):. 
+0000f5b0: 2020 2020 2020 2020 2020 2020 2020 205f                 _
+0000f5c0: 756e 6963 6f64 6566 756e 2e5f 7665 7269  unicodefun._veri
+0000f5d0: 6679 5f70 7974 686f 6e5f 656e 7628 290a  fy_python_env().
+0000f5e0: 2020 2020 2020 2020 2320 4e6f 772c 206c          # Now, l
+0000f5f0: 6574 2773 2073 696c 656e 6365 2043 6c69  et's silence Cli
+0000f600: 636b 2e2e 2e0a 2020 2020 2020 2020 6365  ck....        ce
+0000f610: 7263 6973 2e70 6174 6368 5f63 6c69 636b  rcis.patch_click
+0000f620: 2829 0a20 2020 2020 2020 2023 202e 2e2e  ().        # ...
+0000f630: 616e 6420 636f 6e66 6972 6d20 6974 2773  and confirm it's
+0000f640: 2073 696c 656e 742e 0a20 2020 2020 2020   silent..       
+0000f650: 2077 6974 6820 7061 7463 6828 226c 6f63   with patch("loc
+0000f660: 616c 652e 6765 7470 7265 6665 7272 6564  ale.getpreferred
+0000f670: 656e 636f 6469 6e67 2229 2061 7320 6770  encoding") as gp
+0000f680: 653a 0a20 2020 2020 2020 2020 2020 2067  e:.            g
+0000f690: 7065 2e72 6574 7572 6e5f 7661 6c75 6520  pe.return_value 
+0000f6a0: 3d20 2241 5343 4949 220a 2020 2020 2020  = "ASCII".      
+0000f6b0: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+0000f6c0: 2020 2020 2020 2020 2020 205f 756e 6963             _unic
+0000f6d0: 6f64 6566 756e 2e5f 7665 7269 6679 5f70  odefun._verify_p
+0000f6e0: 7974 686f 6e5f 656e 7628 290a 2020 2020  ython_env().    
+0000f6f0: 2020 2020 2020 2020 6578 6365 7074 2052          except R
+0000f700: 756e 7469 6d65 4572 726f 7220 6173 2072  untimeError as r
+0000f710: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0000f720: 2020 2073 656c 662e 6661 696c 2866 2260     self.fail(f"`
+0000f730: 7061 7463 685f 636c 6963 6b28 2960 2066  patch_click()` f
+0000f740: 6169 6c65 642c 2065 7863 6570 7469 6f6e  ailed, exception
+0000f750: 2073 7469 6c6c 2072 6169 7365 643a 207b   still raised: {
+0000f760: 7265 7d22 290a 0a20 2020 2064 6566 2074  re}")..    def t
+0000f770: 6573 745f 726f 6f74 5f6c 6f67 6765 725f  est_root_logger_
+0000f780: 6e6f 745f 7573 6564 5f64 6972 6563 746c  not_used_directl
+0000f790: 7928 7365 6c66 2920 2d3e 204e 6f6e 653a  y(self) -> None:
+0000f7a0: 0a20 2020 2020 2020 2064 6566 2066 6169  .        def fai
+0000f7b0: 6c28 2a61 7267 733a 2041 6e79 2c20 2a2a  l(*args: Any, **
+0000f7c0: 6b77 6172 6773 3a20 416e 7929 202d 3e20  kwargs: Any) -> 
+0000f7d0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+0000f7e0: 2020 7365 6c66 2e66 6169 6c28 2252 6563    self.fail("Rec
+0000f7f0: 6f72 6420 6372 6561 7465 6420 7769 7468  ord created with
+0000f800: 2072 6f6f 7420 6c6f 6767 6572 2229 0a0a   root logger")..
+0000f810: 2020 2020 2020 2020 7769 7468 2070 6174          with pat
+0000f820: 6368 2e6d 756c 7469 706c 6528 0a20 2020  ch.multiple(.   
+0000f830: 2020 2020 2020 2020 206c 6f67 6769 6e67           logging
+0000f840: 2e72 6f6f 742c 0a20 2020 2020 2020 2020  .root,.         
+0000f850: 2020 2064 6562 7567 3d66 6169 6c2c 0a20     debug=fail,. 
+0000f860: 2020 2020 2020 2020 2020 2069 6e66 6f3d             info=
+0000f870: 6661 696c 2c0a 2020 2020 2020 2020 2020  fail,.          
+0000f880: 2020 7761 726e 696e 673d 6661 696c 2c0a    warning=fail,.
+0000f890: 2020 2020 2020 2020 2020 2020 6572 726f              erro
+0000f8a0: 723d 6661 696c 2c0a 2020 2020 2020 2020  r=fail,.        
+0000f8b0: 2020 2020 6372 6974 6963 616c 3d66 6169      critical=fai
+0000f8c0: 6c2c 0a20 2020 2020 2020 2020 2020 206c  l,.            l
+0000f8d0: 6f67 3d66 6169 6c2c 0a20 2020 2020 2020  og=fail,.       
+0000f8e0: 2029 3a0a 2020 2020 2020 2020 2020 2020   ):.            
+0000f8f0: 6666 2854 4849 535f 4449 5220 2f20 2275  ff(THIS_DIR / "u
+0000f900: 7469 6c2e 7079 2229 0a0a 2020 2020 6465  til.py")..    de
+0000f910: 6620 7465 7374 5f69 6e76 616c 6964 5f63  f test_invalid_c
+0000f920: 6f6e 6669 675f 7265 7475 726e 5f63 6f64  onfig_return_cod
+0000f930: 6528 7365 6c66 2920 2d3e 204e 6f6e 653a  e(self) -> None:
+0000f940: 0a20 2020 2020 2020 2074 6d70 5f66 696c  .        tmp_fil
+0000f950: 6520 3d20 5061 7468 2863 6572 6369 732e  e = Path(cercis.
+0000f960: 6475 6d70 5f74 6f5f 6669 6c65 2829 290a  dump_to_file()).
+0000f970: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+0000f980: 2020 2020 2020 2020 2074 6d70 5f63 6f6e           tmp_con
+0000f990: 6669 6720 3d20 5061 7468 2863 6572 6369  fig = Path(cerci
+0000f9a0: 732e 6475 6d70 5f74 6f5f 6669 6c65 2829  s.dump_to_file()
+0000f9b0: 290a 2020 2020 2020 2020 2020 2020 746d  ).            tm
+0000f9c0: 705f 636f 6e66 6967 2e75 6e6c 696e 6b28  p_config.unlink(
+0000f9d0: 290a 2020 2020 2020 2020 2020 2020 6172  ).            ar
+0000f9e0: 6773 203d 205b 222d 2d63 6f6e 6669 6722  gs = ["--config"
+0000f9f0: 2c20 7374 7228 746d 705f 636f 6e66 6967  , str(tmp_config
+0000fa00: 292c 2073 7472 2874 6d70 5f66 696c 6529  ), str(tmp_file)
+0000fa10: 5d0a 2020 2020 2020 2020 2020 2020 7365  ].            se
+0000fa20: 6c66 2e69 6e76 6f6b 6542 6c61 636b 2861  lf.invokeBlack(a
+0000fa30: 7267 732c 2065 7869 745f 636f 6465 3d32  rgs, exit_code=2
+0000fa40: 2c20 6967 6e6f 7265 5f63 6f6e 6669 673d  , ignore_config=
+0000fa50: 4661 6c73 6529 0a20 2020 2020 2020 2066  False).        f
+0000fa60: 696e 616c 6c79 3a0a 2020 2020 2020 2020  inally:.        
+0000fa70: 2020 2020 746d 705f 6669 6c65 2e75 6e6c      tmp_file.unl
+0000fa80: 696e 6b28 290a 0a20 2020 2064 6566 2074  ink()..    def t
+0000fa90: 6573 745f 7061 7273 655f 7079 7072 6f6a  est_parse_pyproj
+0000faa0: 6563 745f 746f 6d6c 2873 656c 6629 202d  ect_toml(self) -
+0000fab0: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+0000fac0: 7465 7374 5f74 6f6d 6c5f 6669 6c65 203d  test_toml_file =
+0000fad0: 2054 4849 535f 4449 5220 2f20 2274 6573   THIS_DIR / "tes
+0000fae0: 742e 746f 6d6c 220a 2020 2020 2020 2020  t.toml".        
+0000faf0: 636f 6e66 6967 203d 2063 6572 6369 732e  config = cercis.
+0000fb00: 7061 7273 655f 7079 7072 6f6a 6563 745f  parse_pyproject_
+0000fb10: 746f 6d6c 2873 7472 2874 6573 745f 746f  toml(str(test_to
+0000fb20: 6d6c 5f66 696c 6529 290a 2020 2020 2020  ml_file)).      
+0000fb30: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+0000fb40: 616c 2863 6f6e 6669 675b 2276 6572 626f  al(config["verbo
+0000fb50: 7365 225d 2c20 3129 0a20 2020 2020 2020  se"], 1).       
+0000fb60: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+0000fb70: 6c28 636f 6e66 6967 5b22 6368 6563 6b22  l(config["check"
+0000fb80: 5d2c 2022 6e6f 2229 0a20 2020 2020 2020  ], "no").       
+0000fb90: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+0000fba0: 6c28 636f 6e66 6967 5b22 6469 6666 225d  l(config["diff"]
+0000fbb0: 2c20 2279 2229 0a20 2020 2020 2020 2073  , "y").        s
+0000fbc0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+0000fbd0: 636f 6e66 6967 5b22 636f 6c6f 7222 5d2c  config["color"],
+0000fbe0: 2054 7275 6529 0a20 2020 2020 2020 2073   True).        s
+0000fbf0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+0000fc00: 636f 6e66 6967 5b22 6c69 6e65 5f6c 656e  config["line_len
+0000fc10: 6774 6822 5d2c 2037 3929 0a20 2020 2020  gth"], 79).     
+0000fc20: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+0000fc30: 7561 6c28 636f 6e66 6967 5b22 7461 7267  ual(config["targ
+0000fc40: 6574 5f76 6572 7369 6f6e 225d 2c20 5b22  et_version"], ["
+0000fc50: 7079 3336 222c 2022 7079 3337 222c 2022  py36", "py37", "
+0000fc60: 7079 3338 225d 290a 2020 2020 2020 2020  py38"]).        
+0000fc70: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+0000fc80: 2863 6f6e 6669 675b 2270 7974 686f 6e5f  (config["python_
+0000fc90: 6365 6c6c 5f6d 6167 6963 7322 5d2c 205b  cell_magics"], [
+0000fca0: 2263 7573 746f 6d31 222c 2022 6375 7374  "custom1", "cust
+0000fcb0: 6f6d 3222 5d29 0a20 2020 2020 2020 2073  om2"]).        s
+0000fcc0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+0000fcd0: 636f 6e66 6967 5b22 6578 636c 7564 6522  config["exclude"
+0000fce0: 5d2c 2072 225c 2e70 7969 3f24 2229 0a20  ], r"\.pyi?$"). 
+0000fcf0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+0000fd00: 7274 4571 7561 6c28 636f 6e66 6967 5b22  rtEqual(config["
+0000fd10: 696e 636c 7564 6522 5d2c 2072 225c 2e70  include"], r"\.p
+0000fd20: 793f 2422 290a 0a20 2020 2064 6566 2074  y?$")..    def t
+0000fd30: 6573 745f 7061 7273 655f 7079 7072 6f6a  est_parse_pyproj
+0000fd40: 6563 745f 746f 6d6c 5f70 726f 6a65 6374  ect_toml_project
+0000fd50: 5f6d 6574 6164 6174 6128 7365 6c66 2920  _metadata(self) 
+0000fd60: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
+0000fd70: 2066 6f72 2074 6573 745f 746f 6d6c 2c20   for test_toml, 
+0000fd80: 6578 7065 6374 6564 2069 6e20 5b0a 2020  expected in [.  
+0000fd90: 2020 2020 2020 2020 2020 2822 6f6e 6c79            ("only
+0000fda0: 5f62 6c61 636b 5f70 7970 726f 6a65 6374  _black_pyproject
+0000fdb0: 2e74 6f6d 6c22 2c20 5b22 7079 3331 3022  .toml", ["py310"
+0000fdc0: 5d29 2c0a 2020 2020 2020 2020 2020 2020  ]),.            
+0000fdd0: 2822 6f6e 6c79 5f6d 6574 6164 6174 615f  ("only_metadata_
+0000fde0: 7079 7072 6f6a 6563 742e 746f 6d6c 222c  pyproject.toml",
+0000fdf0: 205b 2270 7933 3722 2c20 2270 7933 3822   ["py37", "py38"
+0000fe00: 2c20 2270 7933 3922 2c20 2270 7933 3130  , "py39", "py310
+0000fe10: 225d 292c 0a20 2020 2020 2020 2020 2020  "]),.           
+0000fe20: 2028 226e 6569 7468 6572 5f70 7970 726f   ("neither_pypro
+0000fe30: 6a65 6374 2e74 6f6d 6c22 2c20 4e6f 6e65  ject.toml", None
+0000fe40: 292c 0a20 2020 2020 2020 2020 2020 2028  ),.            (
+0000fe50: 2262 6f74 685f 7079 7072 6f6a 6563 742e  "both_pyproject.
+0000fe60: 746f 6d6c 222c 205b 2270 7933 3130 225d  toml", ["py310"]
+0000fe70: 292c 0a20 2020 2020 2020 205d 3a0a 2020  ),.        ]:.  
+0000fe80: 2020 2020 2020 2020 2020 7465 7374 5f74            test_t
+0000fe90: 6f6d 6c5f 6669 6c65 203d 2054 4849 535f  oml_file = THIS_
+0000fea0: 4449 5220 2f20 2264 6174 6122 202f 2022  DIR / "data" / "
+0000feb0: 7072 6f6a 6563 745f 6d65 7461 6461 7461  project_metadata
+0000fec0: 2220 2f20 7465 7374 5f74 6f6d 6c0a 2020  " / test_toml.  
+0000fed0: 2020 2020 2020 2020 2020 636f 6e66 6967            config
+0000fee0: 203d 2063 6572 6369 732e 7061 7273 655f   = cercis.parse_
+0000fef0: 7079 7072 6f6a 6563 745f 746f 6d6c 2873  pyproject_toml(s
+0000ff00: 7472 2874 6573 745f 746f 6d6c 5f66 696c  tr(test_toml_fil
+0000ff10: 6529 290a 2020 2020 2020 2020 2020 2020  e)).            
+0000ff20: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+0000ff30: 2863 6f6e 6669 672e 6765 7428 2274 6172  (config.get("tar
+0000ff40: 6765 745f 7665 7273 696f 6e22 292c 2065  get_version"), e
+0000ff50: 7870 6563 7465 6429 0a0a 2020 2020 6465  xpected)..    de
+0000ff60: 6620 7465 7374 5f69 6e66 6572 5f74 6172  f test_infer_tar
+0000ff70: 6765 745f 7665 7273 696f 6e28 7365 6c66  get_version(self
+0000ff80: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+0000ff90: 2020 2066 6f72 2076 6572 7369 6f6e 2c20     for version, 
+0000ffa0: 6578 7065 6374 6564 2069 6e20 5b0a 2020  expected in [.  
+0000ffb0: 2020 2020 2020 2020 2020 2822 332e 3622            ("3.6"
+0000ffc0: 2c20 5b54 6172 6765 7456 6572 7369 6f6e  , [TargetVersion
+0000ffd0: 2e50 5933 365d 292c 0a20 2020 2020 2020  .PY36]),.       
+0000ffe0: 2020 2020 2028 2233 2e31 312e 3072 6331       ("3.11.0rc1
+0000fff0: 222c 205b 5461 7267 6574 5665 7273 696f  ", [TargetVersio
+00010000: 6e2e 5059 3331 315d 292c 0a20 2020 2020  n.PY311]),.     
+00010010: 2020 2020 2020 2028 223e 3d33 2e31 3022         (">=3.10"
+00010020: 2c20 5b54 6172 6765 7456 6572 7369 6f6e  , [TargetVersion
+00010030: 2e50 5933 3130 2c20 5461 7267 6574 5665  .PY310, TargetVe
+00010040: 7273 696f 6e2e 5059 3331 315d 292c 0a20  rsion.PY311]),. 
+00010050: 2020 2020 2020 2020 2020 2028 223e 3d33             (">=3
+00010060: 2e31 302e 3622 2c20 5b54 6172 6765 7456  .10.6", [TargetV
+00010070: 6572 7369 6f6e 2e50 5933 3130 2c20 5461  ersion.PY310, Ta
+00010080: 7267 6574 5665 7273 696f 6e2e 5059 3331  rgetVersion.PY31
+00010090: 315d 292c 0a20 2020 2020 2020 2020 2020  1]),.           
+000100a0: 2028 223c 332e 3622 2c20 5b54 6172 6765   ("<3.6", [Targe
+000100b0: 7456 6572 7369 6f6e 2e50 5933 332c 2054  tVersion.PY33, T
+000100c0: 6172 6765 7456 6572 7369 6f6e 2e50 5933  argetVersion.PY3
+000100d0: 342c 2054 6172 6765 7456 6572 7369 6f6e  4, TargetVersion
+000100e0: 2e50 5933 355d 292c 0a20 2020 2020 2020  .PY35]),.       
+000100f0: 2020 2020 2028 223e 332e 372c 3c33 2e31       (">3.7,<3.1
+00010100: 3022 2c20 5b54 6172 6765 7456 6572 7369  0", [TargetVersi
+00010110: 6f6e 2e50 5933 382c 2054 6172 6765 7456  on.PY38, TargetV
+00010120: 6572 7369 6f6e 2e50 5933 395d 292c 0a20  ersion.PY39]),. 
+00010130: 2020 2020 2020 2020 2020 2028 223e 332e             (">3.
+00010140: 372c 213d 332e 382c 213d 332e 3922 2c20  7,!=3.8,!=3.9", 
+00010150: 5b54 6172 6765 7456 6572 7369 6f6e 2e50  [TargetVersion.P
+00010160: 5933 3130 2c20 5461 7267 6574 5665 7273  Y310, TargetVers
+00010170: 696f 6e2e 5059 3331 315d 292c 0a20 2020  ion.PY311]),.   
+00010180: 2020 2020 2020 2020 2028 0a20 2020 2020           (.     
+00010190: 2020 2020 2020 2020 2020 2022 3e20 332e             "> 3.
+000101a0: 392e 342c 2021 3d20 332e 3130 2e33 222c  9.4, != 3.10.3",
+000101b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000101c0: 205b 5461 7267 6574 5665 7273 696f 6e2e   [TargetVersion.
+000101d0: 5059 3339 2c20 5461 7267 6574 5665 7273  PY39, TargetVers
+000101e0: 696f 6e2e 5059 3331 302c 2054 6172 6765  ion.PY310, Targe
+000101f0: 7456 6572 7369 6f6e 2e50 5933 3131 5d2c  tVersion.PY311],
+00010200: 0a20 2020 2020 2020 2020 2020 2029 2c0a  .            ),.
+00010210: 2020 2020 2020 2020 2020 2020 280a 2020              (.  
+00010220: 2020 2020 2020 2020 2020 2020 2020 2221                "!
+00010230: 3d33 2e33 2c21 3d33 2e34 222c 0a20 2020  =3.3,!=3.4",.   
+00010240: 2020 2020 2020 2020 2020 2020 205b 0a20               [. 
+00010250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010260: 2020 2054 6172 6765 7456 6572 7369 6f6e     TargetVersion
+00010270: 2e50 5933 352c 0a20 2020 2020 2020 2020  .PY35,.         
+00010280: 2020 2020 2020 2020 2020 2054 6172 6765             Targe
+00010290: 7456 6572 7369 6f6e 2e50 5933 362c 0a20  tVersion.PY36,. 
+000102a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000102b0: 2020 2054 6172 6765 7456 6572 7369 6f6e     TargetVersion
+000102c0: 2e50 5933 372c 0a20 2020 2020 2020 2020  .PY37,.         
+000102d0: 2020 2020 2020 2020 2020 2054 6172 6765             Targe
+000102e0: 7456 6572 7369 6f6e 2e50 5933 382c 0a20  tVersion.PY38,. 
+000102f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010300: 2020 2054 6172 6765 7456 6572 7369 6f6e     TargetVersion
+00010310: 2e50 5933 392c 0a20 2020 2020 2020 2020  .PY39,.         
+00010320: 2020 2020 2020 2020 2020 2054 6172 6765             Targe
+00010330: 7456 6572 7369 6f6e 2e50 5933 3130 2c0a  tVersion.PY310,.
+00010340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010350: 2020 2020 5461 7267 6574 5665 7273 696f      TargetVersio
+00010360: 6e2e 5059 3331 312c 0a20 2020 2020 2020  n.PY311,.       
+00010370: 2020 2020 2020 2020 205d 2c0a 2020 2020           ],.    
+00010380: 2020 2020 2020 2020 292c 0a20 2020 2020          ),.     
+00010390: 2020 2020 2020 2028 0a20 2020 2020 2020         (.       
+000103a0: 2020 2020 2020 2020 2022 3d3d 332e 2a22           "==3.*"
+000103b0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000103c0: 2020 5b0a 2020 2020 2020 2020 2020 2020    [.            
+000103d0: 2020 2020 2020 2020 5461 7267 6574 5665          TargetVe
+000103e0: 7273 696f 6e2e 5059 3333 2c0a 2020 2020  rsion.PY33,.    
+000103f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010400: 5461 7267 6574 5665 7273 696f 6e2e 5059  TargetVersion.PY
+00010410: 3334 2c0a 2020 2020 2020 2020 2020 2020  34,.            
+00010420: 2020 2020 2020 2020 5461 7267 6574 5665          TargetVe
+00010430: 7273 696f 6e2e 5059 3335 2c0a 2020 2020  rsion.PY35,.    
+00010440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010450: 5461 7267 6574 5665 7273 696f 6e2e 5059  TargetVersion.PY
+00010460: 3336 2c0a 2020 2020 2020 2020 2020 2020  36,.            
+00010470: 2020 2020 2020 2020 5461 7267 6574 5665          TargetVe
+00010480: 7273 696f 6e2e 5059 3337 2c0a 2020 2020  rsion.PY37,.    
+00010490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000104a0: 5461 7267 6574 5665 7273 696f 6e2e 5059  TargetVersion.PY
+000104b0: 3338 2c0a 2020 2020 2020 2020 2020 2020  38,.            
+000104c0: 2020 2020 2020 2020 5461 7267 6574 5665          TargetVe
+000104d0: 7273 696f 6e2e 5059 3339 2c0a 2020 2020  rsion.PY39,.    
+000104e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000104f0: 5461 7267 6574 5665 7273 696f 6e2e 5059  TargetVersion.PY
+00010500: 3331 302c 0a20 2020 2020 2020 2020 2020  310,.           
+00010510: 2020 2020 2020 2020 2054 6172 6765 7456           TargetV
+00010520: 6572 7369 6f6e 2e50 5933 3131 2c0a 2020  ersion.PY311,.  
+00010530: 2020 2020 2020 2020 2020 2020 2020 5d2c                ],
+00010540: 0a20 2020 2020 2020 2020 2020 2029 2c0a  .            ),.
+00010550: 2020 2020 2020 2020 2020 2020 2822 3d3d              ("==
+00010560: 332e 382e 2a22 2c20 5b54 6172 6765 7456  3.8.*", [TargetV
+00010570: 6572 7369 6f6e 2e50 5933 385d 292c 0a20  ersion.PY38]),. 
+00010580: 2020 2020 2020 2020 2020 2028 4e6f 6e65             (None
+00010590: 2c20 4e6f 6e65 292c 0a20 2020 2020 2020  , None),.       
+000105a0: 2020 2020 2028 2222 2c20 4e6f 6e65 292c       ("", None),
+000105b0: 0a20 2020 2020 2020 2020 2020 2028 2269  .            ("i
+000105c0: 6e76 616c 6964 222c 204e 6f6e 6529 2c0a  nvalid", None),.
+000105d0: 2020 2020 2020 2020 2020 2020 2822 3d3d              ("==
+000105e0: 696e 7661 6c69 6422 2c20 4e6f 6e65 292c  invalid", None),
+000105f0: 0a20 2020 2020 2020 2020 2020 2028 223e  .            (">
+00010600: 332e 392c 213d 696e 7661 6c69 6422 2c20  3.9,!=invalid", 
+00010610: 4e6f 6e65 292c 0a20 2020 2020 2020 2020  None),.         
+00010620: 2020 2028 2233 222c 204e 6f6e 6529 2c0a     ("3", None),.
+00010630: 2020 2020 2020 2020 2020 2020 2822 332e              ("3.
+00010640: 3222 2c20 4e6f 6e65 292c 0a20 2020 2020  2", None),.     
+00010650: 2020 2020 2020 2028 2232 2e37 2e31 3822         ("2.7.18"
+00010660: 2c20 4e6f 6e65 292c 0a20 2020 2020 2020  , None),.       
+00010670: 2020 2020 2028 223d 3d32 2e37 222c 204e       ("==2.7", N
+00010680: 6f6e 6529 2c0a 2020 2020 2020 2020 2020  one),.          
+00010690: 2020 2822 3e33 2e31 302c 3c33 2e31 3122    (">3.10,<3.11"
+000106a0: 2c20 4e6f 6e65 292c 0a20 2020 2020 2020  , None),.       
+000106b0: 205d 3a0a 2020 2020 2020 2020 2020 2020   ]:.            
+000106c0: 7465 7374 5f74 6f6d 6c20 3d20 7b22 7072  test_toml = {"pr
+000106d0: 6f6a 6563 7422 3a20 7b22 7265 7175 6972  oject": {"requir
+000106e0: 6573 2d70 7974 686f 6e22 3a20 7665 7273  es-python": vers
+000106f0: 696f 6e7d 7d0a 2020 2020 2020 2020 2020  ion}}.          
+00010700: 2020 7265 7375 6c74 203d 2063 6572 6369    result = cerci
+00010710: 732e 6669 6c65 732e 696e 6665 725f 7461  s.files.infer_ta
+00010720: 7267 6574 5f76 6572 7369 6f6e 2874 6573  rget_version(tes
+00010730: 745f 746f 6d6c 290a 2020 2020 2020 2020  t_toml).        
+00010740: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+00010750: 7175 616c 2872 6573 756c 742c 2065 7870  qual(result, exp
+00010760: 6563 7465 6429 0a0a 2020 2020 6465 6620  ected)..    def 
+00010770: 7465 7374 5f72 6561 645f 7079 7072 6f6a  test_read_pyproj
+00010780: 6563 745f 746f 6d6c 2873 656c 6629 202d  ect_toml(self) -
+00010790: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+000107a0: 7465 7374 5f74 6f6d 6c5f 6669 6c65 203d  test_toml_file =
+000107b0: 2054 4849 535f 4449 5220 2f20 2274 6573   THIS_DIR / "tes
+000107c0: 742e 746f 6d6c 220a 2020 2020 2020 2020  t.toml".        
+000107d0: 6661 6b65 5f63 7478 203d 2046 616b 6543  fake_ctx = FakeC
+000107e0: 6f6e 7465 7874 2829 0a20 2020 2020 2020  ontext().       
+000107f0: 2063 6572 6369 732e 7265 6164 5f70 7970   cercis.read_pyp
+00010800: 726f 6a65 6374 5f74 6f6d 6c28 6661 6b65  roject_toml(fake
+00010810: 5f63 7478 2c20 4661 6b65 5061 7261 6d65  _ctx, FakeParame
+00010820: 7465 7228 292c 2073 7472 2874 6573 745f  ter(), str(test_
+00010830: 746f 6d6c 5f66 696c 6529 290a 2020 2020  toml_file)).    
+00010840: 2020 2020 636f 6e66 6967 203d 2066 616b      config = fak
+00010850: 655f 6374 782e 6465 6661 756c 745f 6d61  e_ctx.default_ma
+00010860: 700a 2020 2020 2020 2020 7365 6c66 2e61  p.        self.a
+00010870: 7373 6572 7445 7175 616c 2863 6f6e 6669  ssertEqual(confi
+00010880: 675b 2276 6572 626f 7365 225d 2c20 2231  g["verbose"], "1
+00010890: 2229 0a20 2020 2020 2020 2073 656c 662e  ").        self.
+000108a0: 6173 7365 7274 4571 7561 6c28 636f 6e66  assertEqual(conf
+000108b0: 6967 5b22 6368 6563 6b22 5d2c 2022 6e6f  ig["check"], "no
+000108c0: 2229 0a20 2020 2020 2020 2073 656c 662e  ").        self.
+000108d0: 6173 7365 7274 4571 7561 6c28 636f 6e66  assertEqual(conf
+000108e0: 6967 5b22 6469 6666 225d 2c20 2279 2229  ig["diff"], "y")
+000108f0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+00010900: 7365 7274 4571 7561 6c28 636f 6e66 6967  sertEqual(config
+00010910: 5b22 636f 6c6f 7222 5d2c 2022 5472 7565  ["color"], "True
+00010920: 2229 0a20 2020 2020 2020 2073 656c 662e  ").        self.
+00010930: 6173 7365 7274 4571 7561 6c28 636f 6e66  assertEqual(conf
+00010940: 6967 5b22 6c69 6e65 5f6c 656e 6774 6822  ig["line_length"
+00010950: 5d2c 2022 3739 2229 0a20 2020 2020 2020  ], "79").       
+00010960: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+00010970: 6c28 636f 6e66 6967 5b22 7461 7267 6574  l(config["target
+00010980: 5f76 6572 7369 6f6e 225d 2c20 5b22 7079  _version"], ["py
+00010990: 3336 222c 2022 7079 3337 222c 2022 7079  36", "py37", "py
+000109a0: 3338 225d 290a 2020 2020 2020 2020 7365  38"]).        se
+000109b0: 6c66 2e61 7373 6572 7445 7175 616c 2863  lf.assertEqual(c
+000109c0: 6f6e 6669 675b 2265 7863 6c75 6465 225d  onfig["exclude"]
+000109d0: 2c20 7222 5c2e 7079 693f 2422 290a 2020  , r"\.pyi?$").  
+000109e0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+000109f0: 7445 7175 616c 2863 6f6e 6669 675b 2269  tEqual(config["i
+00010a00: 6e63 6c75 6465 225d 2c20 7222 5c2e 7079  nclude"], r"\.py
+00010a10: 3f24 2229 0a0a 2020 2020 4070 7974 6573  ?$")..    @pytes
+00010a20: 742e 6d61 726b 2e69 6e63 6f6d 7061 7469  t.mark.incompati
+00010a30: 626c 655f 7769 7468 5f6d 7970 7963 0a20  ble_with_mypyc. 
+00010a40: 2020 2064 6566 2074 6573 745f 6669 6e64     def test_find
+00010a50: 5f70 726f 6a65 6374 5f72 6f6f 7428 7365  _project_root(se
+00010a60: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
+00010a70: 2020 2020 2077 6974 6820 5465 6d70 6f72       with Tempor
+00010a80: 6172 7944 6972 6563 746f 7279 2829 2061  aryDirectory() a
+00010a90: 7320 776f 726b 7370 6163 653a 0a20 2020  s workspace:.   
+00010aa0: 2020 2020 2020 2020 2072 6f6f 7420 3d20           root = 
+00010ab0: 5061 7468 2877 6f72 6b73 7061 6365 290a  Path(workspace).
+00010ac0: 2020 2020 2020 2020 2020 2020 7465 7374              test
+00010ad0: 5f64 6972 203d 2072 6f6f 7420 2f20 2274  _dir = root / "t
+00010ae0: 6573 7422 0a20 2020 2020 2020 2020 2020  est".           
+00010af0: 2074 6573 745f 6469 722e 6d6b 6469 7228   test_dir.mkdir(
+00010b00: 290a 0a20 2020 2020 2020 2020 2020 2073  )..            s
+00010b10: 7263 5f64 6972 203d 2072 6f6f 7420 2f20  rc_dir = root / 
+00010b20: 2273 7263 220a 2020 2020 2020 2020 2020  "src".          
+00010b30: 2020 7372 635f 6469 722e 6d6b 6469 7228    src_dir.mkdir(
+00010b40: 290a 0a20 2020 2020 2020 2020 2020 2072  )..            r
+00010b50: 6f6f 745f 7079 7072 6f6a 6563 7420 3d20  oot_pyproject = 
+00010b60: 726f 6f74 202f 2022 7079 7072 6f6a 6563  root / "pyprojec
+00010b70: 742e 746f 6d6c 220a 2020 2020 2020 2020  t.toml".        
+00010b80: 2020 2020 726f 6f74 5f70 7970 726f 6a65      root_pyproje
+00010b90: 6374 2e74 6f75 6368 2829 0a20 2020 2020  ct.touch().     
+00010ba0: 2020 2020 2020 2073 7263 5f70 7970 726f         src_pypro
+00010bb0: 6a65 6374 203d 2073 7263 5f64 6972 202f  ject = src_dir /
+00010bc0: 2022 7079 7072 6f6a 6563 742e 746f 6d6c   "pyproject.toml
+00010bd0: 220a 2020 2020 2020 2020 2020 2020 7372  ".            sr
+00010be0: 635f 7079 7072 6f6a 6563 742e 746f 7563  c_pyproject.touc
+00010bf0: 6828 290a 2020 2020 2020 2020 2020 2020  h().            
+00010c00: 7372 635f 7079 7468 6f6e 203d 2073 7263  src_python = src
+00010c10: 5f64 6972 202f 2022 666f 6f2e 7079 220a  _dir / "foo.py".
+00010c20: 2020 2020 2020 2020 2020 2020 7372 635f              src_
+00010c30: 7079 7468 6f6e 2e74 6f75 6368 2829 0a0a  python.touch()..
+00010c40: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00010c50: 2e61 7373 6572 7445 7175 616c 280a 2020  .assertEqual(.  
+00010c60: 2020 2020 2020 2020 2020 2020 2020 6365                ce
+00010c70: 7263 6973 2e66 696e 645f 7072 6f6a 6563  rcis.find_projec
+00010c80: 745f 726f 6f74 2828 7372 635f 6469 722c  t_root((src_dir,
+00010c90: 2074 6573 745f 6469 7229 292c 0a20 2020   test_dir)),.   
+00010ca0: 2020 2020 2020 2020 2020 2020 2028 726f               (ro
+00010cb0: 6f74 2e72 6573 6f6c 7665 2829 2c20 2270  ot.resolve(), "p
+00010cc0: 7970 726f 6a65 6374 2e74 6f6d 6c22 292c  yproject.toml"),
+00010cd0: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+00010ce0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00010cf0: 6173 7365 7274 4571 7561 6c28 0a20 2020  assertEqual(.   
+00010d00: 2020 2020 2020 2020 2020 2020 2063 6572               cer
+00010d10: 6369 732e 6669 6e64 5f70 726f 6a65 6374  cis.find_project
+00010d20: 5f72 6f6f 7428 2873 7263 5f64 6972 2c29  _root((src_dir,)
+00010d30: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+00010d40: 2020 2028 7372 635f 6469 722e 7265 736f     (src_dir.reso
+00010d50: 6c76 6528 292c 2022 7079 7072 6f6a 6563  lve(), "pyprojec
+00010d60: 742e 746f 6d6c 2229 2c0a 2020 2020 2020  t.toml"),.      
+00010d70: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00010d80: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+00010d90: 7175 616c 280a 2020 2020 2020 2020 2020  qual(.          
+00010da0: 2020 2020 2020 6365 7263 6973 2e66 696e        cercis.fin
+00010db0: 645f 7072 6f6a 6563 745f 726f 6f74 2828  d_project_root((
+00010dc0: 7372 635f 7079 7468 6f6e 2c29 292c 0a20  src_python,)),. 
+00010dd0: 2020 2020 2020 2020 2020 2020 2020 2028                 (
+00010de0: 7372 635f 6469 722e 7265 736f 6c76 6528  src_dir.resolve(
+00010df0: 292c 2022 7079 7072 6f6a 6563 742e 746f  ), "pyproject.to
+00010e00: 6d6c 2229 2c0a 2020 2020 2020 2020 2020  ml"),.          
+00010e10: 2020 290a 0a20 2020 2020 2020 2020 2020    )..           
+00010e20: 2077 6974 6820 6368 616e 6765 5f64 6972   with change_dir
+00010e30: 6563 746f 7279 2874 6573 745f 6469 7229  ectory(test_dir)
+00010e40: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00010e50: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00010e60: 616c 280a 2020 2020 2020 2020 2020 2020  al(.            
+00010e70: 2020 2020 2020 2020 6365 7263 6973 2e66          cercis.f
+00010e80: 696e 645f 7072 6f6a 6563 745f 726f 6f74  ind_project_root
+00010e90: 2828 222d 222c 292c 2073 7464 696e 5f66  (("-",), stdin_f
+00010ea0: 696c 656e 616d 653d 222e 2e2f 7372 632f  ilename="../src/
+00010eb0: 612e 7079 2229 2c0a 2020 2020 2020 2020  a.py"),.        
+00010ec0: 2020 2020 2020 2020 2020 2020 2873 7263              (src
+00010ed0: 5f64 6972 2e72 6573 6f6c 7665 2829 2c20  _dir.resolve(), 
+00010ee0: 2270 7970 726f 6a65 6374 2e74 6f6d 6c22  "pyproject.toml"
+00010ef0: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+00010f00: 2020 2029 0a0a 2020 2020 4070 6174 6368     )..    @patch
+00010f10: 280a 2020 2020 2020 2020 2263 6572 6369  (.        "cerci
+00010f20: 732e 6669 6c65 732e 6669 6e64 5f75 7365  s.files.find_use
+00010f30: 725f 7079 7072 6f6a 6563 745f 746f 6d6c  r_pyproject_toml
+00010f40: 222c 0a20 2020 2029 0a20 2020 2064 6566  ",.    ).    def
+00010f50: 2074 6573 745f 6669 6e64 5f70 7970 726f   test_find_pypro
+00010f60: 6a65 6374 5f74 6f6d 6c28 7365 6c66 2c20  ject_toml(self, 
+00010f70: 6669 6e64 5f75 7365 725f 7079 7072 6f6a  find_user_pyproj
+00010f80: 6563 745f 746f 6d6c 3a20 4d61 6769 634d  ect_toml: MagicM
+00010f90: 6f63 6b29 202d 3e20 4e6f 6e65 3a0a 2020  ock) -> None:.  
+00010fa0: 2020 2020 2020 6669 6e64 5f75 7365 725f        find_user_
+00010fb0: 7079 7072 6f6a 6563 745f 746f 6d6c 2e73  pyproject_toml.s
+00010fc0: 6964 655f 6566 6665 6374 203d 2052 756e  ide_effect = Run
+00010fd0: 7469 6d65 4572 726f 7228 290a 0a20 2020  timeError()..   
+00010fe0: 2020 2020 2077 6974 6820 7265 6469 7265       with redire
+00010ff0: 6374 5f73 7464 6572 7228 696f 2e53 7472  ct_stderr(io.Str
+00011000: 696e 6749 4f28 2929 2061 7320 7374 6465  ingIO()) as stde
+00011010: 7272 3a0a 2020 2020 2020 2020 2020 2020  rr:.            
+00011020: 7265 7375 6c74 203d 2063 6572 6369 732e  result = cercis.
+00011030: 6669 6c65 732e 6669 6e64 5f70 7970 726f  files.find_pypro
+00011040: 6a65 6374 5f74 6f6d 6c28 0a20 2020 2020  ject_toml(.     
+00011050: 2020 2020 2020 2020 2020 2070 6174 685f             path_
+00011060: 7365 6172 6368 5f73 7461 7274 3d28 7374  search_start=(st
+00011070: 7228 5061 7468 2e63 7764 2829 2e72 6f6f  r(Path.cwd().roo
+00011080: 7429 2c29 0a20 2020 2020 2020 2020 2020  t),).           
+00011090: 2029 0a0a 2020 2020 2020 2020 6173 7365   )..        asse
+000110a0: 7274 2072 6573 756c 7420 6973 204e 6f6e  rt result is Non
+000110b0: 650a 2020 2020 2020 2020 6572 7220 3d20  e.        err = 
+000110c0: 7374 6465 7272 2e67 6574 7661 6c75 6528  stderr.getvalue(
+000110d0: 290a 2020 2020 2020 2020 6173 7365 7274  ).        assert
+000110e0: 2022 4967 6e6f 7269 6e67 2075 7365 7220   "Ignoring user 
+000110f0: 636f 6e66 6967 7572 6174 696f 6e22 2069  configuration" i
+00011100: 6e20 6572 720a 0a20 2020 2040 7061 7463  n err..    @patc
+00011110: 6828 0a20 2020 2020 2020 2022 6365 7263  h(.        "cerc
+00011120: 6973 2e66 696c 6573 2e66 696e 645f 7573  is.files.find_us
+00011130: 6572 5f70 7970 726f 6a65 6374 5f74 6f6d  er_pyproject_tom
+00011140: 6c22 2c0a 2020 2020 2020 2020 6365 7263  l",.        cerc
+00011150: 6973 2e66 696c 6573 2e66 696e 645f 7573  is.files.find_us
+00011160: 6572 5f70 7970 726f 6a65 6374 5f74 6f6d  er_pyproject_tom
+00011170: 6c2e 5f5f 7772 6170 7065 645f 5f2c 0a20  l.__wrapped__,. 
+00011180: 2020 2029 0a20 2020 2064 6566 2074 6573     ).    def tes
+00011190: 745f 6669 6e64 5f75 7365 725f 7079 7072  t_find_user_pypr
+000111a0: 6f6a 6563 745f 746f 6d6c 5f6c 696e 7578  oject_toml_linux
+000111b0: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
+000111c0: 2020 2020 2020 2020 6966 2073 7973 7465          if syste
+000111d0: 6d28 2920 3d3d 2022 5769 6e64 6f77 7322  m() == "Windows"
+000111e0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+000111f0: 7475 726e 0a0a 2020 2020 2020 2020 2320  turn..        # 
+00011200: 5465 7374 2069 6620 5844 475f 434f 4e46  Test if XDG_CONF
+00011210: 4947 5f48 4f4d 4520 6973 2063 6865 636b  IG_HOME is check
+00011220: 6564 0a20 2020 2020 2020 2077 6974 6820  ed.        with 
+00011230: 5465 6d70 6f72 6172 7944 6972 6563 746f  TemporaryDirecto
+00011240: 7279 2829 2061 7320 776f 726b 7370 6163  ry() as workspac
+00011250: 653a 0a20 2020 2020 2020 2020 2020 2074  e:.            t
+00011260: 6d70 5f75 7365 725f 636f 6e66 6967 203d  mp_user_config =
+00011270: 2050 6174 6828 776f 726b 7370 6163 6529   Path(workspace)
+00011280: 202f 2022 6365 7263 6973 220a 2020 2020   / "cercis".    
+00011290: 2020 2020 2020 2020 7769 7468 2070 6174          with pat
+000112a0: 6368 2e64 6963 7428 226f 732e 656e 7669  ch.dict("os.envi
+000112b0: 726f 6e22 2c20 7b22 5844 475f 434f 4e46  ron", {"XDG_CONF
+000112c0: 4947 5f48 4f4d 4522 3a20 776f 726b 7370  IG_HOME": worksp
+000112d0: 6163 657d 293a 0a20 2020 2020 2020 2020  ace}):.         
+000112e0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+000112f0: 7274 4571 7561 6c28 0a20 2020 2020 2020  rtEqual(.       
+00011300: 2020 2020 2020 2020 2020 2020 2063 6572               cer
+00011310: 6369 732e 6669 6c65 732e 6669 6e64 5f75  cis.files.find_u
+00011320: 7365 725f 7079 7072 6f6a 6563 745f 746f  ser_pyproject_to
+00011330: 6d6c 2829 2c20 746d 705f 7573 6572 5f63  ml(), tmp_user_c
+00011340: 6f6e 6669 672e 7265 736f 6c76 6528 290a  onfig.resolve().
+00011350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011360: 290a 0a20 2020 2020 2020 2023 2054 6573  )..        # Tes
+00011370: 7420 6661 6c6c 6261 636b 2066 6f72 2058  t fallback for X
+00011380: 4447 5f43 4f4e 4649 475f 484f 4d45 0a20  DG_CONFIG_HOME. 
+00011390: 2020 2020 2020 2077 6974 6820 7061 7463         with patc
+000113a0: 682e 6469 6374 2822 6f73 2e65 6e76 6972  h.dict("os.envir
+000113b0: 6f6e 2229 3a0a 2020 2020 2020 2020 2020  on"):.          
+000113c0: 2020 6f73 2e65 6e76 6972 6f6e 2e70 6f70    os.environ.pop
+000113d0: 2822 5844 475f 434f 4e46 4947 5f48 4f4d  ("XDG_CONFIG_HOM
+000113e0: 4522 2c20 4e6f 6e65 290a 2020 2020 2020  E", None).      
+000113f0: 2020 2020 2020 6661 6c6c 6261 636b 5f75        fallback_u
+00011400: 7365 725f 636f 6e66 6967 203d 2050 6174  ser_config = Pat
+00011410: 6828 227e 2f2e 636f 6e66 6967 2229 2e65  h("~/.config").e
+00011420: 7870 616e 6475 7365 7228 2920 2f20 2263  xpanduser() / "c
+00011430: 6572 6369 7322 0a20 2020 2020 2020 2020  ercis".         
+00011440: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+00011450: 7561 6c28 0a20 2020 2020 2020 2020 2020  ual(.           
+00011460: 2020 2020 2063 6572 6369 732e 6669 6c65       cercis.file
+00011470: 732e 6669 6e64 5f75 7365 725f 7079 7072  s.find_user_pypr
+00011480: 6f6a 6563 745f 746f 6d6c 2829 2c20 6661  oject_toml(), fa
+00011490: 6c6c 6261 636b 5f75 7365 725f 636f 6e66  llback_user_conf
+000114a0: 6967 2e72 6573 6f6c 7665 2829 0a20 2020  ig.resolve().   
+000114b0: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
+000114c0: 6465 6620 7465 7374 5f66 696e 645f 7573  def test_find_us
+000114d0: 6572 5f70 7970 726f 6a65 6374 5f74 6f6d  er_pyproject_tom
+000114e0: 6c5f 7769 6e64 6f77 7328 7365 6c66 2920  l_windows(self) 
+000114f0: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
+00011500: 2069 6620 7379 7374 656d 2829 2021 3d20   if system() != 
+00011510: 2257 696e 646f 7773 223a 0a20 2020 2020  "Windows":.     
+00011520: 2020 2020 2020 2072 6574 7572 6e0a 0a20         return.. 
+00011530: 2020 2020 2020 2075 7365 725f 636f 6e66         user_conf
+00011540: 6967 5f70 6174 6820 3d20 5061 7468 2e68  ig_path = Path.h
+00011550: 6f6d 6528 2920 2f20 222e 6365 7263 6973  ome() / ".cercis
+00011560: 220a 2020 2020 2020 2020 7365 6c66 2e61  ".        self.a
+00011570: 7373 6572 7445 7175 616c 280a 2020 2020  ssertEqual(.    
+00011580: 2020 2020 2020 2020 6365 7263 6973 2e66          cercis.f
+00011590: 696c 6573 2e66 696e 645f 7573 6572 5f70  iles.find_user_p
+000115a0: 7970 726f 6a65 6374 5f74 6f6d 6c28 292c  yproject_toml(),
+000115b0: 2075 7365 725f 636f 6e66 6967 5f70 6174   user_config_pat
+000115c0: 682e 7265 736f 6c76 6528 290a 2020 2020  h.resolve().    
+000115d0: 2020 2020 290a 0a20 2020 2064 6566 2074      )..    def t
+000115e0: 6573 745f 6270 6f5f 3333 3636 305f 776f  est_bpo_33660_wo
+000115f0: 726b 6172 6f75 6e64 2873 656c 6629 202d  rkaround(self) -
+00011600: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+00011610: 6966 2073 7973 7465 6d28 2920 3d3d 2022  if system() == "
+00011620: 5769 6e64 6f77 7322 3a0a 2020 2020 2020  Windows":.      
+00011630: 2020 2020 2020 7265 7475 726e 0a0a 2020        return..  
+00011640: 2020 2020 2020 2320 6874 7470 733a 2f2f        # https://
+00011650: 6275 6773 2e70 7974 686f 6e2e 6f72 672f  bugs.python.org/
+00011660: 6973 7375 6533 3336 3630 0a20 2020 2020  issue33660.     
+00011670: 2020 2072 6f6f 7420 3d20 5061 7468 2822     root = Path("
+00011680: 2f22 290a 2020 2020 2020 2020 7769 7468  /").        with
+00011690: 2063 6861 6e67 655f 6469 7265 6374 6f72   change_director
+000116a0: 7928 726f 6f74 293a 0a20 2020 2020 2020  y(root):.       
+000116b0: 2020 2020 2070 6174 6820 3d20 5061 7468       path = Path
+000116c0: 2822 776f 726b 7370 6163 6522 2920 2f20  ("workspace") / 
+000116d0: 2270 726f 6a65 6374 220a 2020 2020 2020  "project".      
+000116e0: 2020 2020 2020 7265 706f 7274 203d 2063        report = c
+000116f0: 6572 6369 732e 5265 706f 7274 2876 6572  ercis.Report(ver
+00011700: 626f 7365 3d54 7275 6529 0a20 2020 2020  bose=True).     
+00011710: 2020 2020 2020 206e 6f72 6d61 6c69 7a65         normalize
+00011720: 645f 7061 7468 203d 2063 6572 6369 732e  d_path = cercis.
+00011730: 6e6f 726d 616c 697a 655f 7061 7468 5f6d  normalize_path_m
+00011740: 6179 6265 5f69 676e 6f72 6528 7061 7468  aybe_ignore(path
+00011750: 2c20 726f 6f74 2c20 7265 706f 7274 290a  , root, report).
+00011760: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00011770: 2e61 7373 6572 7445 7175 616c 286e 6f72  .assertEqual(nor
+00011780: 6d61 6c69 7a65 645f 7061 7468 2c20 2277  malized_path, "w
+00011790: 6f72 6b73 7061 6365 2f70 726f 6a65 6374  orkspace/project
+000117a0: 2229 0a0a 2020 2020 6465 6620 7465 7374  ")..    def test
+000117b0: 5f6e 6f72 6d61 6c69 7a65 5f70 6174 685f  _normalize_path_
+000117c0: 6967 6e6f 7265 5f77 696e 646f 7773 5f6a  ignore_windows_j
+000117d0: 756e 6374 696f 6e73 5f6f 7574 7369 6465  unctions_outside
+000117e0: 5f6f 665f 726f 6f74 2873 656c 6629 202d  _of_root(self) -
+000117f0: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+00011800: 6966 2073 7973 7465 6d28 2920 213d 2022  if system() != "
+00011810: 5769 6e64 6f77 7322 3a0a 2020 2020 2020  Windows":.      
+00011820: 2020 2020 2020 7265 7475 726e 0a0a 2020        return..  
+00011830: 2020 2020 2020 7769 7468 2054 656d 706f        with Tempo
+00011840: 7261 7279 4469 7265 6374 6f72 7928 2920  raryDirectory() 
+00011850: 6173 2077 6f72 6b73 7061 6365 3a0a 2020  as workspace:.  
+00011860: 2020 2020 2020 2020 2020 726f 6f74 203d            root =
+00011870: 2050 6174 6828 776f 726b 7370 6163 6529   Path(workspace)
+00011880: 0a20 2020 2020 2020 2020 2020 206a 756e  .            jun
+00011890: 6374 696f 6e5f 6469 7220 3d20 726f 6f74  ction_dir = root
+000118a0: 202f 2022 6a75 6e63 7469 6f6e 220a 2020   / "junction".  
+000118b0: 2020 2020 2020 2020 2020 6a75 6e63 7469            juncti
+000118c0: 6f6e 5f74 6172 6765 745f 6f75 7473 6964  on_target_outsid
+000118d0: 655f 6f66 5f72 6f6f 7420 3d20 726f 6f74  e_of_root = root
+000118e0: 202f 2022 2e2e 220a 2020 2020 2020 2020   / "..".        
+000118f0: 2020 2020 6f73 2e73 7973 7465 6d28 6622      os.system(f"
+00011900: 6d6b 6c69 6e6b 202f 4a20 7b6a 756e 6374  mklink /J {junct
+00011910: 696f 6e5f 6469 727d 207b 6a75 6e63 7469  ion_dir} {juncti
+00011920: 6f6e 5f74 6172 6765 745f 6f75 7473 6964  on_target_outsid
+00011930: 655f 6f66 5f72 6f6f 747d 2229 0a0a 2020  e_of_root}")..  
+00011940: 2020 2020 2020 2020 2020 7265 706f 7274            report
+00011950: 203d 2063 6572 6369 732e 5265 706f 7274   = cercis.Report
+00011960: 2876 6572 626f 7365 3d54 7275 6529 0a20  (verbose=True). 
+00011970: 2020 2020 2020 2020 2020 206e 6f72 6d61             norma
+00011980: 6c69 7a65 645f 7061 7468 203d 2063 6572  lized_path = cer
+00011990: 6369 732e 6e6f 726d 616c 697a 655f 7061  cis.normalize_pa
+000119a0: 7468 5f6d 6179 6265 5f69 676e 6f72 6528  th_maybe_ignore(
+000119b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000119c0: 206a 756e 6374 696f 6e5f 6469 722c 2072   junction_dir, r
+000119d0: 6f6f 742c 2072 6570 6f72 740a 2020 2020  oot, report.    
+000119e0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+000119f0: 2020 2020 2020 2320 4d61 6e75 616c 6c79        # Manually
+00011a00: 2064 656c 6574 6520 666f 7220 5079 7468   delete for Pyth
+00011a10: 6f6e 203c 2033 2e38 0a20 2020 2020 2020  on < 3.8.       
+00011a20: 2020 2020 206f 732e 7379 7374 656d 2866       os.system(f
+00011a30: 2272 6d64 6972 207b 6a75 6e63 7469 6f6e  "rmdir {junction
+00011a40: 5f64 6972 7d22 290a 0a20 2020 2020 2020  _dir}")..       
+00011a50: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00011a60: 4571 7561 6c28 6e6f 726d 616c 697a 6564  Equal(normalized
+00011a70: 5f70 6174 682c 204e 6f6e 6529 0a0a 2020  _path, None)..  
+00011a80: 2020 6465 6620 7465 7374 5f6e 6577 6c69    def test_newli
+00011a90: 6e65 5f63 6f6d 6d65 6e74 5f69 6e74 6572  ne_comment_inter
+00011aa0: 6163 7469 6f6e 2873 656c 6629 202d 3e20  action(self) -> 
+00011ab0: 4e6f 6e65 3a0a 2020 2020 2020 2020 736f  None:.        so
+00011ac0: 7572 6365 203d 2022 636c 6173 7320 413a  urce = "class A:
+00011ad0: 5c5c 5c72 5c6e 2320 7479 7065 3a20 6967  \\\r\n# type: ig
+00011ae0: 6e6f 7265 5c6e 2070 6173 735c 6e22 0a20  nore\n pass\n". 
+00011af0: 2020 2020 2020 206f 7574 7075 7420 3d20         output = 
+00011b00: 6365 7263 6973 2e66 6f72 6d61 745f 7374  cercis.format_st
+00011b10: 7228 736f 7572 6365 2c20 6d6f 6465 3d44  r(source, mode=D
+00011b20: 4546 4155 4c54 5f4d 4f44 4529 0a20 2020  EFAULT_MODE).   
+00011b30: 2020 2020 2063 6572 6369 732e 6173 7365       cercis.asse
+00011b40: 7274 5f73 7461 626c 6528 736f 7572 6365  rt_stable(source
+00011b50: 2c20 6f75 7470 7574 2c20 6d6f 6465 3d44  , output, mode=D
+00011b60: 4546 4155 4c54 5f4d 4f44 4529 0a0a 2020  EFAULT_MODE)..  
+00011b70: 2020 6465 6620 7465 7374 5f62 706f 5f32    def test_bpo_2
+00011b80: 3134 325f 776f 726b 6172 6f75 6e64 2873  142_workaround(s
+00011b90: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
+00011ba0: 2020 2020 2020 2320 6874 7470 733a 2f2f        # https://
+00011bb0: 6275 6773 2e70 7974 686f 6e2e 6f72 672f  bugs.python.org/
+00011bc0: 6973 7375 6532 3134 320a 0a20 2020 2020  issue2142..     
+00011bd0: 2020 2073 6f75 7263 652c 205f 203d 2072     source, _ = r
+00011be0: 6561 645f 6461 7461 2822 6d69 7363 656c  ead_data("miscel
+00011bf0: 6c61 6e65 6f75 7322 2c20 226d 6973 7369  laneous", "missi
+00011c00: 6e67 5f66 696e 616c 5f6e 6577 6c69 6e65  ng_final_newline
+00011c10: 2229 0a20 2020 2020 2020 2023 2072 6561  ").        # rea
+00011c20: 645f 6461 7461 2061 6464 7320 6120 7472  d_data adds a tr
+00011c30: 6169 6c69 6e67 206e 6577 6c69 6e65 0a20  ailing newline. 
+00011c40: 2020 2020 2020 2073 6f75 7263 6520 3d20         source = 
+00011c50: 736f 7572 6365 2e72 7374 7269 7028 290a  source.rstrip().
+00011c60: 2020 2020 2020 2020 6578 7065 6374 6564          expected
+00011c70: 2c20 5f20 3d20 7265 6164 5f64 6174 6128  , _ = read_data(
+00011c80: 226d 6973 6365 6c6c 616e 656f 7573 222c  "miscellaneous",
+00011c90: 2022 6d69 7373 696e 675f 6669 6e61 6c5f   "missing_final_
+00011ca0: 6e65 776c 696e 652e 6469 6666 2229 0a20  newline.diff"). 
+00011cb0: 2020 2020 2020 2074 6d70 5f66 696c 6520         tmp_file 
+00011cc0: 3d20 5061 7468 2863 6572 6369 732e 6475  = Path(cercis.du
+00011cd0: 6d70 5f74 6f5f 6669 6c65 2873 6f75 7263  mp_to_file(sourc
+00011ce0: 652c 2065 6e73 7572 655f 6669 6e61 6c5f  e, ensure_final_
+00011cf0: 6e65 776c 696e 653d 4661 6c73 6529 290a  newline=False)).
+00011d00: 2020 2020 2020 2020 6469 6666 5f68 6561          diff_hea
+00011d10: 6465 7220 3d20 7265 2e63 6f6d 7069 6c65  der = re.compile
+00011d20: 280a 2020 2020 2020 2020 2020 2020 7266  (.            rf
+00011d30: 227b 7265 2e65 7363 6170 6528 7374 7228  "{re.escape(str(
+00011d40: 746d 705f 6669 6c65 2929 7d5c 745c 645c  tmp_file))}\t\d\
+00011d50: 645c 645c 642d 5c64 5c64 2d5c 645c 6420  d\d\d-\d\d-\d\d 
+00011d60: 220a 2020 2020 2020 2020 2020 2020 7222  ".            r"
+00011d70: 5c64 5c64 3a5c 645c 643a 5c64 5c64 5c2e  \d\d:\d\d:\d\d\.
+00011d80: 5c64 5c64 5c64 5c64 5c64 5c64 205c 2b5c  \d\d\d\d\d\d \+\
+00011d90: 645c 645c 645c 6422 0a20 2020 2020 2020  d\d\d\d".       
+00011da0: 2029 0a20 2020 2020 2020 2074 7279 3a0a   ).        try:.
+00011db0: 2020 2020 2020 2020 2020 2020 7265 7375              resu
+00011dc0: 6c74 203d 2042 6c61 636b 5275 6e6e 6572  lt = BlackRunner
+00011dd0: 2829 2e69 6e76 6f6b 6528 6365 7263 6973  ().invoke(cercis
+00011de0: 2e6d 6169 6e2c 205b 222d 2d64 6966 6622  .main, ["--diff"
+00011df0: 2c20 7374 7228 746d 705f 6669 6c65 295d  , str(tmp_file)]
+00011e00: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+00011e10: 6c66 2e61 7373 6572 7445 7175 616c 2872  lf.assertEqual(r
+00011e20: 6573 756c 742e 6578 6974 5f63 6f64 652c  esult.exit_code,
+00011e30: 2030 290a 2020 2020 2020 2020 6669 6e61   0).        fina
+00011e40: 6c6c 793a 0a20 2020 2020 2020 2020 2020  lly:.           
+00011e50: 206f 732e 756e 6c69 6e6b 2874 6d70 5f66   os.unlink(tmp_f
+00011e60: 696c 6529 0a20 2020 2020 2020 2061 6374  ile).        act
+00011e70: 7561 6c20 3d20 7265 7375 6c74 2e6f 7574  ual = result.out
+00011e80: 7075 740a 2020 2020 2020 2020 6163 7475  put.        actu
+00011e90: 616c 203d 2064 6966 665f 6865 6164 6572  al = diff_header
+00011ea0: 2e73 7562 2844 4554 4552 4d49 4e49 5354  .sub(DETERMINIST
+00011eb0: 4943 5f48 4541 4445 522c 2061 6374 7561  IC_HEADER, actua
+00011ec0: 6c29 0a20 2020 2020 2020 2073 656c 662e  l).        self.
+00011ed0: 6173 7365 7274 4571 7561 6c28 6163 7475  assertEqual(actu
+00011ee0: 616c 2c20 6578 7065 6374 6564 290a 0a20  al, expected).. 
+00011ef0: 2020 2040 7374 6174 6963 6d65 7468 6f64     @staticmethod
+00011f00: 0a20 2020 2064 6566 2063 6f6d 7061 7265  .    def compare
+00011f10: 5f72 6573 756c 7473 280a 2020 2020 2020  _results(.      
+00011f20: 2020 2020 2020 7265 7375 6c74 3a20 636c        result: cl
+00011f30: 6963 6b2e 7465 7374 696e 672e 5265 7375  ick.testing.Resu
+00011f40: 6c74 2c20 6578 7065 6374 6564 5f76 616c  lt, expected_val
+00011f50: 7565 3a20 7374 722c 2065 7870 6563 7465  ue: str, expecte
+00011f60: 645f 6578 6974 5f63 6f64 653a 2069 6e74  d_exit_code: int
+00011f70: 0a20 2020 2029 202d 3e20 4e6f 6e65 3a0a  .    ) -> None:.
+00011f80: 2020 2020 2020 2020 2222 2248 656c 7065          """Helpe
+00011f90: 7220 6d65 7468 6f64 2074 6f20 7465 7374  r method to test
+00011fa0: 2074 6865 2076 616c 7565 2061 6e64 2065   the value and e
+00011fb0: 7869 7420 636f 6465 206f 6620 6120 636c  xit code of a cl
+00011fc0: 6963 6b20 5265 7375 6c74 2e22 2222 0a20  ick Result.""". 
+00011fd0: 2020 2020 2020 2061 7373 6572 7420 280a         assert (.
+00011fe0: 2020 2020 2020 2020 2020 2020 7265 7375              resu
+00011ff0: 6c74 2e6f 7574 7075 7420 3d3d 2065 7870  lt.output == exp
+00012000: 6563 7465 645f 7661 6c75 650a 2020 2020  ected_value.    
+00012010: 2020 2020 292c 2022 5468 6520 6f75 7470      ), "The outp
+00012020: 7574 2064 6964 206e 6f74 206d 6174 6368  ut did not match
+00012030: 2074 6865 2065 7870 6563 7465 6420 7661   the expected va
+00012040: 6c75 652e 220a 2020 2020 2020 2020 6173  lue.".        as
+00012050: 7365 7274 2072 6573 756c 742e 6578 6974  sert result.exit
+00012060: 5f63 6f64 6520 3d3d 2065 7870 6563 7465  _code == expecte
+00012070: 645f 6578 6974 5f63 6f64 652c 2022 5468  d_exit_code, "Th
+00012080: 6520 6578 6974 2063 6f64 6520 6973 2069  e exit code is i
+00012090: 6e63 6f72 7265 6374 2e22 0a0a 2020 2020  ncorrect."..    
+000120a0: 6465 6620 7465 7374 5f63 6f64 655f 6f70  def test_code_op
+000120b0: 7469 6f6e 2873 656c 6629 202d 3e20 4e6f  tion(self) -> No
+000120c0: 6e65 3a0a 2020 2020 2020 2020 2222 2254  ne:.        """T
+000120d0: 6573 7420 7468 6520 636f 6465 206f 7074  est the code opt
+000120e0: 696f 6e20 7769 7468 206e 6f20 6368 616e  ion with no chan
+000120f0: 6765 732e 2222 220a 2020 2020 2020 2020  ges.""".        
+00012100: 636f 6465 203d 2022 7072 696e 7428 2748  code = "print('H
+00012110: 656c 6c6f 2077 6f72 6c64 2729 5c6e 220a  ello world')\n".
+00012120: 2020 2020 2020 2020 6172 6773 203d 205b          args = [
+00012130: 222d 2d63 6f64 6522 2c20 636f 6465 2c20  "--code", code, 
+00012140: 222d 2d73 696e 676c 652d 7175 6f74 653d  "--single-quote=
+00012150: 5472 7565 225d 0a20 2020 2020 2020 2072  True"].        r
+00012160: 6573 756c 7420 3d20 436c 6952 756e 6e65  esult = CliRunne
+00012170: 7228 292e 696e 766f 6b65 2863 6572 6369  r().invoke(cerci
+00012180: 732e 6d61 696e 2c20 6172 6773 290a 0a20  s.main, args).. 
+00012190: 2020 2020 2020 2073 656c 662e 636f 6d70         self.comp
+000121a0: 6172 655f 7265 7375 6c74 7328 7265 7375  are_results(resu
+000121b0: 6c74 2c20 636f 6465 2c20 3029 0a0a 2020  lt, code, 0)..  
+000121c0: 2020 6465 6620 7465 7374 5f63 6f64 655f    def test_code_
+000121d0: 6f70 7469 6f6e 5f63 6861 6e67 6564 2873  option_changed(s
+000121e0: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
+000121f0: 2020 2020 2020 2222 2254 6573 7420 7468        """Test th
+00012200: 6520 636f 6465 206f 7074 696f 6e20 7768  e code option wh
+00012210: 656e 2063 6861 6e67 6573 2061 7265 2072  en changes are r
+00012220: 6571 7569 7265 642e 2222 220a 2020 2020  equired.""".    
+00012230: 2020 2020 636f 6465 203d 2027 7072 696e      code = 'prin
+00012240: 7428 2268 656c 6c6f 2077 6f72 6c64 2229  t("hello world")
+00012250: 270a 2020 2020 2020 2020 666f 726d 6174  '.        format
+00012260: 7465 6420 3d20 6365 7263 6973 2e66 6f72  ted = cercis.for
+00012270: 6d61 745f 7374 7228 636f 6465 2c20 6d6f  mat_str(code, mo
+00012280: 6465 3d44 4546 4155 4c54 5f4d 4f44 4529  de=DEFAULT_MODE)
+00012290: 0a0a 2020 2020 2020 2020 6172 6773 203d  ..        args =
+000122a0: 205b 222d 2d63 6f64 6522 2c20 636f 6465   ["--code", code
+000122b0: 2c20 222d 2d73 696e 676c 652d 7175 6f74  , "--single-quot
+000122c0: 653d 5472 7565 225d 0a20 2020 2020 2020  e=True"].       
+000122d0: 2072 6573 756c 7420 3d20 436c 6952 756e   result = CliRun
+000122e0: 6e65 7228 292e 696e 766f 6b65 2863 6572  ner().invoke(cer
+000122f0: 6369 732e 6d61 696e 2c20 6172 6773 290a  cis.main, args).
+00012300: 0a20 2020 2020 2020 2073 656c 662e 636f  .        self.co
+00012310: 6d70 6172 655f 7265 7375 6c74 7328 7265  mpare_results(re
+00012320: 7375 6c74 2c20 666f 726d 6174 7465 642c  sult, formatted,
+00012330: 2030 290a 0a20 2020 2064 6566 2074 6573   0)..    def tes
+00012340: 745f 636f 6465 5f6f 7074 696f 6e5f 6368  t_code_option_ch
+00012350: 6563 6b28 7365 6c66 2920 2d3e 204e 6f6e  eck(self) -> Non
+00012360: 653a 0a20 2020 2020 2020 2022 2222 5465  e:.        """Te
+00012370: 7374 2074 6865 2063 6f64 6520 6f70 7469  st the code opti
+00012380: 6f6e 2077 6865 6e20 6368 6563 6b20 6973  on when check is
+00012390: 2070 6173 7365 642e 2222 220a 2020 2020   passed.""".    
+000123a0: 2020 2020 6172 6773 203d 205b 222d 2d63      args = ["--c
+000123b0: 6865 636b 222c 2022 2d2d 636f 6465 222c  heck", "--code",
+000123c0: 2027 7072 696e 7428 2248 656c 6c6f 2077   'print("Hello w
+000123d0: 6f72 6c64 2229 5c6e 275d 0a20 2020 2020  orld")\n'].     
+000123e0: 2020 2072 6573 756c 7420 3d20 436c 6952     result = CliR
+000123f0: 756e 6e65 7228 292e 696e 766f 6b65 2863  unner().invoke(c
+00012400: 6572 6369 732e 6d61 696e 2c20 6172 6773  ercis.main, args
+00012410: 290a 2020 2020 2020 2020 7365 6c66 2e63  ).        self.c
+00012420: 6f6d 7061 7265 5f72 6573 756c 7473 2872  ompare_results(r
+00012430: 6573 756c 742c 2022 222c 2030 290a 0a20  esult, "", 0).. 
+00012440: 2020 2064 6566 2074 6573 745f 636f 6465     def test_code
+00012450: 5f6f 7074 696f 6e5f 6368 6563 6b5f 6368  _option_check_ch
+00012460: 616e 6765 6428 7365 6c66 2920 2d3e 204e  anged(self) -> N
+00012470: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
+00012480: 5465 7374 2074 6865 2063 6f64 6520 6f70  Test the code op
+00012490: 7469 6f6e 2077 6865 6e20 6368 616e 6765  tion when change
+000124a0: 7320 6172 6520 7265 7175 6972 6564 2c20  s are required, 
+000124b0: 616e 6420 6368 6563 6b20 6973 2070 6173  and check is pas
+000124c0: 7365 642e 2222 220a 2020 2020 2020 2020  sed.""".        
+000124d0: 6172 6773 203d 205b 222d 2d63 6865 636b  args = ["--check
+000124e0: 222c 2022 2d2d 636f 6465 222c 2022 7072  ", "--code", "pr
+000124f0: 696e 7428 2768 656c 6c6f 2077 6f72 6c64  int('hello world
+00012500: 2729 225d 0a20 2020 2020 2020 2072 6573  ')"].        res
+00012510: 756c 7420 3d20 436c 6952 756e 6e65 7228  ult = CliRunner(
+00012520: 292e 696e 766f 6b65 2863 6572 6369 732e  ).invoke(cercis.
+00012530: 6d61 696e 2c20 6172 6773 290a 2020 2020  main, args).    
+00012540: 2020 2020 7365 6c66 2e63 6f6d 7061 7265      self.compare
+00012550: 5f72 6573 756c 7473 2872 6573 756c 742c  _results(result,
+00012560: 2022 222c 2031 290a 0a20 2020 2064 6566   "", 1)..    def
+00012570: 2074 6573 745f 636f 6465 5f6f 7074 696f   test_code_optio
+00012580: 6e5f 6469 6666 2873 656c 6629 202d 3e20  n_diff(self) -> 
+00012590: 4e6f 6e65 3a0a 2020 2020 2020 2020 2222  None:.        ""
+000125a0: 2254 6573 7420 7468 6520 636f 6465 206f  "Test the code o
+000125b0: 7074 696f 6e20 7768 656e 2064 6966 6620  ption when diff 
+000125c0: 6973 2070 6173 7365 642e 2222 220a 2020  is passed.""".  
+000125d0: 2020 2020 2020 636f 6465 203d 2027 7072        code = 'pr
+000125e0: 696e 7428 2268 656c 6c6f 2077 6f72 6c64  int("hello world
+000125f0: 2229 270a 2020 2020 2020 2020 666f 726d  ")'.        form
+00012600: 6174 7465 6420 3d20 6365 7263 6973 2e66  atted = cercis.f
+00012610: 6f72 6d61 745f 7374 7228 636f 6465 2c20  ormat_str(code, 
+00012620: 6d6f 6465 3d44 4546 4155 4c54 5f4d 4f44  mode=DEFAULT_MOD
+00012630: 4529 0a20 2020 2020 2020 2072 6573 756c  E).        resul
+00012640: 745f 6469 6666 203d 2064 6966 6628 636f  t_diff = diff(co
+00012650: 6465 2c20 666f 726d 6174 7465 642c 2022  de, formatted, "
+00012660: 5354 4449 4e22 2c20 2253 5444 4f55 5422  STDIN", "STDOUT"
+00012670: 290a 0a20 2020 2020 2020 2061 7267 7320  )..        args 
+00012680: 3d20 5b22 2d2d 6469 6666 222c 2022 2d2d  = ["--diff", "--
+00012690: 636f 6465 222c 2063 6f64 652c 2022 2d2d  code", code, "--
+000126a0: 7369 6e67 6c65 2d71 756f 7465 3d54 7275  single-quote=Tru
+000126b0: 6522 5d0a 2020 2020 2020 2020 7265 7375  e"].        resu
+000126c0: 6c74 203d 2043 6c69 5275 6e6e 6572 2829  lt = CliRunner()
+000126d0: 2e69 6e76 6f6b 6528 6365 7263 6973 2e6d  .invoke(cercis.m
+000126e0: 6169 6e2c 2061 7267 7329 0a0a 2020 2020  ain, args)..    
+000126f0: 2020 2020 2320 5265 6d6f 7665 2074 696d      # Remove tim
+00012700: 6520 6672 6f6d 2064 6966 660a 2020 2020  e from diff.    
+00012710: 2020 2020 6f75 7470 7574 203d 2044 4946      output = DIF
+00012720: 465f 5449 4d45 2e73 7562 2822 222c 2072  F_TIME.sub("", r
+00012730: 6573 756c 742e 6f75 7470 7574 290a 0a20  esult.output).. 
+00012740: 2020 2020 2020 2061 7373 6572 7420 6f75         assert ou
+00012750: 7470 7574 203d 3d20 7265 7375 6c74 5f64  tput == result_d
+00012760: 6966 662c 2022 5468 6520 6f75 7470 7574  iff, "The output
+00012770: 2064 6964 206e 6f74 206d 6174 6368 2074   did not match t
+00012780: 6865 2065 7870 6563 7465 6420 7661 6c75  he expected valu
+00012790: 652e 220a 2020 2020 2020 2020 6173 7365  e.".        asse
+000127a0: 7274 2072 6573 756c 742e 6578 6974 5f63  rt result.exit_c
+000127b0: 6f64 6520 3d3d 2030 2c20 2254 6865 2065  ode == 0, "The e
+000127c0: 7869 7420 636f 6465 2069 7320 696e 636f  xit code is inco
+000127d0: 7272 6563 742e 220a 0a20 2020 2064 6566  rrect."..    def
+000127e0: 2074 6573 745f 636f 6465 5f6f 7074 696f   test_code_optio
+000127f0: 6e5f 636f 6c6f 725f 6469 6666 2873 656c  n_color_diff(sel
+00012800: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
+00012810: 2020 2020 2222 2254 6573 7420 7468 6520      """Test the 
+00012820: 636f 6465 206f 7074 696f 6e20 7768 656e  code option when
+00012830: 2063 6f6c 6f72 2061 6e64 2064 6966 6620   color and diff 
+00012840: 6172 6520 7061 7373 6564 2e22 2222 0a20  are passed.""". 
+00012850: 2020 2020 2020 2063 6f64 6520 3d20 2770         code = 'p
+00012860: 7269 6e74 2822 6865 6c6c 6f20 776f 726c  rint("hello worl
+00012870: 6422 2927 0a20 2020 2020 2020 2066 6f72  d")'.        for
+00012880: 6d61 7474 6564 203d 2063 6572 6369 732e  matted = cercis.
+00012890: 666f 726d 6174 5f73 7472 2863 6f64 652c  format_str(code,
+000128a0: 206d 6f64 653d 4445 4641 554c 545f 4d4f   mode=DEFAULT_MO
+000128b0: 4445 290a 0a20 2020 2020 2020 2072 6573  DE)..        res
+000128c0: 756c 745f 6469 6666 203d 2064 6966 6628  ult_diff = diff(
+000128d0: 636f 6465 2c20 666f 726d 6174 7465 642c  code, formatted,
+000128e0: 2022 5354 4449 4e22 2c20 2253 5444 4f55   "STDIN", "STDOU
+000128f0: 5422 290a 2020 2020 2020 2020 7265 7375  T").        resu
+00012900: 6c74 5f64 6966 6620 3d20 636f 6c6f 725f  lt_diff = color_
+00012910: 6469 6666 2872 6573 756c 745f 6469 6666  diff(result_diff
+00012920: 290a 0a20 2020 2020 2020 2061 7267 7320  )..        args 
+00012930: 3d20 5b22 2d2d 6469 6666 222c 2022 2d2d  = ["--diff", "--
+00012940: 636f 6c6f 7222 2c20 222d 2d63 6f64 6522  color", "--code"
+00012950: 2c20 636f 6465 2c20 222d 2d73 696e 676c  , code, "--singl
+00012960: 652d 7175 6f74 653d 5472 7565 225d 0a20  e-quote=True"]. 
+00012970: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
+00012980: 436c 6952 756e 6e65 7228 292e 696e 766f  CliRunner().invo
+00012990: 6b65 2863 6572 6369 732e 6d61 696e 2c20  ke(cercis.main, 
+000129a0: 6172 6773 290a 0a20 2020 2020 2020 2023  args)..        #
+000129b0: 2052 656d 6f76 6520 7469 6d65 2066 726f   Remove time fro
+000129c0: 6d20 6469 6666 0a20 2020 2020 2020 206f  m diff.        o
+000129d0: 7574 7075 7420 3d20 4449 4646 5f54 494d  utput = DIFF_TIM
+000129e0: 452e 7375 6228 2222 2c20 7265 7375 6c74  E.sub("", result
+000129f0: 2e6f 7574 7075 7429 0a0a 2020 2020 2020  .output)..      
+00012a00: 2020 6173 7365 7274 206f 7574 7075 7420    assert output 
+00012a10: 3d3d 2072 6573 756c 745f 6469 6666 2c20  == result_diff, 
+00012a20: 2254 6865 206f 7574 7075 7420 6469 6420  "The output did 
+00012a30: 6e6f 7420 6d61 7463 6820 7468 6520 6578  not match the ex
+00012a40: 7065 6374 6564 2076 616c 7565 2e22 0a20  pected value.". 
+00012a50: 2020 2020 2020 2061 7373 6572 7420 7265         assert re
+00012a60: 7375 6c74 2e65 7869 745f 636f 6465 203d  sult.exit_code =
+00012a70: 3d20 302c 2022 5468 6520 6578 6974 2063  = 0, "The exit c
+00012a80: 6f64 6520 6973 2069 6e63 6f72 7265 6374  ode is incorrect
+00012a90: 2e22 0a0a 2020 2020 4070 7974 6573 742e  ."..    @pytest.
+00012aa0: 6d61 726b 2e69 6e63 6f6d 7061 7469 626c  mark.incompatibl
+00012ab0: 655f 7769 7468 5f6d 7970 7963 0a20 2020  e_with_mypyc.   
+00012ac0: 2064 6566 2074 6573 745f 636f 6465 5f6f   def test_code_o
+00012ad0: 7074 696f 6e5f 7361 6665 2873 656c 6629  ption_safe(self)
+00012ae0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
+00012af0: 2020 2222 2254 6573 7420 7468 6174 2074    """Test that t
+00012b00: 6865 2063 6f64 6520 6f70 7469 6f6e 2074  he code option t
+00012b10: 6872 6f77 7320 616e 2065 7272 6f72 2077  hrows an error w
+00012b20: 6865 6e20 7468 6520 7361 6e69 7479 2063  hen the sanity c
+00012b30: 6865 636b 7320 6661 696c 2e22 2222 0a20  hecks fail.""". 
+00012b40: 2020 2020 2020 2023 2050 6174 6368 2063         # Patch c
+00012b50: 6572 6369 732e 6173 7365 7274 5f65 7175  ercis.assert_equ
+00012b60: 6976 616c 656e 7420 746f 2065 6e73 7572  ivalent to ensur
+00012b70: 6520 7468 6520 7361 6e69 7479 2063 6865  e the sanity che
+00012b80: 636b 7320 6661 696c 0a20 2020 2020 2020  cks fail.       
+00012b90: 2077 6974 6820 7061 7463 682e 6f62 6a65   with patch.obje
+00012ba0: 6374 2863 6572 6369 732c 2022 6173 7365  ct(cercis, "asse
+00012bb0: 7274 5f65 7175 6976 616c 656e 7422 2c20  rt_equivalent", 
+00012bc0: 7369 6465 5f65 6666 6563 743d 4173 7365  side_effect=Asse
+00012bd0: 7274 696f 6e45 7272 6f72 293a 0a20 2020  rtionError):.   
+00012be0: 2020 2020 2020 2020 2063 6f64 6520 3d20           code = 
+00012bf0: 2770 7269 6e74 2822 4865 6c6c 6f20 776f  'print("Hello wo
+00012c00: 726c 6422 2927 0a20 2020 2020 2020 2020  rld")'.         
+00012c10: 2020 2065 7272 6f72 5f6d 7367 203d 2066     error_msg = f
+00012c20: 227b 636f 6465 7d5c 6e65 7272 6f72 3a20  "{code}\nerror: 
+00012c30: 6361 6e6e 6f74 2066 6f72 6d61 7420 3c73  cannot format <s
+00012c40: 7472 696e 673e 3a20 5c6e 220a 0a20 2020  tring>: \n"..   
+00012c50: 2020 2020 2020 2020 2061 7267 7320 3d20           args = 
+00012c60: 5b22 2d2d 7361 6665 222c 2022 2d2d 636f  ["--safe", "--co
+00012c70: 6465 222c 2063 6f64 655d 0a20 2020 2020  de", code].     
+00012c80: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
+00012c90: 436c 6952 756e 6e65 7228 292e 696e 766f  CliRunner().invo
+00012ca0: 6b65 2863 6572 6369 732e 6d61 696e 2c20  ke(cercis.main, 
+00012cb0: 6172 6773 290a 0a20 2020 2020 2020 2020  args)..         
+00012cc0: 2020 2073 656c 662e 636f 6d70 6172 655f     self.compare_
+00012cd0: 7265 7375 6c74 7328 7265 7375 6c74 2c20  results(result, 
+00012ce0: 6572 726f 725f 6d73 672c 2031 3233 290a  error_msg, 123).
+00012cf0: 0a20 2020 2064 6566 2074 6573 745f 636f  .    def test_co
+00012d00: 6465 5f6f 7074 696f 6e5f 6661 7374 2873  de_option_fast(s
+00012d10: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
+00012d20: 2020 2020 2020 2222 2254 6573 7420 7468        """Test th
+00012d30: 6174 2074 6865 2063 6f64 6520 6f70 7469  at the code opti
+00012d40: 6f6e 2069 676e 6f72 6573 2065 7272 6f72  on ignores error
+00012d50: 7320 7768 656e 2074 6865 2073 616e 6974  s when the sanit
+00012d60: 7920 6368 6563 6b73 2066 6169 6c2e 2222  y checks fail.""
+00012d70: 220a 2020 2020 2020 2020 2320 5061 7463  ".        # Patc
+00012d80: 6820 6365 7263 6973 2e61 7373 6572 745f  h cercis.assert_
+00012d90: 6571 7569 7661 6c65 6e74 2074 6f20 656e  equivalent to en
+00012da0: 7375 7265 2074 6865 2073 616e 6974 7920  sure the sanity 
+00012db0: 6368 6563 6b73 2066 6169 6c0a 2020 2020  checks fail.    
+00012dc0: 2020 2020 7769 7468 2070 6174 6368 2e6f      with patch.o
+00012dd0: 626a 6563 7428 6365 7263 6973 2c20 2261  bject(cercis, "a
+00012de0: 7373 6572 745f 6571 7569 7661 6c65 6e74  ssert_equivalent
+00012df0: 222c 2073 6964 655f 6566 6665 6374 3d41  ", side_effect=A
+00012e00: 7373 6572 7469 6f6e 4572 726f 7229 3a0a  ssertionError):.
+00012e10: 2020 2020 2020 2020 2020 2020 636f 6465              code
+00012e20: 203d 2022 7072 696e 7428 2748 656c 6c6f   = "print('Hello
+00012e30: 2077 6f72 6c64 2729 220a 2020 2020 2020   world')".      
+00012e40: 2020 2020 2020 666f 726d 6174 7465 6420        formatted 
+00012e50: 3d20 6365 7263 6973 2e66 6f72 6d61 745f  = cercis.format_
+00012e60: 7374 7228 636f 6465 2c20 6d6f 6465 3d44  str(code, mode=D
+00012e70: 4546 4155 4c54 5f4d 4f44 4529 0a0a 2020  EFAULT_MODE)..  
+00012e80: 2020 2020 2020 2020 2020 6172 6773 203d            args =
+00012e90: 205b 222d 2d66 6173 7422 2c20 222d 2d63   ["--fast", "--c
+00012ea0: 6f64 6522 2c20 636f 6465 2c20 222d 2d73  ode", code, "--s
+00012eb0: 696e 676c 652d 7175 6f74 653d 5472 7565  ingle-quote=True
+00012ec0: 225d 0a20 2020 2020 2020 2020 2020 2072  "].            r
+00012ed0: 6573 756c 7420 3d20 436c 6952 756e 6e65  esult = CliRunne
+00012ee0: 7228 292e 696e 766f 6b65 2863 6572 6369  r().invoke(cerci
+00012ef0: 732e 6d61 696e 2c20 6172 6773 290a 0a20  s.main, args).. 
+00012f00: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00012f10: 636f 6d70 6172 655f 7265 7375 6c74 7328  compare_results(
+00012f20: 7265 7375 6c74 2c20 666f 726d 6174 7465  result, formatte
+00012f30: 642c 2030 290a 0a20 2020 2040 7079 7465  d, 0)..    @pyte
+00012f40: 7374 2e6d 6172 6b2e 696e 636f 6d70 6174  st.mark.incompat
+00012f50: 6962 6c65 5f77 6974 685f 6d79 7079 630a  ible_with_mypyc.
+00012f60: 2020 2020 6465 6620 7465 7374 5f63 6f64      def test_cod
+00012f70: 655f 6f70 7469 6f6e 5f63 6f6e 6669 6728  e_option_config(
+00012f80: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
+00012f90: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00012fa0: 2020 2054 6573 7420 7468 6174 2074 6865     Test that the
+00012fb0: 2063 6f64 6520 6f70 7469 6f6e 2066 696e   code option fin
+00012fc0: 6473 2074 6865 2070 7970 726f 6a65 6374  ds the pyproject
+00012fd0: 2e74 6f6d 6c20 696e 2074 6865 2063 7572  .toml in the cur
+00012fe0: 7265 6e74 2064 6972 6563 746f 7279 2e0a  rent directory..
+00012ff0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00013000: 2020 2020 7769 7468 2070 6174 6368 2e6f      with patch.o
+00013010: 626a 6563 7428 6365 7263 6973 2c20 2270  bject(cercis, "p
+00013020: 6172 7365 5f70 7970 726f 6a65 6374 5f74  arse_pyproject_t
+00013030: 6f6d 6c22 2c20 7265 7475 726e 5f76 616c  oml", return_val
+00013040: 7565 3d7b 7d29 2061 7320 7061 7273 653a  ue={}) as parse:
+00013050: 0a20 2020 2020 2020 2020 2020 2061 7267  .            arg
+00013060: 7320 3d20 5b22 2d2d 636f 6465 222c 2022  s = ["--code", "
+00013070: 7072 696e 7422 5d0a 2020 2020 2020 2020  print"].        
+00013080: 2020 2020 2320 5468 6973 2069 7320 7468      # This is th
+00013090: 6520 6f6e 6c79 2064 6972 6563 746f 7279  e only directory
+000130a0: 206b 6e6f 776e 2074 6f20 636f 6e74 6169   known to contai
+000130b0: 6e20 6120 7079 7072 6f6a 6563 742e 746f  n a pyproject.to
+000130c0: 6d6c 0a20 2020 2020 2020 2020 2020 2077  ml.            w
+000130d0: 6974 6820 6368 616e 6765 5f64 6972 6563  ith change_direc
+000130e0: 746f 7279 2850 524f 4a45 4354 5f52 4f4f  tory(PROJECT_ROO
+000130f0: 5429 3a0a 2020 2020 2020 2020 2020 2020  T):.            
+00013100: 2020 2020 436c 6952 756e 6e65 7228 292e      CliRunner().
+00013110: 696e 766f 6b65 2863 6572 6369 732e 6d61  invoke(cercis.ma
+00013120: 696e 2c20 6172 6773 290a 2020 2020 2020  in, args).      
+00013130: 2020 2020 2020 2020 2020 7079 7072 6f6a            pyproj
+00013140: 6563 745f 7061 7468 203d 2050 6174 6828  ect_path = Path(
+00013150: 5061 7468 2e63 7764 2829 2c20 2270 7970  Path.cwd(), "pyp
+00013160: 726f 6a65 6374 2e74 6f6d 6c22 292e 7265  roject.toml").re
+00013170: 736f 6c76 6528 290a 0a20 2020 2020 2020  solve()..       
+00013180: 2020 2020 2061 7373 6572 7420 280a 2020       assert (.  
+00013190: 2020 2020 2020 2020 2020 2020 2020 6c65                le
+000131a0: 6e28 7061 7273 652e 6d6f 636b 5f63 616c  n(parse.mock_cal
+000131b0: 6c73 2920 3e3d 2031 0a20 2020 2020 2020  ls) >= 1.       
+000131c0: 2020 2020 2029 2c20 2245 7870 6563 7465       ), "Expecte
+000131d0: 6420 636f 6e66 6967 2070 6172 7365 2074  d config parse t
+000131e0: 6f20 6265 2063 616c 6c65 6420 7769 7468  o be called with
+000131f0: 2074 6865 2063 7572 7265 6e74 2064 6972   the current dir
+00013200: 6563 746f 7279 2e22 0a0a 2020 2020 2020  ectory."..      
+00013210: 2020 2020 2020 5f2c 2063 616c 6c5f 6172        _, call_ar
+00013220: 6773 2c20 5f20 3d20 7061 7273 652e 6d6f  gs, _ = parse.mo
+00013230: 636b 5f63 616c 6c73 5b30 5d0a 2020 2020  ck_calls[0].    
+00013240: 2020 2020 2020 2020 6173 7365 7274 2028          assert (
+00013250: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013260: 2063 616c 6c5f 6172 6773 5b30 5d2e 6c6f   call_args[0].lo
+00013270: 7765 7228 2920 3d3d 2073 7472 2870 7970  wer() == str(pyp
+00013280: 726f 6a65 6374 5f70 6174 6829 2e6c 6f77  roject_path).low
+00013290: 6572 2829 0a20 2020 2020 2020 2020 2020  er().           
+000132a0: 2029 2c20 2249 6e63 6f72 7265 6374 2063   ), "Incorrect c
+000132b0: 6f6e 6669 6720 6c6f 6164 6564 2e22 0a0a  onfig loaded."..
+000132c0: 2020 2020 4070 7974 6573 742e 6d61 726b      @pytest.mark
+000132d0: 2e69 6e63 6f6d 7061 7469 626c 655f 7769  .incompatible_wi
+000132e0: 7468 5f6d 7970 7963 0a20 2020 2064 6566  th_mypyc.    def
+000132f0: 2074 6573 745f 636f 6465 5f6f 7074 696f   test_code_optio
+00013300: 6e5f 7061 7265 6e74 5f63 6f6e 6669 6728  n_parent_config(
+00013310: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
+00013320: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00013330: 2020 2054 6573 7420 7468 6174 2074 6865     Test that the
+00013340: 2063 6f64 6520 6f70 7469 6f6e 2066 696e   code option fin
+00013350: 6473 2074 6865 2070 7970 726f 6a65 6374  ds the pyproject
+00013360: 2e74 6f6d 6c20 696e 2074 6865 2070 6172  .toml in the par
+00013370: 656e 7420 6469 7265 6374 6f72 792e 0a20  ent directory.. 
+00013380: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00013390: 2020 2077 6974 6820 7061 7463 682e 6f62     with patch.ob
+000133a0: 6a65 6374 2863 6572 6369 732c 2022 7061  ject(cercis, "pa
+000133b0: 7273 655f 7079 7072 6f6a 6563 745f 746f  rse_pyproject_to
+000133c0: 6d6c 222c 2072 6574 7572 6e5f 7661 6c75  ml", return_valu
+000133d0: 653d 7b7d 2920 6173 2070 6172 7365 3a0a  e={}) as parse:.
+000133e0: 2020 2020 2020 2020 2020 2020 7769 7468              with
+000133f0: 2063 6861 6e67 655f 6469 7265 6374 6f72   change_director
+00013400: 7928 5448 4953 5f44 4952 293a 0a20 2020  y(THIS_DIR):.   
+00013410: 2020 2020 2020 2020 2020 2020 2061 7267               arg
+00013420: 7320 3d20 5b22 2d2d 636f 6465 222c 2022  s = ["--code", "
+00013430: 7072 696e 7422 5d0a 2020 2020 2020 2020  print"].        
+00013440: 2020 2020 2020 2020 436c 6952 756e 6e65          CliRunne
+00013450: 7228 292e 696e 766f 6b65 2863 6572 6369  r().invoke(cerci
+00013460: 732e 6d61 696e 2c20 6172 6773 290a 0a20  s.main, args).. 
+00013470: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00013480: 7970 726f 6a65 6374 5f70 6174 6820 3d20  yproject_path = 
+00013490: 5061 7468 2850 6174 6828 292e 6377 6428  Path(Path().cwd(
+000134a0: 292e 7061 7265 6e74 2c20 2270 7970 726f  ).parent, "pypro
+000134b0: 6a65 6374 2e74 6f6d 6c22 292e 7265 736f  ject.toml").reso
+000134c0: 6c76 6528 290a 2020 2020 2020 2020 2020  lve().          
+000134d0: 2020 2020 2020 6173 7365 7274 2028 0a20        assert (. 
+000134e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000134f0: 2020 206c 656e 2870 6172 7365 2e6d 6f63     len(parse.moc
+00013500: 6b5f 6361 6c6c 7329 203e 3d20 310a 2020  k_calls) >= 1.  
+00013510: 2020 2020 2020 2020 2020 2020 2020 292c                ),
+00013520: 2022 4578 7065 6374 6564 2063 6f6e 6669   "Expected confi
+00013530: 6720 7061 7273 6520 746f 2062 6520 6361  g parse to be ca
+00013540: 6c6c 6564 2077 6974 6820 7468 6520 6375  lled with the cu
+00013550: 7272 656e 7420 6469 7265 6374 6f72 792e  rrent directory.
+00013560: 220a 0a20 2020 2020 2020 2020 2020 2020  "..             
+00013570: 2020 205f 2c20 6361 6c6c 5f61 7267 732c     _, call_args,
+00013580: 205f 203d 2070 6172 7365 2e6d 6f63 6b5f   _ = parse.mock_
+00013590: 6361 6c6c 735b 305d 0a20 2020 2020 2020  calls[0].       
+000135a0: 2020 2020 2020 2020 2061 7373 6572 7420           assert 
+000135b0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+000135c0: 2020 2020 2020 6361 6c6c 5f61 7267 735b        call_args[
+000135d0: 305d 2e6c 6f77 6572 2829 203d 3d20 7374  0].lower() == st
+000135e0: 7228 7079 7072 6f6a 6563 745f 7061 7468  r(pyproject_path
+000135f0: 292e 6c6f 7765 7228 290a 2020 2020 2020  ).lower().      
+00013600: 2020 2020 2020 2020 2020 292c 2022 496e            ), "In
+00013610: 636f 7272 6563 7420 636f 6e66 6967 206c  correct config l
+00013620: 6f61 6465 642e 220a 0a20 2020 2064 6566  oaded."..    def
+00013630: 2074 6573 745f 666f 725f 6861 6e64 6c65   test_for_handle
+00013640: 645f 756e 6578 7065 6374 6564 5f65 6f66  d_unexpected_eof
+00013650: 5f65 7272 6f72 2873 656c 6629 202d 3e20  _error(self) -> 
+00013660: 4e6f 6e65 3a0a 2020 2020 2020 2020 2222  None:.        ""
+00013670: 220a 2020 2020 2020 2020 5465 7374 2074  ".        Test t
+00013680: 6861 7420 616e 2075 6e65 7870 6563 7465  hat an unexpecte
+00013690: 6420 454f 4620 5379 6e74 6178 4572 726f  d EOF SyntaxErro
+000136a0: 7220 6973 206e 6963 656c 7920 7072 6573  r is nicely pres
+000136b0: 656e 7465 642e 0a20 2020 2020 2020 2022  ented..        "
+000136c0: 2222 0a20 2020 2020 2020 2077 6974 6820  "".        with 
+000136d0: 7079 7465 7374 2e72 6169 7365 7328 6365  pytest.raises(ce
+000136e0: 7263 6973 2e70 6172 7369 6e67 2e49 6e76  rcis.parsing.Inv
+000136f0: 616c 6964 496e 7075 7429 2061 7320 6578  alidInput) as ex
+00013700: 635f 696e 666f 3a0a 2020 2020 2020 2020  c_info:.        
+00013710: 2020 2020 6365 7263 6973 2e6c 6962 3274      cercis.lib2t
+00013720: 6f33 5f70 6172 7365 2822 7072 696e 7428  o3_parse("print(
+00013730: 222c 207b 7d29 0a0a 2020 2020 2020 2020  ", {})..        
+00013740: 6578 635f 696e 666f 2e6d 6174 6368 2822  exc_info.match("
+00013750: 4361 6e6e 6f74 2070 6172 7365 3a20 323a  Cannot parse: 2:
+00013760: 303a 2045 4f46 2069 6e20 6d75 6c74 692d  0: EOF in multi-
+00013770: 6c69 6e65 2073 7461 7465 6d65 6e74 2229  line statement")
+00013780: 0a0a 2020 2020 6465 6620 7465 7374 5f65  ..    def test_e
+00013790: 7175 6976 616c 656e 6379 5f61 7374 5f70  quivalency_ast_p
+000137a0: 6172 7365 5f66 6169 6c75 7265 5f69 6e63  arse_failure_inc
+000137b0: 6c75 6465 735f 6572 726f 7228 7365 6c66  ludes_error(self
+000137c0: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+000137d0: 2020 2077 6974 6820 7079 7465 7374 2e72     with pytest.r
+000137e0: 6169 7365 7328 4173 7365 7274 696f 6e45  aises(AssertionE
+000137f0: 7272 6f72 2920 6173 2065 7272 3a0a 2020  rror) as err:.  
+00013800: 2020 2020 2020 2020 2020 6365 7263 6973            cercis
+00013810: 2e61 7373 6572 745f 6571 7569 7661 6c65  .assert_equivale
+00013820: 6e74 2822 61c2 abc2 bb61 2020 3d20 3122  nt("a....a  = 1"
+00013830: 2c20 2261 c2ab c2bb 6120 203d 2031 2229  , "a....a  = 1")
+00013840: 0a0a 2020 2020 2020 2020 6572 722e 6d61  ..        err.ma
+00013850: 7463 6828 222d 2d73 6166 6522 290a 2020  tch("--safe").  
+00013860: 2020 2020 2020 2320 556e 666f 7274 756e        # Unfortun
+00013870: 6174 656c 7920 7468 6520 5379 6e74 6178  ately the Syntax
+00013880: 4572 726f 7220 6d65 7373 6167 6520 6861  Error message ha
+00013890: 7320 6368 616e 6765 6420 696e 206e 6577  s changed in new
+000138a0: 6572 2076 6572 7369 6f6e 7320 736f 2077  er versions so w
+000138b0: 650a 2020 2020 2020 2020 2320 6361 6e27  e.        # can'
+000138c0: 7420 6d61 7463 6820 6974 2064 6972 6563  t match it direc
+000138d0: 746c 792e 0a20 2020 2020 2020 2065 7272  tly..        err
+000138e0: 2e6d 6174 6368 2822 696e 7661 6c69 6420  .match("invalid 
+000138f0: 6368 6172 6163 7465 7222 290a 2020 2020  character").    
+00013900: 2020 2020 6572 722e 6d61 7463 6828 7222      err.match(r"
+00013910: 5c28 3c75 6e6b 6e6f 776e 3e2c 206c 696e  \(<unknown>, lin
+00013920: 6520 315c 2922 290a 0a0a 636c 6173 7320  e 1\)")...class 
+00013930: 5465 7374 4361 6368 696e 673a 0a20 2020  TestCaching:.   
+00013940: 2064 6566 2074 6573 745f 6765 745f 6361   def test_get_ca
+00013950: 6368 655f 6469 7228 0a20 2020 2020 2020  che_dir(.       
+00013960: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
+00013970: 2020 2020 2020 2074 6d70 5f70 6174 683a         tmp_path:
+00013980: 2050 6174 682c 0a20 2020 2020 2020 2020   Path,.         
+00013990: 2020 206d 6f6e 6b65 7970 6174 6368 3a20     monkeypatch: 
+000139a0: 7079 7465 7374 2e4d 6f6e 6b65 7950 6174  pytest.MonkeyPat
+000139b0: 6368 2c0a 2020 2020 2920 2d3e 204e 6f6e  ch,.    ) -> Non
+000139c0: 653a 0a20 2020 2020 2020 2023 2043 7265  e:.        # Cre
+000139d0: 6174 6520 6d75 6c74 6970 6c65 2063 6163  ate multiple cac
+000139e0: 6865 2064 6972 6563 746f 7269 6573 0a20  he directories. 
+000139f0: 2020 2020 2020 2077 6f72 6b73 7061 6365         workspace
+00013a00: 3120 3d20 746d 705f 7061 7468 202f 2022  1 = tmp_path / "
+00013a10: 7773 3122 0a20 2020 2020 2020 2077 6f72  ws1".        wor
+00013a20: 6b73 7061 6365 312e 6d6b 6469 7228 290a  kspace1.mkdir().
+00013a30: 2020 2020 2020 2020 776f 726b 7370 6163          workspac
+00013a40: 6532 203d 2074 6d70 5f70 6174 6820 2f20  e2 = tmp_path / 
+00013a50: 2277 7332 220a 2020 2020 2020 2020 776f  "ws2".        wo
+00013a60: 726b 7370 6163 6532 2e6d 6b64 6972 2829  rkspace2.mkdir()
+00013a70: 0a0a 2020 2020 2020 2020 2320 466f 7263  ..        # Forc
+00013a80: 6520 7573 6572 5f63 6163 6865 5f64 6972  e user_cache_dir
+00013a90: 2074 6f20 7573 6520 7468 6520 7465 6d70   to use the temp
+00013aa0: 6f72 6172 7920 6469 7265 6374 6f72 7920  orary directory 
+00013ab0: 666f 7220 6561 7369 6572 2061 7373 6572  for easier asser
+00013ac0: 7469 6f6e 730a 2020 2020 2020 2020 7061  tions.        pa
+00013ad0: 7463 685f 7573 6572 5f63 6163 6865 5f64  tch_user_cache_d
+00013ae0: 6972 203d 2070 6174 6368 280a 2020 2020  ir = patch(.    
+00013af0: 2020 2020 2020 2020 7461 7267 6574 3d22          target="
+00013b00: 6365 7263 6973 2e63 6163 6865 2e75 7365  cercis.cache.use
+00013b10: 725f 6361 6368 655f 6469 7222 2c0a 2020  r_cache_dir",.  
+00013b20: 2020 2020 2020 2020 2020 6175 746f 7370            autosp
+00013b30: 6563 3d54 7275 652c 0a20 2020 2020 2020  ec=True,.       
+00013b40: 2020 2020 2072 6574 7572 6e5f 7661 6c75       return_valu
+00013b50: 653d 7374 7228 776f 726b 7370 6163 6531  e=str(workspace1
+00013b60: 292c 0a20 2020 2020 2020 2029 0a0a 2020  ),.        )..  
+00013b70: 2020 2020 2020 2320 4966 2042 4c41 434b        # If BLACK
+00013b80: 5f43 4143 4845 5f44 4952 2069 7320 6e6f  _CACHE_DIR is no
+00013b90: 7420 7365 742c 2075 7365 2075 7365 725f  t set, use user_
+00013ba0: 6361 6368 655f 6469 720a 2020 2020 2020  cache_dir.      
+00013bb0: 2020 6d6f 6e6b 6579 7061 7463 682e 6465    monkeypatch.de
+00013bc0: 6c65 6e76 2822 424c 4143 4b5f 4341 4348  lenv("BLACK_CACH
+00013bd0: 455f 4449 5222 2c20 7261 6973 696e 673d  E_DIR", raising=
+00013be0: 4661 6c73 6529 0a20 2020 2020 2020 2077  False).        w
+00013bf0: 6974 6820 7061 7463 685f 7573 6572 5f63  ith patch_user_c
+00013c00: 6163 6865 5f64 6972 3a0a 2020 2020 2020  ache_dir:.      
+00013c10: 2020 2020 2020 6173 7365 7274 2067 6574        assert get
+00013c20: 5f63 6163 6865 5f64 6972 2829 203d 3d20  _cache_dir() == 
+00013c30: 776f 726b 7370 6163 6531 0a0a 2020 2020  workspace1..    
+00013c40: 2020 2020 2320 4966 2069 7420 6973 2073      # If it is s
+00013c50: 6574 2c20 7573 6520 7468 6520 7061 7468  et, use the path
+00013c60: 2070 726f 7669 6465 6420 696e 2074 6865   provided in the
+00013c70: 2065 6e76 2076 6172 2e0a 2020 2020 2020   env var..      
+00013c80: 2020 6d6f 6e6b 6579 7061 7463 682e 7365    monkeypatch.se
+00013c90: 7465 6e76 2822 424c 4143 4b5f 4341 4348  tenv("BLACK_CACH
+00013ca0: 455f 4449 5222 2c20 7374 7228 776f 726b  E_DIR", str(work
+00013cb0: 7370 6163 6532 2929 0a20 2020 2020 2020  space2)).       
+00013cc0: 2061 7373 6572 7420 6765 745f 6361 6368   assert get_cach
+00013cd0: 655f 6469 7228 2920 3d3d 2077 6f72 6b73  e_dir() == works
+00013ce0: 7061 6365 320a 0a20 2020 2064 6566 2074  pace2..    def t
+00013cf0: 6573 745f 6361 6368 655f 6272 6f6b 656e  est_cache_broken
+00013d00: 5f66 696c 6528 7365 6c66 2920 2d3e 204e  _file(self) -> N
+00013d10: 6f6e 653a 0a20 2020 2020 2020 206d 6f64  one:.        mod
+00013d20: 6520 3d20 4445 4641 554c 545f 4d4f 4445  e = DEFAULT_MODE
+00013d30: 0a20 2020 2020 2020 2077 6974 6820 6361  .        with ca
+00013d40: 6368 655f 6469 7228 2920 6173 2077 6f72  che_dir() as wor
+00013d50: 6b73 7061 6365 3a0a 2020 2020 2020 2020  kspace:.        
+00013d60: 2020 2020 6361 6368 655f 6669 6c65 203d      cache_file =
+00013d70: 2067 6574 5f63 6163 6865 5f66 696c 6528   get_cache_file(
+00013d80: 6d6f 6465 290a 2020 2020 2020 2020 2020  mode).          
+00013d90: 2020 6361 6368 655f 6669 6c65 2e77 7269    cache_file.wri
+00013da0: 7465 5f74 6578 7428 2274 6869 7320 6973  te_text("this is
+00013db0: 206e 6f74 2061 2070 6963 6b6c 6522 290a   not a pickle").
+00013dc0: 2020 2020 2020 2020 2020 2020 6173 7365              asse
+00013dd0: 7274 2063 6572 6369 732e 7265 6164 5f63  rt cercis.read_c
+00013de0: 6163 6865 286d 6f64 6529 203d 3d20 7b7d  ache(mode) == {}
+00013df0: 0a20 2020 2020 2020 2020 2020 2073 7263  .            src
+00013e00: 203d 2028 776f 726b 7370 6163 6520 2f20   = (workspace / 
+00013e10: 2274 6573 742e 7079 2229 2e72 6573 6f6c  "test.py").resol
+00013e20: 7665 2829 0a20 2020 2020 2020 2020 2020  ve().           
+00013e30: 2073 7263 2e77 7269 7465 5f74 6578 7428   src.write_text(
+00013e40: 2270 7269 6e74 2827 6865 6c6c 6f27 2922  "print('hello')"
+00013e50: 290a 2020 2020 2020 2020 2020 2020 696e  ).            in
+00013e60: 766f 6b65 426c 6163 6b28 5b73 7472 2873  vokeBlack([str(s
+00013e70: 7263 295d 290a 2020 2020 2020 2020 2020  rc)]).          
+00013e80: 2020 6361 6368 6520 3d20 6365 7263 6973    cache = cercis
+00013e90: 2e72 6561 645f 6361 6368 6528 6d6f 6465  .read_cache(mode
+00013ea0: 290a 2020 2020 2020 2020 2020 2020 6173  ).            as
+00013eb0: 7365 7274 2073 7472 2873 7263 2920 696e  sert str(src) in
+00013ec0: 2063 6163 6865 0a0a 2020 2020 6465 6620   cache..    def 
+00013ed0: 7465 7374 5f63 6163 6865 5f73 696e 676c  test_cache_singl
+00013ee0: 655f 6669 6c65 5f61 6c72 6561 6479 5f63  e_file_already_c
+00013ef0: 6163 6865 6428 7365 6c66 2920 2d3e 204e  ached(self) -> N
+00013f00: 6f6e 653a 0a20 2020 2020 2020 206d 6f64  one:.        mod
+00013f10: 6520 3d20 4445 4641 554c 545f 4d4f 4445  e = DEFAULT_MODE
+00013f20: 0a20 2020 2020 2020 2077 6974 6820 6361  .        with ca
+00013f30: 6368 655f 6469 7228 2920 6173 2077 6f72  che_dir() as wor
+00013f40: 6b73 7061 6365 3a0a 2020 2020 2020 2020  kspace:.        
+00013f50: 2020 2020 7372 6320 3d20 2877 6f72 6b73      src = (works
+00013f60: 7061 6365 202f 2022 7465 7374 2e70 7922  pace / "test.py"
+00013f70: 292e 7265 736f 6c76 6528 290a 2020 2020  ).resolve().    
+00013f80: 2020 2020 2020 2020 7372 632e 7772 6974          src.writ
+00013f90: 655f 7465 7874 2822 7072 696e 7428 2768  e_text("print('h
+00013fa0: 656c 6c6f 2729 2229 0a20 2020 2020 2020  ello')").       
+00013fb0: 2020 2020 2063 6572 6369 732e 7772 6974       cercis.writ
+00013fc0: 655f 6361 6368 6528 7b7d 2c20 5b73 7263  e_cache({}, [src
+00013fd0: 5d2c 206d 6f64 6529 0a20 2020 2020 2020  ], mode).       
+00013fe0: 2020 2020 2069 6e76 6f6b 6542 6c61 636b       invokeBlack
+00013ff0: 285b 7374 7228 7372 6329 5d29 0a20 2020  ([str(src)]).   
+00014000: 2020 2020 2020 2020 2061 7373 6572 7420           assert 
+00014010: 7372 632e 7265 6164 5f74 6578 7428 2920  src.read_text() 
+00014020: 3d3d 2022 7072 696e 7428 2768 656c 6c6f  == "print('hello
+00014030: 2729 220a 0a20 2020 2040 6576 656e 745f  ')"..    @event_
+00014040: 6c6f 6f70 2829 0a20 2020 2064 6566 2074  loop().    def t
+00014050: 6573 745f 6361 6368 655f 6d75 6c74 6970  est_cache_multip
+00014060: 6c65 5f66 696c 6573 2873 656c 6629 202d  le_files(self) -
+00014070: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+00014080: 6d6f 6465 203d 2044 4546 4155 4c54 5f4d  mode = DEFAULT_M
+00014090: 4f44 450a 2020 2020 2020 2020 7769 7468  ODE.        with
+000140a0: 2063 6163 6865 5f64 6972 2829 2061 7320   cache_dir() as 
+000140b0: 776f 726b 7370 6163 652c 2070 6174 6368  workspace, patch
+000140c0: 280a 2020 2020 2020 2020 2020 2020 2263  (.            "c
+000140d0: 6f6e 6375 7272 656e 742e 6675 7475 7265  oncurrent.future
+000140e0: 732e 5072 6f63 6573 7350 6f6f 6c45 7865  s.ProcessPoolExe
+000140f0: 6375 746f 7222 2c20 6e65 773d 5468 7265  cutor", new=Thre
+00014100: 6164 506f 6f6c 4578 6563 7574 6f72 0a20  adPoolExecutor. 
+00014110: 2020 2020 2020 2029 3a0a 2020 2020 2020         ):.      
+00014120: 2020 2020 2020 6f6e 6520 3d20 2877 6f72        one = (wor
+00014130: 6b73 7061 6365 202f 2022 6f6e 652e 7079  kspace / "one.py
+00014140: 2229 2e72 6573 6f6c 7665 2829 0a20 2020  ").resolve().   
+00014150: 2020 2020 2020 2020 2077 6974 6820 6f6e           with on
+00014160: 652e 6f70 656e 2822 7722 2920 6173 2066  e.open("w") as f
+00014170: 6f62 6a3a 0a20 2020 2020 2020 2020 2020  obj:.           
+00014180: 2020 2020 2066 6f62 6a2e 7772 6974 6528       fobj.write(
+00014190: 2270 7269 6e74 2827 6865 6c6c 6f27 2922  "print('hello')"
+000141a0: 290a 2020 2020 2020 2020 2020 2020 7477  ).            tw
+000141b0: 6f20 3d20 2877 6f72 6b73 7061 6365 202f  o = (workspace /
+000141c0: 2022 7477 6f2e 7079 2229 2e72 6573 6f6c   "two.py").resol
+000141d0: 7665 2829 0a20 2020 2020 2020 2020 2020  ve().           
+000141e0: 2077 6974 6820 7477 6f2e 6f70 656e 2822   with two.open("
+000141f0: 7722 2920 6173 2066 6f62 6a3a 0a20 2020  w") as fobj:.   
+00014200: 2020 2020 2020 2020 2020 2020 2066 6f62               fob
+00014210: 6a2e 7772 6974 6528 2270 7269 6e74 2827  j.write("print('
+00014220: 6865 6c6c 6f27 2922 290a 2020 2020 2020  hello')").      
+00014230: 2020 2020 2020 6365 7263 6973 2e77 7269        cercis.wri
+00014240: 7465 5f63 6163 6865 287b 7d2c 205b 6f6e  te_cache({}, [on
+00014250: 655d 2c20 6d6f 6465 290a 2020 2020 2020  e], mode).      
+00014260: 2020 2020 2020 696e 766f 6b65 426c 6163        invokeBlac
+00014270: 6b28 5b73 7472 2877 6f72 6b73 7061 6365  k([str(workspace
+00014280: 292c 2022 2d2d 7369 6e67 6c65 2d71 756f  ), "--single-quo
+00014290: 7465 3d46 616c 7365 225d 290a 2020 2020  te=False"]).    
+000142a0: 2020 2020 2020 2020 7769 7468 206f 6e65          with one
+000142b0: 2e6f 7065 6e28 2272 2229 2061 7320 666f  .open("r") as fo
+000142c0: 626a 3a0a 2020 2020 2020 2020 2020 2020  bj:.            
+000142d0: 2020 2020 6173 7365 7274 2066 6f62 6a2e      assert fobj.
+000142e0: 7265 6164 2829 203d 3d20 2270 7269 6e74  read() == "print
+000142f0: 2827 6865 6c6c 6f27 2922 0a20 2020 2020  ('hello')".     
+00014300: 2020 2020 2020 2077 6974 6820 7477 6f2e         with two.
+00014310: 6f70 656e 2822 7222 2920 6173 2066 6f62  open("r") as fob
+00014320: 6a3a 0a20 2020 2020 2020 2020 2020 2020  j:.             
+00014330: 2020 2061 7373 6572 7420 666f 626a 2e72     assert fobj.r
+00014340: 6561 6428 2920 3d3d 2027 7072 696e 7428  ead() == 'print(
+00014350: 2268 656c 6c6f 2229 5c6e 270a 2020 2020  "hello")\n'.    
+00014360: 2020 2020 2020 2020 6361 6368 6520 3d20          cache = 
+00014370: 6365 7263 6973 2e72 6561 645f 6361 6368  cercis.read_cach
+00014380: 6528 6d6f 6465 290a 2020 2020 2020 2020  e(mode).        
+00014390: 2020 2020 6173 7365 7274 2073 7472 286f      assert str(o
+000143a0: 6e65 2920 696e 2063 6163 6865 0a20 2020  ne) in cache.   
+000143b0: 2020 2020 2020 2020 2061 7373 6572 7420           assert 
+000143c0: 7374 7228 7477 6f29 2069 6e20 6361 6368  str(two) in cach
+000143d0: 650a 0a20 2020 2040 7079 7465 7374 2e6d  e..    @pytest.m
+000143e0: 6172 6b2e 7061 7261 6d65 7472 697a 6528  ark.parametrize(
+000143f0: 2263 6f6c 6f72 222c 205b 4661 6c73 652c  "color", [False,
+00014400: 2054 7275 655d 2c20 6964 733d 5b22 6e6f   True], ids=["no
+00014410: 2d63 6f6c 6f72 222c 2022 7769 7468 2d63  -color", "with-c
+00014420: 6f6c 6f72 225d 290a 2020 2020 6465 6620  olor"]).    def 
+00014430: 7465 7374 5f6e 6f5f 6361 6368 655f 7768  test_no_cache_wh
+00014440: 656e 5f77 7269 7465 6261 636b 5f64 6966  en_writeback_dif
+00014450: 6628 7365 6c66 2c20 636f 6c6f 723a 2062  f(self, color: b
+00014460: 6f6f 6c29 202d 3e20 4e6f 6e65 3a0a 2020  ool) -> None:.  
+00014470: 2020 2020 2020 6d6f 6465 203d 2044 4546        mode = DEF
+00014480: 4155 4c54 5f4d 4f44 450a 2020 2020 2020  AULT_MODE.      
+00014490: 2020 7769 7468 2063 6163 6865 5f64 6972    with cache_dir
+000144a0: 2829 2061 7320 776f 726b 7370 6163 653a  () as workspace:
+000144b0: 0a20 2020 2020 2020 2020 2020 2073 7263  .            src
+000144c0: 203d 2028 776f 726b 7370 6163 6520 2f20   = (workspace / 
+000144d0: 2274 6573 742e 7079 2229 2e72 6573 6f6c  "test.py").resol
+000144e0: 7665 2829 0a20 2020 2020 2020 2020 2020  ve().           
+000144f0: 2077 6974 6820 7372 632e 6f70 656e 2822   with src.open("
+00014500: 7722 2920 6173 2066 6f62 6a3a 0a20 2020  w") as fobj:.   
+00014510: 2020 2020 2020 2020 2020 2020 2066 6f62               fob
+00014520: 6a2e 7772 6974 6528 2270 7269 6e74 2827  j.write("print('
+00014530: 6865 6c6c 6f27 2922 290a 2020 2020 2020  hello')").      
+00014540: 2020 2020 2020 7769 7468 2070 6174 6368        with patch
+00014550: 2822 6365 7263 6973 2e72 6561 645f 6361  ("cercis.read_ca
+00014560: 6368 6522 2920 6173 2072 6561 645f 6361  che") as read_ca
+00014570: 6368 652c 2070 6174 6368 280a 2020 2020  che, patch(.    
+00014580: 2020 2020 2020 2020 2020 2020 2263 6572              "cer
+00014590: 6369 732e 7772 6974 655f 6361 6368 6522  cis.write_cache"
+000145a0: 0a20 2020 2020 2020 2020 2020 2029 2061  .            ) a
+000145b0: 7320 7772 6974 655f 6361 6368 653a 0a20  s write_cache:. 
+000145c0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+000145d0: 6d64 203d 205b 7374 7228 7372 6329 2c20  md = [str(src), 
+000145e0: 222d 2d64 6966 6622 5d0a 2020 2020 2020  "--diff"].      
+000145f0: 2020 2020 2020 2020 2020 6966 2063 6f6c            if col
+00014600: 6f72 3a0a 2020 2020 2020 2020 2020 2020  or:.            
+00014610: 2020 2020 2020 2020 636d 642e 6170 7065          cmd.appe
+00014620: 6e64 2822 2d2d 636f 6c6f 7222 290a 2020  nd("--color").  
+00014630: 2020 2020 2020 2020 2020 2020 2020 696e                in
+00014640: 766f 6b65 426c 6163 6b28 636d 6429 0a20  vokeBlack(cmd). 
+00014650: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00014660: 6163 6865 5f66 696c 6520 3d20 6765 745f  ache_file = get_
+00014670: 6361 6368 655f 6669 6c65 286d 6f64 6529  cache_file(mode)
+00014680: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014690: 2061 7373 6572 7420 6361 6368 655f 6669   assert cache_fi
+000146a0: 6c65 2e65 7869 7374 7328 2920 6973 2046  le.exists() is F
+000146b0: 616c 7365 0a20 2020 2020 2020 2020 2020  alse.           
+000146c0: 2020 2020 2077 7269 7465 5f63 6163 6865       write_cache
+000146d0: 2e61 7373 6572 745f 6e6f 745f 6361 6c6c  .assert_not_call
+000146e0: 6564 2829 0a20 2020 2020 2020 2020 2020  ed().           
+000146f0: 2020 2020 2072 6561 645f 6361 6368 652e       read_cache.
+00014700: 6173 7365 7274 5f6e 6f74 5f63 616c 6c65  assert_not_calle
+00014710: 6428 290a 0a20 2020 2040 7079 7465 7374  d()..    @pytest
+00014720: 2e6d 6172 6b2e 7061 7261 6d65 7472 697a  .mark.parametriz
+00014730: 6528 2263 6f6c 6f72 222c 205b 4661 6c73  e("color", [Fals
+00014740: 652c 2054 7275 655d 2c20 6964 733d 5b22  e, True], ids=["
+00014750: 6e6f 2d63 6f6c 6f72 222c 2022 7769 7468  no-color", "with
+00014760: 2d63 6f6c 6f72 225d 290a 2020 2020 4065  -color"]).    @e
+00014770: 7665 6e74 5f6c 6f6f 7028 290a 2020 2020  vent_loop().    
+00014780: 6465 6620 7465 7374 5f6f 7574 7075 745f  def test_output_
+00014790: 6c6f 636b 696e 675f 7768 656e 5f77 7269  locking_when_wri
+000147a0: 7465 6261 636b 5f64 6966 6628 7365 6c66  teback_diff(self
+000147b0: 2c20 636f 6c6f 723a 2062 6f6f 6c29 202d  , color: bool) -
+000147c0: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+000147d0: 7769 7468 2063 6163 6865 5f64 6972 2829  with cache_dir()
+000147e0: 2061 7320 776f 726b 7370 6163 653a 0a20   as workspace:. 
+000147f0: 2020 2020 2020 2020 2020 2066 6f72 2074             for t
+00014800: 6167 2069 6e20 7261 6e67 6528 302c 2034  ag in range(0, 4
+00014810: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00014820: 2020 2073 7263 203d 2028 776f 726b 7370     src = (worksp
+00014830: 6163 6520 2f20 6622 7465 7374 7b74 6167  ace / f"test{tag
+00014840: 7d2e 7079 2229 2e72 6573 6f6c 7665 2829  }.py").resolve()
+00014850: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014860: 2077 6974 6820 7372 632e 6f70 656e 2822   with src.open("
+00014870: 7722 2920 6173 2066 6f62 6a3a 0a20 2020  w") as fobj:.   
+00014880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014890: 2066 6f62 6a2e 7772 6974 6528 2270 7269   fobj.write("pri
+000148a0: 6e74 2827 6865 6c6c 6f27 2922 290a 2020  nt('hello')").  
+000148b0: 2020 2020 2020 2020 2020 7769 7468 2070            with p
+000148c0: 6174 6368 280a 2020 2020 2020 2020 2020  atch(.          
+000148d0: 2020 2020 2020 2263 6572 6369 732e 636f        "cercis.co
+000148e0: 6e63 7572 7265 6e63 792e 4d61 6e61 6765  ncurrency.Manage
+000148f0: 7222 2c20 7772 6170 733d 6d75 6c74 6970  r", wraps=multip
+00014900: 726f 6365 7373 696e 672e 4d61 6e61 6765  rocessing.Manage
+00014910: 720a 2020 2020 2020 2020 2020 2020 2920  r.            ) 
+00014920: 6173 206d 6772 3a0a 2020 2020 2020 2020  as mgr:.        
+00014930: 2020 2020 2020 2020 636d 6420 3d20 5b22          cmd = ["
+00014940: 2d2d 6469 6666 222c 2073 7472 2877 6f72  --diff", str(wor
+00014950: 6b73 7061 6365 295d 0a20 2020 2020 2020  kspace)].       
+00014960: 2020 2020 2020 2020 2069 6620 636f 6c6f           if colo
+00014970: 723a 0a20 2020 2020 2020 2020 2020 2020  r:.             
+00014980: 2020 2020 2020 2063 6d64 2e61 7070 656e         cmd.appen
+00014990: 6428 222d 2d63 6f6c 6f72 2229 0a20 2020  d("--color").   
+000149a0: 2020 2020 2020 2020 2020 2020 2069 6e76               inv
+000149b0: 6f6b 6542 6c61 636b 2863 6d64 2c20 6578  okeBlack(cmd, ex
+000149c0: 6974 5f63 6f64 653d 3029 0a20 2020 2020  it_code=0).     
+000149d0: 2020 2020 2020 2020 2020 2023 2074 6869             # thi
+000149e0: 7320 6973 6e27 7420 7175 6974 6520 646f  s isn't quite do
+000149f0: 696e 6720 7768 6174 2077 6520 7761 6e74  ing what we want
+00014a00: 2c20 6275 7420 6966 2069 7420 5f69 736e  , but if it _isn
+00014a10: 2774 5f0a 2020 2020 2020 2020 2020 2020  't_.            
+00014a20: 2020 2020 2320 6361 6c6c 6564 2074 6865      # called the
+00014a30: 6e20 7765 2063 616e 6e6f 7420 6265 2075  n we cannot be u
+00014a40: 7369 6e67 2074 6865 206c 6f63 6b20 6974  sing the lock it
+00014a50: 2070 726f 7669 6465 730a 2020 2020 2020   provides.      
+00014a60: 2020 2020 2020 2020 2020 6d67 722e 6173            mgr.as
+00014a70: 7365 7274 5f63 616c 6c65 6428 290a 0a20  sert_called().. 
+00014a80: 2020 2064 6566 2074 6573 745f 6e6f 5f63     def test_no_c
+00014a90: 6163 6865 5f77 6865 6e5f 7374 6469 6e28  ache_when_stdin(
+00014aa0: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
+00014ab0: 2020 2020 2020 206d 6f64 6520 3d20 4445         mode = DE
+00014ac0: 4641 554c 545f 4d4f 4445 0a20 2020 2020  FAULT_MODE.     
+00014ad0: 2020 2077 6974 6820 6361 6368 655f 6469     with cache_di
+00014ae0: 7228 293a 0a20 2020 2020 2020 2020 2020  r():.           
+00014af0: 2072 6573 756c 7420 3d20 436c 6952 756e   result = CliRun
+00014b00: 6e65 7228 292e 696e 766f 6b65 280a 2020  ner().invoke(.  
+00014b10: 2020 2020 2020 2020 2020 2020 2020 6365                ce
+00014b20: 7263 6973 2e6d 6169 6e2c 205b 222d 225d  rcis.main, ["-"]
+00014b30: 2c20 696e 7075 743d 4279 7465 7349 4f28  , input=BytesIO(
+00014b40: 6222 7072 696e 7428 2768 656c 6c6f 2729  b"print('hello')
+00014b50: 2229 0a20 2020 2020 2020 2020 2020 2029  ").            )
+00014b60: 0a20 2020 2020 2020 2020 2020 2061 7373  .            ass
+00014b70: 6572 7420 6e6f 7420 7265 7375 6c74 2e65  ert not result.e
+00014b80: 7869 745f 636f 6465 0a20 2020 2020 2020  xit_code.       
+00014b90: 2020 2020 2063 6163 6865 5f66 696c 6520       cache_file 
+00014ba0: 3d20 6765 745f 6361 6368 655f 6669 6c65  = get_cache_file
+00014bb0: 286d 6f64 6529 0a20 2020 2020 2020 2020  (mode).         
+00014bc0: 2020 2061 7373 6572 7420 6e6f 7420 6361     assert not ca
+00014bd0: 6368 655f 6669 6c65 2e65 7869 7374 7328  che_file.exists(
+00014be0: 290a 0a20 2020 2064 6566 2074 6573 745f  )..    def test_
+00014bf0: 7265 6164 5f63 6163 6865 5f6e 6f5f 6361  read_cache_no_ca
+00014c00: 6368 6566 696c 6528 7365 6c66 2920 2d3e  chefile(self) ->
+00014c10: 204e 6f6e 653a 0a20 2020 2020 2020 206d   None:.        m
+00014c20: 6f64 6520 3d20 4445 4641 554c 545f 4d4f  ode = DEFAULT_MO
+00014c30: 4445 0a20 2020 2020 2020 2077 6974 6820  DE.        with 
+00014c40: 6361 6368 655f 6469 7228 293a 0a20 2020  cache_dir():.   
+00014c50: 2020 2020 2020 2020 2061 7373 6572 7420           assert 
+00014c60: 6365 7263 6973 2e72 6561 645f 6361 6368  cercis.read_cach
+00014c70: 6528 6d6f 6465 2920 3d3d 207b 7d0a 0a20  e(mode) == {}.. 
+00014c80: 2020 2064 6566 2074 6573 745f 7772 6974     def test_writ
+00014c90: 655f 6361 6368 655f 7265 6164 5f63 6163  e_cache_read_cac
+00014ca0: 6865 2873 656c 6629 202d 3e20 4e6f 6e65  he(self) -> None
+00014cb0: 3a0a 2020 2020 2020 2020 6d6f 6465 203d  :.        mode =
+00014cc0: 2044 4546 4155 4c54 5f4d 4f44 450a 2020   DEFAULT_MODE.  
+00014cd0: 2020 2020 2020 7769 7468 2063 6163 6865        with cache
+00014ce0: 5f64 6972 2829 2061 7320 776f 726b 7370  _dir() as worksp
+00014cf0: 6163 653a 0a20 2020 2020 2020 2020 2020  ace:.           
+00014d00: 2073 7263 203d 2028 776f 726b 7370 6163   src = (workspac
+00014d10: 6520 2f20 2274 6573 742e 7079 2229 2e72  e / "test.py").r
+00014d20: 6573 6f6c 7665 2829 0a20 2020 2020 2020  esolve().       
+00014d30: 2020 2020 2073 7263 2e74 6f75 6368 2829       src.touch()
+00014d40: 0a20 2020 2020 2020 2020 2020 2063 6572  .            cer
+00014d50: 6369 732e 7772 6974 655f 6361 6368 6528  cis.write_cache(
+00014d60: 7b7d 2c20 5b73 7263 5d2c 206d 6f64 6529  {}, [src], mode)
+00014d70: 0a20 2020 2020 2020 2020 2020 2063 6163  .            cac
+00014d80: 6865 203d 2063 6572 6369 732e 7265 6164  he = cercis.read
+00014d90: 5f63 6163 6865 286d 6f64 6529 0a20 2020  _cache(mode).   
+00014da0: 2020 2020 2020 2020 2061 7373 6572 7420           assert 
+00014db0: 7374 7228 7372 6329 2069 6e20 6361 6368  str(src) in cach
+00014dc0: 650a 2020 2020 2020 2020 2020 2020 6173  e.            as
+00014dd0: 7365 7274 2063 6163 6865 5b73 7472 2873  sert cache[str(s
+00014de0: 7263 295d 203d 3d20 6365 7263 6973 2e67  rc)] == cercis.g
+00014df0: 6574 5f63 6163 6865 5f69 6e66 6f28 7372  et_cache_info(sr
+00014e00: 6329 0a0a 2020 2020 6465 6620 7465 7374  c)..    def test
+00014e10: 5f66 696c 7465 725f 6361 6368 6564 2873  _filter_cached(s
+00014e20: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
+00014e30: 2020 2020 2020 7769 7468 2054 656d 706f        with Tempo
+00014e40: 7261 7279 4469 7265 6374 6f72 7928 2920  raryDirectory() 
+00014e50: 6173 2077 6f72 6b73 7061 6365 3a0a 2020  as workspace:.  
+00014e60: 2020 2020 2020 2020 2020 7061 7468 203d            path =
+00014e70: 2050 6174 6828 776f 726b 7370 6163 6529   Path(workspace)
+00014e80: 0a20 2020 2020 2020 2020 2020 2075 6e63  .            unc
+00014e90: 6163 6865 6420 3d20 2870 6174 6820 2f20  ached = (path / 
+00014ea0: 2275 6e63 6163 6865 6422 292e 7265 736f  "uncached").reso
+00014eb0: 6c76 6528 290a 2020 2020 2020 2020 2020  lve().          
+00014ec0: 2020 6361 6368 6564 203d 2028 7061 7468    cached = (path
+00014ed0: 202f 2022 6361 6368 6564 2229 2e72 6573   / "cached").res
+00014ee0: 6f6c 7665 2829 0a20 2020 2020 2020 2020  olve().         
+00014ef0: 2020 2063 6163 6865 645f 6275 745f 6368     cached_but_ch
+00014f00: 616e 6765 6420 3d20 2870 6174 6820 2f20  anged = (path / 
+00014f10: 2263 6861 6e67 6564 2229 2e72 6573 6f6c  "changed").resol
+00014f20: 7665 2829 0a20 2020 2020 2020 2020 2020  ve().           
+00014f30: 2075 6e63 6163 6865 642e 746f 7563 6828   uncached.touch(
+00014f40: 290a 2020 2020 2020 2020 2020 2020 6361  ).            ca
+00014f50: 6368 6564 2e74 6f75 6368 2829 0a20 2020  ched.touch().   
+00014f60: 2020 2020 2020 2020 2063 6163 6865 645f           cached_
+00014f70: 6275 745f 6368 616e 6765 642e 746f 7563  but_changed.touc
+00014f80: 6828 290a 2020 2020 2020 2020 2020 2020  h().            
+00014f90: 6361 6368 6520 3d20 7b0a 2020 2020 2020  cache = {.      
+00014fa0: 2020 2020 2020 2020 2020 7374 7228 6361            str(ca
+00014fb0: 6368 6564 293a 2063 6572 6369 732e 6765  ched): cercis.ge
+00014fc0: 745f 6361 6368 655f 696e 666f 2863 6163  t_cache_info(cac
+00014fd0: 6865 6429 2c0a 2020 2020 2020 2020 2020  hed),.          
+00014fe0: 2020 2020 2020 7374 7228 6361 6368 6564        str(cached
+00014ff0: 5f62 7574 5f63 6861 6e67 6564 293a 2028  _but_changed): (
+00015000: 302e 302c 2030 292c 0a20 2020 2020 2020  0.0, 0),.       
+00015010: 2020 2020 207d 0a20 2020 2020 2020 2020       }.         
+00015020: 2020 2074 6f64 6f2c 2064 6f6e 6520 3d20     todo, done = 
+00015030: 6365 7263 6973 2e63 6163 6865 2e66 696c  cercis.cache.fil
+00015040: 7465 725f 6361 6368 6564 280a 2020 2020  ter_cached(.    
+00015050: 2020 2020 2020 2020 2020 2020 6361 6368              cach
+00015060: 652c 207b 756e 6361 6368 6564 2c20 6361  e, {uncached, ca
+00015070: 6368 6564 2c20 6361 6368 6564 5f62 7574  ched, cached_but
+00015080: 5f63 6861 6e67 6564 7d0a 2020 2020 2020  _changed}.      
+00015090: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+000150a0: 2020 2020 6173 7365 7274 2074 6f64 6f20      assert todo 
+000150b0: 3d3d 207b 756e 6361 6368 6564 2c20 6361  == {uncached, ca
+000150c0: 6368 6564 5f62 7574 5f63 6861 6e67 6564  ched_but_changed
+000150d0: 7d0a 2020 2020 2020 2020 2020 2020 6173  }.            as
+000150e0: 7365 7274 2064 6f6e 6520 3d3d 207b 6361  sert done == {ca
+000150f0: 6368 6564 7d0a 0a20 2020 2064 6566 2074  ched}..    def t
+00015100: 6573 745f 7772 6974 655f 6361 6368 655f  est_write_cache_
+00015110: 6372 6561 7465 735f 6469 7265 6374 6f72  creates_director
+00015120: 795f 6966 5f6e 6565 6465 6428 7365 6c66  y_if_needed(self
+00015130: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+00015140: 2020 206d 6f64 6520 3d20 4445 4641 554c     mode = DEFAUL
+00015150: 545f 4d4f 4445 0a20 2020 2020 2020 2077  T_MODE.        w
+00015160: 6974 6820 6361 6368 655f 6469 7228 6578  ith cache_dir(ex
+00015170: 6973 7473 3d46 616c 7365 2920 6173 2077  ists=False) as w
+00015180: 6f72 6b73 7061 6365 3a0a 2020 2020 2020  orkspace:.      
+00015190: 2020 2020 2020 6173 7365 7274 206e 6f74        assert not
+000151a0: 2077 6f72 6b73 7061 6365 2e65 7869 7374   workspace.exist
+000151b0: 7328 290a 2020 2020 2020 2020 2020 2020  s().            
+000151c0: 6365 7263 6973 2e77 7269 7465 5f63 6163  cercis.write_cac
+000151d0: 6865 287b 7d2c 205b 5d2c 206d 6f64 6529  he({}, [], mode)
+000151e0: 0a20 2020 2020 2020 2020 2020 2061 7373  .            ass
+000151f0: 6572 7420 776f 726b 7370 6163 652e 6578  ert workspace.ex
+00015200: 6973 7473 2829 0a0a 2020 2020 4065 7665  ists()..    @eve
+00015210: 6e74 5f6c 6f6f 7028 290a 2020 2020 6465  nt_loop().    de
+00015220: 6620 7465 7374 5f66 6169 6c65 645f 666f  f test_failed_fo
+00015230: 726d 6174 7469 6e67 5f64 6f65 735f 6e6f  rmatting_does_no
+00015240: 745f 6765 745f 6361 6368 6564 2873 656c  t_get_cached(sel
+00015250: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
+00015260: 2020 2020 6d6f 6465 203d 2044 4546 4155      mode = DEFAU
+00015270: 4c54 5f4d 4f44 450a 2020 2020 2020 2020  LT_MODE.        
+00015280: 7769 7468 2063 6163 6865 5f64 6972 2829  with cache_dir()
+00015290: 2061 7320 776f 726b 7370 6163 652c 2070   as workspace, p
+000152a0: 6174 6368 280a 2020 2020 2020 2020 2020  atch(.          
+000152b0: 2020 2263 6f6e 6375 7272 656e 742e 6675    "concurrent.fu
+000152c0: 7475 7265 732e 5072 6f63 6573 7350 6f6f  tures.ProcessPoo
+000152d0: 6c45 7865 6375 746f 7222 2c20 6e65 773d  lExecutor", new=
+000152e0: 5468 7265 6164 506f 6f6c 4578 6563 7574  ThreadPoolExecut
+000152f0: 6f72 0a20 2020 2020 2020 2029 3a0a 2020  or.        ):.  
+00015300: 2020 2020 2020 2020 2020 6661 696c 696e            failin
+00015310: 6720 3d20 2877 6f72 6b73 7061 6365 202f  g = (workspace /
+00015320: 2022 6661 696c 696e 672e 7079 2229 2e72   "failing.py").r
+00015330: 6573 6f6c 7665 2829 0a20 2020 2020 2020  esolve().       
+00015340: 2020 2020 2077 6974 6820 6661 696c 696e       with failin
+00015350: 672e 6f70 656e 2822 7722 2920 6173 2066  g.open("w") as f
+00015360: 6f62 6a3a 0a20 2020 2020 2020 2020 2020  obj:.           
+00015370: 2020 2020 2066 6f62 6a2e 7772 6974 6528       fobj.write(
+00015380: 226e 6f74 2061 6374 7561 6c6c 7920 7079  "not actually py
+00015390: 7468 6f6e 2229 0a20 2020 2020 2020 2020  thon").         
+000153a0: 2020 2063 6c65 616e 203d 2028 776f 726b     clean = (work
+000153b0: 7370 6163 6520 2f20 2263 6c65 616e 2e70  space / "clean.p
+000153c0: 7922 292e 7265 736f 6c76 6528 290a 2020  y").resolve().  
+000153d0: 2020 2020 2020 2020 2020 7769 7468 2063            with c
+000153e0: 6c65 616e 2e6f 7065 6e28 2277 2229 2061  lean.open("w") a
+000153f0: 7320 666f 626a 3a0a 2020 2020 2020 2020  s fobj:.        
+00015400: 2020 2020 2020 2020 666f 626a 2e77 7269          fobj.wri
+00015410: 7465 2827 7072 696e 7428 2268 656c 6c6f  te('print("hello
+00015420: 2229 5c6e 2729 0a20 2020 2020 2020 2020  ")\n').         
+00015430: 2020 2069 6e76 6f6b 6542 6c61 636b 285b     invokeBlack([
+00015440: 7374 7228 776f 726b 7370 6163 6529 5d2c  str(workspace)],
+00015450: 2065 7869 745f 636f 6465 3d31 3233 290a   exit_code=123).
+00015460: 2020 2020 2020 2020 2020 2020 6361 6368              cach
+00015470: 6520 3d20 6365 7263 6973 2e72 6561 645f  e = cercis.read_
+00015480: 6361 6368 6528 6d6f 6465 290a 2020 2020  cache(mode).    
+00015490: 2020 2020 2020 2020 6173 7365 7274 2073          assert s
+000154a0: 7472 2866 6169 6c69 6e67 2920 6e6f 7420  tr(failing) not 
+000154b0: 696e 2063 6163 6865 0a20 2020 2020 2020  in cache.       
+000154c0: 2020 2020 2061 7373 6572 7420 7374 7228       assert str(
+000154d0: 636c 6561 6e29 2069 6e20 6361 6368 650a  clean) in cache.
+000154e0: 0a20 2020 2064 6566 2074 6573 745f 7772  .    def test_wr
+000154f0: 6974 655f 6361 6368 655f 7772 6974 655f  ite_cache_write_
+00015500: 6661 696c 2873 656c 6629 202d 3e20 4e6f  fail(self) -> No
+00015510: 6e65 3a0a 2020 2020 2020 2020 6d6f 6465  ne:.        mode
+00015520: 203d 2044 4546 4155 4c54 5f4d 4f44 450a   = DEFAULT_MODE.
+00015530: 2020 2020 2020 2020 7769 7468 2063 6163          with cac
+00015540: 6865 5f64 6972 2829 2c20 7061 7463 682e  he_dir(), patch.
+00015550: 6f62 6a65 6374 2850 6174 682c 2022 6f70  object(Path, "op
+00015560: 656e 2229 2061 7320 6d6f 636b 3a0a 2020  en") as mock:.  
+00015570: 2020 2020 2020 2020 2020 6d6f 636b 2e73            mock.s
+00015580: 6964 655f 6566 6665 6374 203d 204f 5345  ide_effect = OSE
+00015590: 7272 6f72 0a20 2020 2020 2020 2020 2020  rror.           
+000155a0: 2063 6572 6369 732e 7772 6974 655f 6361   cercis.write_ca
+000155b0: 6368 6528 7b7d 2c20 5b5d 2c20 6d6f 6465  che({}, [], mode
+000155c0: 290a 0a20 2020 2064 6566 2074 6573 745f  )..    def test_
+000155d0: 7265 6164 5f63 6163 6865 5f6c 696e 655f  read_cache_line_
+000155e0: 6c65 6e67 7468 7328 7365 6c66 2920 2d3e  lengths(self) ->
+000155f0: 204e 6f6e 653a 0a20 2020 2020 2020 206d   None:.        m
+00015600: 6f64 6520 3d20 4445 4641 554c 545f 4d4f  ode = DEFAULT_MO
+00015610: 4445 0a20 2020 2020 2020 2073 686f 7274  DE.        short
+00015620: 5f6d 6f64 6520 3d20 7265 706c 6163 6528  _mode = replace(
+00015630: 4445 4641 554c 545f 4d4f 4445 2c20 6c69  DEFAULT_MODE, li
+00015640: 6e65 5f6c 656e 6774 683d 3129 0a20 2020  ne_length=1).   
+00015650: 2020 2020 2077 6974 6820 6361 6368 655f       with cache_
+00015660: 6469 7228 2920 6173 2077 6f72 6b73 7061  dir() as workspa
+00015670: 6365 3a0a 2020 2020 2020 2020 2020 2020  ce:.            
+00015680: 7061 7468 203d 2028 776f 726b 7370 6163  path = (workspac
+00015690: 6520 2f20 2266 696c 652e 7079 2229 2e72  e / "file.py").r
+000156a0: 6573 6f6c 7665 2829 0a20 2020 2020 2020  esolve().       
+000156b0: 2020 2020 2070 6174 682e 746f 7563 6828       path.touch(
+000156c0: 290a 2020 2020 2020 2020 2020 2020 6365  ).            ce
+000156d0: 7263 6973 2e77 7269 7465 5f63 6163 6865  rcis.write_cache
+000156e0: 287b 7d2c 205b 7061 7468 5d2c 206d 6f64  ({}, [path], mod
+000156f0: 6529 0a20 2020 2020 2020 2020 2020 206f  e).            o
+00015700: 6e65 203d 2063 6572 6369 732e 7265 6164  ne = cercis.read
+00015710: 5f63 6163 6865 286d 6f64 6529 0a20 2020  _cache(mode).   
+00015720: 2020 2020 2020 2020 2061 7373 6572 7420           assert 
+00015730: 7374 7228 7061 7468 2920 696e 206f 6e65  str(path) in one
+00015740: 0a20 2020 2020 2020 2020 2020 2074 776f  .            two
+00015750: 203d 2063 6572 6369 732e 7265 6164 5f63   = cercis.read_c
+00015760: 6163 6865 2873 686f 7274 5f6d 6f64 6529  ache(short_mode)
+00015770: 0a20 2020 2020 2020 2020 2020 2061 7373  .            ass
+00015780: 6572 7420 7374 7228 7061 7468 2920 6e6f  ert str(path) no
+00015790: 7420 696e 2074 776f 0a0a 0a64 6566 2061  t in two...def a
+000157a0: 7373 6572 745f 636f 6c6c 6563 7465 645f  ssert_collected_
+000157b0: 736f 7572 6365 7328 0a20 2020 2020 2020  sources(.       
+000157c0: 2073 7263 3a20 5365 7175 656e 6365 5b55   src: Sequence[U
+000157d0: 6e69 6f6e 5b73 7472 2c20 5061 7468 5d5d  nion[str, Path]]
+000157e0: 2c0a 2020 2020 2020 2020 6578 7065 6374  ,.        expect
+000157f0: 6564 3a20 5365 7175 656e 6365 5b55 6e69  ed: Sequence[Uni
+00015800: 6f6e 5b73 7472 2c20 5061 7468 5d5d 2c0a  on[str, Path]],.
+00015810: 2020 2020 2020 2020 2a2c 0a20 2020 2020          *,.     
+00015820: 2020 2063 7478 3a20 4f70 7469 6f6e 616c     ctx: Optional
+00015830: 5b46 616b 6543 6f6e 7465 7874 5d20 3d20  [FakeContext] = 
+00015840: 4e6f 6e65 2c0a 2020 2020 2020 2020 6578  None,.        ex
+00015850: 636c 7564 653a 204f 7074 696f 6e61 6c5b  clude: Optional[
+00015860: 7374 725d 203d 204e 6f6e 652c 0a20 2020  str] = None,.   
+00015870: 2020 2020 2069 6e63 6c75 6465 3a20 4f70       include: Op
+00015880: 7469 6f6e 616c 5b73 7472 5d20 3d20 4e6f  tional[str] = No
+00015890: 6e65 2c0a 2020 2020 2020 2020 6578 7465  ne,.        exte
+000158a0: 6e64 5f65 7863 6c75 6465 3a20 4f70 7469  nd_exclude: Opti
+000158b0: 6f6e 616c 5b73 7472 5d20 3d20 4e6f 6e65  onal[str] = None
+000158c0: 2c0a 2020 2020 2020 2020 666f 7263 655f  ,.        force_
+000158d0: 6578 636c 7564 653a 204f 7074 696f 6e61  exclude: Optiona
+000158e0: 6c5b 7374 725d 203d 204e 6f6e 652c 0a20  l[str] = None,. 
+000158f0: 2020 2020 2020 2073 7464 696e 5f66 696c         stdin_fil
+00015900: 656e 616d 653a 204f 7074 696f 6e61 6c5b  ename: Optional[
+00015910: 7374 725d 203d 204e 6f6e 652c 0a29 202d  str] = None,.) -
+00015920: 3e20 4e6f 6e65 3a0a 2020 2020 6773 5f73  > None:.    gs_s
+00015930: 7263 203d 2074 7570 6c65 2873 7472 2850  rc = tuple(str(P
+00015940: 6174 6828 7329 2920 666f 7220 7320 696e  ath(s)) for s in
+00015950: 2073 7263 290a 2020 2020 6773 5f65 7870   src).    gs_exp
+00015960: 6563 7465 6420 3d20 5b50 6174 6828 7329  ected = [Path(s)
+00015970: 2066 6f72 2073 2069 6e20 6578 7065 6374   for s in expect
+00015980: 6564 5d0a 2020 2020 6773 5f65 7863 6c75  ed].    gs_exclu
+00015990: 6465 203d 204e 6f6e 6520 6966 2065 7863  de = None if exc
+000159a0: 6c75 6465 2069 7320 4e6f 6e65 2065 6c73  lude is None els
+000159b0: 6520 636f 6d70 696c 655f 7061 7474 6572  e compile_patter
+000159c0: 6e28 6578 636c 7564 6529 0a20 2020 2067  n(exclude).    g
+000159d0: 735f 696e 636c 7564 6520 3d20 4445 4641  s_include = DEFA
+000159e0: 554c 545f 494e 434c 5544 4520 6966 2069  ULT_INCLUDE if i
+000159f0: 6e63 6c75 6465 2069 7320 4e6f 6e65 2065  nclude is None e
+00015a00: 6c73 6520 636f 6d70 696c 655f 7061 7474  lse compile_patt
+00015a10: 6572 6e28 696e 636c 7564 6529 0a20 2020  ern(include).   
+00015a20: 2067 735f 6578 7465 6e64 5f65 7863 6c75   gs_extend_exclu
+00015a30: 6465 203d 2028 0a20 2020 2020 2020 204e  de = (.        N
+00015a40: 6f6e 6520 6966 2065 7874 656e 645f 6578  one if extend_ex
+00015a50: 636c 7564 6520 6973 204e 6f6e 6520 656c  clude is None el
+00015a60: 7365 2063 6f6d 7069 6c65 5f70 6174 7465  se compile_patte
+00015a70: 726e 2865 7874 656e 645f 6578 636c 7564  rn(extend_exclud
+00015a80: 6529 0a20 2020 2029 0a20 2020 2067 735f  e).    ).    gs_
+00015a90: 666f 7263 655f 6578 636c 7564 6520 3d20  force_exclude = 
+00015aa0: 4e6f 6e65 2069 6620 666f 7263 655f 6578  None if force_ex
+00015ab0: 636c 7564 6520 6973 204e 6f6e 6520 656c  clude is None el
+00015ac0: 7365 2063 6f6d 7069 6c65 5f70 6174 7465  se compile_patte
+00015ad0: 726e 2866 6f72 6365 5f65 7863 6c75 6465  rn(force_exclude
+00015ae0: 290a 2020 2020 636f 6c6c 6563 7465 6420  ).    collected 
+00015af0: 3d20 6365 7263 6973 2e67 6574 5f73 6f75  = cercis.get_sou
+00015b00: 7263 6573 280a 2020 2020 2020 2020 6374  rces(.        ct
+00015b10: 783d 6374 7820 6f72 2046 616b 6543 6f6e  x=ctx or FakeCon
+00015b20: 7465 7874 2829 2c0a 2020 2020 2020 2020  text(),.        
+00015b30: 7372 633d 6773 5f73 7263 2c0a 2020 2020  src=gs_src,.    
+00015b40: 2020 2020 7175 6965 743d 4661 6c73 652c      quiet=False,
+00015b50: 0a20 2020 2020 2020 2076 6572 626f 7365  .        verbose
+00015b60: 3d46 616c 7365 2c0a 2020 2020 2020 2020  =False,.        
+00015b70: 696e 636c 7564 653d 6773 5f69 6e63 6c75  include=gs_inclu
+00015b80: 6465 2c0a 2020 2020 2020 2020 6578 636c  de,.        excl
+00015b90: 7564 653d 6773 5f65 7863 6c75 6465 2c0a  ude=gs_exclude,.
+00015ba0: 2020 2020 2020 2020 6578 7465 6e64 5f65          extend_e
+00015bb0: 7863 6c75 6465 3d67 735f 6578 7465 6e64  xclude=gs_extend
+00015bc0: 5f65 7863 6c75 6465 2c0a 2020 2020 2020  _exclude,.      
+00015bd0: 2020 666f 7263 655f 6578 636c 7564 653d    force_exclude=
+00015be0: 6773 5f66 6f72 6365 5f65 7863 6c75 6465  gs_force_exclude
+00015bf0: 2c0a 2020 2020 2020 2020 7265 706f 7274  ,.        report
+00015c00: 3d63 6572 6369 732e 5265 706f 7274 2829  =cercis.Report()
+00015c10: 2c0a 2020 2020 2020 2020 7374 6469 6e5f  ,.        stdin_
+00015c20: 6669 6c65 6e61 6d65 3d73 7464 696e 5f66  filename=stdin_f
+00015c30: 696c 656e 616d 652c 0a20 2020 2029 0a20  ilename,.    ). 
+00015c40: 2020 2061 7373 6572 7420 736f 7274 6564     assert sorted
+00015c50: 2863 6f6c 6c65 6374 6564 2920 3d3d 2073  (collected) == s
+00015c60: 6f72 7465 6428 6773 5f65 7870 6563 7465  orted(gs_expecte
+00015c70: 6429 0a0a 0a63 6c61 7373 2054 6573 7446  d)...class TestF
+00015c80: 696c 6543 6f6c 6c65 6374 696f 6e3a 0a20  ileCollection:. 
+00015c90: 2020 2064 6566 2074 6573 745f 696e 636c     def test_incl
+00015ca0: 7564 655f 6578 636c 7564 6528 7365 6c66  ude_exclude(self
+00015cb0: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+00015cc0: 2020 2070 6174 6820 3d20 5448 4953 5f44     path = THIS_D
+00015cd0: 4952 202f 2022 6461 7461 2220 2f20 2269  IR / "data" / "i
+00015ce0: 6e63 6c75 6465 5f65 7863 6c75 6465 5f74  nclude_exclude_t
+00015cf0: 6573 7473 220a 2020 2020 2020 2020 7372  ests".        sr
+00015d00: 6320 3d20 5b70 6174 685d 0a20 2020 2020  c = [path].     
+00015d10: 2020 2065 7870 6563 7465 6420 3d20 5b0a     expected = [.
+00015d20: 2020 2020 2020 2020 2020 2020 5061 7468              Path
+00015d30: 2870 6174 6820 2f20 2262 2f64 6f6e 745f  (path / "b/dont_
+00015d40: 6578 636c 7564 652f 612e 7079 2229 2c0a  exclude/a.py"),.
+00015d50: 2020 2020 2020 2020 2020 2020 5061 7468              Path
+00015d60: 2870 6174 6820 2f20 2262 2f64 6f6e 745f  (path / "b/dont_
+00015d70: 6578 636c 7564 652f 612e 7079 6922 292c  exclude/a.pyi"),
+00015d80: 0a20 2020 2020 2020 205d 0a20 2020 2020  .        ].     
+00015d90: 2020 2061 7373 6572 745f 636f 6c6c 6563     assert_collec
+00015da0: 7465 645f 736f 7572 6365 7328 0a20 2020  ted_sources(.   
+00015db0: 2020 2020 2020 2020 2073 7263 2c0a 2020           src,.  
+00015dc0: 2020 2020 2020 2020 2020 6578 7065 6374            expect
+00015dd0: 6564 2c0a 2020 2020 2020 2020 2020 2020  ed,.            
+00015de0: 696e 636c 7564 653d 7222 5c2e 7079 693f  include=r"\.pyi?
+00015df0: 2422 2c0a 2020 2020 2020 2020 2020 2020  $",.            
+00015e00: 6578 636c 7564 653d 7222 2f65 7863 6c75  exclude=r"/exclu
+00015e10: 6465 2f7c 2f5c 2e64 6566 696e 6974 656c  de/|/\.definitel
+00015e20: 795f 6578 636c 7564 652f 222c 0a20 2020  y_exclude/",.   
+00015e30: 2020 2020 2029 0a0a 2020 2020 6465 6620       )..    def 
+00015e40: 7465 7374 5f67 6974 6967 6e6f 7265 5f75  test_gitignore_u
+00015e50: 7365 645f 6173 5f64 6566 6175 6c74 2873  sed_as_default(s
+00015e60: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
+00015e70: 2020 2020 2020 6261 7365 203d 2050 6174        base = Pat
+00015e80: 6828 4441 5441 5f44 4952 202f 2022 696e  h(DATA_DIR / "in
+00015e90: 636c 7564 655f 6578 636c 7564 655f 7465  clude_exclude_te
+00015ea0: 7374 7322 290a 2020 2020 2020 2020 6578  sts").        ex
+00015eb0: 7065 6374 6564 203d 205b 0a20 2020 2020  pected = [.     
+00015ec0: 2020 2020 2020 2062 6173 6520 2f20 2262         base / "b
+00015ed0: 2f2e 6465 6669 6e69 7465 6c79 5f65 7863  /.definitely_exc
+00015ee0: 6c75 6465 2f61 2e70 7922 2c0a 2020 2020  lude/a.py",.    
+00015ef0: 2020 2020 2020 2020 6261 7365 202f 2022          base / "
+00015f00: 622f 2e64 6566 696e 6974 656c 795f 6578  b/.definitely_ex
+00015f10: 636c 7564 652f 612e 7079 6922 2c0a 2020  clude/a.pyi",.  
+00015f20: 2020 2020 2020 5d0a 2020 2020 2020 2020        ].        
+00015f30: 7372 6320 3d20 5b62 6173 6520 2f20 2262  src = [base / "b
+00015f40: 2f22 5d0a 2020 2020 2020 2020 6374 7820  /"].        ctx 
+00015f50: 3d20 4661 6b65 436f 6e74 6578 7428 290a  = FakeContext().
+00015f60: 2020 2020 2020 2020 6374 782e 6f62 6a5b          ctx.obj[
+00015f70: 2272 6f6f 7422 5d20 3d20 6261 7365 0a20  "root"] = base. 
+00015f80: 2020 2020 2020 2061 7373 6572 745f 636f         assert_co
+00015f90: 6c6c 6563 7465 645f 736f 7572 6365 7328  llected_sources(
+00015fa0: 7372 632c 2065 7870 6563 7465 642c 2063  src, expected, c
+00015fb0: 7478 3d63 7478 2c20 6578 7465 6e64 5f65  tx=ctx, extend_e
+00015fc0: 7863 6c75 6465 3d72 222f 6578 636c 7564  xclude=r"/exclud
+00015fd0: 652f 2229 0a0a 2020 2020 6465 6620 7465  e/")..    def te
+00015fe0: 7374 5f67 6974 6967 6e6f 7265 5f75 7365  st_gitignore_use
+00015ff0: 645f 6f6e 5f6d 756c 7469 706c 655f 736f  d_on_multiple_so
+00016000: 7572 6365 7328 7365 6c66 2920 2d3e 204e  urces(self) -> N
+00016010: 6f6e 653a 0a20 2020 2020 2020 2072 6f6f  one:.        roo
+00016020: 7420 3d20 5061 7468 2844 4154 415f 4449  t = Path(DATA_DI
+00016030: 5220 2f20 2267 6974 6967 6e6f 7265 5f75  R / "gitignore_u
+00016040: 7365 645f 6f6e 5f6d 756c 7469 706c 655f  sed_on_multiple_
+00016050: 736f 7572 6365 7322 290a 2020 2020 2020  sources").      
+00016060: 2020 6578 7065 6374 6564 203d 205b 0a20    expected = [. 
+00016070: 2020 2020 2020 2020 2020 2072 6f6f 7420             root 
+00016080: 2f20 2264 6972 3122 202f 2022 622e 7079  / "dir1" / "b.py
+00016090: 222c 0a20 2020 2020 2020 2020 2020 2072  ",.            r
+000160a0: 6f6f 7420 2f20 2264 6972 3222 202f 2022  oot / "dir2" / "
+000160b0: 622e 7079 222c 0a20 2020 2020 2020 205d  b.py",.        ]
+000160c0: 0a20 2020 2020 2020 2063 7478 203d 2046  .        ctx = F
+000160d0: 616b 6543 6f6e 7465 7874 2829 0a20 2020  akeContext().   
+000160e0: 2020 2020 2063 7478 2e6f 626a 5b22 726f       ctx.obj["ro
+000160f0: 6f74 225d 203d 2072 6f6f 740a 2020 2020  ot"] = root.    
+00016100: 2020 2020 7372 6320 3d20 5b72 6f6f 7420      src = [root 
+00016110: 2f20 2264 6972 3122 2c20 726f 6f74 202f  / "dir1", root /
+00016120: 2022 6469 7232 225d 0a20 2020 2020 2020   "dir2"].       
+00016130: 2061 7373 6572 745f 636f 6c6c 6563 7465   assert_collecte
+00016140: 645f 736f 7572 6365 7328 7372 632c 2065  d_sources(src, e
+00016150: 7870 6563 7465 642c 2063 7478 3d63 7478  xpected, ctx=ctx
+00016160: 290a 0a20 2020 2040 7061 7463 6828 2263  )..    @patch("c
+00016170: 6572 6369 732e 6669 6e64 5f70 726f 6a65  ercis.find_proje
+00016180: 6374 5f72 6f6f 7422 2c20 6c61 6d62 6461  ct_root", lambda
+00016190: 202a 6172 6773 3a20 2854 4849 535f 4449   *args: (THIS_DI
+000161a0: 522e 7265 736f 6c76 6528 292c 204e 6f6e  R.resolve(), Non
+000161b0: 6529 290a 2020 2020 6465 6620 7465 7374  e)).    def test
+000161c0: 5f65 7863 6c75 6465 5f66 6f72 5f69 7373  _exclude_for_iss
+000161d0: 7565 5f31 3537 3228 7365 6c66 2920 2d3e  ue_1572(self) ->
+000161e0: 204e 6f6e 653a 0a20 2020 2020 2020 2023   None:.        #
+000161f0: 2045 7863 6c75 6465 2073 686f 756c 646e   Exclude shouldn
+00016200: 2774 2074 6f75 6368 2066 696c 6573 2074  't touch files t
+00016210: 6861 7420 7765 7265 2065 7870 6c69 6369  hat were explici
+00016220: 746c 7920 6769 7665 6e20 746f 2042 6c61  tly given to Bla
+00016230: 636b 2074 6872 6f75 6768 2074 6865 0a20  ck through the. 
+00016240: 2020 2020 2020 2023 2043 4c49 2e20 4578         # CLI. Ex
+00016250: 636c 7564 6520 6973 2073 7570 706f 7365  clude is suppose
+00016260: 6420 746f 206f 6e6c 7920 6170 706c 7920  d to only apply 
+00016270: 746f 2074 6865 2072 6563 7572 7369 7665  to the recursive
+00016280: 2064 6973 636f 7665 7279 206f 6620 6669   discovery of fi
+00016290: 6c65 732e 0a20 2020 2020 2020 2023 2068  les..        # h
+000162a0: 7474 7073 3a2f 2f67 6974 6875 622e 636f  ttps://github.co
+000162b0: 6d2f 7073 662f 626c 6163 6b2f 6973 7375  m/psf/black/issu
+000162c0: 6573 2f31 3537 320a 2020 2020 2020 2020  es/1572.        
+000162d0: 7061 7468 203d 2044 4154 415f 4449 5220  path = DATA_DIR 
+000162e0: 2f20 2269 6e63 6c75 6465 5f65 7863 6c75  / "include_exclu
+000162f0: 6465 5f74 6573 7473 220a 2020 2020 2020  de_tests".      
+00016300: 2020 7372 6320 3d20 5b70 6174 6820 2f20    src = [path / 
+00016310: 2262 2f65 7863 6c75 6465 2f61 2e70 7922  "b/exclude/a.py"
+00016320: 5d0a 2020 2020 2020 2020 6578 7065 6374  ].        expect
+00016330: 6564 203d 205b 7061 7468 202f 2022 622f  ed = [path / "b/
+00016340: 6578 636c 7564 652f 612e 7079 225d 0a20  exclude/a.py"]. 
+00016350: 2020 2020 2020 2061 7373 6572 745f 636f         assert_co
+00016360: 6c6c 6563 7465 645f 736f 7572 6365 7328  llected_sources(
+00016370: 7372 632c 2065 7870 6563 7465 642c 2069  src, expected, i
+00016380: 6e63 6c75 6465 3d22 222c 2065 7863 6c75  nclude="", exclu
+00016390: 6465 3d72 222f 6578 636c 7564 652f 7c61  de=r"/exclude/|a
+000163a0: 5c2e 7079 2229 0a0a 2020 2020 6465 6620  \.py")..    def 
+000163b0: 7465 7374 5f67 6974 6967 6e6f 7265 5f65  test_gitignore_e
+000163c0: 7863 6c75 6465 2873 656c 6629 202d 3e20  xclude(self) -> 
+000163d0: 4e6f 6e65 3a0a 2020 2020 2020 2020 7061  None:.        pa
+000163e0: 7468 203d 2054 4849 535f 4449 5220 2f20  th = THIS_DIR / 
+000163f0: 2264 6174 6122 202f 2022 696e 636c 7564  "data" / "includ
+00016400: 655f 6578 636c 7564 655f 7465 7374 7322  e_exclude_tests"
+00016410: 0a20 2020 2020 2020 2069 6e63 6c75 6465  .        include
+00016420: 203d 2072 652e 636f 6d70 696c 6528 7222   = re.compile(r"
+00016430: 5c2e 7079 693f 2422 290a 2020 2020 2020  \.pyi?$").      
+00016440: 2020 6578 636c 7564 6520 3d20 7265 2e63    exclude = re.c
+00016450: 6f6d 7069 6c65 2872 2222 290a 2020 2020  ompile(r"").    
+00016460: 2020 2020 7265 706f 7274 203d 2063 6572      report = cer
+00016470: 6369 732e 5265 706f 7274 2829 0a20 2020  cis.Report().   
+00016480: 2020 2020 2067 6974 6967 6e6f 7265 203d       gitignore =
+00016490: 2050 6174 6853 7065 632e 6672 6f6d 5f6c   PathSpec.from_l
+000164a0: 696e 6573 280a 2020 2020 2020 2020 2020  ines(.          
+000164b0: 2020 2267 6974 7769 6c64 6d61 7463 6822    "gitwildmatch"
+000164c0: 2c20 5b22 6578 636c 7564 652f 222c 2022  , ["exclude/", "
+000164d0: 2e64 6566 696e 6974 656c 795f 6578 636c  .definitely_excl
+000164e0: 7564 6522 5d0a 2020 2020 2020 2020 290a  ude"].        ).
+000164f0: 2020 2020 2020 2020 736f 7572 6365 733a          sources:
+00016500: 204c 6973 745b 5061 7468 5d20 3d20 5b5d   List[Path] = []
+00016510: 0a20 2020 2020 2020 2065 7870 6563 7465  .        expecte
+00016520: 6420 3d20 5b0a 2020 2020 2020 2020 2020  d = [.          
+00016530: 2020 5061 7468 2870 6174 6820 2f20 2262    Path(path / "b
+00016540: 2f64 6f6e 745f 6578 636c 7564 652f 612e  /dont_exclude/a.
+00016550: 7079 2229 2c0a 2020 2020 2020 2020 2020  py"),.          
+00016560: 2020 5061 7468 2870 6174 6820 2f20 2262    Path(path / "b
+00016570: 2f64 6f6e 745f 6578 636c 7564 652f 612e  /dont_exclude/a.
+00016580: 7079 6922 292c 0a20 2020 2020 2020 205d  pyi"),.        ]
+00016590: 0a20 2020 2020 2020 2074 6869 735f 6162  .        this_ab
+000165a0: 7320 3d20 5448 4953 5f44 4952 2e72 6573  s = THIS_DIR.res
+000165b0: 6f6c 7665 2829 0a20 2020 2020 2020 2073  olve().        s
+000165c0: 6f75 7263 6573 2e65 7874 656e 6428 0a20  ources.extend(. 
+000165d0: 2020 2020 2020 2020 2020 2063 6572 6369             cerci
+000165e0: 732e 6765 6e5f 7079 7468 6f6e 5f66 696c  s.gen_python_fil
+000165f0: 6573 280a 2020 2020 2020 2020 2020 2020  es(.            
+00016600: 2020 2020 7061 7468 2e69 7465 7264 6972      path.iterdir
+00016610: 2829 2c0a 2020 2020 2020 2020 2020 2020  (),.            
+00016620: 2020 2020 7468 6973 5f61 6273 2c0a 2020      this_abs,.  
+00016630: 2020 2020 2020 2020 2020 2020 2020 696e                in
+00016640: 636c 7564 652c 0a20 2020 2020 2020 2020  clude,.         
+00016650: 2020 2020 2020 2065 7863 6c75 6465 2c0a         exclude,.
+00016660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016670: 4e6f 6e65 2c0a 2020 2020 2020 2020 2020  None,.          
+00016680: 2020 2020 2020 4e6f 6e65 2c0a 2020 2020        None,.    
+00016690: 2020 2020 2020 2020 2020 2020 7265 706f              repo
+000166a0: 7274 2c0a 2020 2020 2020 2020 2020 2020  rt,.            
+000166b0: 2020 2020 7b70 6174 683a 2067 6974 6967      {path: gitig
+000166c0: 6e6f 7265 7d2c 0a20 2020 2020 2020 2020  nore},.         
+000166d0: 2020 2020 2020 2076 6572 626f 7365 3d46         verbose=F
+000166e0: 616c 7365 2c0a 2020 2020 2020 2020 2020  alse,.          
+000166f0: 2020 2020 2020 7175 6965 743d 4661 6c73        quiet=Fals
+00016700: 652c 0a20 2020 2020 2020 2020 2020 2029  e,.            )
+00016710: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
+00016720: 2020 2061 7373 6572 7420 736f 7274 6564     assert sorted
+00016730: 2865 7870 6563 7465 6429 203d 3d20 736f  (expected) == so
+00016740: 7274 6564 2873 6f75 7263 6573 290a 0a20  rted(sources).. 
+00016750: 2020 2064 6566 2074 6573 745f 6e65 7374     def test_nest
+00016760: 6564 5f67 6974 6967 6e6f 7265 2873 656c  ed_gitignore(sel
+00016770: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
+00016780: 2020 2020 7061 7468 203d 2050 6174 6828      path = Path(
+00016790: 5448 4953 5f44 4952 202f 2022 6461 7461  THIS_DIR / "data
+000167a0: 2220 2f20 226e 6573 7465 645f 6769 7469  " / "nested_giti
+000167b0: 676e 6f72 655f 7465 7374 7322 290a 2020  gnore_tests").  
+000167c0: 2020 2020 2020 696e 636c 7564 6520 3d20        include = 
+000167d0: 7265 2e63 6f6d 7069 6c65 2872 225c 2e70  re.compile(r"\.p
+000167e0: 7969 3f24 2229 0a20 2020 2020 2020 2065  yi?$").        e
+000167f0: 7863 6c75 6465 203d 2072 652e 636f 6d70  xclude = re.comp
+00016800: 696c 6528 7222 2229 0a20 2020 2020 2020  ile(r"").       
+00016810: 2072 6f6f 745f 6769 7469 676e 6f72 6520   root_gitignore 
+00016820: 3d20 6365 7263 6973 2e66 696c 6573 2e67  = cercis.files.g
+00016830: 6574 5f67 6974 6967 6e6f 7265 2870 6174  et_gitignore(pat
+00016840: 6829 0a20 2020 2020 2020 2072 6570 6f72  h).        repor
+00016850: 7420 3d20 6365 7263 6973 2e52 6570 6f72  t = cercis.Repor
+00016860: 7428 290a 2020 2020 2020 2020 6578 7065  t().        expe
+00016870: 6374 6564 3a20 4c69 7374 5b50 6174 685d  cted: List[Path]
+00016880: 203d 205b 0a20 2020 2020 2020 2020 2020   = [.           
+00016890: 2050 6174 6828 7061 7468 202f 2022 782e   Path(path / "x.
+000168a0: 7079 2229 2c0a 2020 2020 2020 2020 2020  py"),.          
+000168b0: 2020 5061 7468 2870 6174 6820 2f20 2272    Path(path / "r
+000168c0: 6f6f 742f 622e 7079 2229 2c0a 2020 2020  oot/b.py"),.    
+000168d0: 2020 2020 2020 2020 5061 7468 2870 6174          Path(pat
+000168e0: 6820 2f20 2272 6f6f 742f 632e 7079 2229  h / "root/c.py")
+000168f0: 2c0a 2020 2020 2020 2020 2020 2020 5061  ,.            Pa
+00016900: 7468 2870 6174 6820 2f20 2272 6f6f 742f  th(path / "root/
+00016910: 6368 696c 642f 632e 7079 2229 2c0a 2020  child/c.py"),.  
+00016920: 2020 2020 2020 5d0a 2020 2020 2020 2020        ].        
+00016930: 7468 6973 5f61 6273 203d 2054 4849 535f  this_abs = THIS_
+00016940: 4449 522e 7265 736f 6c76 6528 290a 2020  DIR.resolve().  
+00016950: 2020 2020 2020 736f 7572 6365 7320 3d20        sources = 
+00016960: 6c69 7374 280a 2020 2020 2020 2020 2020  list(.          
+00016970: 2020 6365 7263 6973 2e67 656e 5f70 7974    cercis.gen_pyt
+00016980: 686f 6e5f 6669 6c65 7328 0a20 2020 2020  hon_files(.     
+00016990: 2020 2020 2020 2020 2020 2070 6174 682e             path.
+000169a0: 6974 6572 6469 7228 292c 0a20 2020 2020  iterdir(),.     
+000169b0: 2020 2020 2020 2020 2020 2074 6869 735f             this_
+000169c0: 6162 732c 0a20 2020 2020 2020 2020 2020  abs,.           
+000169d0: 2020 2020 2069 6e63 6c75 6465 2c0a 2020       include,.  
+000169e0: 2020 2020 2020 2020 2020 2020 2020 6578                ex
+000169f0: 636c 7564 652c 0a20 2020 2020 2020 2020  clude,.         
+00016a00: 2020 2020 2020 204e 6f6e 652c 0a20 2020         None,.   
+00016a10: 2020 2020 2020 2020 2020 2020 204e 6f6e               Non
+00016a20: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+00016a30: 2020 2072 6570 6f72 742c 0a20 2020 2020     report,.     
+00016a40: 2020 2020 2020 2020 2020 207b 7061 7468             {path
+00016a50: 3a20 726f 6f74 5f67 6974 6967 6e6f 7265  : root_gitignore
+00016a60: 7d2c 0a20 2020 2020 2020 2020 2020 2020  },.             
+00016a70: 2020 2076 6572 626f 7365 3d46 616c 7365     verbose=False
+00016a80: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00016a90: 2020 7175 6965 743d 4661 6c73 652c 0a20    quiet=False,. 
+00016aa0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+00016ab0: 2020 2020 2029 0a20 2020 2020 2020 2061       ).        a
+00016ac0: 7373 6572 7420 736f 7274 6564 2865 7870  ssert sorted(exp
+00016ad0: 6563 7465 6429 203d 3d20 736f 7274 6564  ected) == sorted
+00016ae0: 2873 6f75 7263 6573 290a 0a20 2020 2064  (sources)..    d
+00016af0: 6566 2074 6573 745f 6e65 7374 6564 5f67  ef test_nested_g
+00016b00: 6974 6967 6e6f 7265 5f64 6972 6563 746c  itignore_directl
+00016b10: 795f 696e 5f73 6f75 7263 655f 6469 7265  y_in_source_dire
+00016b20: 6374 6f72 7928 7365 6c66 2920 2d3e 204e  ctory(self) -> N
+00016b30: 6f6e 653a 0a20 2020 2020 2020 2023 2068  one:.        # h
+00016b40: 7474 7073 3a2f 2f67 6974 6875 622e 636f  ttps://github.co
+00016b50: 6d2f 7073 662f 626c 6163 6b2f 6973 7375  m/psf/black/issu
+00016b60: 6573 2f32 3539 380a 2020 2020 2020 2020  es/2598.        
+00016b70: 7061 7468 203d 2050 6174 6828 4441 5441  path = Path(DATA
+00016b80: 5f44 4952 202f 2022 6e65 7374 6564 5f67  _DIR / "nested_g
+00016b90: 6974 6967 6e6f 7265 5f74 6573 7473 2229  itignore_tests")
+00016ba0: 0a20 2020 2020 2020 2073 7263 203d 2050  .        src = P
+00016bb0: 6174 6828 7061 7468 202f 2022 726f 6f74  ath(path / "root
+00016bc0: 2220 2f20 2263 6869 6c64 2229 0a20 2020  " / "child").   
+00016bd0: 2020 2020 2065 7870 6563 7465 6420 3d20       expected = 
+00016be0: 5b73 7263 202f 2022 612e 7079 222c 2073  [src / "a.py", s
+00016bf0: 7263 202f 2022 632e 7079 225d 0a20 2020  rc / "c.py"].   
+00016c00: 2020 2020 2061 7373 6572 745f 636f 6c6c       assert_coll
+00016c10: 6563 7465 645f 736f 7572 6365 7328 5b73  ected_sources([s
+00016c20: 7263 5d2c 2065 7870 6563 7465 6429 0a0a  rc], expected)..
+00016c30: 2020 2020 6465 6620 7465 7374 5f69 6e76      def test_inv
+00016c40: 616c 6964 5f67 6974 6967 6e6f 7265 2873  alid_gitignore(s
+00016c50: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
+00016c60: 2020 2020 2020 7061 7468 203d 2054 4849        path = THI
+00016c70: 535f 4449 5220 2f20 2264 6174 6122 202f  S_DIR / "data" /
+00016c80: 2022 696e 7661 6c69 645f 6769 7469 676e   "invalid_gitign
+00016c90: 6f72 655f 7465 7374 7322 0a20 2020 2020  ore_tests".     
+00016ca0: 2020 2065 6d70 7479 5f63 6f6e 6669 6720     empty_config 
+00016cb0: 3d20 7061 7468 202f 2022 7079 7072 6f6a  = path / "pyproj
+00016cc0: 6563 742e 746f 6d6c 220a 2020 2020 2020  ect.toml".      
+00016cd0: 2020 7265 7375 6c74 203d 2042 6c61 636b    result = Black
+00016ce0: 5275 6e6e 6572 2829 2e69 6e76 6f6b 6528  Runner().invoke(
+00016cf0: 0a20 2020 2020 2020 2020 2020 2063 6572  .            cer
+00016d00: 6369 732e 6d61 696e 2c20 5b22 2d2d 7665  cis.main, ["--ve
+00016d10: 7262 6f73 6522 2c20 222d 2d63 6f6e 6669  rbose", "--confi
+00016d20: 6722 2c20 7374 7228 656d 7074 795f 636f  g", str(empty_co
+00016d30: 6e66 6967 292c 2073 7472 2870 6174 6829  nfig), str(path)
+00016d40: 5d0a 2020 2020 2020 2020 290a 2020 2020  ].        ).    
+00016d50: 2020 2020 6173 7365 7274 2072 6573 756c      assert resul
+00016d60: 742e 6578 6974 5f63 6f64 6520 3d3d 2031  t.exit_code == 1
+00016d70: 0a20 2020 2020 2020 2061 7373 6572 7420  .        assert 
+00016d80: 7265 7375 6c74 2e73 7464 6572 725f 6279  result.stderr_by
+00016d90: 7465 7320 6973 206e 6f74 204e 6f6e 650a  tes is not None.
+00016da0: 0a20 2020 2020 2020 2067 6974 6967 6e6f  .        gitigno
+00016db0: 7265 203d 2070 6174 6820 2f20 222e 6769  re = path / ".gi
+00016dc0: 7469 676e 6f72 6522 0a20 2020 2020 2020  tignore".       
+00016dd0: 2061 7373 6572 7420 6622 436f 756c 6420   assert f"Could 
+00016de0: 6e6f 7420 7061 7273 6520 7b67 6974 6967  not parse {gitig
+00016df0: 6e6f 7265 7d22 2069 6e20 7265 7375 6c74  nore}" in result
+00016e00: 2e73 7464 6572 725f 6279 7465 732e 6465  .stderr_bytes.de
+00016e10: 636f 6465 2829 0a0a 2020 2020 6465 6620  code()..    def 
+00016e20: 7465 7374 5f69 6e76 616c 6964 5f6e 6573  test_invalid_nes
+00016e30: 7465 645f 6769 7469 676e 6f72 6528 7365  ted_gitignore(se
+00016e40: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
+00016e50: 2020 2020 2070 6174 6820 3d20 5448 4953       path = THIS
+00016e60: 5f44 4952 202f 2022 6461 7461 2220 2f20  _DIR / "data" / 
+00016e70: 2269 6e76 616c 6964 5f6e 6573 7465 645f  "invalid_nested_
+00016e80: 6769 7469 676e 6f72 655f 7465 7374 7322  gitignore_tests"
+00016e90: 0a20 2020 2020 2020 2065 6d70 7479 5f63  .        empty_c
+00016ea0: 6f6e 6669 6720 3d20 7061 7468 202f 2022  onfig = path / "
+00016eb0: 7079 7072 6f6a 6563 742e 746f 6d6c 220a  pyproject.toml".
+00016ec0: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
+00016ed0: 2042 6c61 636b 5275 6e6e 6572 2829 2e69   BlackRunner().i
+00016ee0: 6e76 6f6b 6528 0a20 2020 2020 2020 2020  nvoke(.         
+00016ef0: 2020 2063 6572 6369 732e 6d61 696e 2c20     cercis.main, 
+00016f00: 5b22 2d2d 7665 7262 6f73 6522 2c20 222d  ["--verbose", "-
+00016f10: 2d63 6f6e 6669 6722 2c20 7374 7228 656d  -config", str(em
+00016f20: 7074 795f 636f 6e66 6967 292c 2073 7472  pty_config), str
+00016f30: 2870 6174 6829 5d0a 2020 2020 2020 2020  (path)].        
+00016f40: 290a 2020 2020 2020 2020 6173 7365 7274  ).        assert
+00016f50: 2072 6573 756c 742e 6578 6974 5f63 6f64   result.exit_cod
+00016f60: 6520 3d3d 2031 0a20 2020 2020 2020 2061  e == 1.        a
+00016f70: 7373 6572 7420 7265 7375 6c74 2e73 7464  ssert result.std
+00016f80: 6572 725f 6279 7465 7320 6973 206e 6f74  err_bytes is not
+00016f90: 204e 6f6e 650a 0a20 2020 2020 2020 2067   None..        g
+00016fa0: 6974 6967 6e6f 7265 203d 2070 6174 6820  itignore = path 
+00016fb0: 2f20 2261 2220 2f20 222e 6769 7469 676e  / "a" / ".gitign
+00016fc0: 6f72 6522 0a20 2020 2020 2020 2061 7373  ore".        ass
+00016fd0: 6572 7420 6622 436f 756c 6420 6e6f 7420  ert f"Could not 
+00016fe0: 7061 7273 6520 7b67 6974 6967 6e6f 7265  parse {gitignore
+00016ff0: 7d22 2069 6e20 7265 7375 6c74 2e73 7464  }" in result.std
+00017000: 6572 725f 6279 7465 732e 6465 636f 6465  err_bytes.decode
+00017010: 2829 0a0a 2020 2020 6465 6620 7465 7374  ()..    def test
+00017020: 5f67 6974 6967 6e6f 7265 5f74 6861 745f  _gitignore_that_
+00017030: 6967 6e6f 7265 735f 7375 6266 6f6c 6465  ignores_subfolde
+00017040: 7273 2873 656c 6629 202d 3e20 4e6f 6e65  rs(self) -> None
+00017050: 3a0a 2020 2020 2020 2020 2320 4966 2067  :.        # If g
+00017060: 6974 6967 6e6f 7265 2077 6974 6820 2a2f  itignore with */
+00017070: 2a20 6973 2069 6e20 726f 6f74 0a20 2020  * is in root.   
+00017080: 2020 2020 2072 6f6f 7420 3d20 5061 7468       root = Path
+00017090: 2844 4154 415f 4449 5220 2f20 2269 676e  (DATA_DIR / "ign
+000170a0: 6f72 655f 7375 6266 6f6c 6465 7273 5f67  ore_subfolders_g
+000170b0: 6974 6967 6e6f 7265 5f74 6573 7473 2220  itignore_tests" 
+000170c0: 2f20 2273 7562 6469 7222 290a 2020 2020  / "subdir").    
+000170d0: 2020 2020 6578 7065 6374 6564 203d 205b      expected = [
+000170e0: 726f 6f74 202f 2022 622e 7079 225d 0a20  root / "b.py"]. 
+000170f0: 2020 2020 2020 2063 7478 203d 2046 616b         ctx = Fak
+00017100: 6543 6f6e 7465 7874 2829 0a20 2020 2020  eContext().     
+00017110: 2020 2063 7478 2e6f 626a 5b22 726f 6f74     ctx.obj["root
+00017120: 225d 203d 2072 6f6f 740a 2020 2020 2020  "] = root.      
+00017130: 2020 6173 7365 7274 5f63 6f6c 6c65 6374    assert_collect
+00017140: 6564 5f73 6f75 7263 6573 285b 726f 6f74  ed_sources([root
+00017150: 5d2c 2065 7870 6563 7465 642c 2063 7478  ], expected, ctx
+00017160: 3d63 7478 290a 0a20 2020 2020 2020 2023  =ctx)..        #
+00017170: 2049 6620 2e67 6974 6967 6e6f 7265 2077   If .gitignore w
+00017180: 6974 6820 2a2f 2a20 6973 206e 6573 7465  ith */* is neste
+00017190: 640a 2020 2020 2020 2020 726f 6f74 203d  d.        root =
+000171a0: 2050 6174 6828 4441 5441 5f44 4952 202f   Path(DATA_DIR /
+000171b0: 2022 6967 6e6f 7265 5f73 7562 666f 6c64   "ignore_subfold
+000171c0: 6572 735f 6769 7469 676e 6f72 655f 7465  ers_gitignore_te
+000171d0: 7374 7322 290a 2020 2020 2020 2020 6578  sts").        ex
+000171e0: 7065 6374 6564 203d 205b 0a20 2020 2020  pected = [.     
+000171f0: 2020 2020 2020 2072 6f6f 7420 2f20 2261         root / "a
+00017200: 2e70 7922 2c0a 2020 2020 2020 2020 2020  .py",.          
+00017210: 2020 726f 6f74 202f 2022 7375 6264 6972    root / "subdir
+00017220: 2220 2f20 2262 2e70 7922 2c0a 2020 2020  " / "b.py",.    
+00017230: 2020 2020 5d0a 2020 2020 2020 2020 6374      ].        ct
+00017240: 7820 3d20 4661 6b65 436f 6e74 6578 7428  x = FakeContext(
+00017250: 290a 2020 2020 2020 2020 6374 782e 6f62  ).        ctx.ob
+00017260: 6a5b 2272 6f6f 7422 5d20 3d20 726f 6f74  j["root"] = root
+00017270: 0a20 2020 2020 2020 2061 7373 6572 745f  .        assert_
+00017280: 636f 6c6c 6563 7465 645f 736f 7572 6365  collected_source
+00017290: 7328 5b72 6f6f 745d 2c20 6578 7065 6374  s([root], expect
+000172a0: 6564 2c20 6374 783d 6374 7829 0a0a 2020  ed, ctx=ctx)..  
+000172b0: 2020 2020 2020 2320 4966 2063 6f6d 6d61        # If comma
+000172c0: 6e64 2069 7320 6578 6563 7574 6564 2066  nd is executed f
+000172d0: 726f 6d20 6f75 7465 7220 6469 720a 2020  rom outer dir.  
+000172e0: 2020 2020 2020 726f 6f74 203d 2050 6174        root = Pat
+000172f0: 6828 4441 5441 5f44 4952 202f 2022 6967  h(DATA_DIR / "ig
+00017300: 6e6f 7265 5f73 7562 666f 6c64 6572 735f  nore_subfolders_
+00017310: 6769 7469 676e 6f72 655f 7465 7374 7322  gitignore_tests"
+00017320: 290a 2020 2020 2020 2020 7461 7267 6574  ).        target
+00017330: 203d 2072 6f6f 7420 2f20 2273 7562 6469   = root / "subdi
+00017340: 7222 0a20 2020 2020 2020 2065 7870 6563  r".        expec
+00017350: 7465 6420 3d20 5b74 6172 6765 7420 2f20  ted = [target / 
+00017360: 2262 2e70 7922 5d0a 2020 2020 2020 2020  "b.py"].        
+00017370: 6374 7820 3d20 4661 6b65 436f 6e74 6578  ctx = FakeContex
+00017380: 7428 290a 2020 2020 2020 2020 6374 782e  t().        ctx.
+00017390: 6f62 6a5b 2272 6f6f 7422 5d20 3d20 726f  obj["root"] = ro
+000173a0: 6f74 0a20 2020 2020 2020 2061 7373 6572  ot.        asser
+000173b0: 745f 636f 6c6c 6563 7465 645f 736f 7572  t_collected_sour
+000173c0: 6365 7328 5b74 6172 6765 745d 2c20 6578  ces([target], ex
+000173d0: 7065 6374 6564 2c20 6374 783d 6374 7829  pected, ctx=ctx)
+000173e0: 0a0a 2020 2020 6465 6620 7465 7374 5f65  ..    def test_e
+000173f0: 6d70 7479 5f69 6e63 6c75 6465 2873 656c  mpty_include(sel
+00017400: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
+00017410: 2020 2020 7061 7468 203d 2044 4154 415f      path = DATA_
+00017420: 4449 5220 2f20 2269 6e63 6c75 6465 5f65  DIR / "include_e
+00017430: 7863 6c75 6465 5f74 6573 7473 220a 2020  xclude_tests".  
+00017440: 2020 2020 2020 7372 6320 3d20 5b70 6174        src = [pat
+00017450: 685d 0a20 2020 2020 2020 2065 7870 6563  h].        expec
+00017460: 7465 6420 3d20 5b0a 2020 2020 2020 2020  ted = [.        
+00017470: 2020 2020 5061 7468 2870 6174 6820 2f20      Path(path / 
+00017480: 2262 2f65 7863 6c75 6465 2f61 2e70 6965  "b/exclude/a.pie
+00017490: 2229 2c0a 2020 2020 2020 2020 2020 2020  "),.            
+000174a0: 5061 7468 2870 6174 6820 2f20 2262 2f65  Path(path / "b/e
+000174b0: 7863 6c75 6465 2f61 2e70 7922 292c 0a20  xclude/a.py"),. 
+000174c0: 2020 2020 2020 2020 2020 2050 6174 6828             Path(
+000174d0: 7061 7468 202f 2022 622f 6578 636c 7564  path / "b/exclud
+000174e0: 652f 612e 7079 6922 292c 0a20 2020 2020  e/a.pyi"),.     
+000174f0: 2020 2020 2020 2050 6174 6828 7061 7468         Path(path
+00017500: 202f 2022 622f 646f 6e74 5f65 7863 6c75   / "b/dont_exclu
+00017510: 6465 2f61 2e70 6965 2229 2c0a 2020 2020  de/a.pie"),.    
+00017520: 2020 2020 2020 2020 5061 7468 2870 6174          Path(pat
+00017530: 6820 2f20 2262 2f64 6f6e 745f 6578 636c  h / "b/dont_excl
+00017540: 7564 652f 612e 7079 2229 2c0a 2020 2020  ude/a.py"),.    
+00017550: 2020 2020 2020 2020 5061 7468 2870 6174          Path(pat
+00017560: 6820 2f20 2262 2f64 6f6e 745f 6578 636c  h / "b/dont_excl
+00017570: 7564 652f 612e 7079 6922 292c 0a20 2020  ude/a.pyi"),.   
+00017580: 2020 2020 2020 2020 2050 6174 6828 7061           Path(pa
+00017590: 7468 202f 2022 622f 2e64 6566 696e 6974  th / "b/.definit
+000175a0: 656c 795f 6578 636c 7564 652f 612e 7069  ely_exclude/a.pi
+000175b0: 6522 292c 0a20 2020 2020 2020 2020 2020  e"),.           
+000175c0: 2050 6174 6828 7061 7468 202f 2022 622f   Path(path / "b/
+000175d0: 2e64 6566 696e 6974 656c 795f 6578 636c  .definitely_excl
+000175e0: 7564 652f 612e 7079 2229 2c0a 2020 2020  ude/a.py"),.    
+000175f0: 2020 2020 2020 2020 5061 7468 2870 6174          Path(pat
+00017600: 6820 2f20 2262 2f2e 6465 6669 6e69 7465  h / "b/.definite
+00017610: 6c79 5f65 7863 6c75 6465 2f61 2e70 7969  ly_exclude/a.pyi
+00017620: 2229 2c0a 2020 2020 2020 2020 2020 2020  "),.            
+00017630: 5061 7468 2870 6174 6820 2f20 222e 6769  Path(path / ".gi
+00017640: 7469 676e 6f72 6522 292c 0a20 2020 2020  tignore"),.     
+00017650: 2020 2020 2020 2050 6174 6828 7061 7468         Path(path
+00017660: 202f 2022 7079 7072 6f6a 6563 742e 746f   / "pyproject.to
+00017670: 6d6c 2229 2c0a 2020 2020 2020 2020 5d0a  ml"),.        ].
+00017680: 2020 2020 2020 2020 2320 5365 7474 696e          # Settin
+00017690: 6720 6578 636c 7564 6520 6578 706c 6963  g exclude explic
+000176a0: 6974 6c79 2074 6f20 616e 2065 6d70 7479  itly to an empty
+000176b0: 2073 7472 696e 6720 746f 2062 6c6f 636b   string to block
+000176c0: 202e 6769 7469 676e 6f72 6520 7573 6167   .gitignore usag
+000176d0: 652e 0a20 2020 2020 2020 2061 7373 6572  e..        asser
+000176e0: 745f 636f 6c6c 6563 7465 645f 736f 7572  t_collected_sour
+000176f0: 6365 7328 7372 632c 2065 7870 6563 7465  ces(src, expecte
+00017700: 642c 2069 6e63 6c75 6465 3d22 222c 2065  d, include="", e
+00017710: 7863 6c75 6465 3d22 2229 0a0a 2020 2020  xclude="")..    
+00017720: 6465 6620 7465 7374 5f65 7874 656e 645f  def test_extend_
+00017730: 6578 636c 7564 6528 7365 6c66 2920 2d3e  exclude(self) ->
+00017740: 204e 6f6e 653a 0a20 2020 2020 2020 2070   None:.        p
+00017750: 6174 6820 3d20 4441 5441 5f44 4952 202f  ath = DATA_DIR /
+00017760: 2022 696e 636c 7564 655f 6578 636c 7564   "include_exclud
+00017770: 655f 7465 7374 7322 0a20 2020 2020 2020  e_tests".       
+00017780: 2073 7263 203d 205b 7061 7468 5d0a 2020   src = [path].  
+00017790: 2020 2020 2020 6578 7065 6374 6564 203d        expected =
+000177a0: 205b 0a20 2020 2020 2020 2020 2020 2050   [.            P
+000177b0: 6174 6828 7061 7468 202f 2022 622f 6578  ath(path / "b/ex
+000177c0: 636c 7564 652f 612e 7079 2229 2c0a 2020  clude/a.py"),.  
+000177d0: 2020 2020 2020 2020 2020 5061 7468 2870            Path(p
+000177e0: 6174 6820 2f20 2262 2f64 6f6e 745f 6578  ath / "b/dont_ex
+000177f0: 636c 7564 652f 612e 7079 2229 2c0a 2020  clude/a.py"),.  
+00017800: 2020 2020 2020 5d0a 2020 2020 2020 2020        ].        
+00017810: 6173 7365 7274 5f63 6f6c 6c65 6374 6564  assert_collected
+00017820: 5f73 6f75 7263 6573 280a 2020 2020 2020  _sources(.      
+00017830: 2020 2020 2020 7372 632c 2065 7870 6563        src, expec
+00017840: 7465 642c 2065 7863 6c75 6465 3d72 225c  ted, exclude=r"\
+00017850: 2e70 7969 2422 2c20 6578 7465 6e64 5f65  .pyi$", extend_e
+00017860: 7863 6c75 6465 3d72 225c 2e64 6566 696e  xclude=r"\.defin
+00017870: 6974 656c 795f 6578 636c 7564 6522 0a20  itely_exclude". 
+00017880: 2020 2020 2020 2029 0a0a 2020 2020 4070         )..    @p
+00017890: 7974 6573 742e 6d61 726b 2e69 6e63 6f6d  ytest.mark.incom
+000178a0: 7061 7469 626c 655f 7769 7468 5f6d 7970  patible_with_myp
+000178b0: 7963 0a20 2020 2064 6566 2074 6573 745f  yc.    def test_
+000178c0: 7379 6d6c 696e 6b5f 6f75 745f 6f66 5f72  symlink_out_of_r
+000178d0: 6f6f 745f 6469 7265 6374 6f72 7928 7365  oot_directory(se
+000178e0: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
+000178f0: 2020 2020 2070 6174 6820 3d20 4d61 6769       path = Magi
+00017900: 634d 6f63 6b28 290a 2020 2020 2020 2020  cMock().        
+00017910: 726f 6f74 203d 2054 4849 535f 4449 522e  root = THIS_DIR.
+00017920: 7265 736f 6c76 6528 290a 2020 2020 2020  resolve().      
+00017930: 2020 6368 696c 6420 3d20 4d61 6769 634d    child = MagicM
+00017940: 6f63 6b28 290a 2020 2020 2020 2020 696e  ock().        in
+00017950: 636c 7564 6520 3d20 7265 2e63 6f6d 7069  clude = re.compi
+00017960: 6c65 2863 6572 6369 732e 4445 4641 554c  le(cercis.DEFAUL
+00017970: 545f 494e 434c 5544 4553 290a 2020 2020  T_INCLUDES).    
+00017980: 2020 2020 6578 636c 7564 6520 3d20 7265      exclude = re
+00017990: 2e63 6f6d 7069 6c65 2863 6572 6369 732e  .compile(cercis.
+000179a0: 4445 4641 554c 545f 4558 434c 5544 4553  DEFAULT_EXCLUDES
+000179b0: 290a 2020 2020 2020 2020 7265 706f 7274  ).        report
+000179c0: 203d 2063 6572 6369 732e 5265 706f 7274   = cercis.Report
+000179d0: 2829 0a20 2020 2020 2020 2067 6974 6967  ().        gitig
+000179e0: 6e6f 7265 203d 2050 6174 6853 7065 632e  nore = PathSpec.
+000179f0: 6672 6f6d 5f6c 696e 6573 2822 6769 7477  from_lines("gitw
+00017a00: 696c 646d 6174 6368 222c 205b 5d29 0a20  ildmatch", []). 
+00017a10: 2020 2020 2020 2023 2060 6368 696c 6460         # `child`
+00017a20: 2073 686f 756c 6420 6265 6861 7665 206c   should behave l
+00017a30: 696b 6520 6120 7379 6d6c 696e 6b20 7768  ike a symlink wh
+00017a40: 6963 6820 7265 736f 6c76 6564 2070 6174  ich resolved pat
+00017a50: 6820 6973 2063 6c65 6172 6c79 0a20 2020  h is clearly.   
+00017a60: 2020 2020 2023 206f 7574 7369 6465 206f       # outside o
+00017a70: 6620 7468 6520 6072 6f6f 7460 2064 6972  f the `root` dir
+00017a80: 6563 746f 7279 2e0a 2020 2020 2020 2020  ectory..        
+00017a90: 7061 7468 2e69 7465 7264 6972 2e72 6574  path.iterdir.ret
+00017aa0: 7572 6e5f 7661 6c75 6520 3d20 5b63 6869  urn_value = [chi
+00017ab0: 6c64 5d0a 2020 2020 2020 2020 6368 696c  ld].        chil
+00017ac0: 642e 7265 736f 6c76 652e 7265 7475 726e  d.resolve.return
+00017ad0: 5f76 616c 7565 203d 2050 6174 6828 222f  _value = Path("/
+00017ae0: 612f 622f 6322 290a 2020 2020 2020 2020  a/b/c").        
+00017af0: 6368 696c 642e 6173 5f70 6f73 6978 2e72  child.as_posix.r
+00017b00: 6574 7572 6e5f 7661 6c75 6520 3d20 222f  eturn_value = "/
+00017b10: 612f 622f 6322 0a20 2020 2020 2020 2074  a/b/c".        t
+00017b20: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+00017b30: 6c69 7374 280a 2020 2020 2020 2020 2020  list(.          
+00017b40: 2020 2020 2020 6365 7263 6973 2e67 656e        cercis.gen
+00017b50: 5f70 7974 686f 6e5f 6669 6c65 7328 0a20  _python_files(. 
+00017b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017b70: 2020 2070 6174 682e 6974 6572 6469 7228     path.iterdir(
+00017b80: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+00017b90: 2020 2020 2020 2072 6f6f 742c 0a20 2020         root,.   
+00017ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017bb0: 2069 6e63 6c75 6465 2c0a 2020 2020 2020   include,.      
+00017bc0: 2020 2020 2020 2020 2020 2020 2020 6578                ex
+00017bd0: 636c 7564 652c 0a20 2020 2020 2020 2020  clude,.         
+00017be0: 2020 2020 2020 2020 2020 204e 6f6e 652c             None,
+00017bf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017c00: 2020 2020 204e 6f6e 652c 0a20 2020 2020       None,.     
+00017c10: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00017c20: 6570 6f72 742c 0a20 2020 2020 2020 2020  eport,.         
+00017c30: 2020 2020 2020 2020 2020 207b 7061 7468             {path
+00017c40: 3a20 6769 7469 676e 6f72 657d 2c0a 2020  : gitignore},.  
+00017c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017c60: 2020 7665 7262 6f73 653d 4661 6c73 652c    verbose=False,
+00017c70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017c80: 2020 2020 2071 7569 6574 3d46 616c 7365       quiet=False
+00017c90: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00017ca0: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+00017cb0: 290a 2020 2020 2020 2020 6578 6365 7074  ).        except
+00017cc0: 2056 616c 7565 4572 726f 7220 6173 2076   ValueError as v
+00017cd0: 653a 0a20 2020 2020 2020 2020 2020 2070  e:.            p
+00017ce0: 7974 6573 742e 6661 696c 2866 2260 6765  ytest.fail(f"`ge
+00017cf0: 745f 7079 7468 6f6e 5f66 696c 6573 5f69  t_python_files_i
+00017d00: 6e5f 6469 7228 2960 2066 6169 6c65 643a  n_dir()` failed:
+00017d10: 207b 7665 7d22 290a 2020 2020 2020 2020   {ve}").        
+00017d20: 7061 7468 2e69 7465 7264 6972 2e61 7373  path.iterdir.ass
+00017d30: 6572 745f 6361 6c6c 6564 5f6f 6e63 6528  ert_called_once(
+00017d40: 290a 2020 2020 2020 2020 6368 696c 642e  ).        child.
+00017d50: 7265 736f 6c76 652e 6173 7365 7274 5f63  resolve.assert_c
+00017d60: 616c 6c65 645f 6f6e 6365 2829 0a0a 2020  alled_once()..  
+00017d70: 2020 4070 6174 6368 2822 6365 7263 6973    @patch("cercis
+00017d80: 2e66 696e 645f 7072 6f6a 6563 745f 726f  .find_project_ro
+00017d90: 6f74 222c 206c 616d 6264 6120 2a61 7267  ot", lambda *arg
+00017da0: 733a 2028 5448 4953 5f44 4952 2e72 6573  s: (THIS_DIR.res
+00017db0: 6f6c 7665 2829 2c20 4e6f 6e65 2929 0a20  olve(), None)). 
+00017dc0: 2020 2064 6566 2074 6573 745f 6765 745f     def test_get_
+00017dd0: 736f 7572 6365 735f 7769 7468 5f73 7464  sources_with_std
+00017de0: 696e 2873 656c 6629 202d 3e20 4e6f 6e65  in(self) -> None
+00017df0: 3a0a 2020 2020 2020 2020 7372 6320 3d20  :.        src = 
+00017e00: 5b22 2d22 5d0a 2020 2020 2020 2020 6578  ["-"].        ex
+00017e10: 7065 6374 6564 203d 205b 222d 225d 0a20  pected = ["-"]. 
+00017e20: 2020 2020 2020 2061 7373 6572 745f 636f         assert_co
+00017e30: 6c6c 6563 7465 645f 736f 7572 6365 7328  llected_sources(
+00017e40: 7372 632c 2065 7870 6563 7465 642c 2069  src, expected, i
+00017e50: 6e63 6c75 6465 3d22 222c 2065 7863 6c75  nclude="", exclu
+00017e60: 6465 3d72 222f 6578 636c 7564 652f 7c61  de=r"/exclude/|a
+00017e70: 5c2e 7079 2229 0a0a 2020 2020 4070 6174  \.py")..    @pat
+00017e80: 6368 2822 6365 7263 6973 2e66 696e 645f  ch("cercis.find_
+00017e90: 7072 6f6a 6563 745f 726f 6f74 222c 206c  project_root", l
+00017ea0: 616d 6264 6120 2a61 7267 733a 2028 5448  ambda *args: (TH
+00017eb0: 4953 5f44 4952 2e72 6573 6f6c 7665 2829  IS_DIR.resolve()
+00017ec0: 2c20 4e6f 6e65 2929 0a20 2020 2064 6566  , None)).    def
+00017ed0: 2074 6573 745f 6765 745f 736f 7572 6365   test_get_source
+00017ee0: 735f 7769 7468 5f73 7464 696e 5f66 696c  s_with_stdin_fil
+00017ef0: 656e 616d 6528 7365 6c66 2920 2d3e 204e  ename(self) -> N
+00017f00: 6f6e 653a 0a20 2020 2020 2020 2073 7263  one:.        src
+00017f10: 203d 205b 222d 225d 0a20 2020 2020 2020   = ["-"].       
+00017f20: 2073 7464 696e 5f66 696c 656e 616d 6520   stdin_filename 
+00017f30: 3d20 7374 7228 5448 4953 5f44 4952 202f  = str(THIS_DIR /
+00017f40: 2022 6461 7461 2f63 6f6c 6c65 6374 696f   "data/collectio
+00017f50: 6e73 2e70 7922 290a 2020 2020 2020 2020  ns.py").        
+00017f60: 6578 7065 6374 6564 203d 205b 6622 5f5f  expected = [f"__
+00017f70: 424c 4143 4b5f 5354 4449 4e5f 4649 4c45  BLACK_STDIN_FILE
+00017f80: 4e41 4d45 5f5f 7b73 7464 696e 5f66 696c  NAME__{stdin_fil
+00017f90: 656e 616d 657d 225d 0a20 2020 2020 2020  ename}"].       
+00017fa0: 2061 7373 6572 745f 636f 6c6c 6563 7465   assert_collecte
+00017fb0: 645f 736f 7572 6365 7328 0a20 2020 2020  d_sources(.     
+00017fc0: 2020 2020 2020 2073 7263 2c0a 2020 2020         src,.    
+00017fd0: 2020 2020 2020 2020 6578 7065 6374 6564          expected
+00017fe0: 2c0a 2020 2020 2020 2020 2020 2020 6578  ,.            ex
+00017ff0: 636c 7564 653d 7222 2f65 7863 6c75 6465  clude=r"/exclude
+00018000: 2f61 5c2e 7079 222c 0a20 2020 2020 2020  /a\.py",.       
+00018010: 2020 2020 2073 7464 696e 5f66 696c 656e       stdin_filen
+00018020: 616d 653d 7374 6469 6e5f 6669 6c65 6e61  ame=stdin_filena
+00018030: 6d65 2c0a 2020 2020 2020 2020 290a 0a20  me,.        ).. 
+00018040: 2020 2040 7061 7463 6828 2263 6572 6369     @patch("cerci
+00018050: 732e 6669 6e64 5f70 726f 6a65 6374 5f72  s.find_project_r
+00018060: 6f6f 7422 2c20 6c61 6d62 6461 202a 6172  oot", lambda *ar
+00018070: 6773 3a20 2854 4849 535f 4449 522e 7265  gs: (THIS_DIR.re
+00018080: 736f 6c76 6528 292c 204e 6f6e 6529 290a  solve(), None)).
+00018090: 2020 2020 6465 6620 7465 7374 5f67 6574      def test_get
+000180a0: 5f73 6f75 7263 6573 5f77 6974 685f 7374  _sources_with_st
+000180b0: 6469 6e5f 6669 6c65 6e61 6d65 5f61 6e64  din_filename_and
+000180c0: 5f65 7863 6c75 6465 2873 656c 6629 202d  _exclude(self) -
+000180d0: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+000180e0: 2320 4578 636c 7564 6520 7368 6f75 6c64  # Exclude should
+000180f0: 6e27 7420 6578 636c 7564 6520 7374 6469  n't exclude stdi
+00018100: 6e5f 6669 6c65 6e61 6d65 2073 696e 6365  n_filename since
+00018110: 2069 7420 6973 206d 696d 6963 6b69 6e67   it is mimicking
+00018120: 2074 6865 0a20 2020 2020 2020 2023 2066   the.        # f
+00018130: 696c 6520 6265 696e 6720 7061 7373 6564  ile being passed
+00018140: 2064 6972 6563 746c 792e 2054 6869 7320   directly. This 
+00018150: 6973 2074 6865 2073 616d 6520 6173 0a20  is the same as. 
+00018160: 2020 2020 2020 2023 2074 6573 745f 6578         # test_ex
+00018170: 636c 7564 655f 666f 725f 6973 7375 655f  clude_for_issue_
+00018180: 3135 3732 0a20 2020 2020 2020 2070 6174  1572.        pat
+00018190: 6820 3d20 4441 5441 5f44 4952 202f 2022  h = DATA_DIR / "
+000181a0: 696e 636c 7564 655f 6578 636c 7564 655f  include_exclude_
+000181b0: 7465 7374 7322 0a20 2020 2020 2020 2073  tests".        s
+000181c0: 7263 203d 205b 222d 225d 0a20 2020 2020  rc = ["-"].     
+000181d0: 2020 2073 7464 696e 5f66 696c 656e 616d     stdin_filenam
+000181e0: 6520 3d20 7374 7228 7061 7468 202f 2022  e = str(path / "
+000181f0: 622f 6578 636c 7564 652f 612e 7079 2229  b/exclude/a.py")
+00018200: 0a20 2020 2020 2020 2065 7870 6563 7465  .        expecte
+00018210: 6420 3d20 5b66 225f 5f42 4c41 434b 5f53  d = [f"__BLACK_S
+00018220: 5444 494e 5f46 494c 454e 414d 455f 5f7b  TDIN_FILENAME__{
+00018230: 7374 6469 6e5f 6669 6c65 6e61 6d65 7d22  stdin_filename}"
+00018240: 5d0a 2020 2020 2020 2020 6173 7365 7274  ].        assert
+00018250: 5f63 6f6c 6c65 6374 6564 5f73 6f75 7263  _collected_sourc
+00018260: 6573 280a 2020 2020 2020 2020 2020 2020  es(.            
+00018270: 7372 632c 0a20 2020 2020 2020 2020 2020  src,.           
+00018280: 2065 7870 6563 7465 642c 0a20 2020 2020   expected,.     
+00018290: 2020 2020 2020 2065 7863 6c75 6465 3d72         exclude=r
+000182a0: 222f 6578 636c 7564 652f 7c61 5c2e 7079  "/exclude/|a\.py
+000182b0: 222c 0a20 2020 2020 2020 2020 2020 2073  ",.            s
+000182c0: 7464 696e 5f66 696c 656e 616d 653d 7374  tdin_filename=st
+000182d0: 6469 6e5f 6669 6c65 6e61 6d65 2c0a 2020  din_filename,.  
+000182e0: 2020 2020 2020 290a 0a20 2020 2040 7061        )..    @pa
+000182f0: 7463 6828 2263 6572 6369 732e 6669 6e64  tch("cercis.find
+00018300: 5f70 726f 6a65 6374 5f72 6f6f 7422 2c20  _project_root", 
+00018310: 6c61 6d62 6461 202a 6172 6773 3a20 2854  lambda *args: (T
+00018320: 4849 535f 4449 522e 7265 736f 6c76 6528  HIS_DIR.resolve(
+00018330: 292c 204e 6f6e 6529 290a 2020 2020 6465  ), None)).    de
+00018340: 6620 7465 7374 5f67 6574 5f73 6f75 7263  f test_get_sourc
+00018350: 6573 5f77 6974 685f 7374 6469 6e5f 6669  es_with_stdin_fi
+00018360: 6c65 6e61 6d65 5f61 6e64 5f65 7874 656e  lename_and_exten
+00018370: 645f 6578 636c 7564 6528 7365 6c66 2920  d_exclude(self) 
+00018380: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
+00018390: 2023 2045 7874 656e 6420 6578 636c 7564   # Extend exclud
+000183a0: 6520 7368 6f75 6c64 6e27 7420 6578 636c  e shouldn't excl
+000183b0: 7564 6520 7374 6469 6e5f 6669 6c65 6e61  ude stdin_filena
+000183c0: 6d65 2073 696e 6365 2069 7420 6973 206d  me since it is m
+000183d0: 696d 6963 6b69 6e67 2074 6865 0a20 2020  imicking the.   
+000183e0: 2020 2020 2023 2066 696c 6520 6265 696e       # file bein
+000183f0: 6720 7061 7373 6564 2064 6972 6563 746c  g passed directl
+00018400: 792e 2054 6869 7320 6973 2074 6865 2073  y. This is the s
+00018410: 616d 6520 6173 0a20 2020 2020 2020 2023  ame as.        #
+00018420: 2074 6573 745f 6578 636c 7564 655f 666f   test_exclude_fo
+00018430: 725f 6973 7375 655f 3135 3732 0a20 2020  r_issue_1572.   
+00018440: 2020 2020 2073 7263 203d 205b 222d 225d       src = ["-"]
+00018450: 0a20 2020 2020 2020 2070 6174 6820 3d20  .        path = 
+00018460: 5448 4953 5f44 4952 202f 2022 6461 7461  THIS_DIR / "data
+00018470: 2220 2f20 2269 6e63 6c75 6465 5f65 7863  " / "include_exc
+00018480: 6c75 6465 5f74 6573 7473 220a 2020 2020  lude_tests".    
+00018490: 2020 2020 7374 6469 6e5f 6669 6c65 6e61      stdin_filena
+000184a0: 6d65 203d 2073 7472 2870 6174 6820 2f20  me = str(path / 
+000184b0: 2262 2f65 7863 6c75 6465 2f61 2e70 7922  "b/exclude/a.py"
+000184c0: 290a 2020 2020 2020 2020 6578 7065 6374  ).        expect
+000184d0: 6564 203d 205b 6622 5f5f 424c 4143 4b5f  ed = [f"__BLACK_
+000184e0: 5354 4449 4e5f 4649 4c45 4e41 4d45 5f5f  STDIN_FILENAME__
+000184f0: 7b73 7464 696e 5f66 696c 656e 616d 657d  {stdin_filename}
+00018500: 225d 0a20 2020 2020 2020 2061 7373 6572  "].        asser
+00018510: 745f 636f 6c6c 6563 7465 645f 736f 7572  t_collected_sour
+00018520: 6365 7328 0a20 2020 2020 2020 2020 2020  ces(.           
+00018530: 2073 7263 2c0a 2020 2020 2020 2020 2020   src,.          
+00018540: 2020 6578 7065 6374 6564 2c0a 2020 2020    expected,.    
+00018550: 2020 2020 2020 2020 6578 7465 6e64 5f65          extend_e
+00018560: 7863 6c75 6465 3d72 222f 6578 636c 7564  xclude=r"/exclud
+00018570: 652f 7c61 5c2e 7079 222c 0a20 2020 2020  e/|a\.py",.     
+00018580: 2020 2020 2020 2073 7464 696e 5f66 696c         stdin_fil
+00018590: 656e 616d 653d 7374 6469 6e5f 6669 6c65  ename=stdin_file
+000185a0: 6e61 6d65 2c0a 2020 2020 2020 2020 290a  name,.        ).
+000185b0: 0a20 2020 2040 7061 7463 6828 2263 6572  .    @patch("cer
+000185c0: 6369 732e 6669 6e64 5f70 726f 6a65 6374  cis.find_project
+000185d0: 5f72 6f6f 7422 2c20 6c61 6d62 6461 202a  _root", lambda *
+000185e0: 6172 6773 3a20 2854 4849 535f 4449 522e  args: (THIS_DIR.
+000185f0: 7265 736f 6c76 6528 292c 204e 6f6e 6529  resolve(), None)
+00018600: 290a 2020 2020 6465 6620 7465 7374 5f67  ).    def test_g
+00018610: 6574 5f73 6f75 7263 6573 5f77 6974 685f  et_sources_with_
+00018620: 7374 6469 6e5f 6669 6c65 6e61 6d65 5f61  stdin_filename_a
+00018630: 6e64 5f66 6f72 6365 5f65 7863 6c75 6465  nd_force_exclude
+00018640: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
+00018650: 2020 2020 2020 2020 2320 466f 7263 6520          # Force 
+00018660: 6578 636c 7564 6520 7368 6f75 6c64 2065  exclude should e
+00018670: 7863 6c75 6465 2074 6865 2066 696c 6520  xclude the file 
+00018680: 7768 656e 2070 6173 7369 6e67 2069 7420  when passing it 
+00018690: 7468 726f 7567 680a 2020 2020 2020 2020  through.        
+000186a0: 2320 7374 6469 6e5f 6669 6c65 6e61 6d65  # stdin_filename
+000186b0: 0a20 2020 2020 2020 2070 6174 6820 3d20  .        path = 
+000186c0: 5448 4953 5f44 4952 202f 2022 6461 7461  THIS_DIR / "data
+000186d0: 2220 2f20 2269 6e63 6c75 6465 5f65 7863  " / "include_exc
+000186e0: 6c75 6465 5f74 6573 7473 220a 2020 2020  lude_tests".    
+000186f0: 2020 2020 7374 6469 6e5f 6669 6c65 6e61      stdin_filena
+00018700: 6d65 203d 2073 7472 2870 6174 6820 2f20  me = str(path / 
+00018710: 2262 2f65 7863 6c75 6465 2f61 2e70 7922  "b/exclude/a.py"
+00018720: 290a 2020 2020 2020 2020 6173 7365 7274  ).        assert
+00018730: 5f63 6f6c 6c65 6374 6564 5f73 6f75 7263  _collected_sourc
+00018740: 6573 280a 2020 2020 2020 2020 2020 2020  es(.            
+00018750: 7372 633d 5b22 2d22 5d2c 0a20 2020 2020  src=["-"],.     
+00018760: 2020 2020 2020 2065 7870 6563 7465 643d         expected=
+00018770: 5b5d 2c0a 2020 2020 2020 2020 2020 2020  [],.            
+00018780: 666f 7263 655f 6578 636c 7564 653d 7222  force_exclude=r"
+00018790: 2f65 7863 6c75 6465 2f7c 615c 2e70 7922  /exclude/|a\.py"
+000187a0: 2c0a 2020 2020 2020 2020 2020 2020 7374  ,.            st
+000187b0: 6469 6e5f 6669 6c65 6e61 6d65 3d73 7464  din_filename=std
+000187c0: 696e 5f66 696c 656e 616d 652c 0a20 2020  in_filename,.   
+000187d0: 2020 2020 2029 0a0a 0a74 7279 3a0a 2020       )...try:.  
+000187e0: 2020 7769 7468 206f 7065 6e28 6365 7263    with open(cerc
+000187f0: 6973 2e5f 5f66 696c 655f 5f2c 2022 7222  is.__file__, "r"
+00018800: 2c20 656e 636f 6469 6e67 3d22 7574 662d  , encoding="utf-
+00018810: 3822 2920 6173 205f 6266 3a0a 2020 2020  8") as _bf:.    
+00018820: 2020 2020 626c 6163 6b5f 736f 7572 6365      black_source
+00018830: 5f6c 696e 6573 203d 205f 6266 2e72 6561  _lines = _bf.rea
+00018840: 646c 696e 6573 2829 0a65 7863 6570 7420  dlines().except 
+00018850: 556e 6963 6f64 6544 6563 6f64 6545 7272  UnicodeDecodeErr
+00018860: 6f72 3a0a 2020 2020 6966 206e 6f74 2063  or:.    if not c
+00018870: 6572 6369 732e 434f 4d50 494c 4544 3a0a  ercis.COMPILED:.
+00018880: 2020 2020 2020 2020 7261 6973 650a 0a0a          raise...
+00018890: 6465 6620 7472 6163 6566 756e 6328 0a20  def tracefunc(. 
+000188a0: 2020 2020 2020 2066 7261 6d65 3a20 7479         frame: ty
+000188b0: 7065 732e 4672 616d 6554 7970 652c 2065  pes.FrameType, e
+000188c0: 7665 6e74 3a20 7374 722c 2061 7267 3a20  vent: str, arg: 
+000188d0: 416e 790a 2920 2d3e 2043 616c 6c61 626c  Any.) -> Callabl
+000188e0: 655b 5b74 7970 6573 2e46 7261 6d65 5479  e[[types.FrameTy
+000188f0: 7065 2c20 7374 722c 2041 6e79 5d2c 2041  pe, str, Any], A
+00018900: 6e79 5d3a 0a20 2020 2022 2222 5368 6f77  ny]:.    """Show
+00018910: 2066 756e 6374 696f 6e20 6361 6c6c 7320   function calls 
+00018920: 6066 726f 6d20 6365 7263 6973 2f5f 5f69  `from cercis/__i
+00018930: 6e69 745f 5f2e 7079 6020 6173 2074 6865  nit__.py` as the
+00018940: 7920 6861 7070 656e 2e0a 0a20 2020 2052  y happen...    R
+00018950: 6567 6973 7465 7220 7468 6973 2077 6974  egister this wit
+00018960: 6820 6073 7973 2e73 6574 7472 6163 6528  h `sys.settrace(
+00018970: 2960 2069 6e20 6120 7465 7374 2079 6f75  )` in a test you
+00018980: 2772 6520 6465 6275 6767 696e 672e 0a20  're debugging.. 
+00018990: 2020 2022 2222 0a20 2020 2069 6620 6576     """.    if ev
+000189a0: 656e 7420 213d 2022 6361 6c6c 223a 0a20  ent != "call":. 
+000189b0: 2020 2020 2020 2072 6574 7572 6e20 7472         return tr
+000189c0: 6163 6566 756e 630a 0a20 2020 2073 7461  acefunc..    sta
+000189d0: 636b 203d 206c 656e 2869 6e73 7065 6374  ck = len(inspect
+000189e0: 2e73 7461 636b 2829 2920 2d20 3139 0a20  .stack()) - 19. 
+000189f0: 2020 2073 7461 636b 202a 3d20 320a 2020     stack *= 2.  
+00018a00: 2020 6669 6c65 6e61 6d65 203d 2066 7261    filename = fra
+00018a10: 6d65 2e66 5f63 6f64 652e 636f 5f66 696c  me.f_code.co_fil
+00018a20: 656e 616d 650a 2020 2020 6c69 6e65 6e6f  ename.    lineno
+00018a30: 203d 2066 7261 6d65 2e66 5f6c 696e 656e   = frame.f_linen
+00018a40: 6f0a 2020 2020 6675 6e63 5f73 6967 5f6c  o.    func_sig_l
+00018a50: 696e 656e 6f20 3d20 6c69 6e65 6e6f 202d  ineno = lineno -
+00018a60: 2031 0a20 2020 2066 756e 636e 616d 6520   1.    funcname 
+00018a70: 3d20 626c 6163 6b5f 736f 7572 6365 5f6c  = black_source_l
+00018a80: 696e 6573 5b66 756e 635f 7369 675f 6c69  ines[func_sig_li
+00018a90: 6e65 6e6f 5d2e 7374 7269 7028 290a 2020  neno].strip().  
+00018aa0: 2020 7768 696c 6520 6675 6e63 6e61 6d65    while funcname
+00018ab0: 2e73 7461 7274 7377 6974 6828 2240 2229  .startswith("@")
+00018ac0: 3a0a 2020 2020 2020 2020 6675 6e63 5f73  :.        func_s
+00018ad0: 6967 5f6c 696e 656e 6f20 2b3d 2031 0a20  ig_lineno += 1. 
+00018ae0: 2020 2020 2020 2066 756e 636e 616d 6520         funcname 
+00018af0: 3d20 626c 6163 6b5f 736f 7572 6365 5f6c  = black_source_l
+00018b00: 696e 6573 5b66 756e 635f 7369 675f 6c69  ines[func_sig_li
+00018b10: 6e65 6e6f 5d2e 7374 7269 7028 290a 2020  neno].strip().  
+00018b20: 2020 6966 2022 6365 7263 6973 2f5f 5f69    if "cercis/__i
+00018b30: 6e69 745f 5f2e 7079 2220 696e 2066 696c  nit__.py" in fil
+00018b40: 656e 616d 653a 0a20 2020 2020 2020 2070  ename:.        p
+00018b50: 7269 6e74 2866 227b 2720 2720 2a20 7374  rint(f"{' ' * st
+00018b60: 6163 6b7d 7b6c 696e 656e 6f7d 3a7b 6675  ack}{lineno}:{fu
+00018b70: 6e63 6e61 6d65 7d22 290a 2020 2020 7265  ncname}").    re
+00018b80: 7475 726e 2074 7261 6365 6675 6e63 0a    turn tracefunc.
```

### Comparing `cercis-0.1.2/tests/test_blackd.py` & `cercis-0.1.3/tests/test_blackd.py`

 * *Files 2% similar despite different names*

```diff
@@ -40,22 +40,22 @@
             self.assertEqual(result.exit_code, 0)
 
     async def get_application(self) -> web.Application:
         return blackd.make_app()
 
     @unittest_run_loop
     async def test_blackd_request_needs_formatting(self) -> None:
-        response = await self.client.post("/", data=b"print('hello world')")
+        response = await self.client.post("/", data=b'print("hello world")')
         self.assertEqual(response.status, 200)
         self.assertEqual(response.charset, "utf8")
-        self.assertEqual(await response.read(), b'print("hello world")\n')
+        self.assertEqual(await response.read(), b"print('hello world')\n")
 
     @unittest_run_loop
     async def test_blackd_request_no_change(self) -> None:
-        response = await self.client.post("/", data=b'print("hello world")\n')
+        response = await self.client.post("/", data=b"print('hello world')\n")
         self.assertEqual(response.status, 204)
         self.assertEqual(await response.read(), b"")
 
     @unittest_run_loop
     async def test_blackd_request_syntax_error(self) -> None:
         response = await self.client.post("/", data=b"what even ( is")
         self.assertEqual(response.status, 400)
@@ -190,15 +190,15 @@
         )
         self.assertEqual(response.status, 200)
         self.assertEqual(await response.read(), expected_result)
 
     @unittest_run_loop
     async def test_blackd_preview(self) -> None:
         response = await self.client.post(
-            "/", data=b'print("hello")\n', headers={blackd.PREVIEW: "true"}
+            "/", data=b"print('hello')\n", headers={blackd.PREVIEW: "true"}
         )
         self.assertEqual(response.status, 204)
 
     @unittest_run_loop
     async def test_blackd_response_black_version_header(self) -> None:
         response = await self.client.post("/")
         self.assertIsNotNone(response.headers.get(blackd.BLACK_VERSION_HEADER))
```

### Comparing `cercis-0.1.2/tests/test_format.py` & `cercis-0.1.3/tests/test_format.py`

 * *Files 25% similar despite different names*

```diff
@@ -12,14 +12,22 @@
     all_data_cases,
     assert_format,
     dump_to_stderr,
     read_data,
 )
 
 
+def _override_single_quote_for_cleaner_future_rebase(mode: cercis.Mode) -> None:
+    mode.single_quote = False
+
+
+def _use_line_length_of_88_for_cleaner_future_rebase(mode: cercis.Mode) -> None:
+    mode.line_length = 88
+
+
 @pytest.fixture(autouse=True)
 def patch_dump_to_file(request: Any) -> Iterator[None]:
     with patch("cercis.dump_to_file", dump_to_stderr):
         yield
 
 
 def check_file(
@@ -29,47 +37,63 @@
     assert_format(source, expected, mode, fast=False)
 
 
 @pytest.mark.filterwarnings("ignore:invalid escape sequence.*:DeprecationWarning")
 @pytest.mark.parametrize("filename", all_data_cases("simple_cases"))
 def test_simple_format(filename: str) -> None:
     magic_trailing_comma = filename != "skip_magic_trailing_comma"
+    single_quote = filename == "expression"
     mode = cercis.Mode(
         magic_trailing_comma=magic_trailing_comma,
         wrap_line_with_long_string=True,
+        collapse_nested_brackets=False,
+        single_quote=single_quote,
+        wrap_pragma_comments=True,
+        line_length=88,
     )
     check_file("simple_cases", filename, mode)
 
 
 @pytest.mark.parametrize("filename", all_data_cases("preview"))
 def test_preview_format(filename: str) -> None:
-    mode = cercis.Mode(preview=True, wrap_line_with_long_string=True)
+    mode = cercis.Mode(
+        preview=True,
+        wrap_line_with_long_string=True,
+        collapse_nested_brackets=False,
+        wrap_pragma_comments=True,
+        line_length=88,
+    )
+    _override_single_quote_for_cleaner_future_rebase(mode)
     check_file("preview", filename, mode)
 
 
 def test_preview_context_managers_targeting_py38() -> None:
     source, expected = read_data("preview_context_managers", "targeting_py38.py")
     mode = cercis.Mode(preview=True, target_versions={cercis.TargetVersion.PY38})
+    _override_single_quote_for_cleaner_future_rebase(mode)
     assert_format(source, expected, mode, minimum_version=(3, 8))
 
 
 def test_preview_context_managers_targeting_py39() -> None:
     source, expected = read_data("preview_context_managers", "targeting_py39.py")
     mode = cercis.Mode(preview=True, target_versions={cercis.TargetVersion.PY39})
+    _override_single_quote_for_cleaner_future_rebase(mode)
+    _use_line_length_of_88_for_cleaner_future_rebase(mode)
     assert_format(source, expected, mode, minimum_version=(3, 9))
 
 
 @pytest.mark.parametrize(
     "filename", all_data_cases("preview_context_managers/auto_detect")
 )
 def test_preview_context_managers_auto_detect(filename: str) -> None:
     match = re.match(r"features_3_(\d+)", filename)
     assert match is not None, "Unexpected filename format: %s" % filename
     source, expected = read_data("preview_context_managers/auto_detect", filename)
     mode = cercis.Mode(preview=True)
+    _override_single_quote_for_cleaner_future_rebase(mode)
     assert_format(source, expected, mode, minimum_version=(3, int(match.group(1))))
 
 
 # =============== #
 # Complex cases
 # ============= #
 
@@ -93,35 +117,41 @@
     assert_format(source, expected, mode, minimum_version=(3, 7))
 
 
 @pytest.mark.parametrize("filename", all_data_cases("py_38"))
 def test_python_38(filename: str) -> None:
     source, expected = read_data("py_38", filename)
     mode = cercis.Mode(target_versions={cercis.TargetVersion.PY38})
+    _override_single_quote_for_cleaner_future_rebase(mode)
     assert_format(source, expected, mode, minimum_version=(3, 8))
 
 
 @pytest.mark.parametrize("filename", all_data_cases("py_39"))
 def test_python_39(filename: str) -> None:
     source, expected = read_data("py_39", filename)
     mode = cercis.Mode(target_versions={cercis.TargetVersion.PY39})
+    _override_single_quote_for_cleaner_future_rebase(mode)
     assert_format(source, expected, mode, minimum_version=(3, 9))
 
 
 @pytest.mark.parametrize("filename", all_data_cases("py_310"))
 def test_python_310(filename: str) -> None:
     source, expected = read_data("py_310", filename)
     mode = cercis.Mode(target_versions={cercis.TargetVersion.PY310})
+    _override_single_quote_for_cleaner_future_rebase(mode)
+    _use_line_length_of_88_for_cleaner_future_rebase(mode)
     assert_format(source, expected, mode, minimum_version=(3, 10))
 
 
 @pytest.mark.parametrize("filename", all_data_cases("py_310"))
 def test_python_310_without_target_version(filename: str) -> None:
     source, expected = read_data("py_310", filename)
     mode = cercis.Mode()
+    _override_single_quote_for_cleaner_future_rebase(mode)
+    _use_line_length_of_88_for_cleaner_future_rebase(mode)
     assert_format(source, expected, mode, minimum_version=(3, 10))
 
 
 def test_patma_invalid() -> None:
     source, expected = read_data("miscellaneous", "pattern_matching_invalid")
     mode = cercis.Mode(target_versions={cercis.TargetVersion.PY310})
     with pytest.raises(cercis.parsing.InvalidInput) as exc_info:
@@ -130,14 +160,15 @@
     exc_info.match("Cannot parse: 10:11")
 
 
 @pytest.mark.parametrize("filename", all_data_cases("py_311"))
 def test_python_311(filename: str) -> None:
     source, expected = read_data("py_311", filename)
     mode = cercis.Mode(target_versions={cercis.TargetVersion.PY311})
+    _override_single_quote_for_cleaner_future_rebase(mode)
     assert_format(source, expected, mode, minimum_version=(3, 11))
 
 
 @pytest.mark.parametrize("filename", all_data_cases("fast"))
 def test_fast_cases(filename: str) -> None:
     source, expected = read_data("fast", filename)
     assert_format(source, expected, fast=True)
@@ -180,14 +211,15 @@
     """Tests for turning off the string processing logic."""
     source, expected = read_data("miscellaneous", "long_strings_flag_disabled")
     mode = replace(
         DEFAULT_MODE,
         experimental_string_processing=False,
         wrap_line_with_long_string=True,
     )
+    _override_single_quote_for_cleaner_future_rebase(mode)
     assert_format(source, expected, mode)
 
 
 def test_stub() -> None:
     mode = replace(DEFAULT_MODE, is_pyi=True)
     source, expected = read_data("miscellaneous", "stub.pyi")
     assert_format(source, expected, mode)
@@ -217,32 +249,71 @@
     [
         ("func_def_extra_indent.py", True),  # Cercis's default
         ("func_def_no_extra_indent.py", False),  # Black's default
     ],
 )
 def test_function_definition_extra_indent(filename: str, extra_indent: bool) -> None:
     mode = replace(DEFAULT_MODE, function_definition_extra_indent=extra_indent)
+    _override_single_quote_for_cleaner_future_rebase(mode)
     check_file("configurable_cases/func_def_indent", filename, mode)
 
 
 @pytest.mark.filterwarnings("ignore:invalid escape sequence.*:DeprecationWarning")
 @pytest.mark.parametrize(
     "filename",
     all_data_cases("configurable_cases/single_quote"),
 )
 def test_single_quote(filename: str) -> None:
-    mode = replace(DEFAULT_MODE, single_quote=True, wrap_line_with_long_string=True)
+    mode = replace(
+        DEFAULT_MODE,
+        single_quote=True,
+        wrap_line_with_long_string=True,
+        collapse_nested_brackets=False,
+        wrap_pragma_comments=True,
+        line_length=88,
+    )
     check_file("configurable_cases/single_quote", filename, mode)
 
 
 @pytest.mark.parametrize(
     "filename, wrap_line",
     [
         ("test_cases__Cercis_default.py", False),
         ("test_cases__Black_default.py", True),
         ("long_strings_flag_disabled__Cercis_default.py", False),
         ("long_strings_flag_disabled__Black_default.py", True),
+        ("edge_cases.py", False),
+        ("edge_cases.py", True),
     ],
 )
 def test_opt_out_of_wrapping(filename: str, wrap_line: bool) -> None:
     mode = replace(DEFAULT_MODE, wrap_line_with_long_string=wrap_line)
+    _override_single_quote_for_cleaner_future_rebase(mode)
+    _use_line_length_of_88_for_cleaner_future_rebase(mode)
     check_file("configurable_cases/line_with_long_string", filename, mode)
+
+
+@pytest.mark.parametrize(
+    "filename, collapse_nested_brackets",
+    [
+        ("nested_brackets__Cercis_default.py", True),
+        ("nested_brackets__Black_default.py", False),
+        ("nested_brackets_explodes__Cercis_default.py", True),
+        ("nested_brackets_explodes__Black_default.py", False),
+    ],
+)
+def test_nested_brackets(filename: str, collapse_nested_brackets: bool) -> None:
+    mode = replace(DEFAULT_MODE, collapse_nested_brackets=collapse_nested_brackets)
+    _override_single_quote_for_cleaner_future_rebase(mode)
+    check_file("configurable_cases/nested_brackets", filename, mode)
+
+
+@pytest.mark.parametrize(
+    "filename, wrap",
+    [
+        ("Cercis_default.py", False),
+        ("Black_default.py", True),
+    ],
+)
+def test_wrap_pragma_comments(filename: str, wrap: bool) -> None:
+    mode = replace(DEFAULT_MODE, wrap_pragma_comments=wrap, line_length=80)
+    check_file("configurable_cases/pragma_comments", filename, mode)
```

### Comparing `cercis-0.1.2/tests/test_ipynb.py` & `cercis-0.1.3/tests/test_ipynb.py`

 * *Files 2% similar despite different names*

```diff
@@ -22,39 +22,39 @@
 
 with contextlib.suppress(ModuleNotFoundError):
     import IPython
 pytestmark = pytest.mark.jupyter
 pytest.importorskip("IPython", reason="IPython is an optional dependency")
 pytest.importorskip("tokenize_rt", reason="tokenize-rt is an optional dependency")
 
-JUPYTER_MODE = Mode(is_ipynb=True)
+JUPYTER_MODE = Mode(is_ipynb=True, single_quote=True)
 
 EMPTY_CONFIG = DATA_DIR / "empty_pyproject.toml"
 
 runner = CliRunner()
 
 
 def test_noop() -> None:
-    src = 'foo = "a"'
+    src = "foo = 'a'"
     with pytest.raises(NothingChanged):
         format_cell(src, fast=True, mode=JUPYTER_MODE)
 
 
 @pytest.mark.parametrize("fast", [True, False])
 def test_trailing_semicolon(fast: bool) -> None:
     src = 'foo = "a" ;'
     result = format_cell(src, fast=fast, mode=JUPYTER_MODE)
-    expected = 'foo = "a";'
+    expected = "foo = 'a';"
     assert result == expected
 
 
 def test_trailing_semicolon_with_comment() -> None:
     src = 'foo = "a" ;  # bar'
     result = format_cell(src, fast=True, mode=JUPYTER_MODE)
-    expected = 'foo = "a";  # bar'
+    expected = "foo = 'a';  # bar"
     assert result == expected
 
 
 def test_trailing_semicolon_with_comment_on_next_line() -> None:
     src = "import cercis;\n\n# this is a comment"
     with pytest.raises(NothingChanged):
         format_cell(src, fast=True, mode=JUPYTER_MODE)
@@ -63,15 +63,15 @@
 def test_trailing_semicolon_indented() -> None:
     src = "with foo:\n    plot_bar();"
     with pytest.raises(NothingChanged):
         format_cell(src, fast=True, mode=JUPYTER_MODE)
 
 
 def test_trailing_semicolon_noop() -> None:
-    src = 'foo = "a";'
+    src = "foo = 'a';"
     with pytest.raises(NothingChanged):
         format_cell(src, fast=True, mode=JUPYTER_MODE)
 
 
 @pytest.mark.parametrize(
     "mode",
     [
@@ -105,24 +105,24 @@
         ),
     ],
 )
 @pytest.mark.parametrize(
     "src, expected",
     (
         pytest.param("ls =!ls", "ls = !ls", id="System assignment"),
-        pytest.param("!ls\n'foo'", '!ls\n"foo"', id="System call"),
-        pytest.param("!!ls\n'foo'", '!!ls\n"foo"', id="Other system call"),
-        pytest.param("?str\n'foo'", '?str\n"foo"', id="Help"),
-        pytest.param("??str\n'foo'", '??str\n"foo"', id="Other help"),
+        pytest.param('!ls\n"foo"', "!ls\n'foo'", id="System call"),
+        pytest.param('!!ls\n"foo"', "!!ls\n'foo'", id="Other system call"),
+        pytest.param('?str\n"foo"', "?str\n'foo'", id="Help"),
+        pytest.param('??str\n"foo"', "??str\n'foo'", id="Other help"),
         pytest.param(
-            "%matplotlib inline\n'foo'",
             '%matplotlib inline\n"foo"',
+            "%matplotlib inline\n'foo'",
             id="Line magic with argument",
         ),
-        pytest.param("%time\n'foo'", '%time\n"foo"', id="Line magic without argument"),
+        pytest.param('%time\n"foo"', "%time\n'foo'", id="Line magic without argument"),
         pytest.param(
             "env =  %env var", "env = %env var", id="Assignment to environment variable"
         ),
         pytest.param("env =  %env", "env = %env", id="Assignment to magic"),
     ),
 )
 def test_magic(src: str, expected: str, mode: Mode) -> None:
@@ -265,15 +265,15 @@
         '   "metadata": {\n'
         '    "tags": []\n'
         "   },\n"
         '   "outputs": [],\n'
         '   "source": [\n'
         '    "%%time\\n",\n'
         '    "\\n",\n'
-        '    "print(\\"foo\\")"\n'
+        '    "print(\'foo\')"\n'
         "   ]\n"
         "  },\n"
         "  {\n"
         '   "cell_type": "code",\n'
         '   "execution_count": null,\n'
         '   "metadata": {},\n'
         '   "outputs": [],\n'
@@ -302,15 +302,15 @@
         '   "metadata": {\n'
         '    "tags": []\n'
         "   },\n"
         '   "outputs": [],\n'
         '   "source": [\n'
         '    "%%time\\n",\n'
         '    "\\n",\n'
-        '    "print(\\"foo\\")"\n'
+        '    "print(\'foo\')"\n'
         "   ]\n"
         "  },\n"
         "  {\n"
         '   "cell_type": "code",\n'
         '   "execution_count": null,\n'
         '   "metadata": {},\n'
         '   "outputs": [],\n'
@@ -351,15 +351,15 @@
         '   "metadata": {\n'
         '    "tags": []\n'
         "   },\n"
         '   "outputs": [],\n'
         '   "source": [\n'
         '    "%%time\\n",\n'
         '    "\\n",\n'
-        '    "print(\\"foo\\")"\n'
+        '    "print(\'foo\')"\n'
         "   ]\n"
         "  },\n"
         "  {\n"
         '   "cell_type": "code",\n'
         '   "execution_count": null,\n'
         '   "metadata": {},\n'
         '   "outputs": [],\n'
@@ -417,15 +417,15 @@
         main,
         [
             str(get_case_path("jupyter", "notebook_trailing_newline.ipynb")),
             "--diff",
             f"--config={EMPTY_CONFIG}",
         ],
     )
-    expected = "@@ -1,3 +1,3 @@\n %%time\n \n-print('foo')\n+print(\"foo\")\n"
+    expected = "@@ -1,3 +1,3 @@\n %%time\n \n-print(\"foo\")\n+print('foo')\n"
     assert expected in result.output
 
 
 def test_ipynb_diff_with_no_change() -> None:
     result = runner.invoke(
         main,
         [
@@ -496,15 +496,15 @@
         [
             str(tmp_nb),
             "--diff",
             "--ipynb",
             f"--config={EMPTY_CONFIG}",
         ],
     )
-    expected = "@@ -1,3 +1,3 @@\n %%time\n \n-print('foo')\n+print(\"foo\")\n"
+    expected = "@@ -1,3 +1,3 @@\n %%time\n \n-print(\"foo\")\n+print('foo')\n"
     assert expected in result.output
 
 
 def test_ipynb_and_pyi_flags() -> None:
     nb = get_case_path("jupyter", "notebook_trailing_newline.ipynb")
     result = runner.invoke(
         main,
```

### Comparing `cercis-0.1.2/tests/test_no_ipynb.py` & `cercis-0.1.3/tests/test_no_ipynb.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/test_trans.py` & `cercis-0.1.3/tests/test_trans.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/test_utils_line_wrapping.py` & `cercis-0.1.3/tests/test_utils_line_wrapping.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/util.py` & `cercis-0.1.3/tests/util.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/conditional_expression.py` & `cercis-0.1.3/tests/data/conditional_expression.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/configurable_cases/line_with_long_string/long_strings_flag_disabled__Black_default.py` & `cercis-0.1.3/tests/data/miscellaneous/long_strings_flag_disabled.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/configurable_cases/line_with_long_string/long_strings_flag_disabled__Cercis_default.py` & `cercis-0.1.3/tests/data/configurable_cases/line_with_long_string/long_strings_flag_disabled__Cercis_default.py`

 * *Files 2% similar despite different names*

```diff
@@ -272,29 +272,14 @@
 
 def foo():
     yield "This is a really long string that can't possibly be expected to fit all together on one line. In fact it may even take up three or more lines... like four or five... but probably just three."
 
 
 x = f"This is a {{really}} long string that needs to be split without a doubt (i.e. most definitely). In short, this {string} that can't possibly be {{expected}} to fit all together on one line. In {fact} it may even take up three or more lines... like four or five... but probably just four."
 
-long_unmergable_string_with_pragma = (
-    "This is a really long string that can't be merged because it has a likely pragma at the end"  # type: ignore
-    " of it."
-)
-
-long_unmergable_string_with_pragma = (
-    "This is a really long string that can't be merged because it has a likely pragma at the end"  # noqa
-    " of it."
-)
-
-long_unmergable_string_with_pragma = (
-    "This is a really long string that can't be merged because it has a likely pragma at the end"  # pylint: disable=some-pylint-check
-    " of it."
-)
-
 # output
 
 x = "This is a really long string that can't possibly be expected to fit all together on one line. In fact it may even take up three or more lines... like four or five... but probably just three."
 
 x += "This is a really long string that can't possibly be expected to fit all together on one line. In fact it may even take up three or more lines... like four or five... but probably just three."
 
 y = "Short string"
@@ -347,15 +332,19 @@
     my_kwarg="Long keyword strings also need to be wrapped, but they will probably need to be handled a little bit differently.",
 )
 
 bad_split1 = "But what should happen when code has already been formatted but in the wrong way? Like" " with a space at the end instead of the beginning. Or what about when it is split too soon?"
 
 bad_split2 = "But what should happen when code has already " "been formatted but in the wrong way? Like " "with a space at the end instead of the " "beginning. Or what about when it is split too " "soon? In the case of a split that is too " "short, cercis will try to honer the custom " "split."
 
-bad_split3 = "What if we have inline comments on " "each line of a bad split? In that " "case, we should just leave it alone."  # First Comment  # Second Comment  # Third Comment
+bad_split3 = (
+    "What if we have inline comments on "  # First Comment
+    "each line of a bad split? In that "  # Second Comment
+    "case, we should just leave it alone."  # Third Comment
+)
 
 bad_split_func1(
     "But what should happen when code has already "
     "been formatted but in the wrong way? Like "
     "with a space at the end instead of the "
     "beginning. Or what about when it is split too "
     "soon? In the case of a split that is too "
@@ -551,13 +540,7 @@
 
 
 def foo():
     yield "This is a really long string that can't possibly be expected to fit all together on one line. In fact it may even take up three or more lines... like four or five... but probably just three."
 
 
 x = f"This is a {{really}} long string that needs to be split without a doubt (i.e. most definitely). In short, this {string} that can't possibly be {{expected}} to fit all together on one line. In {fact} it may even take up three or more lines... like four or five... but probably just four."
-
-long_unmergable_string_with_pragma = "This is a really long string that can't be merged because it has a likely pragma at the end" " of it."  # type: ignore
-
-long_unmergable_string_with_pragma = "This is a really long string that can't be merged because it has a likely pragma at the end" " of it."  # noqa
-
-long_unmergable_string_with_pragma = "This is a really long string that can't be merged because it has a likely pragma at the end" " of it."  # pylint: disable=some-pylint-check
```

### Comparing `cercis-0.1.2/tests/data/configurable_cases/line_with_long_string/test_cases__Black_default.py` & `cercis-0.1.3/tests/data/configurable_cases/line_with_long_string/test_cases__Black_default.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/configurable_cases/line_with_long_string/test_cases__Cercis_default.py` & `cercis-0.1.3/tests/data/configurable_cases/line_with_long_string/test_cases__Cercis_default.py`

 * *Files 2% similar despite different names*

```diff
@@ -136,28 +136,32 @@
 
 a = A(B(C(D(E("")))))
 
 a.b.c.d.e.some_attr = "Once upon a time there is" " a village alongside the river that flows quitely."
 
 a.b.c.d.e = "Once upon a time there is" " a village alongside the river that flows quitely."
 
-a.b.c.d.e = "Once upon a time there is" " a village alongside the river that flows quitely."  # two tabs
+a.b.c.d.e = (
+    "Once upon a time there is" " a village alongside the river that flows quitely."
+)  # two tabs
 
 a.b.c.d.e = "Once upon a time there is" " a village alongside the river that flows quitely."
 
 a.b.c = "Once upon a time there is" " a village alongside the river that flows quitely. QED"
 
 a.b.c = "Once upon a time there is" " a village alongside the river that flows quitely. The end."
 
 abc = "this line has two parts; the first string is already long than the line limit of 88 characters;" " this is the 2nd part"
 
 "It was the best of times, it was the worst of times, it was the age of wisdom, it was the age of foolishness, it was the epoch of belief, it was the epoch of incredulity, it was the season of Light, it was the season of Darkness, it was the spring of hope, it was the winter of despair, we had everything before us, we had nothing before us, we were all going direct to Heaven, we were all going direct the other way—in short, the period was so far like the present period, that some of its noisiest authorities insisted on its being received, for good or for evil, in the superlative degree of comparison only."
 
 
-result_1 = "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"  # aaa
+result_1 = (  # aaa
+    "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
+)
 
 result_2 = "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"  # bbb
 
 result_3 = "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"  # ccc
 
 result_4 = "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"  # aaa  # bbb
 
@@ -166,10 +170,14 @@
 result_6 = "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"  # aaa  # ccc
 
 result_7 = "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"  # aaa  # bbb  # ccc
 
 
 ("my very long string that shouldn't get formatted even if it goes over the 88 char" " limit like it does now")
 
-three_strings_1 = "What if we have inline comments on " "each line of a bad split? In that " "case, should we just leave it alone?"  # aaa  # bbb  # ccc
+three_strings_1 = (
+    "What if we have inline comments on "  # aaa
+    "each line of a bad split? In that "  # bbb
+    "case, should we just leave it alone?"  # ccc
+)
 
 three_strings_2 = "a" "b" "c"  # aa  # bb  # cc
```

### Comparing `cercis-0.1.2/tests/data/configurable_cases/single_quote/docstring.py` & `cercis-0.1.3/tests/data/configurable_cases/single_quote/docstring.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/configurable_cases/single_quote/docstring_preview.py` & `cercis-0.1.3/tests/data/configurable_cases/single_quote/docstring_preview.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/configurable_cases/single_quote/more_quotes.py` & `cercis-0.1.3/tests/data/configurable_cases/single_quote/more_quotes.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/configurable_cases/single_quote/string_prefixes.py` & `cercis-0.1.3/tests/data/configurable_cases/single_quote/string_prefixes.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/configurable_cases/single_quote/torture.py` & `cercis-0.1.3/tests/data/configurable_cases/single_quote/torture.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/jupyter/notebook_no_trailing_newline.ipynb` & `cercis-0.1.3/tests/data/jupyter/notebook_no_trailing_newline.ipynb`

 * *Files 4% similar despite different names*

#### Pretty-printed

 * *Similarity: 0.996875%*

 * *Differences: {"'cells'": '{0: {\'source\': {insert: [(2, \'print("foo")\')], delete: [2]}}}'}*

```diff
@@ -6,15 +6,15 @@
             "metadata": {
                 "tags": []
             },
             "outputs": [],
             "source": [
                 "%%time\n",
                 "\n",
-                "print('foo')"
+                "print(\"foo\")"
             ]
         },
         {
             "cell_type": "code",
             "execution_count": null,
             "metadata": {},
             "outputs": [],
```

### Comparing `cercis-0.1.2/tests/data/jupyter/notebook_trailing_newline.ipynb` & `cercis-0.1.3/tests/data/jupyter/notebook_trailing_newline.ipynb`

 * *Files 4% similar despite different names*

#### Pretty-printed

 * *Similarity: 0.996875%*

 * *Differences: {"'cells'": '{0: {\'source\': {insert: [(2, \'print("foo")\')], delete: [2]}}}'}*

```diff
@@ -6,15 +6,15 @@
             "metadata": {
                 "tags": []
             },
             "outputs": [],
             "source": [
                 "%%time\n",
                 "\n",
-                "print('foo')"
+                "print(\"foo\")"
             ]
         },
         {
             "cell_type": "code",
             "execution_count": null,
             "metadata": {},
             "outputs": [],
```

### Comparing `cercis-0.1.2/tests/data/miscellaneous/debug_visitor.out` & `cercis-0.1.3/tests/data/miscellaneous/debug_visitor.out`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/miscellaneous/debug_visitor.py` & `cercis-0.1.3/tests/data/miscellaneous/debug_visitor.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/miscellaneous/decorators.py` & `cercis-0.1.3/tests/data/miscellaneous/decorators.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/miscellaneous/docstring_no_string_normalization.py` & `cercis-0.1.3/tests/data/miscellaneous/docstring_no_string_normalization.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/miscellaneous/expression_skip_magic_trailing_comma.diff` & `cercis-0.1.3/tests/data/simple_cases/expression.diff`

 * *Files 4% similar despite different names*

```diff
@@ -1,21 +1,21 @@
 --- [Deterministic header]
 +++ [Deterministic header]
 @@ -1,8 +1,8 @@
  ...
--'some_string'
--b'\\xa3'
-+"some_string"
-+b"\\xa3"
+-"some_string"
+-b"\\xa3"
++'some_string'
++b'\\xa3'
  Name
  None
  True
  False
  1
-@@ -21,99 +21,118 @@
+@@ -21,99 +21,135 @@
  Name1 or (Name2 and Name3) or Name4
  Name1 or Name2 and Name3 or Name4
  v1 << 2
  1 >> v2
  1 % finished
 -1 + v2 - v3 * 4 ^ 5 ** v6 / 7 // 8
 -((1 + v2) - (v3 * 4)) ^ (((5 ** v6) / 7) // 8)
@@ -30,105 +30,117 @@
 -+really ** -confusing ** ~operator ** -precedence
 -flags & ~ select.EPOLLIN and waiters.write_task is not None
 ++(really ** -(confusing ** ~(operator**-precedence)))
 +flags & ~select.EPOLLIN and waiters.write_task is not None
  lambda arg: None
  lambda a=True: a
  lambda a, b, c=True: a
--lambda a, b, c=True, *, d=(1 << v2), e='str': a
--lambda a, b, c=True, *vararg, d=(v1 << 2), e='str', **kwargs: a + b
-+lambda a, b, c=True, *, d=(1 << v2), e="str": a
-+lambda a, b, c=True, *vararg, d=(v1 << 2), e="str", **kwargs: a + b
+-lambda a, b, c=True, *, d=(1 << v2), e="str": a
+-lambda a, b, c=True, *vararg, d=(v1 << 2), e="str", **kwargs: a + b
++lambda a, b, c=True, *, d=(1 << v2), e='str': a
++lambda a, b, c=True, *vararg, d=(v1 << 2), e='str', **kwargs: a + b
  manylambdas = lambda x=lambda y=lambda z=1: z: y(): x()
 -foo = (lambda port_id, ignore_missing: {"port1": port1_resource, "port2": port2_resource}[port_id])
 +foo = lambda port_id, ignore_missing: {
-+    "port1": port1_resource,
-+    "port2": port2_resource,
++    'port1': port1_resource,
++    'port2': port2_resource,
 +}[port_id]
  1 if True else 2
  str or None if True else str or bytes or None
  (str or None) if True else (str or bytes or None)
  str or None if (1 if True else 2) else str or bytes or None
  (str or None) if (1 if True else 2) else (str or bytes or None)
 -((super_long_variable_name or None) if (1 if super_long_test_name else 2) else (str or bytes or None))
--{'2.7': dead, '3.7': (long_live or die_hard)}
--{'2.7': dead, '3.7': (long_live or die_hard), **{'3.6': verygood}}
+-{"2.7": dead, "3.7": (long_live or die_hard)}
+-{"2.7": dead, "3.7": (long_live or die_hard), **{"3.6": verygood}}
 +(
 +    (super_long_variable_name or None)
 +    if (1 if super_long_test_name else 2)
 +    else (str or bytes or None)
 +)
-+{"2.7": dead, "3.7": (long_live or die_hard)}
-+{"2.7": dead, "3.7": (long_live or die_hard), **{"3.6": verygood}}
++{'2.7': dead, '3.7': (long_live or die_hard)}
++{'2.7': dead, '3.7': (long_live or die_hard), **{'3.6': verygood}}
  {**a, **b, **c}
--{'2.7', '3.6', '3.7', '3.8', '3.9', ('4.0' if gilectomy else '3.10')}
--({'a': 'b'}, (True or False), (+value), 'string', b'bytes') or None
-+{"2.7", "3.6", "3.7", "3.8", "3.9", ("4.0" if gilectomy else "3.10")}
-+({"a": "b"}, (True or False), (+value), "string", b"bytes") or None
+-{"2.7", "3.6", "3.7", "3.8", "3.9", ("4.0" if gilectomy else "3.10")}
+-({"a": "b"}, (True or False), (+value), "string", b"bytes") or None
++{'2.7', '3.6', '3.7', '3.8', '3.9', ('4.0' if gilectomy else '3.10')}
++({'a': 'b'}, (True or False), (+value), 'string', b'bytes') or None
  ()
  (1,)
  (1, 2)
  (1, 2, 3)
  []
  [1, 2, 3, 4, 5, 6, 7, 8, 9, (10 or A), (11 or B), (12 or C)]
 -[1, 2, 3,]
-+[1, 2, 3]
++[
++    1,
++    2,
++    3,
++]
  [*a]
  [*range(10)]
 -[*a, 4, 5,]
 -[4, *a, 5,]
 -[this_is_a_very_long_variable_which_will_force_a_delimiter_split, element, another, *more]
-+[*a, 4, 5]
-+[4, *a, 5]
++[
++    *a,
++    4,
++    5,
++]
++[
++    4,
++    *a,
++    5,
++]
 +[
 +    this_is_a_very_long_variable_which_will_force_a_delimiter_split,
 +    element,
 +    another,
 +    *more,
 +]
  {i for i in (1, 2, 3)}
 -{(i ** 2) for i in (1, 2, 3)}
--{(i ** 2) for i, _ in ((1, 'a'), (2, 'b'), (3, 'c'))}
+-{(i ** 2) for i, _ in ((1, "a"), (2, "b"), (3, "c"))}
 -{((i ** 2) + j) for i in (1, 2, 3) for j in (1, 2, 3)}
 +{(i**2) for i in (1, 2, 3)}
-+{(i**2) for i, _ in ((1, "a"), (2, "b"), (3, "c"))}
++{(i**2) for i, _ in ((1, 'a'), (2, 'b'), (3, 'c'))}
 +{((i**2) + j) for i in (1, 2, 3) for j in (1, 2, 3)}
  [i for i in (1, 2, 3)]
 -[(i ** 2) for i in (1, 2, 3)]
--[(i ** 2) for i, _ in ((1, 'a'), (2, 'b'), (3, 'c'))]
+-[(i ** 2) for i, _ in ((1, "a"), (2, "b"), (3, "c"))]
 -[((i ** 2) + j) for i in (1, 2, 3) for j in (1, 2, 3)]
 +[(i**2) for i in (1, 2, 3)]
-+[(i**2) for i, _ in ((1, "a"), (2, "b"), (3, "c"))]
++[(i**2) for i, _ in ((1, 'a'), (2, 'b'), (3, 'c'))]
 +[((i**2) + j) for i in (1, 2, 3) for j in (1, 2, 3)]
  {i: 0 for i in (1, 2, 3)}
--{i: j for i, j in ((1, 'a'), (2, 'b'), (3, 'c'))}
-+{i: j for i, j in ((1, "a"), (2, "b"), (3, "c"))}
+-{i: j for i, j in ((1, "a"), (2, "b"), (3, "c"))}
++{i: j for i, j in ((1, 'a'), (2, 'b'), (3, 'c'))}
  {a: b * 2 for a, b in dictionary.items()}
  {a: b * -2 for a, b in dictionary.items()}
 -{k: v for k, v in this_is_a_very_long_variable_which_will_cause_a_trailing_comma_which_breaks_the_comprehension}
 +{
 +    k: v
 +    for k, v in this_is_a_very_long_variable_which_will_cause_a_trailing_comma_which_breaks_the_comprehension
 +}
  Python3 > Python2 > COBOL
  Life is Life
  call()
  call(arg)
--call(kwarg='hey')
--call(arg, kwarg='hey')
--call(arg, another, kwarg='hey', **kwargs)
--call(this_is_a_very_long_variable_which_will_force_a_delimiter_split, arg, another, kwarg='hey', **kwargs)  # note: no trailing comma pre-3.6
-+call(kwarg="hey")
-+call(arg, kwarg="hey")
-+call(arg, another, kwarg="hey", **kwargs)
+-call(kwarg="hey")
+-call(arg, kwarg="hey")
+-call(arg, another, kwarg="hey", **kwargs)
+-call(this_is_a_very_long_variable_which_will_force_a_delimiter_split, arg, another, kwarg="hey", **kwargs)  # note: no trailing comma pre-3.6
++call(kwarg='hey')
++call(arg, kwarg='hey')
++call(arg, another, kwarg='hey', **kwargs)
 +call(
 +    this_is_a_very_long_variable_which_will_force_a_delimiter_split,
 +    arg,
 +    another,
-+    kwarg="hey",
++    kwarg='hey',
 +    **kwargs
 +)  # note: no trailing comma pre-3.6
  call(*gidgets[:2])
  call(a, *gidgets[:2])
  call(**self.screen_kwargs)
  call(b, **self.screen_kwargs)
  lukasz.langa.pl
@@ -137,20 +149,24 @@
 -1.0 .real
 +(1).real
 +(1.0).real
  ....__class__
  list[str]
  dict[str, int]
  tuple[str, ...]
--tuple[
++tuple[str, int, float, dict[str, int]]
+ tuple[
 -    str, int, float, dict[str, int]
 -]
 -tuple[str, int, float, dict[str, int],]
-+tuple[str, int, float, dict[str, int]]
-+tuple[str, int, float, dict[str, int]]
++    str,
++    int,
++    float,
++    dict[str, int],
++]
  very_long_variable_name_filters: t.List[
      t.Tuple[str, t.Union[str, t.List[t.Optional[str]]]],
  ]
  xxxx_xxxxx_xxxx_xxx: Callable[..., List[SomeClass]] = classmethod(  # type: ignore
      sync(async_xxxx_xxx_xxxx_xxxxx_xxxx_xxx.__func__)
  )
  xxxx_xxx_xxxx_xxxxx_xxxx_xxx: Callable[..., List[SomeClass]] = classmethod(  # type: ignore
@@ -163,54 +179,54 @@
 +    sync(async_xxxx_xxx_xxxx_xxxxx_xxxx_xxx.__func__)
 +)  # type: ignore
  slice[0]
  slice[0:1]
  slice[0:1:2]
  slice[:]
  slice[:-1]
-@@ -137,118 +156,197 @@
+@@ -137,118 +173,199 @@
  numpy[-(c + 1) :, d]
  numpy[:, l[-2]]
  numpy[:, ::-1]
  numpy[np.newaxis, :]
  (str or None) if (sys.version_info[0] > (3,)) else (str or bytes or None)
--{'2.7': dead, '3.7': long_live or die_hard}
--{'2.7', '3.6', '3.7', '3.8', '3.9', '4.0' if gilectomy else '3.10'}
-+{"2.7": dead, "3.7": long_live or die_hard}
-+{"2.7", "3.6", "3.7", "3.8", "3.9", "4.0" if gilectomy else "3.10"}
+-{"2.7": dead, "3.7": long_live or die_hard}
+-{"2.7", "3.6", "3.7", "3.8", "3.9", "4.0" if gilectomy else "3.10"}
++{'2.7': dead, '3.7': long_live or die_hard}
++{'2.7', '3.6', '3.7', '3.8', '3.9', '4.0' if gilectomy else '3.10'}
  [1, 2, 3, 4, 5, 6, 7, 8, 9, 10 or A, 11 or B, 12 or C]
  (SomeName)
  SomeName
  (Good, Bad, Ugly)
  (i for i in (1, 2, 3))
 -((i ** 2) for i in (1, 2, 3))
--((i ** 2) for i, _ in ((1, 'a'), (2, 'b'), (3, 'c')))
+-((i ** 2) for i, _ in ((1, "a"), (2, "b"), (3, "c")))
 -(((i ** 2) + j) for i in (1, 2, 3) for j in (1, 2, 3))
 +((i**2) for i in (1, 2, 3))
-+((i**2) for i, _ in ((1, "a"), (2, "b"), (3, "c")))
++((i**2) for i, _ in ((1, 'a'), (2, 'b'), (3, 'c')))
 +(((i**2) + j) for i in (1, 2, 3) for j in (1, 2, 3))
  (*starred,)
 -{"id": "1","type": "type","started_at": now(),"ended_at": now() + timedelta(days=10),"priority": 1,"import_session_id": 1,**kwargs}
 +{
-+    "id": "1",
-+    "type": "type",
-+    "started_at": now(),
-+    "ended_at": now() + timedelta(days=10),
-+    "priority": 1,
-+    "import_session_id": 1,
++    'id': '1',
++    'type': 'type',
++    'started_at': now(),
++    'ended_at': now() + timedelta(days=10),
++    'priority': 1,
++    'import_session_id': 1,
 +    **kwargs,
 +}
  a = (1,)
 -b = 1,
 +b = (1,)
  c = 1
  d = (1,) + a + (2,)
  e = (1,).count(1)
  f = 1, *range(10)
- g = 1, *"ten"
+ g = 1, *'ten'
 -what_is_up_with_those_new_coord_names = (coord_names + set(vars_to_create)) + set(vars_to_remove)
 -what_is_up_with_those_new_coord_names = (coord_names | set(vars_to_create)) - set(vars_to_remove)
 -result = session.query(models.Customer.id).filter(models.Customer.account_id == account_id, models.Customer.email == email_address).order_by(models.Customer.id.asc()).all()
 -result = session.query(models.Customer.id).filter(models.Customer.account_id == account_id, models.Customer.email == email_address).order_by(models.Customer.id.asc(),).all()
 +what_is_up_with_those_new_coord_names = (coord_names + set(vars_to_create)) + set(
 +    vars_to_remove
 +)
@@ -226,15 +242,17 @@
 +    .all()
 +)
 +result = (
 +    session.query(models.Customer.id)
 +    .filter(
 +        models.Customer.account_id == account_id, models.Customer.email == email_address
 +    )
-+    .order_by(models.Customer.id.asc())
++    .order_by(
++        models.Customer.id.asc(),
++    )
 +    .all()
 +)
  Ø = set()
  authors.łukasz.say_thanks()
  mapping = {
      A: 0.25 * (10.0 / 12),
      B: 0.1 * (10.0 / 12),
@@ -257,29 +275,29 @@
      await some.complicated[0].call(with_args=(True or (1 is not 1)))
 -print(* [] or [1])
 +
 +
 +print(*[] or [1])
  print(**{1: 3} if False else {x: x for x in range(3)})
 -print(* lambda x: x)
--assert(not Test),("Short message")
--assert this is ComplexTest and not requirements.fit_in_a_single_line(force=False), "Short message"
+-assert(not Test),('Short message')
+-assert this is ComplexTest and not requirements.fit_in_a_single_line(force=False), 'Short message'
 -assert(((parens is TooMany)))
 -for x, in (1,), (2,), (3,): ...
 -for y in (): ...
 -for z in (i for i in (1, 2, 3)): ...
 -for i in (call()): ...
 -for j in (1 + (2 + 3)): ...
 -while(this and that): ...
 -for addr_family, addr_type, addr_proto, addr_canonname, addr_sockaddr in socket.getaddrinfo('google.com', 'http'):
 +print(*lambda x: x)
-+assert not Test, "Short message"
++assert not Test, 'Short message'
 +assert this is ComplexTest and not requirements.fit_in_a_single_line(
 +    force=False
-+), "Short message"
++), 'Short message'
 +assert parens is TooMany
 +for (x,) in (1,), (2,), (3,):
 +    ...
 +for y in ():
 +    ...
 +for z in (i for i in (1, 2, 3)):
 +    ...
@@ -291,15 +309,15 @@
 +    ...
 +for (
 +    addr_family,
 +    addr_type,
 +    addr_proto,
 +    addr_canonname,
 +    addr_sockaddr,
-+) in socket.getaddrinfo("google.com", "http"):
++) in socket.getaddrinfo('google.com', 'http'):
      pass
 -a = aaaa.bbbb.cccc.dddd.eeee.ffff.gggg.hhhh.iiii.jjjj.kkkk.llll.mmmm.nnnn.oooo.pppp in qqqq.rrrr.ssss.tttt.uuuu.vvvv.xxxx.yyyy.zzzz
 -a = aaaa.bbbb.cccc.dddd.eeee.ffff.gggg.hhhh.iiii.jjjj.kkkk.llll.mmmm.nnnn.oooo.pppp not in qqqq.rrrr.ssss.tttt.uuuu.vvvv.xxxx.yyyy.zzzz
 -a = aaaa.bbbb.cccc.dddd.eeee.ffff.gggg.hhhh.iiii.jjjj.kkkk.llll.mmmm.nnnn.oooo.pppp is qqqq.rrrr.ssss.tttt.uuuu.vvvv.xxxx.yyyy.zzzz
 -a = aaaa.bbbb.cccc.dddd.eeee.ffff.gggg.hhhh.iiii.jjjj.kkkk.llll.mmmm.nnnn.oooo.pppp is not qqqq.rrrr.ssss.tttt.uuuu.vvvv.xxxx.yyyy.zzzz
 -if (
 -    threading.current_thread() != threading.main_thread() and
```

### Comparing `cercis-0.1.2/tests/data/miscellaneous/force_py36.py` & `cercis-0.1.3/tests/data/miscellaneous/force_py36.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/miscellaneous/force_pyi.py` & `cercis-0.1.3/tests/data/miscellaneous/force_pyi.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/miscellaneous/long_strings_flag_disabled.py` & `cercis-0.1.3/tests/data/configurable_cases/line_with_long_string/long_strings_flag_disabled__Black_default.py`

 * *Files 2% similar despite different names*

```diff
@@ -271,22 +271,7 @@
 
 
 def foo():
     yield "This is a really long string that can't possibly be expected to fit all together on one line. In fact it may even take up three or more lines... like four or five... but probably just three."
 
 
 x = f"This is a {{really}} long string that needs to be split without a doubt (i.e. most definitely). In short, this {string} that can't possibly be {{expected}} to fit all together on one line. In {fact} it may even take up three or more lines... like four or five... but probably just four."
-
-long_unmergable_string_with_pragma = (
-    "This is a really long string that can't be merged because it has a likely pragma at the end"  # type: ignore
-    " of it."
-)
-
-long_unmergable_string_with_pragma = (
-    "This is a really long string that can't be merged because it has a likely pragma at the end"  # noqa
-    " of it."
-)
-
-long_unmergable_string_with_pragma = (
-    "This is a really long string that can't be merged because it has a likely pragma at the end"  # pylint: disable=some-pylint-check
-    " of it."
-)
```

### Comparing `cercis-0.1.2/tests/data/miscellaneous/python2_detection.py` & `cercis-0.1.3/tests/data/miscellaneous/python2_detection.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/miscellaneous/string_quotes.py` & `cercis-0.1.3/tests/data/miscellaneous/string_quotes.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/miscellaneous/stub.pyi` & `cercis-0.1.3/tests/data/miscellaneous/stub.pyi`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/preview/cantfit.py` & `cercis-0.1.3/tests/data/preview/cantfit.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/preview/comments7.py` & `cercis-0.1.3/tests/data/preview/comments7.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/preview/format_unicode_escape_seq.py` & `cercis-0.1.3/tests/data/preview/format_unicode_escape_seq.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/preview/long_dict_values.py` & `cercis-0.1.3/tests/data/preview/long_dict_values.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/preview/long_strings.py` & `cercis-0.1.3/tests/data/preview/long_strings.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/preview/long_strings__east_asian_width.py` & `cercis-0.1.3/tests/data/preview/long_strings__east_asian_width.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/preview/long_strings__edge_case.py` & `cercis-0.1.3/tests/data/preview/long_strings__edge_case.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/preview/long_strings__regression.py` & `cercis-0.1.3/tests/data/preview/long_strings__regression.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/preview/long_strings__type_annotations.py` & `cercis-0.1.3/tests/data/preview/long_strings__type_annotations.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/preview/multiline_strings.py` & `cercis-0.1.3/tests/data/preview/multiline_strings.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/preview/prefer_rhs_split.py` & `cercis-0.1.3/tests/data/preview/prefer_rhs_split.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/preview/trailing_comma.py` & `cercis-0.1.3/tests/data/preview/trailing_comma.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/preview_context_managers/targeting_py38.py` & `cercis-0.1.3/tests/data/preview_context_managers/targeting_py38.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/preview_context_managers/targeting_py39.py` & `cercis-0.1.3/tests/data/preview_context_managers/targeting_py39.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/preview_context_managers/auto_detect/features_3_10.py` & `cercis-0.1.3/tests/data/preview_context_managers/auto_detect/features_3_10.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/preview_context_managers/auto_detect/features_3_11.py` & `cercis-0.1.3/tests/data/preview_context_managers/auto_detect/features_3_11.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/preview_context_managers/auto_detect/features_3_8.py` & `cercis-0.1.3/tests/data/preview_context_managers/auto_detect/features_3_8.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/preview_context_managers/auto_detect/features_3_9.py` & `cercis-0.1.3/tests/data/preview_context_managers/auto_detect/features_3_9.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/py_310/parenthesized_context_managers.py` & `cercis-0.1.3/tests/data/py_310/parenthesized_context_managers.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/py_310/pattern_matching_complex.py` & `cercis-0.1.3/tests/data/py_310/pattern_matching_complex.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/py_310/pattern_matching_extras.py` & `cercis-0.1.3/tests/data/py_310/pattern_matching_extras.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/py_310/pattern_matching_generic.py` & `cercis-0.1.3/tests/data/py_310/pattern_matching_generic.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/py_310/pattern_matching_simple.py` & `cercis-0.1.3/tests/data/py_310/pattern_matching_simple.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/py_310/pattern_matching_style.py` & `cercis-0.1.3/tests/data/py_310/pattern_matching_style.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/py_311/pep_646.py` & `cercis-0.1.3/tests/data/py_311/pep_646.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/py_311/pep_654.py` & `cercis-0.1.3/tests/data/py_311/pep_654.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/py_311/pep_654_style.py` & `cercis-0.1.3/tests/data/py_311/pep_654_style.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/py_36/numeric_literals.py` & `cercis-0.1.3/tests/data/py_36/numeric_literals.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/py_37/python37.py` & `cercis-0.1.3/tests/data/py_37/python37.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/py_38/pep_570.py` & `cercis-0.1.3/tests/data/py_38/pep_570.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/py_38/pep_572.py` & `cercis-0.1.3/tests/data/py_38/pep_572.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/py_38/pep_572_remove_parens.py` & `cercis-0.1.3/tests/data/py_38/pep_572_remove_parens.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/py_38/python38.py` & `cercis-0.1.3/tests/data/py_38/python38.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/py_39/python39.py` & `cercis-0.1.3/tests/data/py_39/python39.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/py_39/remove_with_brackets.py` & `cercis-0.1.3/tests/data/py_39/remove_with_brackets.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/simple_cases/attribute_access_on_number_literals.py` & `cercis-0.1.3/tests/data/simple_cases/attribute_access_on_number_literals.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/simple_cases/class_blank_parentheses.py` & `cercis-0.1.3/tests/data/simple_cases/class_blank_parentheses.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/simple_cases/class_methods_new_line.py` & `cercis-0.1.3/tests/data/simple_cases/class_methods_new_line.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/simple_cases/collections.py` & `cercis-0.1.3/tests/data/simple_cases/collections.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/simple_cases/comments.py` & `cercis-0.1.3/tests/data/simple_cases/comments.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/simple_cases/comments2.py` & `cercis-0.1.3/tests/data/simple_cases/comments2.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/simple_cases/comments3.py` & `cercis-0.1.3/tests/data/simple_cases/comments3.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/simple_cases/comments4.py` & `cercis-0.1.3/tests/data/simple_cases/comments4.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/simple_cases/comments5.py` & `cercis-0.1.3/tests/data/simple_cases/comments5.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/simple_cases/comments6.py` & `cercis-0.1.3/tests/data/simple_cases/comments6.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/simple_cases/comments9.py` & `cercis-0.1.3/tests/data/simple_cases/comments9.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/simple_cases/comments_non_breaking_space.py` & `cercis-0.1.3/tests/data/simple_cases/comments_non_breaking_space.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/simple_cases/composition.py` & `cercis-0.1.3/tests/data/simple_cases/composition.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/simple_cases/composition_no_trailing_comma.py` & `cercis-0.1.3/tests/data/simple_cases/composition_no_trailing_comma.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/simple_cases/docstring.py` & `cercis-0.1.3/tests/data/simple_cases/docstring.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/simple_cases/docstring_preview.py` & `cercis-0.1.3/tests/data/simple_cases/docstring_preview.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/simple_cases/empty_lines.py` & `cercis-0.1.3/tests/data/simple_cases/empty_lines.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/simple_cases/expression.diff` & `cercis-0.1.3/tests/data/miscellaneous/expression_skip_magic_trailing_comma.diff`

 * *Files 7% similar despite different names*

```diff
@@ -1,21 +1,21 @@
 --- [Deterministic header]
 +++ [Deterministic header]
 @@ -1,8 +1,8 @@
  ...
--'some_string'
--b'\\xa3'
-+"some_string"
-+b"\\xa3"
+-"some_string"
+-b"\\xa3"
++'some_string'
++b'\\xa3'
  Name
  None
  True
  False
  1
-@@ -21,99 +21,135 @@
+@@ -21,99 +21,118 @@
  Name1 or (Name2 and Name3) or Name4
  Name1 or Name2 and Name3 or Name4
  v1 << 2
  1 >> v2
  1 % finished
 -1 + v2 - v3 * 4 ^ 5 ** v6 / 7 // 8
 -((1 + v2) - (v3 * 4)) ^ (((5 ** v6) / 7) // 8)
@@ -30,117 +30,105 @@
 -+really ** -confusing ** ~operator ** -precedence
 -flags & ~ select.EPOLLIN and waiters.write_task is not None
 ++(really ** -(confusing ** ~(operator**-precedence)))
 +flags & ~select.EPOLLIN and waiters.write_task is not None
  lambda arg: None
  lambda a=True: a
  lambda a, b, c=True: a
--lambda a, b, c=True, *, d=(1 << v2), e='str': a
--lambda a, b, c=True, *vararg, d=(v1 << 2), e='str', **kwargs: a + b
-+lambda a, b, c=True, *, d=(1 << v2), e="str": a
-+lambda a, b, c=True, *vararg, d=(v1 << 2), e="str", **kwargs: a + b
+-lambda a, b, c=True, *, d=(1 << v2), e="str": a
+-lambda a, b, c=True, *vararg, d=(v1 << 2), e="str", **kwargs: a + b
++lambda a, b, c=True, *, d=(1 << v2), e='str': a
++lambda a, b, c=True, *vararg, d=(v1 << 2), e='str', **kwargs: a + b
  manylambdas = lambda x=lambda y=lambda z=1: z: y(): x()
 -foo = (lambda port_id, ignore_missing: {"port1": port1_resource, "port2": port2_resource}[port_id])
 +foo = lambda port_id, ignore_missing: {
-+    "port1": port1_resource,
-+    "port2": port2_resource,
++    'port1': port1_resource,
++    'port2': port2_resource,
 +}[port_id]
  1 if True else 2
  str or None if True else str or bytes or None
  (str or None) if True else (str or bytes or None)
  str or None if (1 if True else 2) else str or bytes or None
  (str or None) if (1 if True else 2) else (str or bytes or None)
 -((super_long_variable_name or None) if (1 if super_long_test_name else 2) else (str or bytes or None))
--{'2.7': dead, '3.7': (long_live or die_hard)}
--{'2.7': dead, '3.7': (long_live or die_hard), **{'3.6': verygood}}
+-{"2.7": dead, "3.7": (long_live or die_hard)}
+-{"2.7": dead, "3.7": (long_live or die_hard), **{"3.6": verygood}}
 +(
 +    (super_long_variable_name or None)
 +    if (1 if super_long_test_name else 2)
 +    else (str or bytes or None)
 +)
-+{"2.7": dead, "3.7": (long_live or die_hard)}
-+{"2.7": dead, "3.7": (long_live or die_hard), **{"3.6": verygood}}
++{'2.7': dead, '3.7': (long_live or die_hard)}
++{'2.7': dead, '3.7': (long_live or die_hard), **{'3.6': verygood}}
  {**a, **b, **c}
--{'2.7', '3.6', '3.7', '3.8', '3.9', ('4.0' if gilectomy else '3.10')}
--({'a': 'b'}, (True or False), (+value), 'string', b'bytes') or None
-+{"2.7", "3.6", "3.7", "3.8", "3.9", ("4.0" if gilectomy else "3.10")}
-+({"a": "b"}, (True or False), (+value), "string", b"bytes") or None
+-{"2.7", "3.6", "3.7", "3.8", "3.9", ("4.0" if gilectomy else "3.10")}
+-({"a": "b"}, (True or False), (+value), "string", b"bytes") or None
++{'2.7', '3.6', '3.7', '3.8', '3.9', ('4.0' if gilectomy else '3.10')}
++({'a': 'b'}, (True or False), (+value), 'string', b'bytes') or None
  ()
  (1,)
  (1, 2)
  (1, 2, 3)
  []
  [1, 2, 3, 4, 5, 6, 7, 8, 9, (10 or A), (11 or B), (12 or C)]
 -[1, 2, 3,]
-+[
-+    1,
-+    2,
-+    3,
-+]
++[1, 2, 3]
  [*a]
  [*range(10)]
 -[*a, 4, 5,]
 -[4, *a, 5,]
 -[this_is_a_very_long_variable_which_will_force_a_delimiter_split, element, another, *more]
-+[
-+    *a,
-+    4,
-+    5,
-+]
-+[
-+    4,
-+    *a,
-+    5,
-+]
++[*a, 4, 5]
++[4, *a, 5]
 +[
 +    this_is_a_very_long_variable_which_will_force_a_delimiter_split,
 +    element,
 +    another,
 +    *more,
 +]
  {i for i in (1, 2, 3)}
 -{(i ** 2) for i in (1, 2, 3)}
--{(i ** 2) for i, _ in ((1, 'a'), (2, 'b'), (3, 'c'))}
+-{(i ** 2) for i, _ in ((1, "a"), (2, "b"), (3, "c"))}
 -{((i ** 2) + j) for i in (1, 2, 3) for j in (1, 2, 3)}
 +{(i**2) for i in (1, 2, 3)}
-+{(i**2) for i, _ in ((1, "a"), (2, "b"), (3, "c"))}
++{(i**2) for i, _ in ((1, 'a'), (2, 'b'), (3, 'c'))}
 +{((i**2) + j) for i in (1, 2, 3) for j in (1, 2, 3)}
  [i for i in (1, 2, 3)]
 -[(i ** 2) for i in (1, 2, 3)]
--[(i ** 2) for i, _ in ((1, 'a'), (2, 'b'), (3, 'c'))]
+-[(i ** 2) for i, _ in ((1, "a"), (2, "b"), (3, "c"))]
 -[((i ** 2) + j) for i in (1, 2, 3) for j in (1, 2, 3)]
 +[(i**2) for i in (1, 2, 3)]
-+[(i**2) for i, _ in ((1, "a"), (2, "b"), (3, "c"))]
++[(i**2) for i, _ in ((1, 'a'), (2, 'b'), (3, 'c'))]
 +[((i**2) + j) for i in (1, 2, 3) for j in (1, 2, 3)]
  {i: 0 for i in (1, 2, 3)}
--{i: j for i, j in ((1, 'a'), (2, 'b'), (3, 'c'))}
-+{i: j for i, j in ((1, "a"), (2, "b"), (3, "c"))}
+-{i: j for i, j in ((1, "a"), (2, "b"), (3, "c"))}
++{i: j for i, j in ((1, 'a'), (2, 'b'), (3, 'c'))}
  {a: b * 2 for a, b in dictionary.items()}
  {a: b * -2 for a, b in dictionary.items()}
 -{k: v for k, v in this_is_a_very_long_variable_which_will_cause_a_trailing_comma_which_breaks_the_comprehension}
 +{
 +    k: v
 +    for k, v in this_is_a_very_long_variable_which_will_cause_a_trailing_comma_which_breaks_the_comprehension
 +}
  Python3 > Python2 > COBOL
  Life is Life
  call()
  call(arg)
--call(kwarg='hey')
--call(arg, kwarg='hey')
--call(arg, another, kwarg='hey', **kwargs)
--call(this_is_a_very_long_variable_which_will_force_a_delimiter_split, arg, another, kwarg='hey', **kwargs)  # note: no trailing comma pre-3.6
-+call(kwarg="hey")
-+call(arg, kwarg="hey")
-+call(arg, another, kwarg="hey", **kwargs)
+-call(kwarg="hey")
+-call(arg, kwarg="hey")
+-call(arg, another, kwarg="hey", **kwargs)
+-call(this_is_a_very_long_variable_which_will_force_a_delimiter_split, arg, another, kwarg="hey", **kwargs)  # note: no trailing comma pre-3.6
++call(kwarg='hey')
++call(arg, kwarg='hey')
++call(arg, another, kwarg='hey', **kwargs)
 +call(
 +    this_is_a_very_long_variable_which_will_force_a_delimiter_split,
 +    arg,
 +    another,
-+    kwarg="hey",
++    kwarg='hey',
 +    **kwargs
 +)  # note: no trailing comma pre-3.6
  call(*gidgets[:2])
  call(a, *gidgets[:2])
  call(**self.screen_kwargs)
  call(b, **self.screen_kwargs)
  lukasz.langa.pl
@@ -149,24 +137,20 @@
 -1.0 .real
 +(1).real
 +(1.0).real
  ....__class__
  list[str]
  dict[str, int]
  tuple[str, ...]
-+tuple[str, int, float, dict[str, int]]
- tuple[
+-tuple[
 -    str, int, float, dict[str, int]
 -]
 -tuple[str, int, float, dict[str, int],]
-+    str,
-+    int,
-+    float,
-+    dict[str, int],
-+]
++tuple[str, int, float, dict[str, int]]
++tuple[str, int, float, dict[str, int]]
  very_long_variable_name_filters: t.List[
      t.Tuple[str, t.Union[str, t.List[t.Optional[str]]]],
  ]
  xxxx_xxxxx_xxxx_xxx: Callable[..., List[SomeClass]] = classmethod(  # type: ignore
      sync(async_xxxx_xxx_xxxx_xxxxx_xxxx_xxx.__func__)
  )
  xxxx_xxx_xxxx_xxxxx_xxxx_xxx: Callable[..., List[SomeClass]] = classmethod(  # type: ignore
@@ -179,54 +163,54 @@
 +    sync(async_xxxx_xxx_xxxx_xxxxx_xxxx_xxx.__func__)
 +)  # type: ignore
  slice[0]
  slice[0:1]
  slice[0:1:2]
  slice[:]
  slice[:-1]
-@@ -137,118 +173,199 @@
+@@ -137,118 +156,197 @@
  numpy[-(c + 1) :, d]
  numpy[:, l[-2]]
  numpy[:, ::-1]
  numpy[np.newaxis, :]
  (str or None) if (sys.version_info[0] > (3,)) else (str or bytes or None)
--{'2.7': dead, '3.7': long_live or die_hard}
--{'2.7', '3.6', '3.7', '3.8', '3.9', '4.0' if gilectomy else '3.10'}
-+{"2.7": dead, "3.7": long_live or die_hard}
-+{"2.7", "3.6", "3.7", "3.8", "3.9", "4.0" if gilectomy else "3.10"}
+-{"2.7": dead, "3.7": long_live or die_hard}
+-{"2.7", "3.6", "3.7", "3.8", "3.9", "4.0" if gilectomy else "3.10"}
++{'2.7': dead, '3.7': long_live or die_hard}
++{'2.7', '3.6', '3.7', '3.8', '3.9', '4.0' if gilectomy else '3.10'}
  [1, 2, 3, 4, 5, 6, 7, 8, 9, 10 or A, 11 or B, 12 or C]
  (SomeName)
  SomeName
  (Good, Bad, Ugly)
  (i for i in (1, 2, 3))
 -((i ** 2) for i in (1, 2, 3))
--((i ** 2) for i, _ in ((1, 'a'), (2, 'b'), (3, 'c')))
+-((i ** 2) for i, _ in ((1, "a"), (2, "b"), (3, "c")))
 -(((i ** 2) + j) for i in (1, 2, 3) for j in (1, 2, 3))
 +((i**2) for i in (1, 2, 3))
-+((i**2) for i, _ in ((1, "a"), (2, "b"), (3, "c")))
++((i**2) for i, _ in ((1, 'a'), (2, 'b'), (3, 'c')))
 +(((i**2) + j) for i in (1, 2, 3) for j in (1, 2, 3))
  (*starred,)
 -{"id": "1","type": "type","started_at": now(),"ended_at": now() + timedelta(days=10),"priority": 1,"import_session_id": 1,**kwargs}
 +{
-+    "id": "1",
-+    "type": "type",
-+    "started_at": now(),
-+    "ended_at": now() + timedelta(days=10),
-+    "priority": 1,
-+    "import_session_id": 1,
++    'id': '1',
++    'type': 'type',
++    'started_at': now(),
++    'ended_at': now() + timedelta(days=10),
++    'priority': 1,
++    'import_session_id': 1,
 +    **kwargs,
 +}
  a = (1,)
 -b = 1,
 +b = (1,)
  c = 1
  d = (1,) + a + (2,)
  e = (1,).count(1)
  f = 1, *range(10)
- g = 1, *"ten"
+ g = 1, *'ten'
 -what_is_up_with_those_new_coord_names = (coord_names + set(vars_to_create)) + set(vars_to_remove)
 -what_is_up_with_those_new_coord_names = (coord_names | set(vars_to_create)) - set(vars_to_remove)
 -result = session.query(models.Customer.id).filter(models.Customer.account_id == account_id, models.Customer.email == email_address).order_by(models.Customer.id.asc()).all()
 -result = session.query(models.Customer.id).filter(models.Customer.account_id == account_id, models.Customer.email == email_address).order_by(models.Customer.id.asc(),).all()
 +what_is_up_with_those_new_coord_names = (coord_names + set(vars_to_create)) + set(
 +    vars_to_remove
 +)
@@ -242,17 +226,15 @@
 +    .all()
 +)
 +result = (
 +    session.query(models.Customer.id)
 +    .filter(
 +        models.Customer.account_id == account_id, models.Customer.email == email_address
 +    )
-+    .order_by(
-+        models.Customer.id.asc(),
-+    )
++    .order_by(models.Customer.id.asc())
 +    .all()
 +)
  Ø = set()
  authors.łukasz.say_thanks()
  mapping = {
      A: 0.25 * (10.0 / 12),
      B: 0.1 * (10.0 / 12),
@@ -275,29 +257,29 @@
      await some.complicated[0].call(with_args=(True or (1 is not 1)))
 -print(* [] or [1])
 +
 +
 +print(*[] or [1])
  print(**{1: 3} if False else {x: x for x in range(3)})
 -print(* lambda x: x)
--assert(not Test),("Short message")
--assert this is ComplexTest and not requirements.fit_in_a_single_line(force=False), "Short message"
+-assert(not Test),('Short message')
+-assert this is ComplexTest and not requirements.fit_in_a_single_line(force=False), 'Short message'
 -assert(((parens is TooMany)))
 -for x, in (1,), (2,), (3,): ...
 -for y in (): ...
 -for z in (i for i in (1, 2, 3)): ...
 -for i in (call()): ...
 -for j in (1 + (2 + 3)): ...
 -while(this and that): ...
 -for addr_family, addr_type, addr_proto, addr_canonname, addr_sockaddr in socket.getaddrinfo('google.com', 'http'):
 +print(*lambda x: x)
-+assert not Test, "Short message"
++assert not Test, 'Short message'
 +assert this is ComplexTest and not requirements.fit_in_a_single_line(
 +    force=False
-+), "Short message"
++), 'Short message'
 +assert parens is TooMany
 +for (x,) in (1,), (2,), (3,):
 +    ...
 +for y in ():
 +    ...
 +for z in (i for i in (1, 2, 3)):
 +    ...
@@ -309,15 +291,15 @@
 +    ...
 +for (
 +    addr_family,
 +    addr_type,
 +    addr_proto,
 +    addr_canonname,
 +    addr_sockaddr,
-+) in socket.getaddrinfo("google.com", "http"):
++) in socket.getaddrinfo('google.com', 'http'):
      pass
 -a = aaaa.bbbb.cccc.dddd.eeee.ffff.gggg.hhhh.iiii.jjjj.kkkk.llll.mmmm.nnnn.oooo.pppp in qqqq.rrrr.ssss.tttt.uuuu.vvvv.xxxx.yyyy.zzzz
 -a = aaaa.bbbb.cccc.dddd.eeee.ffff.gggg.hhhh.iiii.jjjj.kkkk.llll.mmmm.nnnn.oooo.pppp not in qqqq.rrrr.ssss.tttt.uuuu.vvvv.xxxx.yyyy.zzzz
 -a = aaaa.bbbb.cccc.dddd.eeee.ffff.gggg.hhhh.iiii.jjjj.kkkk.llll.mmmm.nnnn.oooo.pppp is qqqq.rrrr.ssss.tttt.uuuu.vvvv.xxxx.yyyy.zzzz
 -a = aaaa.bbbb.cccc.dddd.eeee.ffff.gggg.hhhh.iiii.jjjj.kkkk.llll.mmmm.nnnn.oooo.pppp is not qqqq.rrrr.ssss.tttt.uuuu.vvvv.xxxx.yyyy.zzzz
 -if (
 -    threading.current_thread() != threading.main_thread() and
```

### Comparing `cercis-0.1.2/tests/data/simple_cases/expression.py` & `cercis-0.1.3/tests/data/simple_cases/expression.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 ...
-'some_string'
-b'\\xa3'
+"some_string"
+b"\\xa3"
 Name
 None
 True
 False
 1
 1.0
 1j
@@ -32,62 +32,62 @@
 ~int and not v1 ^ 123 + v2 | True
 (~int) and (not ((v1 ^ (123 + v2)) | True))
 +really ** -confusing ** ~operator ** -precedence
 flags & ~ select.EPOLLIN and waiters.write_task is not None
 lambda arg: None
 lambda a=True: a
 lambda a, b, c=True: a
-lambda a, b, c=True, *, d=(1 << v2), e='str': a
-lambda a, b, c=True, *vararg, d=(v1 << 2), e='str', **kwargs: a + b
+lambda a, b, c=True, *, d=(1 << v2), e="str": a
+lambda a, b, c=True, *vararg, d=(v1 << 2), e="str", **kwargs: a + b
 manylambdas = lambda x=lambda y=lambda z=1: z: y(): x()
 foo = (lambda port_id, ignore_missing: {"port1": port1_resource, "port2": port2_resource}[port_id])
 1 if True else 2
 str or None if True else str or bytes or None
 (str or None) if True else (str or bytes or None)
 str or None if (1 if True else 2) else str or bytes or None
 (str or None) if (1 if True else 2) else (str or bytes or None)
 ((super_long_variable_name or None) if (1 if super_long_test_name else 2) else (str or bytes or None))
-{'2.7': dead, '3.7': (long_live or die_hard)}
-{'2.7': dead, '3.7': (long_live or die_hard), **{'3.6': verygood}}
+{"2.7": dead, "3.7": (long_live or die_hard)}
+{"2.7": dead, "3.7": (long_live or die_hard), **{"3.6": verygood}}
 {**a, **b, **c}
-{'2.7', '3.6', '3.7', '3.8', '3.9', ('4.0' if gilectomy else '3.10')}
-({'a': 'b'}, (True or False), (+value), 'string', b'bytes') or None
+{"2.7", "3.6", "3.7", "3.8", "3.9", ("4.0" if gilectomy else "3.10")}
+({"a": "b"}, (True or False), (+value), "string", b"bytes") or None
 ()
 (1,)
 (1, 2)
 (1, 2, 3)
 []
 [1, 2, 3, 4, 5, 6, 7, 8, 9, (10 or A), (11 or B), (12 or C)]
 [1, 2, 3,]
 [*a]
 [*range(10)]
 [*a, 4, 5,]
 [4, *a, 5,]
 [this_is_a_very_long_variable_which_will_force_a_delimiter_split, element, another, *more]
 {i for i in (1, 2, 3)}
 {(i ** 2) for i in (1, 2, 3)}
-{(i ** 2) for i, _ in ((1, 'a'), (2, 'b'), (3, 'c'))}
+{(i ** 2) for i, _ in ((1, "a"), (2, "b"), (3, "c"))}
 {((i ** 2) + j) for i in (1, 2, 3) for j in (1, 2, 3)}
 [i for i in (1, 2, 3)]
 [(i ** 2) for i in (1, 2, 3)]
-[(i ** 2) for i, _ in ((1, 'a'), (2, 'b'), (3, 'c'))]
+[(i ** 2) for i, _ in ((1, "a"), (2, "b"), (3, "c"))]
 [((i ** 2) + j) for i in (1, 2, 3) for j in (1, 2, 3)]
 {i: 0 for i in (1, 2, 3)}
-{i: j for i, j in ((1, 'a'), (2, 'b'), (3, 'c'))}
+{i: j for i, j in ((1, "a"), (2, "b"), (3, "c"))}
 {a: b * 2 for a, b in dictionary.items()}
 {a: b * -2 for a, b in dictionary.items()}
 {k: v for k, v in this_is_a_very_long_variable_which_will_cause_a_trailing_comma_which_breaks_the_comprehension}
 Python3 > Python2 > COBOL
 Life is Life
 call()
 call(arg)
-call(kwarg='hey')
-call(arg, kwarg='hey')
-call(arg, another, kwarg='hey', **kwargs)
-call(this_is_a_very_long_variable_which_will_force_a_delimiter_split, arg, another, kwarg='hey', **kwargs)  # note: no trailing comma pre-3.6
+call(kwarg="hey")
+call(arg, kwarg="hey")
+call(arg, another, kwarg="hey", **kwargs)
+call(this_is_a_very_long_variable_which_will_force_a_delimiter_split, arg, another, kwarg="hey", **kwargs)  # note: no trailing comma pre-3.6
 call(*gidgets[:2])
 call(a, *gidgets[:2])
 call(**self.screen_kwargs)
 call(b, **self.screen_kwargs)
 lukasz.langa.pl
 call.me(maybe)
 1 .real
@@ -135,33 +135,33 @@
 numpy[:, [i]]
 numpy[1 : c + 1, c]
 numpy[-(c + 1) :, d]
 numpy[:, l[-2]]
 numpy[:, ::-1]
 numpy[np.newaxis, :]
 (str or None) if (sys.version_info[0] > (3,)) else (str or bytes or None)
-{'2.7': dead, '3.7': long_live or die_hard}
-{'2.7', '3.6', '3.7', '3.8', '3.9', '4.0' if gilectomy else '3.10'}
+{"2.7": dead, "3.7": long_live or die_hard}
+{"2.7", "3.6", "3.7", "3.8", "3.9", "4.0" if gilectomy else "3.10"}
 [1, 2, 3, 4, 5, 6, 7, 8, 9, 10 or A, 11 or B, 12 or C]
 (SomeName)
 SomeName
 (Good, Bad, Ugly)
 (i for i in (1, 2, 3))
 ((i ** 2) for i in (1, 2, 3))
-((i ** 2) for i, _ in ((1, 'a'), (2, 'b'), (3, 'c')))
+((i ** 2) for i, _ in ((1, "a"), (2, "b"), (3, "c")))
 (((i ** 2) + j) for i in (1, 2, 3) for j in (1, 2, 3))
 (*starred,)
 {"id": "1","type": "type","started_at": now(),"ended_at": now() + timedelta(days=10),"priority": 1,"import_session_id": 1,**kwargs}
 a = (1,)
 b = 1,
 c = 1
 d = (1,) + a + (2,)
 e = (1,).count(1)
 f = 1, *range(10)
-g = 1, *"ten"
+g = 1, *'ten'
 what_is_up_with_those_new_coord_names = (coord_names + set(vars_to_create)) + set(vars_to_remove)
 what_is_up_with_those_new_coord_names = (coord_names | set(vars_to_create)) - set(vars_to_remove)
 result = session.query(models.Customer.id).filter(models.Customer.account_id == account_id, models.Customer.email == email_address).order_by(models.Customer.id.asc()).all()
 result = session.query(models.Customer.id).filter(models.Customer.account_id == account_id, models.Customer.email == email_address).order_by(models.Customer.id.asc(),).all()
 Ø = set()
 authors.łukasz.say_thanks()
 mapping = {
@@ -178,16 +178,16 @@
     c = (((yield)))
 
 async def f():
     await some.complicated[0].call(with_args=(True or (1 is not 1)))
 print(* [] or [1])
 print(**{1: 3} if False else {x: x for x in range(3)})
 print(* lambda x: x)
-assert(not Test),("Short message")
-assert this is ComplexTest and not requirements.fit_in_a_single_line(force=False), "Short message"
+assert(not Test),('Short message')
+assert this is ComplexTest and not requirements.fit_in_a_single_line(force=False), 'Short message'
 assert(((parens is TooMany)))
 for x, in (1,), (2,), (3,): ...
 for y in (): ...
 for z in (i for i in (1, 2, 3)): ...
 for i in (call()): ...
 for j in (1 + (2 + 3)): ...
 while(this and that): ...
@@ -254,16 +254,16 @@
 # standalone comment at ENDMARKER
 
 
 # output
 
 
 ...
-"some_string"
-b"\\xa3"
+'some_string'
+b'\\xa3'
 Name
 None
 True
 False
 1
 1.0
 1j
@@ -291,36 +291,36 @@
 ~int and not v1 ^ 123 + v2 | True
 (~int) and (not ((v1 ^ (123 + v2)) | True))
 +(really ** -(confusing ** ~(operator**-precedence)))
 flags & ~select.EPOLLIN and waiters.write_task is not None
 lambda arg: None
 lambda a=True: a
 lambda a, b, c=True: a
-lambda a, b, c=True, *, d=(1 << v2), e="str": a
-lambda a, b, c=True, *vararg, d=(v1 << 2), e="str", **kwargs: a + b
+lambda a, b, c=True, *, d=(1 << v2), e='str': a
+lambda a, b, c=True, *vararg, d=(v1 << 2), e='str', **kwargs: a + b
 manylambdas = lambda x=lambda y=lambda z=1: z: y(): x()
 foo = lambda port_id, ignore_missing: {
-    "port1": port1_resource,
-    "port2": port2_resource,
+    'port1': port1_resource,
+    'port2': port2_resource,
 }[port_id]
 1 if True else 2
 str or None if True else str or bytes or None
 (str or None) if True else (str or bytes or None)
 str or None if (1 if True else 2) else str or bytes or None
 (str or None) if (1 if True else 2) else (str or bytes or None)
 (
     (super_long_variable_name or None)
     if (1 if super_long_test_name else 2)
     else (str or bytes or None)
 )
-{"2.7": dead, "3.7": (long_live or die_hard)}
-{"2.7": dead, "3.7": (long_live or die_hard), **{"3.6": verygood}}
+{'2.7': dead, '3.7': (long_live or die_hard)}
+{'2.7': dead, '3.7': (long_live or die_hard), **{'3.6': verygood}}
 {**a, **b, **c}
-{"2.7", "3.6", "3.7", "3.8", "3.9", ("4.0" if gilectomy else "3.10")}
-({"a": "b"}, (True or False), (+value), "string", b"bytes") or None
+{'2.7', '3.6', '3.7', '3.8', '3.9', ('4.0' if gilectomy else '3.10')}
+({'a': 'b'}, (True or False), (+value), 'string', b'bytes') or None
 ()
 (1,)
 (1, 2)
 (1, 2, 3)
 []
 [1, 2, 3, 4, 5, 6, 7, 8, 9, (10 or A), (11 or B), (12 or C)]
 [
@@ -344,40 +344,40 @@
     this_is_a_very_long_variable_which_will_force_a_delimiter_split,
     element,
     another,
     *more,
 ]
 {i for i in (1, 2, 3)}
 {(i**2) for i in (1, 2, 3)}
-{(i**2) for i, _ in ((1, "a"), (2, "b"), (3, "c"))}
+{(i**2) for i, _ in ((1, 'a'), (2, 'b'), (3, 'c'))}
 {((i**2) + j) for i in (1, 2, 3) for j in (1, 2, 3)}
 [i for i in (1, 2, 3)]
 [(i**2) for i in (1, 2, 3)]
-[(i**2) for i, _ in ((1, "a"), (2, "b"), (3, "c"))]
+[(i**2) for i, _ in ((1, 'a'), (2, 'b'), (3, 'c'))]
 [((i**2) + j) for i in (1, 2, 3) for j in (1, 2, 3)]
 {i: 0 for i in (1, 2, 3)}
-{i: j for i, j in ((1, "a"), (2, "b"), (3, "c"))}
+{i: j for i, j in ((1, 'a'), (2, 'b'), (3, 'c'))}
 {a: b * 2 for a, b in dictionary.items()}
 {a: b * -2 for a, b in dictionary.items()}
 {
     k: v
     for k, v in this_is_a_very_long_variable_which_will_cause_a_trailing_comma_which_breaks_the_comprehension
 }
 Python3 > Python2 > COBOL
 Life is Life
 call()
 call(arg)
-call(kwarg="hey")
-call(arg, kwarg="hey")
-call(arg, another, kwarg="hey", **kwargs)
+call(kwarg='hey')
+call(arg, kwarg='hey')
+call(arg, another, kwarg='hey', **kwargs)
 call(
     this_is_a_very_long_variable_which_will_force_a_delimiter_split,
     arg,
     another,
-    kwarg="hey",
+    kwarg='hey',
     **kwargs
 )  # note: no trailing comma pre-3.6
 call(*gidgets[:2])
 call(a, *gidgets[:2])
 call(**self.screen_kwargs)
 call(b, **self.screen_kwargs)
 lukasz.langa.pl
@@ -430,41 +430,41 @@
 numpy[:, [i]]
 numpy[1 : c + 1, c]
 numpy[-(c + 1) :, d]
 numpy[:, l[-2]]
 numpy[:, ::-1]
 numpy[np.newaxis, :]
 (str or None) if (sys.version_info[0] > (3,)) else (str or bytes or None)
-{"2.7": dead, "3.7": long_live or die_hard}
-{"2.7", "3.6", "3.7", "3.8", "3.9", "4.0" if gilectomy else "3.10"}
+{'2.7': dead, '3.7': long_live or die_hard}
+{'2.7', '3.6', '3.7', '3.8', '3.9', '4.0' if gilectomy else '3.10'}
 [1, 2, 3, 4, 5, 6, 7, 8, 9, 10 or A, 11 or B, 12 or C]
 (SomeName)
 SomeName
 (Good, Bad, Ugly)
 (i for i in (1, 2, 3))
 ((i**2) for i in (1, 2, 3))
-((i**2) for i, _ in ((1, "a"), (2, "b"), (3, "c")))
+((i**2) for i, _ in ((1, 'a'), (2, 'b'), (3, 'c')))
 (((i**2) + j) for i in (1, 2, 3) for j in (1, 2, 3))
 (*starred,)
 {
-    "id": "1",
-    "type": "type",
-    "started_at": now(),
-    "ended_at": now() + timedelta(days=10),
-    "priority": 1,
-    "import_session_id": 1,
+    'id': '1',
+    'type': 'type',
+    'started_at': now(),
+    'ended_at': now() + timedelta(days=10),
+    'priority': 1,
+    'import_session_id': 1,
     **kwargs,
 }
 a = (1,)
 b = (1,)
 c = 1
 d = (1,) + a + (2,)
 e = (1,).count(1)
 f = 1, *range(10)
-g = 1, *"ten"
+g = 1, *'ten'
 what_is_up_with_those_new_coord_names = (coord_names + set(vars_to_create)) + set(
     vars_to_remove
 )
 what_is_up_with_those_new_coord_names = (coord_names | set(vars_to_create)) - set(
     vars_to_remove
 )
 result = (
@@ -505,18 +505,18 @@
 async def f():
     await some.complicated[0].call(with_args=(True or (1 is not 1)))
 
 
 print(*[] or [1])
 print(**{1: 3} if False else {x: x for x in range(3)})
 print(*lambda x: x)
-assert not Test, "Short message"
+assert not Test, 'Short message'
 assert this is ComplexTest and not requirements.fit_in_a_single_line(
     force=False
-), "Short message"
+), 'Short message'
 assert parens is TooMany
 for (x,) in (1,), (2,), (3,):
     ...
 for y in ():
     ...
 for z in (i for i in (1, 2, 3)):
     ...
@@ -528,15 +528,15 @@
     ...
 for (
     addr_family,
     addr_type,
     addr_proto,
     addr_canonname,
     addr_sockaddr,
-) in socket.getaddrinfo("google.com", "http"):
+) in socket.getaddrinfo('google.com', 'http'):
     pass
 a = (
     aaaa.bbbb.cccc.dddd.eeee.ffff.gggg.hhhh.iiii.jjjj.kkkk.llll.mmmm.nnnn.oooo.pppp
     in qqqq.rrrr.ssss.tttt.uuuu.vvvv.xxxx.yyyy.zzzz
 )
 a = (
     aaaa.bbbb.cccc.dddd.eeee.ffff.gggg.hhhh.iiii.jjjj.kkkk.llll.mmmm.nnnn.oooo.pppp
```

### Comparing `cercis-0.1.2/tests/data/simple_cases/fmtonoff.py` & `cercis-0.1.3/tests/data/simple_cases/fmtonoff.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/simple_cases/fmtonoff2.py` & `cercis-0.1.3/tests/data/simple_cases/fmtonoff2.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/simple_cases/fmtonoff5.py` & `cercis-0.1.3/tests/data/simple_cases/fmtonoff5.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/simple_cases/fmtskip2.py` & `cercis-0.1.3/tests/data/simple_cases/fmtskip2.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/simple_cases/fmtskip8.py` & `cercis-0.1.3/tests/data/simple_cases/fmtskip8.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/simple_cases/fstring.py` & `cercis-0.1.3/tests/data/simple_cases/fstring.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/simple_cases/function.py` & `cercis-0.1.3/tests/data/simple_cases/function.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/simple_cases/function2.py` & `cercis-0.1.3/tests/data/simple_cases/function2.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/simple_cases/function_trailing_comma.py` & `cercis-0.1.3/tests/data/simple_cases/function_trailing_comma.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/simple_cases/import_spacing.py` & `cercis-0.1.3/tests/data/simple_cases/import_spacing.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/simple_cases/one_element_subscript.py` & `cercis-0.1.3/tests/data/simple_cases/one_element_subscript.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/simple_cases/power_op_spacing.py` & `cercis-0.1.3/tests/data/simple_cases/power_op_spacing.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/simple_cases/prefer_rhs_split_reformatted.py` & `cercis-0.1.3/tests/data/simple_cases/prefer_rhs_split_reformatted.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/simple_cases/remove_await_parens.py` & `cercis-0.1.3/tests/data/simple_cases/remove_await_parens.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/simple_cases/remove_except_parens.py` & `cercis-0.1.3/tests/data/simple_cases/remove_except_parens.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/simple_cases/remove_for_brackets.py` & `cercis-0.1.3/tests/data/simple_cases/remove_for_brackets.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/simple_cases/remove_newline_after_code_block_open.py` & `cercis-0.1.3/tests/data/simple_cases/remove_newline_after_code_block_open.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/simple_cases/remove_parens.py` & `cercis-0.1.3/tests/data/simple_cases/remove_parens.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/simple_cases/return_annotation_brackets.py` & `cercis-0.1.3/tests/data/simple_cases/return_annotation_brackets.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/simple_cases/skip_magic_trailing_comma.py` & `cercis-0.1.3/tests/data/simple_cases/skip_magic_trailing_comma.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/simple_cases/slices.py` & `cercis-0.1.3/tests/data/simple_cases/slices.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/simple_cases/string_prefixes.py` & `cercis-0.1.3/tests/data/simple_cases/string_prefixes.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/simple_cases/torture.py` & `cercis-0.1.3/tests/data/simple_cases/torture.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/simple_cases/trailing_comma_optional_parens1.py` & `cercis-0.1.3/tests/data/simple_cases/trailing_comma_optional_parens1.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/simple_cases/trailing_comma_optional_parens3.py` & `cercis-0.1.3/tests/data/simple_cases/trailing_comma_optional_parens3.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/tests/data/simple_cases/trailing_commas_in_leading_parts.py` & `cercis-0.1.3/tests/data/simple_cases/trailing_commas_in_leading_parts.py`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/LICENSE` & `cercis-0.1.3/LICENSE`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/LICENSE_ORIGINAL` & `cercis-0.1.3/LICENSE_ORIGINAL`

 * *Files identical despite different names*

### Comparing `cercis-0.1.2/pyproject.toml` & `cercis-0.1.3/pyproject.toml`

 * *Files 3% similar despite different names*

```diff
@@ -4,15 +4,17 @@
 # It's the equivalent of r-strings in Python.  Multiline strings are treated as
 # verbose regular expressions by Black.  Use [ ] to denote a significant space
 # character.
 
 [tool.cercis]
 line-length = 88
 function-definition-extra-indent = true
-single-quote = false
+single-quote = false  # use Black style for easier rebasing in the future
+collapse-nested-brackets = false  # use Black style for easier rebasing
+wrap-pragma-comments = true  # use Black style for easier rebasing
 target-version = ['py37', 'py38']
 include = '\.pyi?$'
 extend-exclude = '''
 /(
   # The following are specific to Black, you probably don't want those.
   | blib2to3
   | tests/data
@@ -29,15 +31,15 @@
 
 [build-system]
 requires = ["hatchling>=1.8.0", "hatch-vcs", "hatch-fancy-pypi-readme"]
 build-backend = "hatchling.build"
 
 [project]
 name = "cercis"
-version = "0.1.2"
+version = "0.1.3"
 description = "A more configurable Python code formatter"
 license = { text = "MIT" }
 requires-python = ">=3.7"
 authors = [
   { name = "Łukasz Langa", email = "lukasz@langa.pl" },
   { name = "jsh9", email = "" },
 ]
@@ -97,15 +99,15 @@
 Changelog = "https://github.com/jsh9/cercis/blob/main/CHANGES.md"
 Homepage = "https://github.com/jsh9/cercis"
 
 [tool.hatch.metadata.hooks.fancy-pypi-readme]
 content-type = "text/markdown"
 fragments = [
   { path = "README.md" },
-  { path = "CHANGES.md" },
+  { path = "CHANGELOG.md" },
 ]
 
 [tool.hatch.version]
 source = "vcs"
 
 [tool.hatch.build.hooks.vcs]
 version-file = "src/_cercis_version.py"
```

### Comparing `cercis-0.1.2/PKG-INFO` & `cercis-0.1.3/PKG-INFO`

 * *Files 26% similar despite different names*

```diff
@@ -1,17 +1,16 @@
 Metadata-Version: 2.1
 Name: cercis
-Version: 0.1.2
+Version: 0.1.3
 Summary: A more configurable Python code formatter
 Project-URL: Changelog, https://github.com/jsh9/cercis/blob/main/CHANGES.md
 Project-URL: Homepage, https://github.com/jsh9/cercis
 Author: jsh9
 Author-email: Łukasz Langa <lukasz@langa.pl>
 License: MIT
-License-File: AUTHORS.md
 License-File: LICENSE
 License-File: LICENSE_ORIGINAL
 Keywords: automation,autopep8,formatter,gofmt,pyfmt,rustfmt,yapf
 Classifier: Development Status :: 5 - Production/Stable
 Classifier: Environment :: Console
 Classifier: Intended Audience :: Developers
 Classifier: License :: OSI Approved :: MIT License
@@ -45,36 +44,38 @@
 Requires-Dist: uvloop>=0.15.2; extra == 'uvloop'
 Description-Content-Type: text/markdown
 
 # Cercis
 
 [![](https://upload.wikimedia.org/wikipedia/commons/thumb/4/4c/Red_bud_2009.jpg/320px-Red_bud_2009.jpg)](https://en.wikipedia.org/wiki/Cercis)
 
-_**Cercis**_ /ˈsɜːrsɪs/ is a Python code formatter that is more configurable than
-[Black](https://github.com/psf/black) (a popular Python code formatter).
+_**Cercis**_ /ˈsɜːrsɪs/ is a Python code formatter that is more configurable
+than [Black](https://github.com/psf/black) (a popular Python code formatter).
 
-[_Cercis_](https://en.wikipedia.org/wiki/Cercis) is also the name of a deciduous tree
-that boasts vibrant pink to purple-hued flowers, which bloom in early spring.
+[_Cercis_](https://en.wikipedia.org/wiki/Cercis) is also the name of a
+deciduous tree that boasts vibrant pink to purple-hued flowers, which bloom in
+early spring.
 
 This code repository is forked from and directly inspired by
-[Black](https://github.com/psf/black). The original license of Black is included in this
-repository (see [LICENSE_ORIGINAL](./LICENSE_ORIGINAL)).
+[Black](https://github.com/psf/black). The original license of Black is
+included in this repository (see [LICENSE_ORIGINAL](./LICENSE_ORIGINAL)).
 
 ## 1. Motivations
 
-While we like the idea of auto-formatting and code readability, we take issue with some
-style choices and the lack of configurability of the Black formatter. Therefore,
-_Cercis_ aims at providing some configurability beyond Black's limited offering.
+While we like the idea of auto-formatting and code readability, we take issue
+with some style choices and the lack of configurability of the Black formatter.
+Therefore, _Cercis_ aims at providing some configurability beyond Black's
+limited offering.
 
 ## 2. Installation and usage
 
 ### 2.1. Installation
 
-_Cercis_ can be installed by running `pip install cercis`. It requires Python 3.7+ to
-run. If you want to format Jupyter Notebooks, install with
+_Cercis_ can be installed by running `pip install cercis`. It requires Python
+3.7+ to run. If you want to format Jupyter Notebooks, install with
 `pip install "cercis[jupyter]"`.
 
 ### 2.2. Usage
 
 #### 2.2.1. Command line usage
 
 To get started right away with sensible defaults:
@@ -89,16 +90,17 @@
 python -m cercis {source_file_or_directory}
 ```
 
 The commands above reformat entire file(s) in place.
 
 #### 2.2.2. As pre-commit hook
 
-To format Python files (.py), put the following into your `.pre-commit-config.yaml`
-file. Remember to replace `<VERSION>` with your version of this tool (such as `v0.1.0`):
+To format Python files (.py), put the following into your
+`.pre-commit-config.yaml` file. Remember to replace `<VERSION>` with your
+version of this tool (such as `v0.1.0`):
 
 ```yaml
 - repo: https://github.com/jsh9/cercis
   rev: <VERSION>
   hooks:
     - id: cercis
       args: [--line-length=88]
@@ -111,36 +113,74 @@
 - repo: https://github.com/jsh9/cercis
   rev: <VERSION>
   hooks:
     - id: cercis-jupyter
       args: [--line-length=88]
 ```
 
-See [pre-commit](https://github.com/pre-commit/pre-commit) for more instructions. In
-particular, [here](https://pre-commit.com/#passing-arguments-to-hooks) is how to specify
+See [pre-commit](https://github.com/pre-commit/pre-commit) for more
+instructions. In particular,
+[here](https://pre-commit.com/#passing-arguments-to-hooks) is how to specify
 arguments in pre-commit config.
 
-## 3. The code style
+## 3. _Cercis_'s code style
 
-The code style in _Cercis_ is largely consistent with the
-[style of of _Black_](https://black.readthedocs.io/en/stable/the_black_code_style/current_style.html).
+_Cercis_'s code style is largely consistent with the
+[style of of Black](https://black.readthedocs.io/en/stable/the_black_code_style/current_style.html).
 
-The main difference is that _Cercis_ provides several configurable options that Black
-doesn't. That's also our main motivation of creating _Cercis_.
+The main difference is that _Cercis_ provides several configurable options that
+Black doesn't. Configurability is our main motivation behind creating _Cercis_.
 
 _Cercis_ offers the following configurable options:
 
-- [Extra indentation at function definition](#31-extra-indentation-at-function-definition)
-- [Single quote vs double quote](#32-single-quote-vs-double-quote)
-- ["Simple" lines with long strings](#33-simple-lines-with-long-strings)
+1. [Line length](#31-line-length)
+2. [Single quote vs double quote](#32-single-quote-vs-double-quote)
+3. [Extra indentation at function definition](#33-extra-indentation-at-function-definition)
+4. ["Simple" lines with long strings](#34-simple-lines-with-long-strings)
+5. [Collapse nested brackets](#35-collapse-nested-brackets)
+6. [Wrap pragma comments](#36-wrapping-long-lines-ending-with-pragma-comments)
+
+The next section ([How to configure _Cercis_](#4-how-to-configure-cercis))
+contains detailed instructions of how to configure these options.
+
+### 3.1. Line length
+
+_Cercis_ uses 79 characters as the line length limit, instead of 88 (Black's
+default).
+
+You can override this default if necessary.
+
+| Option                 |                                           |
+| ---------------------- | ----------------------------------------- |
+| Name                   | `--line-length`                           |
+| Abbreviation           | `-l`                                      |
+| Default                | 79                                        |
+| Black's default        | 88                                        |
+| Command line usage     | `cercis -l=120 myScript.py`               |
+| `pyproject.toml` usage | `line-length = 120` under `[tool.cercis]` |
+| `pre-commit` usage     | `args: [--line-length=120]`               |
 
-The next section ([How to configure _Cercis_](#4-how-to-configure-cercis)) contains
-detailed instructions of how to configure these options.
+### 3.2. Single quote vs double quote
+
+_Cercis_ uses single quotes (`'`) as the default for strings, instead of double
+quotes (`"`) which is Black's default.
+
+You can override this default if necessary.
 
-### 3.1. Extra indentation at function definition
+| Option                 |                                              |
+| ---------------------- | -------------------------------------------- |
+| Name                   | `--single-quote`                             |
+| Abbreviation           | `-sq`                                        |
+| Default                | `True`                                       |
+| Black's default        | `False`                                      |
+| Command line usage     | `cercis -sq=True myScript.py`                |
+| `pyproject.toml` usage | `single-quote = false` under `[tool.cercis]` |
+| `pre-commit` usage     | `args: [--single-quote=False]`               |
+
+### 3.3. Extra indentation at function definition
 
 <table>
   <tr>
     <td>
 
 ```python
 # Cercis's default style
@@ -169,123 +209,279 @@
 ```
 
   </td>
 
   </tr>
 </table>
 
-We choose to indent an extra 4 spaces because it adds a clear visual separation between
-the function name and the argument list. Not adding extra indentation is also called out
-as wrong in the the official
+We choose to indent an extra 4 spaces (8 in total) because it adds a clear
+visual separation between the function name and the argument list. Not adding
+extra indentation is also called out as wrong in the the official
 [PEP8 style guide](https://peps.python.org/pep-0008/#indentation).
 
-If you do not like this default, you can easily turn it off.
+You can override this default if necessary.
 
 | Option                 |                                                                 |
 | ---------------------- | --------------------------------------------------------------- |
 | Name                   | `--function-definition-extra-indent`                            |
 | Abbreviation           | `-fdei`                                                         |
 | Default                | `True`                                                          |
+| Black's default        | `False`                                                         |
 | Command line usage     | `cercis -fdei=False myScript.py`                                |
 | `pyproject.toml` usage | `function-definition-extra-indent = true` under `[tool.cercis]` |
 | `pre-commit` usage     | `args: [--function-definition-extra-indent=False]`              |
 
-### 3.2. Single quote vs double quote
-
-Both _Cercis_ and Black default to using double quotes. But in _Cercis_ you can specify
-using single quotes as the default style.
+### 3.4. "Simple" lines with long strings
 
-| Option                 |                                             |
-| ---------------------- | ------------------------------------------- |
-| Name                   | `--single-quote`                            |
-| Abbreviation           | `-sq`                                       |
-| Default                | `False`                                     |
-| Command line usage     | `cercis -sq=True myScript.py`               |
-| `pyproject.toml` usage | `single-quote = true` under `[tool.cercis]` |
-| `pre-commit` usage     | `args: [--single-quote=False]`              |
-
-### 3.3. "Simple" lines with long strings
-
-By default, Black wraps lines that exceed length limit. But for very simple lines (such
-as assigning a long string to a variable), line wrapping is not necessary.
-
-Also, as seen below, Black's default style can be a bit hard to predict (`var2` vs
-`var3`).
+By default, Black wraps lines that exceed length limit. But for very simple
+lines (such as assigning a long string to a variable), line wrapping is not
+necessary.
 
 <table>
   <tr>
     <td>
 
 ```python
 # Cercis's default style
-var1 = "not wrapped even if too long"
+# (Suppose line length limit is 30 chars)
+
+# Cercis doesn't wrap slightly long lines
+var1 = 'This line has 31 chars'
+
+
 
-var2 = "not wrapped even if too long"  # comment
+# Cercis doesn't wrap longer lines
+var2 = 'This line has 43 characters_______'
 
-var3 = "not wrapped, if the line gets too long"
+
+# Falls back to Black when comments present
+var3 = (
+    'shorter line'  # comment
+)
 ```
 
   </td>
 
   <td>
 
 ```python
 # Black's style (not configurable)
+# (Suppose line length limit is 30 chars)
+
+# Black wraps slightly long lines
 var1 = (
-    "wrapped when too long"
+    "This line has 31 chars"
 )
 
-var2 = (
-    "wrapped when too long"
-)  # comment
+# But Black doesn't wrap longer lines
+var2 = "This line has 43 characters_______"
 
-var3 = "not wrapped, if the line gets too long"
+
+# Black wraps comments like this:
+var3 = (
+    "shorter line"  # comment
+)
 ```
 
   </td>
 
   </tr>
 </table>
 
 | Option                 |                                                           |
 | ---------------------- | --------------------------------------------------------- |
 | Name                   | `--wrap-line-with-long-string`                            |
 | Abbreviation           | `-wl`                                                     |
 | Default                | `False`                                                   |
+| Black's default        | `True`                                                    |
 | Command line usage     | `cercis -wl=True myScript.py`                             |
 | `pyproject.toml` usage | `wrap-line-with-long-string = true` under `[tool.cercis]` |
 | `pre-commit` usage     | `args: [--wrap-line-with-long-string=False]`              |
 
+### 3.5. Collapse nested brackets
+
+_Cercis_ by default collapses nested brackets to make the code more compact.
+
+<table>
+  <tr>
+    <td>
+
+```python
+# Cercis's default style
+
+# If line length limit is 30
+value = np.array([
+    [1, 2, 3, 4, 5],
+    [6, 7, 8, 9, 0],
+])
+
+
+
+# If line length limit is 10
+value = function({
+    1,
+    2,
+    3,
+    4,
+    5,
+})
+
+
+```
+
+  </td>
+
+  <td>
+
+```python
+# Black's style (not configurable)
+
+# If line length limit is 30
+value = np.array(
+    [
+        [1, 2, 3, 4, 5],
+        [6, 7, 8, 9, 0],
+    ]
+)
+
+# If line length limit is 10
+value = function(
+    {
+        1,
+        2,
+        3,
+        4,
+        5,
+    }
+)
+```
+
+  </td>
+
+  </tr>
+</table>
+
+| Option                 |                                                         |
+| ---------------------- | ------------------------------------------------------- |
+| Name                   | `--collapse-nested-brackets`                            |
+| Abbreviation           | `-cnb`                                                  |
+| Default                | `True`                                                  |
+| Black's style          | `False`                                                 |
+| Command line usage     | `cercis -cnb=True myScript.py`                          |
+| `pyproject.toml` usage | `collapse-nested-brackets = true` under `[tool.cercis]` |
+| `pre-commit` usage     | `args: [--collapse-nested-brackets=False]`              |
+
+The code implementation of this option comes from
+[Pyink](https://github.com/google/pyink), another forked project from Black.
+
+### 3.6. Wrapping long lines ending with pragma comments [^](#3-cerciss-code-style)
+
+"Pragma comments", in this context, mean the directives for Python linters
+usually to tell them to ignore certain errors. Pragma comments that _Cercis_
+currently recognizes include:
+
+- _noqa_: `# noqa: E501`
+- _type: ignore_: `# type: ignore[no-untyped-def]`
+- _pylint_: `# pylint: disable=protected-access`
+- _pytype_: `# pytype: disable=attribute-error`
+
+<table>
+  <tr>
+    <td>
+
+```python
+# Cercis's default style
+# (Suppose line length limit is 30)
+
+# This line has 30 characters
+var = some_func(some_long_arg)  # noqa:F501
+
+# This line has 31 characters
+var_ = some_func(
+    some_long_arg
+)  # type: ignore
+
+# Cercis doesn't wraps a line if its main
+# content (without the comment) does not
+# exceed the line length limit.
+
+
+
+
+
+```
+
+  </td>
+
+  <td>
+
+```python
+# Black's style (not configurable)
+# (Suppose line length limit is 30)
+
+# Black doesn't wrap lines, no matter
+# how long, if the line has
+# a "# type: ignore..." comment.
+# (This line has 31 characters.)
+var_ = some_func(some_long_arg)  # type: ignore
+
+# Black does not recognize "# type:ignore",
+# even though mypy recognizes it.
+var_ = some_func(
+    some_long_arg
+)  # type:ignore
+
+# Black only recognizes "# type: ignore"
+var_ = some_func(
+    some_long_arg
+)  # noqa:F501
+```
+
+  </td>
+
+  </tr>
+</table>
+
+| Option                 |                                                     |
+| ---------------------- | --------------------------------------------------- |
+| Name                   | `--wrap-pragma-comments`                            |
+| Abbreviation           | `-wpc`                                              |
+| Default                | `False`                                             |
+| Black's style          | `True`                                              |
+| Command line usage     | `cercis -wpc=True myScript.py`                      |
+| `pyproject.toml` usage | `wrap-pragma-comments = true` under `[tool.cercis]` |
+| `pre-commit` usage     | `args: [--wrap-pragma-comments=False]`              |
+
 ## 4. How to configure _Cercis_
 
 ### 4.1. Dynamically in the command line
 
 Here are some examples:
 
 - `cercis --single-quote=True myScript.py` to format files to single quotes
-- `cercis --function-definition-extra-indent=False myScript.py` to format files without
-  extra indentation at function definition
-- `cercis --line-length=79 myScript.py` to format files with a line length of 79
-  characters
+- `cercis --function-definition-extra-indent=False myScript.py` to format files
+  without extra indentation at function definition
+- `cercis --line-length=79 myScript.py` to format files with a line length of
+  79 characters
 
 ### 4.2. In your project's `pyproject.toml` file
 
 You can specify the options under the `[tool.cercis]` section of the file:
 
 ```toml
 [tool.cercis]
 line-length = 88
 function-definition-extra-indent = true
 single-quote = false
 ```
 
 ### 4.3. In your project's `.pre-commit-config.yaml` file
 
-You can specify the options under the `args` section of your `.pre-commit-config.yaml`
-file.
+You can specify the options under the `args` section of your
+`.pre-commit-config.yaml` file.
 
 For example:
 
 ```yaml
 repos:
   - repo: https://github.com/jsh9/cercis
     rev: 0.1.0
@@ -295,39 +491,65 @@
   - repo: https://github.com/jsh9/cercis
     rev: 0.1.0
     hooks:
       - id: cercis-jupyter
         args: [--function-definition-extra-indent=False, --line-length=79]
 ```
 
-### 4.4. Specify options in `tox.ini`
-
-Currently, _Cercis_ does not support a config section in `tox.ini`. Instead, you can
-specify the options in `pyproject.toml`.
-# Change Log
-
-## [0.1.1] - 2023-05-03
+The value in `rev` can be any _Cercis_ release, or it can be `main`, which
+means to always use the latest (including unreleased) _Cercis_ features.
 
-### Added
+### 4.4. Specify options in `tox.ini`
 
-- A configurable option: `single-quote`, for formatting code into single quotes
+Currently, _Cercis_ does not support a config section in `tox.ini`. Instead,
+you can specify the options in `pyproject.toml`.
 
-### Full changelog
+### 4.5. How to reproduce Black's behavior
 
-- https://github.com/jsh9/cercis/compare/0.1.0...0.1.1
+If you'd like to reproduce Black's behavior, simply set all the configurable
+options in [Section 3](#3-cerciss-code-style) to Black's default values.
+# Change Log
 
-## [0.1.0] - 2023-04-30
+## [0.1.3] - 2023-05-07
 
-This is the initial version that branches away from Black (commit:
-[e712e4](https://github.com/psf/black/commit/e712e48e06420d9240ce95c81acfcf6f11d14c83))
+- Added
+  - A new configurable option: `--collapse-nested-brackets`
+  - A new configurable option: `--wrap-pragma-comments`
+  - Some Github workflow actions to make sure CHANGELOG.md is updated
+
+- Changed
+  - Changed the default quote to single quote
+  - Changed the default line length to 79 characters
+
+- Removed
+  - Some unrelated documentation and config files
+
+## [0.1.2] - 2023-05-04
+
+- Added
+  - Merged 2 changes from psf/black:main
+    ([#5](https://github.com/jsh9/cercis/pull/5))
+  - Added option to not wrap "simple" lines with long strings
+    ([#6](https://github.com/jsh9/cercis/pull/6))
+- Full changelog
+  - https://github.com/jsh9/cercis/compare/0.1.1...0.1.2
 
-### Changed
+## [0.1.1] - 2023-05-03
 
-- The default indentation within a function definition (when line wrap happens) is now 8
-  spaces. (Black's default is 4, which is
-  [not PEP8-compatible](https://github.com/psf/black/issues/1127))
-- Updated README, because `cercis` now branches away from Black
+- Added
+  - A configurable option: `single-quote`, for formatting code into single
+    quotes
+- Full changelog
+  - https://github.com/jsh9/cercis/compare/0.1.0...0.1.1
 
-### Added
+## [0.1.0] - 2023-04-30
 
-- A configurable option (`function-definition-extra-indent`) is added instead of
-  enforcing 8 spaces for everyone
+- This is the initial version that branches away from Black (commit:
+  [e712e4](https://github.com/psf/black/commit/e712e48e06420d9240ce95c81acfcf6f11d14c83))
+- Changed
+  - The default indentation within a function definition (when line wrap
+    happens) is now 8 spaces. (Black's default is 4, which is
+    [not PEP8-compatible](https://github.com/psf/black/issues/1127))
+  - Updated README, because `cercis` now branches away from Black
+- Added
+  - A configurable option (`function-definition-extra-indent`) is added instead
+    of enforcing 8 spaces for everyone
```

