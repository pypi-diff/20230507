# Comparing `tmp/usls-0.2.4-py3-none-any.whl.zip` & `tmp/usls-0.2.5-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,25 +1,22 @@
-Zip file size: 43787 bytes, number of entries: 23
--rwxrwxrwx  2.0 unx      171 b- defN 23-May-06 08:48 usls/__init__.py
--rwxrwxrwx  2.0 unx    11772 b- defN 23-May-06 08:48 usls/cli.py
--rwxrwxrwx  2.0 unx     2625 b- defN 23-May-06 08:48 usls/run.py
--rwxrwxrwx  2.0 unx      276 b- defN 23-May-06 08:48 usls/src/__init__.py
--rwxrwxrwx  2.0 unx     2171 b- defN 23-May-06 08:48 usls/src/class_modify.py
--rwxrwxrwx  2.0 unx     6119 b- defN 23-May-06 08:48 usls/src/cleanup.py
--rwxrwxrwx  2.0 unx     5530 b- defN 23-May-06 08:48 usls/src/deduplicate.py
--rwxrwxrwx  2.0 unx     2071 b- defN 23-May-06 08:48 usls/src/dir_combine.py
--rwxrwxrwx  2.0 unx     4010 b- defN 23-May-06 08:48 usls/src/info.py
--rwxrwxrwx  2.0 unx     3204 b- defN 23-May-06 08:48 usls/src/label_combine.py
--rwxrwxrwx  2.0 unx    34798 b- defN 23-May-06 08:48 usls/src/labelling.py
--rwxrwxrwx  2.0 unx        1 b- defN 23-May-06 08:48 usls/src/labelling_cls.py
--rwxrwxrwx  2.0 unx        1 b- defN 23-May-06 08:48 usls/src/labelling_det_2.py
--rwxrwxrwx  2.0 unx     2616 b- defN 23-May-06 08:48 usls/src/rename.py
--rwxrwxrwx  2.0 unx     3470 b- defN 23-May-06 08:48 usls/src/spider.py
--rwxrwxrwx  2.0 unx     7793 b- defN 23-May-06 08:48 usls/src/utils.py
--rwxrwxrwx  2.0 unx     9412 b- defN 23-May-06 08:48 usls/src/video_tools.py
--rwxrwxrwx  2.0 unx    35149 b- defN 23-May-06 08:50 usls-0.2.4.dist-info/LICENSE
--rwxrwxrwx  2.0 unx      540 b- defN 23-May-06 08:50 usls-0.2.4.dist-info/METADATA
--rwxrwxrwx  2.0 unx       92 b- defN 23-May-06 08:50 usls-0.2.4.dist-info/WHEEL
--rwxrwxrwx  2.0 unx       34 b- defN 23-May-06 08:50 usls-0.2.4.dist-info/entry_points.txt
--rwxrwxrwx  2.0 unx        5 b- defN 23-May-06 08:50 usls-0.2.4.dist-info/top_level.txt
-?rw-rw-r--  2.0 unx     1762 b- defN 23-May-06 08:50 usls-0.2.4.dist-info/RECORD
-23 files, 133622 bytes uncompressed, 40981 bytes compressed:  69.3%
+Zip file size: 43227 bytes, number of entries: 20
+-rw-r--r--  2.0 unx      256 b- defN 23-May-07 10:05 usls/__init__.py
+-rw-r--r--  2.0 unx    12485 b- defN 23-May-07 09:50 usls/cli.py
+-rw-r--r--  2.0 unx      276 b- defN 23-May-07 06:11 usls/src/__init__.py
+-rw-r--r--  2.0 unx     2171 b- defN 23-May-07 06:11 usls/src/class_modify.py
+-rw-r--r--  2.0 unx     6119 b- defN 23-May-07 06:11 usls/src/cleanup.py
+-rw-r--r--  2.0 unx     5518 b- defN 23-May-07 07:36 usls/src/deduplicate.py
+-rw-r--r--  2.0 unx     2071 b- defN 23-May-07 06:11 usls/src/dir_combine.py
+-rw-r--r--  2.0 unx     4010 b- defN 23-May-07 06:11 usls/src/info.py
+-rw-r--r--  2.0 unx     3204 b- defN 23-May-07 06:11 usls/src/label_combine.py
+-rw-r--r--  2.0 unx    35075 b- defN 23-May-07 10:00 usls/src/labelling.py
+-rw-r--r--  2.0 unx     2616 b- defN 23-May-07 06:11 usls/src/rename.py
+-rw-r--r--  2.0 unx     3462 b- defN 23-May-07 07:36 usls/src/spider.py
+-rw-r--r--  2.0 unx     9547 b- defN 23-May-07 10:05 usls/src/utils.py
+-rw-r--r--  2.0 unx     9396 b- defN 23-May-07 07:38 usls/src/video_tools.py
+-rw-r--r--  2.0 unx    35149 b- defN 23-May-07 10:09 usls-0.2.5.dist-info/LICENSE
+-rw-r--r--  2.0 unx      540 b- defN 23-May-07 10:09 usls-0.2.5.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 23-May-07 10:09 usls-0.2.5.dist-info/WHEEL
+-rw-r--r--  2.0 unx       34 b- defN 23-May-07 10:09 usls-0.2.5.dist-info/entry_points.txt
+-rw-r--r--  2.0 unx        5 b- defN 23-May-07 10:09 usls-0.2.5.dist-info/top_level.txt
+-rw-rw-r--  2.0 unx     1534 b- defN 23-May-07 10:09 usls-0.2.5.dist-info/RECORD
+20 files, 133560 bytes uncompressed, 40775 bytes compressed:  69.5%
```

## zipnote {}

```diff
@@ -1,16 +1,13 @@
 Filename: usls/__init__.py
 Comment: 
 
 Filename: usls/cli.py
 Comment: 
 
-Filename: usls/run.py
-Comment: 
-
 Filename: usls/src/__init__.py
 Comment: 
 
 Filename: usls/src/class_modify.py
 Comment: 
 
 Filename: usls/src/cleanup.py
@@ -27,44 +24,38 @@
 
 Filename: usls/src/label_combine.py
 Comment: 
 
 Filename: usls/src/labelling.py
 Comment: 
 
-Filename: usls/src/labelling_cls.py
-Comment: 
-
-Filename: usls/src/labelling_det_2.py
-Comment: 
-
 Filename: usls/src/rename.py
 Comment: 
 
 Filename: usls/src/spider.py
 Comment: 
 
 Filename: usls/src/utils.py
 Comment: 
 
 Filename: usls/src/video_tools.py
 Comment: 
 
-Filename: usls-0.2.4.dist-info/LICENSE
+Filename: usls-0.2.5.dist-info/LICENSE
 Comment: 
 
-Filename: usls-0.2.4.dist-info/METADATA
+Filename: usls-0.2.5.dist-info/METADATA
 Comment: 
 
-Filename: usls-0.2.4.dist-info/WHEEL
+Filename: usls-0.2.5.dist-info/WHEEL
 Comment: 
 
-Filename: usls-0.2.4.dist-info/entry_points.txt
+Filename: usls-0.2.5.dist-info/entry_points.txt
 Comment: 
 
-Filename: usls-0.2.4.dist-info/top_level.txt
+Filename: usls-0.2.5.dist-info/top_level.txt
 Comment: 
 
-Filename: usls-0.2.4.dist-info/RECORD
+Filename: usls-0.2.5.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## usls/__init__.py

```diff
@@ -1,15 +1,21 @@
 #!/usr/bin/env python
 # -*- coding:utf-8 -*- 
 
+__version__ = '0.2.5'
 
-__version__ = '0.2.4'
 
 from usls.cli import cli
-from usls.run import run
+from usls.src.utils import (
+	SmartDir, smart_path, TIMER, Palette
+)
+
 
 
 __all__ = [
 	'__version__', 
 	'cli',
-	'run', 
+	'SmartDir',
+	'smart_path',
+	'TIMER',
+	'Palette'
 ]
```

## usls/cli.py

```diff
@@ -6,52 +6,51 @@
 from enum import Enum, auto, unique
 from rich.panel import Panel
 from typing import Dict, List, Union, Optional, Any
 
 
 from usls import __version__
 from usls.src.utils import LOGGER, CONSOLE, IMG_FORMAT, LABEL_FORMAT, VIDEO_FORMAT
-from usls.run import run
+# ---------------------------------------------------------------------------------------------
+from usls.src.info import run_dir_info
+from usls.src.labelling import run_inspect
+from usls.src.cleanup import run_cleanup
+from usls.src.dir_combine import run_dir_combine
+from usls.src.spider import run_spider
+from usls.src.rename import run_rename
+from usls.src.deduplicate import run_deduplicate
+from usls.src.video_tools import run_v2is, run_vs2is, run_play 
+
+# TODO
+from usls.src.label_combine import combine_labels
+from usls.src.class_modify import class_modify
+# ---------------------------------------------------------------------------------------------
+
+
+
+def run(opt: DictConfig):
+    task_mapping = {
+        'info': run_dir_info,
+        'dir_combine': run_dir_combine,
+        'dir-combine': run_dir_combine,
+        'inspect': run_inspect,
+        'clean': run_cleanup,
+        'cleanup': run_cleanup,
+        'clean-up': run_cleanup,
+        'spider': run_spider,
+        'rename': run_rename,
+        'de-duplicate': run_deduplicate,
+        'de_duplicate': run_deduplicate,
+        'check': run_deduplicate,
+        'v2is': run_v2is,
+        'vs2is': run_vs2is,
+        'play': run_play,
+    }.get(opt.task)(opt)
 
 
-# # support task list
-# TASKS = (
-# 	'info', 
-# 	'inspect', 'inspect2',
-# 	'dir_combine', 
-# 	'label_combine',
-# 	'spider',
-# 	'clean', 
-# 	'cleanup',
-# 	'v2is',
-# 	'vs2is',
-# 	'play',
-# 	'is2v',
-# 	'classify',
-# 	'deduplicate',
-# 	'class_modify',
-# )
-
-
-# class TasksType(Enum):
-# 	info = 0
-# 	isnepct = auto()
-# 	isnepct2 = auto()
-# 	dir_combine = auto()
-# 	label_combine = auto()
-# 	spider = auto()
-# 	clean = auto()
-# 	cleanup = auto()
-# 	v2is = auto()
-# 	vs2is = auto()
-# 	play = auto()
-# 	is2v2 = auto()
-# 	classify = auto()
-# 	deduplicate = auto()
-# 	class_modify = auto()
 
 
 
 def cli() -> None:
 
 	if len(sys.argv) == 1:
 		sys.argv.append('-h')
@@ -460,15 +459,14 @@
 	# 	class-modify parser  
 	# ---------------------
 
 
 
 	# ---------------------
 	# 	inspect parser  ✅
-	# 	TODO: update 
 	# ---------------------
 	inspect_parser = subparsers.add_parser(
 		name='inspect', # aliases=['label-det'], 
 		help='Detection labelling'
 	)
 	inspect_parser.add_argument(
 		'--img-dir', '--dir',
@@ -481,15 +479,20 @@
 	inspect_parser.add_argument(
 		'--depreacated-dir', 
 		required=False, type=str, default="deprecated-images", help='deprecated image dir'
 	)
 	inspect_parser.add_argument('--classes', default='', nargs="+", required=True, type=str, help='label classes list')
 	inspect_parser.add_argument('--window-width', default=800, type=int, help='opencv windows width')
 	inspect_parser.add_argument('--window-height', default=600, type=int, help='opencv windows height')
-
+	inspect_parser.add_argument(
+		'--no-qt',
+		action='store_true',
+		required=False, 
+		help='without QT'
+	)
 
 	args = vars(parser.parse_args())
 	return args
```

## usls/src/deduplicate.py

```diff
@@ -9,15 +9,15 @@
 from omegaconf import OmegaConf, DictConfig
 from typing import Dict, List
 from PIL import Image, ImageOps
 import photohash
 
 from usls.src.utils import (
     CONSOLE, IMG_FORMAT, VIDEO_FORMAT, LABEL_FORMAT, 
-    increment_path, get_md5, verify_images, time_now
+    smart_path, get_md5, verify_images, time_now
 )
     
 
 
 def deduplicate(
         directory, 
         directory_duplicated, 
@@ -30,17 +30,17 @@
 
     # get files
     f_list = [x for x in Path(directory).iterdir() if x.suffix.lower() in IMG_FORMAT]
     CONSOLE.log(f"Find {len(f_list)} files (image file only: {IMG_FORMAT}).")
 
 
     # saveout directory: increment
-    directory_duplicated = increment_path(Path(directory_duplicated), exist_ok=False, sep='-')  # duplicated
+    directory_duplicated = smart_path(Path(directory_duplicated), exist_ok=False, sep='-')  # duplicated
     directory_duplicated.mkdir(parents=True, exist_ok=True)  # make dir
-    directory_deprecated = increment_path(Path(directory_deprecated), exist_ok=False, sep='-')  # deprecated
+    directory_deprecated = smart_path(Path(directory_deprecated), exist_ok=False, sep='-')  # deprecated
     directory_deprecated.mkdir(parents=True, exist_ok=True)  # make dir
 
 
     # way 1
     if simple:
         with CONSOLE.status("[bold green]Checking integrity & De-duplicating...") as status:
```

## usls/src/labelling.py

```diff
@@ -9,19 +9,19 @@
 import shutil
 import random
 import time
 import rich
 from omegaconf import OmegaConf, DictConfig
 from typing import List, Union, Dict, Optional
 from enum import Enum, auto
-from dataclasses import dataclass
+from dataclasses import dataclass, field
 
 from usls.src.utils import (
-    Colors, IMG_FORMAT, CONSOLE, natural_sort,
-    increment_path
+    Palette, IMG_FORMAT, CONSOLE, natural_sort,
+    smart_path
 )
 
 
 
 # help message
 HELP_MSG = '''
 Usage:
@@ -66,16 +66,20 @@
     x: Union[int, float]
     y: Union[int, float]
     z: Union[int, float, None] = None
 
 
 @dataclass
 class TlBr:
-    tl: Point = Point(-1, -1)
-    br: Point = Point(-1, -1)
+    # tl: Point = Point(-1, -1)
+    # br: Point = Point(-1, -1)
+    tl: Point = field(default_factory=lambda: Point(-1, -1))
+    br: Point = field(default_factory=lambda: Point(-1, -1))
+
+    
 
 
 class Labelling:
     def __init__(
         self, 
         dir_img, 
         dir_label,
@@ -164,30 +168,30 @@
 
         # mode trackbar
         # trackerbar_mode_name = list(InspectMode.__members__.keys())
         # cv2.createTrackbar(str(trackerbar_mode_name) + '\n', self.window_name, 0, len(trackerbar_mode_name), lambda: None)
         
         # info
         if self.with_QT:
-            cv2.createTrackbar('HHHHHHHhahahah', self.window_name, 0, 999, lambda x: None)
+            cv2.createTrackbar('>>>><<<<<<>>>><<<>>', self.window_name, 0, 999, lambda x: None)
 
 
         # images trackbar
         if self.with_QT and self.IMG_COUNT != 0:
             cv2.createTrackbar(self.trackerbar_img_name, self.window_name, 0, self.IMG_COUNT, self.set_img_index)   
 
 
         # class trackbar
         if self.with_QT and self.CLS_COUNT != 0:
             self.trackerbar_class_name = self.trackerbar_class_name + '\n' + str(classes) + '\n'
             cv2.createTrackbar(self.trackerbar_class_name, self.window_name, 0, self.CLS_COUNT, self.set_class_index)
 
 
         self.set_img_index(0)  # initialize the img index=0  !! entrypoint set CLS_IDX_CURRENT
-        self.COLOR_PALETTE = Colors(shuffle=False)    # colors palette
+        self.COLOR_PALETTE = Palette(shuffle=False)    # colors palette
         CONSOLE.log(f"{HELP_MSG}")  # help message
 
 
 
     def mainloop(self):
         # main loop
         while True:
@@ -204,24 +208,25 @@
             # current class index and it's class name
             class_name = self.CLASS_LIST[self.CLS_IDX_CURRENT]
             
             # current image path, relative path: img/img_1.jpg
             img_path = self.IMAGE_PATH_LIST[self.IMG_IDX_CURRENT]
             label_path = Path(self.dir_label) / (Path(img_path).stem + '.txt')  # get corresponding label path
             
-            # statusbar info
-            status_msg = (
-                f"Mode: {self.mode}" + "\t" * 8 + 
-                f"CURSOR: ({self.CURSOR})" + "\t" * 8 + 
-                f"NUM_BBOXES: {str(len(self.IMG_OBJECTS))}" + "\t" * 8 +
-                f"IMG RESOLUTION: ({img_height_current}, {img_width_current})" + "\t" * 5 +
-                f"IMAGE PATH: {Path(img_path).name}"  + "\t" * 10 + 
-                f"LABEL PATH: {Path(label_path).name}"  + "\t" * 10
-            )
-            cv2.displayStatusBar(self.window_name, status_msg)
+            if self.with_QT:
+                # statusbar info
+                status_msg = (
+                    f"Mode: {self.mode}" + "\t" * 8 + 
+                    f"CURSOR: ({self.CURSOR})" + "\t" * 8 + 
+                    f"NUM_BBOXES: {str(len(self.IMG_OBJECTS))}" + "\t" * 8 +
+                    f"IMG RESOLUTION: ({img_height_current}, {img_width_current})" + "\t" * 5 +
+                    f"IMAGE PATH: {Path(img_path).name}"  + "\t" * 10 + 
+                    f"LABEL PATH: {Path(label_path).name}"  + "\t" * 10
+                )
+                cv2.displayStatusBar(self.window_name, status_msg)
             
             # Blink bboxes
             # TODO: do_blinking()
             if self.DO_BLINKING:
 
                 if self.BLINK_OR_NOT_SWITCHER == False:
                     tmp_img, self.IMG_OBJECTS = self.draw_bboxes_from_file(
@@ -356,15 +361,15 @@
 
 
         # deal with wrong img: can not be opened by opencv
         if len(self.deprecated_img_set) > 0:
             CONSOLE.log(f"Warning: {len(self.deprecated_img_set)} images can not be read by OpenCV")
             
             # create dir
-            self.dir_deprecated = increment_path(Path(self.dir_deprecated), exist_ok=False, sep='-')  # increment run
+            self.dir_deprecated = smart_path(Path(self.dir_deprecated), exist_ok=False, sep='-')  # increment run
             self.dir_deprecated.mkdir(parents=True, exist_ok=True)  # make dir for every page
 
             # move
             for img in tqdm(self.deprecated_img_set, desc='moving deprecated...'):
                 shutil.move(img, str(self.dir_deprecated))
 
 
@@ -480,16 +485,16 @@
         # boundary check and rectify
         det_points.tl.x = min(max(eps, det_points.tl.x), img_w - eps) 
         det_points.br.x = max(min(img_w - eps, det_points.br.x), eps)
         det_points.tl.y = min(max(eps, det_points.tl.y), img_h - eps) 
         det_points.br.y = max(min(img_w - eps, det_points.br.y), eps)
 
         # check again
-        if (det_points.tl.x >= det_points.br.x) or (det_points.tl.y >= det_points.br.y):
-            raise ValueError(f'point of bottom-right {det_points.br} should greater than point of top-left {det_points.tl}')
+        # if (det_points.tl.x >= det_points.br.x) or (det_points.tl.y >= det_points.br.y):
+        #     raise ValueError(f'point of bottom-right {det_points.br} should greater than point of top-left {det_points.tl}')
 
         # convert
         cx = float((det_points.tl.x + det_points.br.x) / (2.0 * img_w) )
         cy = float((det_points.tl.y + det_points.br.y) / (2.0 * img_h))
         w = float(abs(det_points.br.x - det_points.tl.x)) / img_w
         h = float(abs(det_points.br.y - det_points.tl.y)) / img_h
 
@@ -646,14 +651,15 @@
         if self.mode == InspectMode.mark_dets:
             if event == cv2.EVENT_MOUSEMOVE:
                 self.CURSOR.x = x
                 self.CURSOR.y = y
 
             # left button double click -> select object
             elif event == cv2.EVENT_LBUTTONDBLCLK:
+                print(f'----> double click')
                 self.PRVE_WAS_DOUBLE_CLICK = True    
                 self.POINTS_DET.tl = Point(-1, -1)   # reset top_left point
 
                 # if clicked inside a bounding box we set that bbox
                 self.set_selected_bbox(set_cls_trackbar=True)
 
             # right button pressed down
@@ -780,15 +786,15 @@
         # ---------------------------------------
         elif pressed_key in (ord('='), ord('+')):
 
             # set the adjust flag TRUE
             self.LINE_THICKNESS_ADJUST = True
             
             # get the max line width
-            max_t = max(round(sum(tmp_img.shape) / 2 * 0.003), 2) + 5
+            max_t = max(round(sum(self.IMG_CURRENT.shape) / 2 * 0.003), 2) + 5
 
             # increate the line width
             if self.LINE_THICKNESS <= max_t:
                 self.LINE_THICKNESS += 1
                 if self.with_QT:
                     cv2.displayOverlay(self.window_name, f'Line Thickness +1, now = {self.LINE_THICKNESS}', 800)
             else:
@@ -849,18 +855,18 @@
 
 
 
         # ---------------------------------------
         # l/L  =>  shuffle bbox color
         # ---------------------------------------
         elif pressed_key in (ord('l'), ord('L')):
-            self.COLOR_PALETTE = Colors(shuffle=True)
+            self.COLOR_PALETTE = Palette(shuffle=True)
 
             if self.with_QT:
-                cv2.displayOverlay(self.window_name, f"Colors palette shuffled!", 800)
+                cv2.displayOverlay(self.window_name, f"Palette palette shuffled!", 800)
 
 
         # ---------------------------------------
         # t/T  =>  min line width
         # ---------------------------------------
         elif pressed_key in (ord('t'), ord('T')):
             self.MIN_LINE_WIDTH = not self.MIN_LINE_WIDTH
@@ -910,11 +916,11 @@
         dir_deprecated=args.depreacated_dir,
         classes=args.classes,
         window_width=args.window_width,
         window_height=args.window_height,
         window_name='usls labelling',
         trackerbar_img_name='IMAGES',
         trackerbar_class_name='CLASSES',
-        with_QT=True 
+        with_QT=not args.no_qt 
     )
     with CONSOLE.status("[bold cyan]Doing inspect...") as status:
         labelling.mainloop()
```

## usls/src/spider.py

```diff
@@ -5,15 +5,15 @@
 import rich
 import sys
 import re
 from omegaconf import OmegaConf, DictConfig
 from typing import Dict, List
 
 
-from usls.src.utils import CONSOLE, IMG_FORMAT, VIDEO_FORMAT, LABEL_FORMAT, increment_path
+from usls.src.utils import CONSOLE, IMG_FORMAT, VIDEO_FORMAT, LABEL_FORMAT, smart_path
 
 
 
 
 def spider_baidu_image(
 		words,
 		output_dir,
@@ -101,15 +101,15 @@
 				page_end.append(int(c[1]))
 				break
 
 
 	for i, word in enumerate(tqdm(words, desc='Downloading...')):
 
 		# saveout dir
-		save_dir = increment_path(Path(output_dir)/word, exist_ok=False, sep='-')  # increment run
+		save_dir = smart_path(Path(output_dir)/word, exist_ok=False, sep='-')  # increment run
 
 		# loop
 		for n in range(page_begin[i], page_end[i]):
 			
 			res = BaiduSpider().search_pic(word, n)  # spider
 			(save_dir / str(n)).mkdir(parents=True, exist_ok=True)  # make dir for every page
```

## usls/src/utils.py

```diff
@@ -18,25 +18,25 @@
 import contextlib
 import numpy as np
 from dataclasses import dataclass
 from typing import Union
 from PIL import ExifTags, Image, ImageOps
 import hashlib
 from loguru import logger as LOGGER
+import uuid
 
 
 CONSOLE = Console()
 IMG_FORMAT = ('.jpg', '.jpeg', '.png', '.bmp')
 LABEL_FORMAT = ('.txt', '.xml', '.yaml', '.csv')
 VIDEO_FORMAT = ('.mp4', '.flv', '.avi', '.mov')
 ASCII_LETTERS = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ'
 
 
 
-
 def time_now():
     return datetime.now().strftime('%Y-%m-%d %H:%M:%S')
 
 
 def get_md5(f):
     m = hashlib.md5(open(f,'rb').read())
     return m.hexdigest()
@@ -138,28 +138,51 @@
 def get_corresponding_label_path(img_path, output_dir):
     label_name = Path(img_path).stem + '.txt'
     saveout = Path(output_dir) / label_name 
     return str(saveout)
 
 
 
-class Colors:
-    '''
-        colors palette
-        # hex 颜色对照表    https://www.cnblogs.com/summary-2017/p/7504126.html
-        # RGB的数值 = 16 * HEX的第一位 + HEX的第二位
-        # RGB: 92, 184, 232 
-        # 92 / 16 = 5余12 -> 5C
-        # 184 / 16 = 11余8 -> B8
-        # 232 / 16 = 14余8 -> E8
-        # HEX = 5CB8E8
-    '''
+class TIMER(contextlib.ContextDecorator):
+
+    def __init__(self, prefix='Inspector', verbose=True):
+        self.prefix = prefix
+        self.verbose = verbose
+
+
+    def __enter__(self):
+        self.t0 = time.time()
+        return self
+
+
+    def __exit__(self, type, value, traceback):
+        self.duration = time.time() - self.t0
+        if self.verbose:
+            print(f"[{self.prefix}] --> {(time.time() - self.t0) * 1e3:.2f} ms.")
+
+
+    def __call__(self, func):
+        def wrapper(*args, **kwargs):
+            t0 = time.time()
+            ret = func(*args, **kwargs)
+            if self.verbose:
+                print(f"[{self.prefix}] --> {(time.time() - t0) * 1e3:.2f} ms.")
+
+            return ret
+        return wrapper
+
+
+
+
+class Palette:
+    """colors palette"""
+
     def __init__(self, shuffle=False):
-        hex_color = (
-            '33FF00', '9933FF', 'CC0000', 'FFCC00', '99FFFF', '3300FF', 'FF3333', # new add
+        _hex_colors = [
+            '33FF00', '9933FF', 'CC0000', 'FFCC00', '99FFFF', '3300FF',
             'FF3838', 'FF9D97', 'FF701F', 'FFB21D', 'CFD231', '48F90A', '92CC17', '3DDB86', 
             '1A9334', '00D4BB', '2C99A8', '00C2FF', '344593', '6473FF', '0018EC', '8438FF', 
             '520085', 'CB38FF', 'FF95C8', 'FF37C7', '#F0F8FF', '#4682B4', '#0000CD', '#9932CC',  
             '#FFB6C1', '#FFC0CB', '#DC143C', '#FFF0F5', '#DB7093', '#FF69B4', '#FF1493', '#C71585',  
             '#DDA0DD', '#EE82EE', '#FF00FF', '#FF00FF', '#8B008B', '#800080', '#BA55D3', '#9400D3',   
             '#8A2BE2', '#9370DB', '#7B68EE', '#6A5ACD', '#483D8B', '#E6E6FA', '#F8F8FF', '#0000FF', 
             '#00008B', '#000080', '#4169E1', '#6495ED', '#B0C4DE', '#778899', '#708090', '#1E90FF', 
@@ -172,53 +195,129 @@
             '#FFE4B5', '#FFA500', '#FFEFD5', '#FFEBCD', '#FFDEAD', '#FAEBD7', '#D2B48C', '#DEB887',
             '#FAF0E6', '#CD853F', '#FFDAB9', '#F4A460', '#D2691E', '#8B4513', '#FFF5EE', '#A0522D', 
             '#FF4500', '#E9967A', '#FF6347', '#FFE4E1', '#FA8072', '#FFFAFA', '#F08080', '#BC8F8F', 
             '#A52A2A', '#B22222', '#8B0000', '#800000', '#FFFFFF', '#F5F5F5', '#DCDCDC', '#D3D3D3', 
             '#191970', '#9932CC', '#00CED1', '#2F4F4F', '#C0C0C0', '#A9A9A9', '#CD5C5C', '#FF0000',
             '#FFA07A', '#FF7F50', '#FFE4C4', '#FF8C00', '#FDF5E6', '#F5DEB3', '#FFFF00', '#808000',
             '#008000', '#006400', '#00FF7F', '#3CB371', '#4B0082',
-        )
+        ]
         
         # shuffle color 
         if shuffle:
-            hex_list = list(hex_color)
-            random.shuffle(hex_list)
-            hex_color = tuple(hex_list)
+            random.shuffle(_hex_colors)
 
-        self.palette = [self.hex2rgb(c) if c.startswith('#') else self.hex2rgb('#' + c) for c in hex_color]
+        self.palette = [self.hex2rgb(c) if c.startswith('#') else self.hex2rgb('#' + c) for c in _hex_colors]
         self.n = len(self.palette)
 
 
-    def __call__(self, i, bgr=False):        
+    def __call__(self, i, bgr=False):    
+        """ int -> rgb color """    
         c = self.palette[int(i) % self.n]
         return (c[2], c[1], c[0]) if bgr else c
 
     @staticmethod  
-    def hex2rgb(h):  # int('CC', base=16) hex -> 10
+    def hex2rgb(h):
+        """
+        int('CC', base=16) hex -> 10
+        RGB的数值 = 16 * HEX的第一位 + HEX的第二位
+        RGB: 92, 184, 232 
+        92 / 16 = 5余12 -> 5C
+        184 / 16 = 11余8 -> B8
+        232 / 16 = 14余8 -> E8
+        HEX = 5CB8E8
+        """
         return tuple(int(h[1 + i:1 + i + 2], 16) for i in (0, 2, 4))
 
 
 
+def smart_path(path='', *, exist_ok=False, sep='-', mkdir=False, method=0):
+    # Increment file or directory path
 
-def increment_path(path, exist_ok=False, sep='', mkdir=False):
-    # Increment file or directory path, i.e. runs/exp --> runs/exp{sep}2, runs/exp{sep}3, ... etc.
-    # Usage:
-    '''
-    save_dir = increment_path(Path(project) / name, exist_ok=False, sep='-')  # increment run
-    save_dir.mkdir(parents=True, exist_ok=True)  # make dir 中间目录存在不报错
-    '''
+    # random string in currnet path
+    if path == '':
+        if method == 0:
+            _ASCII_LETTERS = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ'
+            path = Path.cwd() / (''.join(random.choices(_ASCII_LETTERS, k=8)))
+        elif method == 1:
+            path = Path.cwd() / str(uuid.uuid4())
+        elif method == 2:
+             path = Path.cwd() / datetime.now().strftime('%Y-%m-%d-%H-%M-%S')
     path = Path(path)  # os-agnostic
+
+    # make increment
     if path.exists() and not exist_ok:
         path, suffix = (path.with_suffix(''), path.suffix) if path.is_file() else (path, '')
-        dirs = glob.glob(f"{path}{sep}*")  # similar paths
-        matches = [re.search(rf"%s{sep}(\d+)" % path.stem, d) for d in dirs]
-        i = [int(m.groups()[0]) for m in matches if m]  # indices
-        n = max(i) + 1 if i else 2  # increment number
-        path = Path(f"{path}{sep}{n}{suffix}")  # increment path
+
+        # increment path
+        for n in range(2, 9999):
+            p = f'{path}{sep}{n}{suffix}'  
+            if not os.path.exists(p):  # non-exist will break
+                break
+        path = Path(p)
+
+        # path, suffix = (path.with_suffix(''), path.suffix) if path.is_file() else (path, '')
+        # dirs = glob.glob(f"{path}{sep}*")  # similar paths
+        # matches = [re.search(rf"%s{sep}(\d+)" % path.stem, d) for d in dirs]
+        # i = [int(m.groups()[0]) for m in matches if m]  # indices
+        # n = max(i) + 1 if i else 2  # increment number
+        # path = Path(f"{path}{sep}{n}{suffix}")  # increment path
+
+    # make dir directly
     if mkdir:
         path.mkdir(parents=True, exist_ok=True)  # make directory
+
+
     return path
 
 
 
 
 
+class SmartDir:
+
+    def __init__(
+            self, 
+            path,
+            # *, 
+        ):
+        self.path = Path(path)
+
+
+
+    def file_type(self):
+        # hidden file
+        # executable file
+        # normal file
+        ...
+
+
+    def info(self):
+        # parse dir info
+        ...
+
+    def clean_empty_dir():
+        ...
+
+
+    def get_file_by_fmt(self):
+        ...
+
+
+    def combine(self):
+        ...
+
+
+    def rename_content(self):
+        # rename 
+        ...
+
+
+    def cleanup(self):
+        # clean up dir
+        ...
+
+
+    def de_duplicate(self):
+        # de-duplicate
+        ...
+
+
```

## usls/src/video_tools.py

```diff
@@ -5,15 +5,15 @@
 import argparse
 from pathlib import Path
 import sys
 from omegaconf import OmegaConf, DictConfig
 from datetime import datetime
 
 
-from usls.src.utils import CONSOLE, IMG_FORMAT, VIDEO_FORMAT, LABEL_FORMAT, increment_path
+from usls.src.utils import CONSOLE, IMG_FORMAT, VIDEO_FORMAT, LABEL_FORMAT, smart_path
 
 
 
 def play_and_record(
         source,
         delay=1, 
         flip=None,
@@ -71,15 +71,15 @@
 
     # record flag
     do_rec = record
 
     # rec 
     if do_rec:
         CONSOLE.log(f"Rec...")
-        save_dir = increment_path(
+        save_dir = smart_path(
             Path(output_dir) / datetime.now().strftime('%Y-%m-%d-%H-%M-%S'), 
             exist_ok=False, 
             sep='-'
         )  # increment dir
         save_dir.mkdir(parents=True, exist_ok=True)
         saveout = save_dir / 'rec.mp4' 
         video_writer = cv2.VideoWriter(str(saveout), fourcc_, fps, (w, h))  # build video writer
@@ -140,15 +140,15 @@
             if key == ord('r'):
                 do_rec = not do_rec   # ~  
 
                 # rec 
                 if do_rec:
                     CONSOLE.log(f"Rec...")
 
-                    save_dir = increment_path(
+                    save_dir = smart_path(
                         Path(output_dir) / datetime.now().strftime('%Y-%m-%d-%H-%M-%S'), 
                         exist_ok=False, 
                         sep='-'
                     )  # increment dir
                     save_dir.mkdir(parents=True, exist_ok=True)
                     saveout = save_dir / 'rec.mp4' 
                     video_writer = cv2.VideoWriter(str(saveout), fourcc_, fps, (w, h))
@@ -218,15 +218,15 @@
 
 
 
     # frame count
     idx = 0 
 
     # save_dir 
-    save_dir = increment_path(
+    save_dir = smart_path(
         Path(output_dir) / image_dir,
         exist_ok=False, 
         sep='-'
     )  # increment run
     save_dir.mkdir(parents=True, exist_ok=True)  # make dir
```

## Comparing `usls-0.2.4.dist-info/LICENSE` & `usls-0.2.5.dist-info/LICENSE`

 * *Files identical despite different names*

## Comparing `usls-0.2.4.dist-info/METADATA` & `usls-0.2.5.dist-info/METADATA`

 * *Files 15% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: usls
-Version: 0.2.4
+Version: 0.2.5
 Summary: Useless CV toolkits
 Home-page: https://github.com/jamjamjon/usls
 Author: jamjamjon
 License: GPL-3.0
 Requires-Python: >=3.9
 Description-Content-Type: text/markdown
 License-File: LICENSE
```

## Comparing `usls-0.2.4.dist-info/RECORD` & `usls-0.2.5.dist-info/RECORD`

 * *Files 16% similar despite different names*

```diff
@@ -1,23 +1,20 @@
-usls/__init__.py,sha256=WgRAll4dPMlT1JOSl3EGCqXElRj_ZFGv9rWVRUMZqz0,171
-usls/cli.py,sha256=tChIen0X0Crs6PKFhWADxfp0KYDd0M9LfxeAxCqbIXw,11772
-usls/run.py,sha256=jwpzTJ6v1pWe39iMY8mpK-7OQ9BQOx1hkdhSpe_rd48,2625
+usls/__init__.py,sha256=5f4GnvcJh9-H--K448SdJTlBIs5TOfqv17HjxxDzdUc,256
+usls/cli.py,sha256=6KW57Z5r3x4uxi2JT8KVtzVJEWpW6SAR67PSxX1dsRA,12485
 usls/src/__init__.py,sha256=x_CWzE-z_jOmeRTUbEjDZ7jMmw1vc2ZYes2ztGRYWyg,276
 usls/src/class_modify.py,sha256=MVwj18Z47GV67EfLv77wEKMfRLT2DgOmckQPFQQkU2I,2171
 usls/src/cleanup.py,sha256=owKLqy3pUI9O7e1FiIJz2JWKl4Y0bLlbdZYccZmPFtk,6119
-usls/src/deduplicate.py,sha256=7Uaq4QScnOVPVMWRZiG1eBXorg9oF6SWjJklsL6rc_w,5530
+usls/src/deduplicate.py,sha256=JyPoGQEySFVgMmabDOtxRvd16Y3-W0rk8y4BXuiqkFk,5518
 usls/src/dir_combine.py,sha256=7xlIFvksHWn53awmp_0jCFbJPbglTEsRiWIgrFNZFwo,2071
 usls/src/info.py,sha256=bYY6yaWDGnv1Fz5E2tBNCKaqKVQbxEom1Ba8vHGrNqA,4010
 usls/src/label_combine.py,sha256=T99nvA4fcHt94cCV9zZVPJvmgj_Lus-5H3lowCbp9So,3204
-usls/src/labelling.py,sha256=L2NF_ASvNnsCROr0OqoyGFWnur0zWczC-XmVqskd4yw,34798
-usls/src/labelling_cls.py,sha256=AbpHGcgLb-kRsJGnwFEktk7uzpZOCcBY74-YBdrKVGs,1
-usls/src/labelling_det_2.py,sha256=AbpHGcgLb-kRsJGnwFEktk7uzpZOCcBY74-YBdrKVGs,1
+usls/src/labelling.py,sha256=FRtd2RA_xOkMXB7jLmdJF4v0C7VzLwCUpvZd4W3Jun0,35075
 usls/src/rename.py,sha256=2vqbHZUCjuxVOwM99Mz8Mng9SQ6Li0SE2HQxa7yq9k8,2616
-usls/src/spider.py,sha256=g70JjlPX5H2qOjMrmdHspaW9lki9kVIprEBtV49lD8M,3470
-usls/src/utils.py,sha256=QQAqlRjNbsnoyTqot63cMnNioUGOBpOGwmXqGDKCfmM,7793
-usls/src/video_tools.py,sha256=NxKNndtCOBldES3XEXRDAjflQKMznNg6kJS7iTBjJUs,9412
-usls-0.2.4.dist-info/LICENSE,sha256=OXLcl0T2SZ8Pmy2_dmlvKuetivmyPd5m1q-Gyd-zaYY,35149
-usls-0.2.4.dist-info/METADATA,sha256=FeUxPw5ZAvSNYFjxlNQYRkJAspIrOI4Oabf-cdzBGMI,540
-usls-0.2.4.dist-info/WHEEL,sha256=2wepM1nk4DS4eFpYrW1TTqPcoGNfHhhO_i5m4cOimbo,92
-usls-0.2.4.dist-info/entry_points.txt,sha256=NtT7OjVpekraB5xlzXzTbTQ9q8VOKMUrByrtciZMJms,34
-usls-0.2.4.dist-info/top_level.txt,sha256=oS7b-J2DgqOuJIQaKnSyirCC_Rt6yeQCLkbNqh2H_DM,5
-usls-0.2.4.dist-info/RECORD,,
+usls/src/spider.py,sha256=RKU2xcopolQx2Sae_J4J7-TDXVkfwkgfAg7llA3piWU,3462
+usls/src/utils.py,sha256=S7-S9qbae3VD-ON4vQZRgnxGr4v1TBZpyVTz5Q4Qulk,9547
+usls/src/video_tools.py,sha256=EKx3Zg1Vg6A-8HjuH4s9oPBxYS2upSkbDGQpwdlGIng,9396
+usls-0.2.5.dist-info/LICENSE,sha256=OXLcl0T2SZ8Pmy2_dmlvKuetivmyPd5m1q-Gyd-zaYY,35149
+usls-0.2.5.dist-info/METADATA,sha256=jvhtt9TjFI4cesOuD_QR3_313WkZIkjf-LRPBnvAajw,540
+usls-0.2.5.dist-info/WHEEL,sha256=pkctZYzUS4AYVn6dJ-7367OJZivF2e8RA9b_ZBjif18,92
+usls-0.2.5.dist-info/entry_points.txt,sha256=NtT7OjVpekraB5xlzXzTbTQ9q8VOKMUrByrtciZMJms,34
+usls-0.2.5.dist-info/top_level.txt,sha256=oS7b-J2DgqOuJIQaKnSyirCC_Rt6yeQCLkbNqh2H_DM,5
+usls-0.2.5.dist-info/RECORD,,
```

